<?xml version="1.0" encoding="utf-8"?>
<search> 
  
    
    <entry>
      <title><![CDATA[Kotlinä½¿ç”¨æŠ€å·§ä¸€-æ¥å£ä¸å‘½åå‚æ•°çš„ä¼˜é›…è¿ç”¨]]></title>
      <url>/Kotlin%E4%BD%BF%E7%94%A8%E6%8A%80%E5%B7%A7%E4%B8%80-%E6%8E%A5%E5%8F%A3%E4%B8%8E%E5%91%BD%E5%90%8D%E5%8F%82%E6%95%B0%E7%9A%84%E4%BC%98%E9%9B%85%E8%BF%90%E7%94%A8.html</url>
      <content type="html"><![CDATA[<p><strong>ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºåšä¸»åŸåˆ›æ–‡ç« ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„(www.huangjie.name)ï¼Œä¿æŠ¤åŸåˆ›ï¼Œä»æˆ‘åšèµ·.</strong></p>
<hr>
<blockquote>
<p>æ–‡ç« é¦–å‘äºæˆ‘çš„<a href="https://www.jianshu.com/u/2334b8b9f764" target="_blank" rel="noopener">ç®€ä¹¦</a>,æœ¬å¤„åªåšæ•´ç†å½’æ¡£ç”¨<br><a id="more"></a></p>
</blockquote>
<h3 id="æŠ›å‡ºé—®é¢˜"><a href="#æŠ›å‡ºé—®é¢˜" class="headerlink" title="æŠ›å‡ºé—®é¢˜"></a>æŠ›å‡ºé—®é¢˜</h3><p>çœ‹è¿‡æˆ‘çš„<a href="https://www.jianshu.com/p/35c91abaae44" target="_blank" rel="noopener">Kotlin-é«˜é˜¶å‡½æ•°çš„ä½¿ç”¨(äºŒ)</a>éƒ½çŸ¥é“ï¼Œæˆ‘ä»¬çš„<code>setOnClickListener</code>å¯ä»¥è¿™æ ·å†™ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">view.setOnClickListener &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>ä½†æ˜¯å½“æ¥å£æœ‰å¤šä¸ªå®ç°æ–¹æ³•çš„æ—¶å€™æˆ‘ä»¬å¯èƒ½å°±éœ€è¦è¿™æ ·å®ç°äº†ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">edittext.addTextChangedListener(object :TextWatcher&#123;</span><br><span class="line">            override fun afterTextChanged(s: Editable?) &#123;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            override fun beforeTextChanged(s: CharSequence?, start: Int, count: Int, after: Int) &#123;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            override fun onTextChanged(s: CharSequence?, start: Int, before: Int, count: Int) &#123;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;)</span><br></pre></td></tr></table></figure></p>
<p>é€šå¸¸æˆ‘ä»¬åªéœ€è¦åœ¨<code>onTextChanged</code>é‡Œæ‰§è¡Œä¸€äº›é€»è¾‘ï¼Œå…¶ä½™çš„æ–¹æ³•ç”¨ä¸åˆ°ï¼Œè¿™æ ·å°±æ˜¾å¾—å¾ˆä¸ä¼˜é›…äº†ï¼Œé‚£æœ‰æ²¡æœ‰åŠæ³•æ˜¾å¾—æ›´åŠ çš„ä¼˜é›…å‘¢,ç­”æ¡ˆè‚¯å®šæ˜¯æœ‰å“’~~~</p>
<h3 id="è§£å†³é—®é¢˜"><a href="#è§£å†³é—®é¢˜" class="headerlink" title="è§£å†³é—®é¢˜"></a>è§£å†³é—®é¢˜</h3><h4 id="1-ä½¿ç”¨æ‰©å±•å‡½æ•°å°è£…å¯¹åº”çš„æ–¹æ³•"><a href="#1-ä½¿ç”¨æ‰©å±•å‡½æ•°å°è£…å¯¹åº”çš„æ–¹æ³•" class="headerlink" title="1.ä½¿ç”¨æ‰©å±•å‡½æ•°å°è£…å¯¹åº”çš„æ–¹æ³•"></a>1.ä½¿ç”¨æ‰©å±•å‡½æ•°å°è£…å¯¹åº”çš„æ–¹æ³•</h4><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ‰©å±•æ–¹æ³•å†…éƒ¨å®ç°3ä¸ªæ–¹æ³•ï¼Œç„¶åè®©å…¶ä¸­ä¸€ä¸ªæ–¹æ³•<code>invoke</code>å‡ºå»ï¼Œå®ç°ä¹‹ååƒè¿™æ ·ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">edittext.onTextChanged &#123; s, start, before, count -&gt;</span><br><span class="line">            </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>å®ç°ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">fun EditText.onTextChanged(changed:(s: CharSequence?, start: Int, before: Int, count: Int)-&gt;Unit)&#123;</span><br><span class="line">     addTextChangedListener(object : TextWatcher&#123;</span><br><span class="line">         override fun afterTextChanged(s: Editable?) &#123;</span><br><span class="line">         &#125;</span><br><span class="line"></span><br><span class="line">         override fun beforeTextChanged(s: CharSequence?, start: Int, count: Int, after: Int) &#123;</span><br><span class="line">         &#125;</span><br><span class="line"></span><br><span class="line">         override fun onTextChanged(s: CharSequence?, start: Int, before: Int, count: Int) &#123;</span><br><span class="line">             changed(s,start,before, count)</span><br><span class="line">         &#125;</span><br><span class="line"></span><br><span class="line">     &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>è¿™é‡Œæˆ‘å‡è®¾ä½ å·²ç»ç†è§£äº†æ‰©å±•å‡½æ•°çš„ä½¿ç”¨ï¼Œå¦‚æœçœ‹ä¸å¤ªæ‡‚ï¼Œå¯ä»¥å…ˆçœ‹çœ‹æˆ‘çš„è¿™ç¯‡æ–‡ç« <a href="https://www.jianshu.com/p/7a771317ab74" target="_blank" rel="noopener">Kotlin-é«˜é˜¶å‡½æ•°çš„ä½¿ç”¨(ä¸€)</a></p>
</blockquote>
<p>ä»£ç ä¸€ä¸‹å­æ¸…çˆ½èµ·æ¥äº†ï¼Œå¹¶ä¸”æˆ‘å¯ä»¥ä¸“æ³¨äºä¸€ä¸ªæ–¹æ³•é€»è¾‘çš„å®ç°ï¼Œä½†æ˜¯æœ‰ä¸€ä¸ªç¼ºç‚¹ï¼Œä¸‡ä¸€æˆ‘éœ€è¦åœ¨<code>beforeTextChanged</code>é‡Œå®ç°ä¸€äº›é€»è¾‘å‘¢ï¼Œä¸‡ä¸€æˆ‘æƒ³å®ç°å…¶ä»–çš„æ–¹æ³•å‘¢ï¼Œæœ‰äººä¼šè¯´æˆ‘å†ç”³æ˜ä¸€ä¸ª<code>beforeTextChanged</code>çš„æ‰©å±•æ–¹æ³•å•Šï¼Œç„¶ååƒè¿™æ ·ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"> edittext.onTextChanged &#123; s, start, before, count -&gt;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">edittext.beforeTextChanged&#123;s, start, count, after-&gt;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>è¿™æ ·å†™å®é™…ä¸Šæ˜¯ç”³æ˜äº†ä¸¤ä¸ªç›‘å¬ï¼Œ<code>onTextChanged</code>æ˜¯ä¼šå¤±æ•ˆçš„ï¼Œæ‰€ä»¥è¿™ç§æ–¹æ¡ˆpassã€‚æˆ‘ä»¬å¯ä»¥æƒ³åˆ°åœ¨ä¸€ä¸ªæ–¹æ³•é‡Œç”³æ˜å¤šä¸ª<code>lambda</code>ï¼Œè²Œä¼¼è§£å†³äº†é—®é¢˜ï¼Œäºæ˜¯å°±åƒè¿™æ ·ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">edittext.addTextChangedListener(&#123; s -&gt;</span><br><span class="line"></span><br><span class="line">       &#125;, &#123; s, start, count, after -&gt;</span><br><span class="line"></span><br><span class="line">       &#125;, &#123; s, start, before, count-&gt;</span><br><span class="line"></span><br><span class="line">       &#125;)</span><br></pre></td></tr></table></figure></p>
<p>å®ç°ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">fun EditText.addTextChangedListener(after:(s: Editable?)-&gt;Unit,before:(s: CharSequence?, start: Int, count: Int, after: Int)-&gt;Unit,</span><br><span class="line">                                    changed: (s: CharSequence?, start: Int, before: Int, count: Int) -&gt; Unit)&#123;</span><br><span class="line">    addTextChangedListener(object : TextWatcher&#123;</span><br><span class="line">        override fun afterTextChanged(s: Editable?) &#123;</span><br><span class="line">            after(s)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        override fun beforeTextChanged(s: CharSequence?, start: Int, count: Int, after: Int) &#123;</span><br><span class="line">            before(s, start, count, after)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        override fun onTextChanged(s: CharSequence?, start: Int, before: Int, count: Int) &#123;</span><br><span class="line">            changed(s,start,before, count)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>æˆ‘æ»´å¦ˆï¼Œè¿™å•¥è·Ÿå•¥ï¼Œè°è¦æ˜¯è¿™ä¹ˆå†™ä¼°è®¡å‡ºé—¨ä¼šè¢«æ‰“ã€‚å…¶å®è¿™ç§æ€è·¯æ˜¯å¯¹çš„ï¼Œä½†æ˜¯å¯èƒ½æ•²å‡ºæ¥çš„ä»£ç ä»–æœ‰è‡ªå·±çš„æƒ³æ³•â€¦..</p>
<h4 id="2-ä½¿ç”¨å‘½åå‚æ•°å’Œé»˜è®¤å€¼è§£å†³lambdaæ–¹æ³•åŒºåˆ†é—®é¢˜"><a href="#2-ä½¿ç”¨å‘½åå‚æ•°å’Œé»˜è®¤å€¼è§£å†³lambdaæ–¹æ³•åŒºåˆ†é—®é¢˜" class="headerlink" title="2.ä½¿ç”¨å‘½åå‚æ•°å’Œé»˜è®¤å€¼è§£å†³lambdaæ–¹æ³•åŒºåˆ†é—®é¢˜"></a>2.ä½¿ç”¨å‘½åå‚æ•°å’Œé»˜è®¤å€¼è§£å†³lambdaæ–¹æ³•åŒºåˆ†é—®é¢˜</h4><p>æˆ‘ä»¬çŸ¥é“ä¸Šé¢é‚£ç§å®ç°çš„ç¼ºç‚¹å°±æ˜¯æ–¹æ³•ä¸æ˜“åŒºåˆ†ï¼Œsoï¼Œæˆ‘ä»¬åªéœ€è¦åŠ å…¥ä¸€ä¸ªå‘½åå‚æ•°å°±è§£å†³é—®é¢˜å•¦ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">edittext.addTextChangedListener(</span><br><span class="line">        after = &#123; s -&gt;</span><br><span class="line"></span><br><span class="line">        &#125;,</span><br><span class="line">        before = &#123; s, start, count, after -&gt;</span><br><span class="line"></span><br><span class="line">        &#125;,</span><br><span class="line">        changed = &#123; s, start, before, count -&gt;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure></p>
<p>å®ç°ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">inline fun EditText.addTextChangedListener(crossinline after:(s: Editable?)-&gt;Unit,</span><br><span class="line">                                           crossinline before:(s: CharSequence?, start: Int, count: Int, after: Int)-&gt;Unit,</span><br><span class="line">                                           crossinline changed: (s: CharSequence?, start: Int, before: Int, count: Int) -&gt; Unit)&#123;</span><br><span class="line">    addTextChangedListener(object : TextWatcher&#123;</span><br><span class="line">        override fun afterTextChanged(s: Editable?) &#123;</span><br><span class="line">            after(s)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        override fun beforeTextChanged(s: CharSequence?, start: Int, count: Int, after: Int) &#123;</span><br><span class="line">            before(s, start, count, after)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        override fun onTextChanged(s: CharSequence?, start: Int, before: Int, count: Int) &#123;</span><br><span class="line">            changed(s,start,before, count)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>ä½¿ç”¨<code>crossinline</code>å…³é”®å­—æ¥è§„å®šå‘½åå‚æ•°ï¼Œä½†å¿…é¡»ç”³æ˜æ–¹æ³•ä¸º<code>inline</code>,å…³äºå†…è”ï¼Œè¯¦è§<a href="https://www.kotlincn.net/docs/reference/inline-functions.html" target="_blank" rel="noopener">å®˜æ–¹æ–‡æ¡£</a></p>
</blockquote>
<p>è¿™æ ·çœ‹èµ·æ¥å°±æ¸…æ™°å¤šäº†ï¼Œæ¯ä¸ª<code>lambda</code>å¯¹åº”ä»€ä¹ˆæ–¹æ³•ä¸€ç›®äº†ç„¶ï¼Œä½†æ˜¯ï¼Œå›åˆ°æˆ‘ä»¬æœ€åˆè¯´çš„ï¼Œæˆ‘ä»¬æœ‰æ—¶åªéœ€è¦å…¶ä¸­çš„ä¸€ä¸ªæ–¹æ³•çš„ï¼Œè¿™æ ·è¿˜æ˜¯è¦ç”³æ˜3ä¸ªæ–¹æ³•å‘€ï¼Œåˆ«æ€¥ï¼ŒåŠ ä¸ªé»˜è®¤å€¼æå®šï¼š<br>å®ç°:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">inline fun EditText.addTextChangedListener(crossinline after:(s: Editable?)-&gt;Unit=&#123;&#125;,</span><br><span class="line">                                           crossinline before:(s: CharSequence?, start: Int, count: Int, after: Int)-&gt;Unit=&#123;</span><br><span class="line">                                               _, _, _, _ -&gt; </span><br><span class="line">                                           &#125;,</span><br><span class="line">                                           crossinline changed: (s: CharSequence?, start: Int, before: Int, count: Int) -&gt; Unit=&#123;</span><br><span class="line">                                               _, _, _, _ -&gt;</span><br><span class="line">                                           &#125;)&#123;</span><br><span class="line">    addTextChangedListener(object : TextWatcher&#123;</span><br><span class="line">        override fun afterTextChanged(s: Editable?) &#123;</span><br><span class="line">            after(s)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        override fun beforeTextChanged(s: CharSequence?, start: Int, count: Int, after: Int) &#123;</span><br><span class="line">            before(s, start, count, after)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        override fun onTextChanged(s: CharSequence?, start: Int, before: Int, count: Int) &#123;</span><br><span class="line">            changed(s,start,before, count)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>ä½¿ç”¨ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">edittext.addTextChangedListener(</span><br><span class="line">        changed = &#123; s, start, before, count -&gt;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure></p>
<p>è¿™æ ·çœ‹èµ·æ¥å°±èˆ’æœå¤šäº†ï¼Œæ—¢è¾¾åˆ°äº†ç”³æ˜å•ä¸ªå¤šä¸ªå®ç°çš„çµæ´»é€‰æ‹©ï¼Œåˆè¾¾åˆ°äº†æ–¹æ³•åçš„å‘½ååŒºåˆ†ï¼Œæ„Ÿè§‰äººç”Ÿå·²ç»åˆ°è¾¾äº†å·…å³°æœ‰æœ¨æœ‰ï¼ï¼</p>
<blockquote>
<p>æˆ‘ä»¬çŸ¥é“å¦‚æœæ–¹æ³•ç”³æ˜äº†é»˜è®¤å€¼ï¼Œé‚£ä¹ˆè¿™ä¸ªå‚æ•°å¯ä»¥ä¸ç”³æ˜ï¼Œæˆ‘ä»¬æ­£æ˜¯åˆ©ç”¨äº†è¿™ä¸ªç‰¹æ€§æ¥è¾¾åˆ°çš„æ•ˆæœ,å…³äºè¿™ä¸ªç‰¹æ€§ä¹Ÿå¯ä»¥ç”¨åˆ°æ¥å£ä¸Šï¼Œå½“æˆ‘ä»¬æœ‰äº›æ¥å£ä¸æƒ³è®©å®ƒæ¯æ¬¡éƒ½å®ç°ï¼Œå¯ä»¥åœ¨æ¥å£åé¢åŠ å…¥ä¸€ä¸ªè¿”å›å€¼ï¼Œå¦‚æœæ²¡æœ‰è¿”å›å€¼å¯ä»¥è¿”å›ä¸€ä¸ª<code>Unit</code>ï¼Œåƒè¿™æ ·ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">interface Test &#123;</span><br><span class="line">    fun test1() = Unit</span><br><span class="line">    fun test2()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
</blockquote>
<p>è¿™æ ·çš„è¯<code>test2</code>ä¸ºå¿…é¡»å®ç°ï¼Œ<code>test1</code>å°±å˜æˆäº†é€‰æ‹©å®ç°</p>
<h3 id="æ€»ç»“ï¼š"><a href="#æ€»ç»“ï¼š" class="headerlink" title="æ€»ç»“ï¼š"></a>æ€»ç»“ï¼š</h3><p>ç»è¿‡<code>addTextChangedListener</code>çš„ä¸€ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬å­¦ä¹ äº†æ‰©å±•å‡½æ•°ï¼Œæ¥å£ä¸å‘½åå‚æ•°çš„è¿ç”¨ï¼Œåœ¨å®é™…é¡¹ç›®ä¸­ï¼Œå»ºè®®è¯»è€…ä»¬å¯ä»¥å°†å¸¸ç”¨çš„ä¸€äº›æ¥å£å®ç°åšä¸€äº›å°è£…ï¼Œå…·ä½“é€‰æ‹©é‚£ç§æ–¹å¼è§†å®é™…æƒ…å†µè€Œå®šï¼Œå¦‚æœä½ ä¸ç»å¸¸çš„ä½¿ç”¨å®ƒï¼Œé‚£ä¹ˆå°±ä¸ç”¨å»ç‰¹æ„å»å°è£…å®ƒï¼Œä¸ç„¶ä¼šé€ æˆæ–¹æ³•è‡ƒè‚¿ã€‚</p>
<p>å…³äºæ–¹æ³•ä¸æ¥å£çš„å°è£…ï¼Œè¿˜æœ‰æ›´åŠ é«˜çº§çš„ç”¨æ³•ï¼Œå°±æ˜¯<code>DSL</code>,è¿™ç§æ–¹æ¡ˆåœ¨<code>Anko</code>æ¡†æ¶ä¸­ä½¿ç”¨çš„éå¸¸é¢‘ç¹ï¼Œæœ‰å…´è¶£çš„å¯ä»¥å»ç ”ç©¶ä¸€ä¸‹</p>
]]></content>
      
        <categories>
            
            <category> Kotlin </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Kotlin </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[flutterè¸©å‘è®°å½•(æŒç»­æ›´æ–°ä¸­)]]></title>
      <url>/fluttercaikengjilv.html</url>
      <content type="html"><![CDATA[<p><strong>ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºåšä¸»åŸåˆ›æ–‡ç« ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„(www.huangjie.name)ï¼Œä¿æŠ¤åŸåˆ›ï¼Œä»æˆ‘åšèµ·.</strong></p>
<hr>
<blockquote>
<p>æ–‡ç« é¦–å‘äºæˆ‘çš„<a href="https://www.jianshu.com/u/2334b8b9f764" target="_blank" rel="noopener">ç®€ä¹¦</a>,æœ¬å¤„åªåšæ•´ç†å½’æ¡£ç”¨<br><a id="more"></a></p>
</blockquote>
<h2 id="Flutterç¼–è¯‘é—®é¢˜"><a href="#Flutterç¼–è¯‘é—®é¢˜" class="headerlink" title="Flutterç¼–è¯‘é—®é¢˜"></a>Flutterç¼–è¯‘é—®é¢˜</h2><h4 id="1-Flutterç¼–è¯‘æ—¶ä¸€ç›´å¡åœ¨â€Resolving-dependenciesâ€"><a href="#1-Flutterç¼–è¯‘æ—¶ä¸€ç›´å¡åœ¨â€Resolving-dependenciesâ€" class="headerlink" title="1.Flutterç¼–è¯‘æ—¶ä¸€ç›´å¡åœ¨â€Resolving dependenciesâ€"></a>1.Flutterç¼–è¯‘æ—¶ä¸€ç›´å¡åœ¨â€Resolving dependenciesâ€</h4><p>åŸå› ï¼šå›½å†…è¢«å¢™çš„åŸå› </p>
<p><strong>è§£å†³æ–¹æ¡ˆ1ï¼š</strong><br>é…ç½®ç³»ç»Ÿç¯å¢ƒå˜é‡ï¼š</p>
<ul>
<li><code>PUB_HOSTED_URL</code>-&gt;<code>https://pub.flutter-io.cn</code></li>
<li><code>FLUTTER_STORAGE_BASE_URL</code>-&gt;<code>https://storage.flutter-io.cn</code><br>æœ€æ–°çš„å˜é‡åœ°å€è¯·è®¿é—®ï¼š<a href="https://flutter.io/community/china" target="_blank" rel="noopener">https://flutter.io/community/china</a></li>
</ul>
<p><strong>è§£å†³æ–¹æ¡ˆ2ï¼š</strong><br>åœ¨<code>android</code>ç›®å½•çš„<code>build.gradle</code>ä¸‹æ·»åŠ é˜¿é‡Œé•œåƒä»£ç†ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">buildscript &#123;</span><br><span class="line">    repositories &#123;</span><br><span class="line">        maven &#123; url &apos;https://maven.aliyun.com/repository/google&apos; &#125;</span><br><span class="line">        maven &#123; url &apos;https://maven.aliyun.com/repository/jcenter&apos; &#125;</span><br><span class="line">        maven &#123; url &apos;https://maven.aliyun.com/repository/public&apos; &#125;</span><br><span class="line">        maven &#123; url &apos;https://maven.aliyun.com/repository/gradle-plugin&apos; &#125;</span><br><span class="line">        google()</span><br><span class="line">        jcenter()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    dependencies &#123;</span><br><span class="line">        classpath &apos;com.android.tools.build:gradle:3.2.1&apos;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">allprojects &#123;</span><br><span class="line">    repositories &#123;</span><br><span class="line">        maven &#123; url &apos;https://maven.aliyun.com/repository/google&apos; &#125;</span><br><span class="line">        maven &#123; url &apos;https://maven.aliyun.com/repository/jcenter&apos; &#125;</span><br><span class="line">        maven &#123; url &apos;https://maven.aliyun.com/repository/public&apos; &#125;</span><br><span class="line">        maven &#123; url &apos;https://maven.aliyun.com/repository/gradle-plugin&apos; &#125;</span><br><span class="line">        google()</span><br><span class="line">        jcenter()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><strong>è§£å†³æ–¹æ¡ˆ3ï¼š</strong><br>ä½¿ç”¨ç¿»å¢™å·¥å…·æ„å»º</p>
<h4 id="2-è¿è¡Œä¸€äº›å¼€æºçš„é¡¹ç›®ç¼–è¾‘æŠ¥é”™æç¤ºFinished-with-error-FormatException-Bad-UTF-8-encoding-0xc3-at-offset-169"><a href="#2-è¿è¡Œä¸€äº›å¼€æºçš„é¡¹ç›®ç¼–è¾‘æŠ¥é”™æç¤ºFinished-with-error-FormatException-Bad-UTF-8-encoding-0xc3-at-offset-169" class="headerlink" title="2.è¿è¡Œä¸€äº›å¼€æºçš„é¡¹ç›®ç¼–è¾‘æŠ¥é”™æç¤ºFinished with error: FormatException: Bad UTF-8 encoding 0xc3 (at offset 169)"></a>2.è¿è¡Œä¸€äº›å¼€æºçš„é¡¹ç›®ç¼–è¾‘æŠ¥é”™æç¤º<code>Finished with error: FormatException: Bad UTF-8 encoding 0xc3 (at offset 169)</code></h4><p>åŸå› ï¼šappçš„releaseç‰ˆæœ¬æ‰¾ä¸åˆ°keystoreæ–‡ä»¶<br>è§£å†³æ–¹æ¡ˆï¼š<br>æ‰¾åˆ°<code>android</code>-&gt;<code>app</code>ç›®å½•ä¸‹çš„<code>build.gradle</code>ï¼Œæ‰¾åˆ°<code>buildTypes</code>,ä¿®æ”¹<code>release</code>çš„<code>signingConfigs.release</code>ä¸º<code>debug</code>:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">buildTypes &#123;</span><br><span class="line">    debug &#123;</span><br><span class="line">        signingConfig signingConfigs.debug</span><br><span class="line">    &#125;</span><br><span class="line">    release &#123;</span><br><span class="line">        signingConfig signingConfigs.debug</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>æˆ–è€…è‡ªå·±é‡æ–°é…ç½®<code>release</code>çš„ç­¾å</p>
<h4 id="3-ç¬¬ä¸€æ¬¡æ„å»ºFlutteré¡¹ç›®ä¸€ç›´å¡åœ¨Initializing-gradleâ€¦"><a href="#3-ç¬¬ä¸€æ¬¡æ„å»ºFlutteré¡¹ç›®ä¸€ç›´å¡åœ¨Initializing-gradleâ€¦" class="headerlink" title="3.ç¬¬ä¸€æ¬¡æ„å»ºFlutteré¡¹ç›®ä¸€ç›´å¡åœ¨Initializing gradleâ€¦"></a>3.ç¬¬ä¸€æ¬¡æ„å»ºFlutteré¡¹ç›®ä¸€ç›´å¡åœ¨Initializing gradleâ€¦</h4><h5 id="ç»“åˆç½‘ä¸Šåšå®¢æ€»ç»“ï¼Œæœ‰ä¸¤ç§è§£å†³æ–¹æ¡ˆ"><a href="#ç»“åˆç½‘ä¸Šåšå®¢æ€»ç»“ï¼Œæœ‰ä¸¤ç§è§£å†³æ–¹æ¡ˆ" class="headerlink" title="ç»“åˆç½‘ä¸Šåšå®¢æ€»ç»“ï¼Œæœ‰ä¸¤ç§è§£å†³æ–¹æ¡ˆ"></a>ç»“åˆç½‘ä¸Šåšå®¢æ€»ç»“ï¼Œæœ‰ä¸¤ç§è§£å†³æ–¹æ¡ˆ</h5><p>1.ä¿®æ”¹é•œåƒ<br>åšå®¢åœ°å€:<a href="https://blog.csdn.net/qq_16071655/article/details/84106853" target="_blank" rel="noopener"><br>Flutter è¿è¡Œ ä¸€ç›´Initializing gradleâ€¦ï¼Œå’Œæ¨¡æ‹Ÿå™¨è¿è¡Œç™½å±é—®é¢˜</a></p>
<p>æœ¬äººæµ‹è¯•å‘ç°æ²¡æœ‰æ•ˆæœï¼Œäºæ˜¯æ‰¾åˆ°äº†ç¬¬äºŒç§è§£å†³æ–¹æ¡ˆ,äº²æµ‹æœ‰æ•ˆ</p>
<p>2.ä¿®æ”¹gradleä¸‹è½½åœ°å€<br>æ‰¾åˆ°é¡¹ç›®ä¸­çš„<code>android</code>-&gt;<code>gradle</code>-&gt;<code>wrapper</code>-&gt;<code>gradle-wrapper.properties</code>:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#Fri Jun 23 08:50:38 CEST 2017</span><br><span class="line">distributionBase=GRADLE_USER_HOME</span><br><span class="line">distributionPath=wrapper/dists</span><br><span class="line">zipStoreBase=GRADLE_USER_HOME</span><br><span class="line">zipStorePath=wrapper/dists</span><br><span class="line">distributionUrl=https\://services.gradle.org/distributions/gradle-4.10.2-all.zip</span><br></pre></td></tr></table></figure></p>
<p>ä¿®æ”¹<code>distributionUrl</code>ï¼Œå¯ä»¥å…ˆçœ‹ä¸€ä¸‹ä½ æœ¬åœ°èƒ½è¿è¡Œçš„é¡¹ç›®çš„gradleçš„é…ç½®ï¼Œå¦‚æœæ²¡æœ‰ï¼Œå¯ä»¥ä¿®æ”¹ä¸º:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">distributionUrl=https\://services.gradle.org/distributions/gradle-4.6-all.zip</span><br></pre></td></tr></table></figure></p>
<p>ä½ç‰ˆæœ¬æ˜¯ä¸è¡Œçš„ï¼Œflutteréœ€è¦çš„gradleç‰ˆæœ¬éœ€è¦4.6æˆ–æ›´é«˜æ‰è¡Œ,æ‰€ä»¥ä½ æœ¬åœ°å¦‚æœæ¯”è¿™ä¸ªä½ä¹Ÿéœ€è¦æ”¹æˆæ›´é«˜çš„ã€‚</p>
<p>æˆ‘çŒœæµ‹æ˜¯å› ä¸ºè¿™ä¸ªåœ°å€åœ¨æœ¬åœ°æ˜¯æ²¡æœ‰çš„ï¼Œæ‰€ä»¥éœ€è¦åˆ°<a href="http://services.gradle.org/distributions/" target="_blank" rel="noopener">gradleå®˜ç½‘</a>ä¸Šå»ä¸‹è½½ï¼Œè€Œåœ¨ä¸­å›½ä¸‹è½½æ˜¯å·¨æ…¢çš„ï¼Œæ‰€ä»¥ä¼šä¸€ç›´å¡åœ¨é‚£é‡Œï¼Œå¦‚æœæ¢æˆæœ¬åœ°çš„å°±ä¸éœ€è¦å»ä¸‹è½½äº†ï¼Œç›´æ¥ä½¿ç”¨æœ¬åœ°çš„gradle,æ‰€ä»¥å°±å˜å¿«äº†ã€‚</p>
<h3 id="Flutterå¼€å‘é—®é¢˜"><a href="#Flutterå¼€å‘é—®é¢˜" class="headerlink" title="Flutterå¼€å‘é—®é¢˜"></a>Flutterå¼€å‘é—®é¢˜</h3><h4 id="1-ä½¿ç”¨Navigator-push-è·³è½¬ç•Œé¢æŠ¥é”™ï¼š"><a href="#1-ä½¿ç”¨Navigator-push-è·³è½¬ç•Œé¢æŠ¥é”™ï¼š" class="headerlink" title="1.ä½¿ç”¨Navigator.push()è·³è½¬ç•Œé¢æŠ¥é”™ï¼š"></a>1.ä½¿ç”¨<code>Navigator.push()</code>è·³è½¬ç•Œé¢æŠ¥é”™ï¼š</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&apos;Navigator operation requested with a context that does not include a Navigator.\n&apos;</span><br><span class="line">&apos;The context used to push or pop routes from the Navigator must be that of a &apos;</span><br><span class="line">&apos;widget that is a descendant of a Navigator widget.&apos;</span><br></pre></td></tr></table></figure>
<p>åŸå› ï¼šä¼ å…¥çš„<code>context</code>ä¸æ”¯æŒå †æ ˆç®¡ç†ï¼Œæ¯”å¦‚ä¸€ä¸ªç±»ç›´æ¥ç»§æ‰¿è‡ª<code>StatelessWidget</code>æˆ–<code>StatefulWidget</code>ï¼Œè€Œå®ƒæœ¬èº«æˆ–çˆ¶ç±»æ²¡æœ‰å †æ ˆç®¡ç†åŠŸèƒ½ã€‚é‚£ä¹ˆè¿™ä¸ªç±»æ˜¯ä¸æ”¯æŒé¡µé¢è·³è½¬çš„ï¼Œæ‰€ä»¥å°±ä¼šæŠ¥é”™ã€‚è¦æŸ¥çœ‹æ˜¯å¦æ”¯æŒé¡µé¢è·³è½¬ï¼Œç›´æ¥è¿›å…¥æºç ï¼Œæ¯”å¦‚<code>MaterialApp</code>ç±»ï¼Œå®ƒæ˜¯æ”¯æŒçš„ï¼Œé‚£ä¹ˆå®ƒçš„æºç é‡Œä¼šæœ‰å¯¹åº”çš„åŠŸèƒ½ä»‹ç»ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">/// See also:</span><br><span class="line">///</span><br><span class="line">///  * [Scaffold], which provides standard app elements like an [AppBar] and a [Drawer].</span><br><span class="line">///  * [Navigator], which is used to manage the app&apos;s stack of pages.  //è¿™é‡Œåšäº†å¯¹åº”çš„ä»‹ç»</span><br><span class="line">///  * [MaterialPageRoute], which defines an app page that transitions in a material-specific way.</span><br><span class="line">///  * [WidgetsApp], which defines the basic app elements but does not depend on the material library.</span><br><span class="line">///  * The Flutter Internationalization Tutorial,</span><br><span class="line">///    &lt;https://flutter.io/tutorials/internationalization/&gt;.</span><br><span class="line">class MaterialApp extends StatefulWidget &#123;</span><br><span class="line">  .....</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>æ”¾ä¸€ä¸ªæŠ¥é”™çš„ä»£ç ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">void main() =&gt; runApp(new MyApp());</span><br><span class="line"></span><br><span class="line">class MyApp extends StatelessWidget &#123;</span><br><span class="line"></span><br><span class="line">  @override</span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    return new MaterialApp(</span><br><span class="line">        title: &apos;Welcome to Flutter&apos;,</span><br><span class="line">        home: new Scaffold(</span><br><span class="line">            body:Container(</span><br><span class="line">              child: FlatButton(onPressed:()&#123;</span><br><span class="line">                var push = Navigator.push(context,MaterialPageRoute(builder: (BuildContext context) &#123;</span><br><span class="line">                  return new OtherPager(&quot;æˆ‘æ˜¯ä»mainä¼ è¿‡å»çš„å€¼&quot;);</span><br><span class="line">                &#125;));</span><br><span class="line">                push.then((value)&#123;</span><br><span class="line">                print(&quot;æˆ‘æ˜¯ä»ä¸Šä¸ªé¡µé¢ä¼ é€’å›æ¥çš„å€¼$value&quot;);</span><br><span class="line">                &#125;);</span><br><span class="line">              &#125;, child:new Icon(Icons.build)),</span><br><span class="line">            )</span><br><span class="line">        )</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>è¿™é‡Œçš„<code>MyApp</code>æ˜¯ç›´æ¥ç»§æ‰¿è‡ª<code>StatelessWidget</code>çš„ï¼Œè€Œåœ¨<code>runApp()</code>ä¸­ç›´æ¥ä½¿ç”¨äº†å®ƒï¼Œå®ƒæ²¡æœ‰çˆ¶ç±»è€Œå®ƒæœ¬èº«ä¹Ÿä¸æ”¯æŒç•Œé¢çš„è·³è½¬ï¼Œæ‰€ä»¥ç”¨å®ƒçš„<code>context</code>ä¼ å…¥åˆ°<code>Navigator</code>ä¸­è‚¯å®šæ˜¯ä¼šæŠ¥é”™çš„<br><strong>è§£å†³æ–¹æ¡ˆ</strong><br>ä½¿ç”¨ä¸€ä¸ªæœ‰å †æ ˆç®¡ç†åŠŸèƒ½çš„çˆ¶ç±»å°†<code>MyApp</code>ç±»åŒ…è£¹ï¼Œä½¿å…¶å…·æœ‰å †æ ˆè·³è½¬åŠŸèƒ½<br>è§å¦‚ä¸‹ä»£ç ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">void main() =&gt; runApp(MaterialApp(home: MyApp()));</span><br><span class="line"></span><br><span class="line">class MyApp extends StatelessWidget &#123;</span><br><span class="line">  @override</span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    // TODO: implement build</span><br><span class="line">    return new Scaffold(</span><br><span class="line">        body: Container(</span><br><span class="line">      child: FlatButton(</span><br><span class="line">          onPressed: () &#123;</span><br><span class="line">            var push = Navigator.push(context,</span><br><span class="line">                MaterialPageRoute(builder: (BuildContext context) &#123;</span><br><span class="line">              return new OtherPager(&quot;æˆ‘æ˜¯ä»mainä¼ è¿‡å»çš„å€¼&quot;);</span><br><span class="line">            &#125;));</span><br><span class="line">            push.then((value) &#123;</span><br><span class="line">              print(&quot;æˆ‘æ˜¯ä»ä¸Šä¸ªé¡µé¢ä¼ é€’å›æ¥çš„å€¼$value&quot;);</span><br><span class="line">            &#125;);</span><br><span class="line">          &#125;,</span><br><span class="line">          child: new Icon(Icons.build)),</span><br><span class="line">    ));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>ä»£ç ä¸­å°†<code>MaterialApp</code>ç§»å‡ºæ¥äº†ï¼Œç›´æ¥å°†<code>MyApp</code>åŒ…è£¹äº†ï¼Œé‚£ä¹ˆ<code>MyApp</code>çš„<code>context</code>å°±ç”Ÿæ•ˆäº†ï¼Œä»£ç ä¹Ÿä¸ä¼šæŠ¥é”™å•¦ã€‚</p>
<h4 id="2-åœ¨pubspec-yamlç”³æ˜æœ¬åœ°å›¾ç‰‡è·¯å¾„æŠ¥é”™"><a href="#2-åœ¨pubspec-yamlç”³æ˜æœ¬åœ°å›¾ç‰‡è·¯å¾„æŠ¥é”™" class="headerlink" title="2.åœ¨pubspec.yamlç”³æ˜æœ¬åœ°å›¾ç‰‡è·¯å¾„æŠ¥é”™"></a>2.åœ¨pubspec.yamlç”³æ˜æœ¬åœ°å›¾ç‰‡è·¯å¾„æŠ¥é”™</h4><p>é”™è¯¯ä¿¡æ¯ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Error on line 29, column 4 of pubspec.yaml: Expected a key while parsing a block mapping.</span><br><span class="line">   assets:</span><br><span class="line">   ^</span><br><span class="line"></span><br><span class="line">pub get failed (65)</span><br></pre></td></tr></table></figure></p>
<p>åŸå› ï¼šæ ¼å¼ä¸å¯¹ï¼Œæ³¨æ„ç©ºæ ¼ï¼Œä¸ä¸Šé¢å¯¹é½,ç›´æ¥å°†åŸæ¥çš„å®˜æ–¹æ³¨é‡Šæ‰çš„è§£å¼€å°±ä¼šå‡ºç°è¿™ä¸ªé”™è¯¯ï¼Œåˆ«é—®æˆ‘æ€ä¹ˆçŸ¥é“çš„!!</p>
]]></content>
      
        <categories>
            
            <category> flutter </category>
            
        </categories>
        
        
        <tags>
            
            <tag> flutter </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[flutter_reduxæ¡†æ¶çš„ä½¿ç”¨]]></title>
      <url>/flutter-redux%E6%A1%86%E6%9E%B6%E7%9A%84%E4%BD%BF%E7%94%A8.html</url>
      <content type="html"><![CDATA[<p><strong>ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºåšä¸»åŸåˆ›æ–‡ç« ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„(www.huangjie.name)ï¼Œä¿æŠ¤åŸåˆ›ï¼Œä»æˆ‘åšèµ·.</strong></p>
<hr>
<blockquote>
<p>æ–‡ç« é¦–å‘äºæˆ‘çš„<a href="https://www.jianshu.com/u/2334b8b9f764" target="_blank" rel="noopener">ç®€ä¹¦</a>,æœ¬å¤„åªåšæ•´ç†å½’æ¡£ç”¨<br><a id="more"></a></p>
</blockquote>
<h3 id="æ¡†æ¶ç®€ä»‹ä»¥åŠä½œç”¨"><a href="#æ¡†æ¶ç®€ä»‹ä»¥åŠä½œç”¨" class="headerlink" title="æ¡†æ¶ç®€ä»‹ä»¥åŠä½œç”¨"></a>æ¡†æ¶ç®€ä»‹ä»¥åŠä½œç”¨</h3><p><code>flutter_redux</code>æ˜¯åŸºäº<a href="https://book.flutterchina.club/chapter7/inherited_widget.html" target="_blank" rel="noopener">InheritedWidget</a>å°è£…çš„ç”¨äºWidgetæ ‘çš„æ•°æ®ä¼ é€’ä¸å…±äº«çš„çš„ä¸€å¥—æ¡†æ¶ï¼Œå®ƒèƒ½é«˜æ•ˆçš„å®Œæˆæ•°æ®å…±äº«ï¼Œè¿›è€Œè¾¾åˆ°uiåŠæ—¶æ›´æ–°ç­‰ç›®çš„ï¼Œä½¿ç”¨èµ·æ¥ç•¥æ˜¾å¤æ‚ï¼Œä¸€èˆ¬ä¸æ˜¯å¾ˆå¤šçš„æ•°æ®æ›´æ–°ä¸å»ºè®®ä½¿ç”¨ï¼Œç›´æ¥ç”¨InheritedWidgetå°±èƒ½è§£å†³ï¼Œå½“Widgetç»‘å®šçš„å¾ˆå¤šçš„æ—¶å€™ï¼Œä½¿ç”¨èµ·æ¥å°±ä¼šå¾ˆçˆ½äº†ã€‚ğŸŒ¼</p>
<h3 id="å¼€å§‹ä½¿ç”¨"><a href="#å¼€å§‹ä½¿ç”¨" class="headerlink" title="å¼€å§‹ä½¿ç”¨"></a>å¼€å§‹ä½¿ç”¨</h3><p>æ‰“å¼€<code>pubspec.yaml</code>æ·»åŠ å¦‚ä¸‹ä»£ç ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">dependencies:</span><br><span class="line">  flutter:</span><br><span class="line">    sdk: flutter</span><br><span class="line">  flutter_redux: ^0.5.3</span><br></pre></td></tr></table></figure></p>
<p>å…³äºç‰ˆæœ¬å¯å‰å¾€dartåº“æŸ¥çœ‹ï¼Œä¼ é€é—¨ï¼š<a href="https://pub.dartlang.org/packages/flutter_redux#-readme-tab-" target="_blank" rel="noopener">flutter_redux</a></p>
<p>ä½¿ç”¨æ­¥éª¤ï¼š<br>1.æ–°å»ºä¸€ä¸ªæ•°æ®å…±äº«ç±»ï¼Œä¹Ÿå¯ä»¥æ˜¯åŸºæœ¬æ•°æ®ç±»å‹ï¼Œé‡Œé¢ç”³æ˜éœ€è¦å…±äº«çš„æ•°æ®<br>2.æ–°å»ºä¸€ä¸ªæšä¸¾ç”¨äºæ¶ˆæ¯å‘é€ä¸åŒºåˆ†<br>3.ç”³æ˜ä¸€ä¸ªæ–¹æ³•ç”¨äºå¤„ç†æ•°æ®æ›´æ–°é€»è¾‘ä¸æ–°çš„æ•°æ®è¿”å›<br>4.ç”³æ˜<code>Store</code>ç±»ï¼Œå°†æ­¥éª¤4çš„æ–¹æ³•æ”¾è¿›å»<br>5.åœ¨éœ€è¦å…±äº«æ•°æ®çš„åœ°æ–¹ç”³æ˜<code>StoreProvider</code>è·Ÿå¸ƒå±€ï¼Œç»‘å®š<code>Store</code>ç±»<br>6.ä½¿ç”¨<code>StoreConnector</code>ç±»æˆ–<code>StoreBuilder</code>å¤„ç†æ•°æ®é€»è¾‘ä¸<code>Widget</code>äº¤äº’é€»è¾‘</p>
<p>æ³¨æ„äº‹é¡¹ï¼š<br>ä½¿ç”¨<code>StoreConnector</code>è¦æ³¨æ„å‰é¢çš„æ³›å‹ç”³æ˜ï¼Œå…·ä½“ä½¿ç”¨çœ‹ä»¥ä¸‹ç¤ºä¾‹ä»£ç (æ¥è‡ªå®˜æ–¹ç¤ºä¾‹)ï¼Œæ­¤ç¤ºä¾‹å®ç°äº†ä¸€ä¸ªç‚¹å‡»æŒ‰é’®æ–‡æœ¬åŠ ä¸€çš„æ•ˆæœã€‚</p>
<h3 id="ä»£ç åˆ†æ"><a href="#ä»£ç åˆ†æ" class="headerlink" title="ä»£ç åˆ†æ"></a>ä»£ç åˆ†æ</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">import &apos;package:flutter/material.dart&apos;;</span><br><span class="line">import &apos;package:flutter_redux/flutter_redux.dart&apos;;</span><br><span class="line">import &apos;package:redux/redux.dart&apos;;</span><br><span class="line"></span><br><span class="line">void main() &#123;</span><br><span class="line">  runApp(FlutterReduxApp());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//æ­¥éª¤2ï¼Œç”¨äºåœ¨æ­¥éª¤ä¸‰ä¸­åšæ¶ˆæ¯åŒºåˆ†ä¸æ¶ˆæ¯å‘é€</span><br><span class="line">enum Action &#123; Increment &#125;</span><br><span class="line"></span><br><span class="line">//æ­¥éª¤1çš„æ•°æ®å…±äº«ç±»æ˜¯count,ä¸€ä¸ªåŸºæœ¬æ•°æ®ç±»å‹</span><br><span class="line">//æ­¥éª¤3ï¼Œå¤„ç†æ•°æ®çš„æ›´æ–°é€»è¾‘ï¼Œæ­¤å¤„æ˜¯åšåŠ ä¸€æ“ä½œï¼Œæ³¨æ„éœ€è¦æŠŠæ–°çš„ç±»å‹è¿”å›</span><br><span class="line">int reducer(int count, action) &#123;</span><br><span class="line">  if (action == Action.Increment) &#123;</span><br><span class="line">    return count + 1;</span><br><span class="line">  &#125;</span><br><span class="line">  return count;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class FlutterReduxApp extends StatelessWidget &#123;</span><br><span class="line">  //æ­¥éª¤4 ç”³æ˜ä¸€ä¸ªstore,å¿…é¡»ä¼ å…¥ä¸€ä¸ªæ–¹æ³•è¿›å»ï¼Œå…¶ä½™çš„å‚æ•°é€‰å¡«ï¼Œè¿™é‡Œé€‰æ‹©åˆå§‹åŒ–ä¸€ä¸‹åŸºç¡€å‚æ•°</span><br><span class="line">  final store = Store(reducer, initialState: 0);</span><br><span class="line"></span><br><span class="line">  @override</span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    return StoreProvider(</span><br><span class="line">        store: store, //ç»‘å®šstore</span><br><span class="line">        child: MaterialApp(</span><br><span class="line">          home: Scaffold(</span><br><span class="line">            appBar: AppBar(</span><br><span class="line">              title: Text(&quot;Title&quot;),</span><br><span class="line">            ),</span><br><span class="line">            body: Center(</span><br><span class="line">              child: Column(</span><br><span class="line">                mainAxisAlignment: MainAxisAlignment.center,</span><br><span class="line">                children: &lt;Widget&gt;[</span><br><span class="line">                  Text(&quot;You have pushed the button this many times:&quot;),</span><br><span class="line">                   //å½“éœ€è¦ä½¿ç”¨åˆ°å…±äº«æ•°æ®çš„æ—¶å€™ä½¿ç”¨StoreConnectoræ¥è·å–æ•°æ®</span><br><span class="line">                  StoreConnector&lt;int, String&gt;(builder: (context, value) &#123;</span><br><span class="line">                    return Text(value, style: Theme.of(context).textTheme.display1);</span><br><span class="line">                  &#125;, converter: (Store store) &#123;</span><br><span class="line">                    return store.state.toString();</span><br><span class="line">                  &#125;)</span><br><span class="line">                ],</span><br><span class="line">              ),</span><br><span class="line">            ),</span><br><span class="line">            floatingActionButton: StoreConnector&lt;int, VoidCallback&gt;(</span><br><span class="line">              converter: (Store store) &#123;</span><br><span class="line">                return () =&gt; store.dispatch(Action.Increment); //å‘é€æ•°æ®</span><br><span class="line">              &#125;,</span><br><span class="line">              builder: (BuildContext context, VoidCallback callback) &#123;</span><br><span class="line">                return FloatingActionButton(</span><br><span class="line">                    onPressed: callback, child: Icon(Icons.add));</span><br><span class="line">              &#125;,</span><br><span class="line">            ),</span><br><span class="line">          ),</span><br><span class="line">        ));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æºç ä¸­ä¸»è¦æ³¨æ„å¦‚ä¸‹åœ°æ–¹ï¼š<br><strong>1.StoreConnectorçš„ä½¿ç”¨</strong><br><code>StoreConnector</code>ä¸»è¦æ˜¯èµ·ä¸€ä¸ªæ•°æ®è½¬åŒ–çš„ä½œç”¨ï¼Œå¯ä»¥åœ¨ç»„ä»¶èµ‹å€¼ä¹‹å‰åšä¸€äº›æ•°æ®è½¬åŒ–æ“ä½œï¼Œè€Œ<code>StoreBuilder</code>æ˜¯ç›´æ¥å°†å…±äº«çš„æ•°æ®èµ‹å€¼åœ¨ç»„ä»¶ä¸Šï¼Œå…·ä½“çš„é€‰æ‹©çœ‹éœ€æ±‚è€Œå®šã€‚<br>StoreConnectoræœ‰ä¸¤ä¸ªæ³›å‹å‚æ•°ï¼Œç¬¬ä¸€ä¸ªæ˜¯æˆ‘ä»¬çš„åŸæœ¬çš„å…±äº«ç±»å‹ï¼Œç¬¬äºŒä¸ªæ˜¯æˆ‘ä»¬éœ€è¦è½¬æ¢çš„å‚æ•°ç±»å‹ï¼Œå®ƒå¯ä»¥æ˜¯ç±»ï¼Œæ–¹æ³•ï¼ŒåŸºæœ¬æ•°æ®ç±»å‹ç­‰éƒ½å¯ä»¥<br>å®ƒéœ€è¦ç”³æ˜ä¸¤ä¸ªæ–¹æ³•ï¼š</p>
<ul>
<li>converter èµ·æ•°æ®è½¬åŒ–ä½œç”¨ï¼Œä¾‹å¦‚æºç ä¸­ç”³æ˜äº†ä¸€ä¸ªStringç±»å‹çš„è½¬åŒ–å‚æ•°ï¼Œé‚£ä¹ˆconverterçš„è¿”å›å€¼å°±æ˜¯ä¸€ä¸ªStringç±»å‹ï¼Œè¿”å›å€¼ä¼šç›´æ¥ä¼ é€’åˆ°builderæ–¹æ³•çš„ç¬¬äºŒä¸ªå‚æ•°ä¸­å»ã€‚</li>
<li>builder æ¥æ”¶æ•°æ®ï¼Œæ„å»ºWidgetäº¤äº’ï¼Œç¬¬ä¸€ä¸ªcontextä¸éœ€è¦è§£é‡Šï¼Œç¬¬äºŒä¸ªå‚æ•°å°±æ˜¯æˆ‘ä»¬ç”³æ˜çš„è½¬åŒ–å‚æ•°çš„è¿”å›å€¼ï¼Œè¿”å›å€¼ç±»å‹è§†ä¼ å…¥çš„æ³›å‹ç±»å‹è€Œå®šã€‚</li>
</ul>
<p>ç»è¿‡ä»¥ä¸Šåˆ†æï¼Œéœ€è¦æ³¨æ„çš„å°±æ˜¯æ³›å‹çš„ç”³æ˜ä»¥åŠå®ƒçš„æ•°æ®æµå‘ï¼šStoreConnectorç”³æ˜ä¸€ä¸ªè½¬åŒ–ç±»å‹=&gt;converter è½¬åŒ–=&gt;<br>builderæ–¹æ³•ä¸­æ¥æ”¶å¹¶ä½¿ç”¨</p>
<p><strong>store.dispatch(Action.Increment);</strong><br>æ­¤æ–¹æ³•ç”¨æ¥é€šçŸ¥æ•°æ®çš„æ”¹å˜ä¸æ›´æ–°</p>
<p><strong>StoreBuilder</strong><br>ä¸<code>StoreConnector</code>ä¸åŒï¼Œå®ƒåªéœ€è¦ç”³æ˜ä¸€ä¸ªå…±äº«æ•°æ®ç±»å‹çš„æ³›å‹ï¼Œåœ¨ä½¿ç”¨ä¸­ä¹Ÿåªæœ‰ä¸€ä¸ª<code>builder</code>å‚æ•°ï¼Œä½¿ç”¨æ–¹å¼ä¸<code>StoreConnector</code>ä¸€æ ·ï¼Œç¤ºä¾‹ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">return new StoreProvider(</span><br><span class="line">      store: store,</span><br><span class="line">      child: new StoreBuilder&lt;String&gt;(builder: (context, count) &#123;</span><br><span class="line">        return new Text(count);</span><br><span class="line">    );</span><br></pre></td></tr></table></figure></p>
]]></content>
      
        <categories>
            
            <category> flutter </category>
            
        </categories>
        
        
        <tags>
            
            <tag> flutter </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Glideè®¾ç½®é»˜è®¤å›¾ç‰‡åsetImageBitmap,setImageResourceå¤±æ•ˆé—®é¢˜]]></title>
      <url>/Glide%E8%AE%BE%E7%BD%AE%E9%BB%98%E8%AE%A4%E5%9B%BE%E7%89%87%E5%90%8EsetImageBitmapsetImageResource%E5%A4%B1%E6%95%88%E9%97%AE%E9%A2%98.html</url>
      <content type="html"><![CDATA[<p><strong>ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºåšä¸»åŸåˆ›æ–‡ç« ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„(www.huangjie.name)ï¼Œä¿æŠ¤åŸåˆ›ï¼Œä»æˆ‘åšèµ·.</strong></p>
<hr>
<blockquote>
<p>æ–‡ç« é¦–å‘äºæˆ‘çš„<a href="https://www.jianshu.com/u/2334b8b9f764" target="_blank" rel="noopener">ç®€ä¹¦</a>,æœ¬å¤„åªåšæ•´ç†å½’æ¡£ç”¨<br><a id="more"></a></p>
</blockquote>
<h4 id="å¤ç°åœºæ™¯"><a href="#å¤ç°åœºæ™¯" class="headerlink" title="å¤ç°åœºæ™¯"></a>å¤ç°åœºæ™¯</h4><p>åœ¨é€‚é…å™¨ä¸­æ·»åŠ äº†ä¸€ä¸ªæ¡ä»¶ï¼Œpathä¸ºç©ºå°±å»åŠ è½½æœ¬åœ°å›¾ç‰‡ï¼Œä¸ä¸ºç©ºå°±ä½¿ç”¨<code>Glide</code>å»åŠ è½½å›¾ç‰‡ï¼Œä¼ªä»£ç å®ç°å¦‚ä¸‹ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">   public void onBindViewHolder(ViewHolder holder, int position) &#123;</span><br><span class="line">        if(path==null)&#123;</span><br><span class="line">              imageView.setImageResource(R.drawable.my_image)</span><br><span class="line">        &#125;else&#123;</span><br><span class="line">              Glide.with(this).load(path).apply( RequestOptions().placeholder(R.drawable.place).error(R.drawable.error)).into(imageView)</span><br><span class="line">          &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure></p>
<p>å’‹ä¸€çœ‹æ²¡å•¥é—®é¢˜,å½“pathä¸ºä¸€ä¸ªæ— æ•ˆåœ°å€çš„æ—¶å€™ï¼ŒimageViewä¼šæ˜¾ç¤ºerrorçš„å›¾ç‰‡ï¼Œä½†æ˜¯å½“pathä¸ºnullçš„æ—¶å€™ï¼Œå‘ç°imageViewæ²¡æœ‰æ˜¾ç¤ºmy_imageï¼Œè¿˜æ˜¯æ˜¾ç¤ºçš„errorå›¾ç‰‡ï¼Œæ‰“æ–­ç‚¹å‘ç°<code>imageView.setImageResource(R.drawable.my_image)</code>è¿™å¥ä»£ç æ˜¯æ‰§è¡Œäº†çš„ï¼Œä½†ä¸ºä»€ä¹ˆä¼šå¤±æ•ˆå‘¢ï¼Ÿ</p>
<h4 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h4><p>å…ˆæ¥è¯´ä¸€ä¸‹è§£å†³æ–¹æ¡ˆï¼Œå¦‚æœå¯¹å‡ºç°åŸå› (ä»æºç å±‚é¢åˆ†æ)æ„Ÿå…´è¶£å¯ä»¥ç»§ç»­å¾€ä¸‹çœ‹</p>
<p>1.ä½¿ç”¨<code>Glide.with(this).clear(imageView)</code>å…³é—­å¤±è´¥é‡è¯•<br>2.ä½¿ç”¨<code>Glide</code>åŠ è½½æœ¬åœ°å›¾ç‰‡,ä¸ä½¿ç”¨åŸç”ŸApi:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Glide.with(imageView).load(R.drawable.my_image).into(imageView)</span><br></pre></td></tr></table></figure></p>
<h4 id="å‡ºç°åŸå› "><a href="#å‡ºç°åŸå› " class="headerlink" title="å‡ºç°åŸå› "></a>å‡ºç°åŸå› </h4><p>Glideå†…éƒ¨æœ‰åŠ è½½å¤±è´¥é‡è¯•æœºåˆ¶ï¼Œå½“ç¬¬ä¸€æ¬¡åŠ è½½å¤±è´¥ï¼Œé‡è¯•æœºåˆ¶å°±ä¼šå¯åŠ¨ï¼Œè¿™æ—¶<code>imageView.setImageResource(R.drawable.my_image)</code>ä¹ŸåŒæ­¥æ‰§è¡Œäº†ï¼Œä½†æ˜¯å½“é‡è¯•æœºåˆ¶æ‰§è¡Œå®Œæ¯•åï¼ŒGlideå‘ç°å›¾ç‰‡æœ€ç»ˆè¿˜æ˜¯åŠ è½½å¤±è´¥ï¼Œæ‰€ä»¥ä¼šå°†errorä¸­è®¾ç½®çš„å›¾ç‰‡åˆæ·»åŠ åˆ°<code>imageView</code>ä¸Šå»ï¼Œæ‰€ä»¥å¹¶ä¸æ˜¯<code>imageView.setImageResource(R.drawable.my_image)</code>è¿™å¥ä»£ç å¤±æ•ˆäº†ï¼Œè€Œæ˜¯Glideåˆé‡æ–°è®¾ç½®äº†ä¸€éã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥æ¥ç…ä¸€çœ¼æºç ï¼Œæˆ‘ä»¬çŸ¥é“å›¾ç‰‡åŠ è½½å¤±è´¥æ˜¯æœ‰ä¸€ä¸ªå›è°ƒçš„ï¼Œæ‰€ä»¥ä»å›è°ƒå…¥æ‰‹ï¼š<br>å…ˆæ‰¾åˆ°<code>RequestListener</code>å›è°ƒï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">public interface RequestListener&lt;R&gt; &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  boolean onLoadFailed(</span><br><span class="line">      @Nullable GlideException e, Object model, Target&lt;R&gt; target, boolean isFirstResource);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  boolean onResourceReady(</span><br><span class="line">      R resource, Object model, Target&lt;R&gt; target, DataSource dataSource, boolean isFirstResource);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>éšåæ‰¾åˆ°<code>onLoadFailed</code>å®ç°ç±»<code>SingleRequest</code>:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * A callback method that should never be invoked directly.</span><br><span class="line"> */</span><br><span class="line">@Override</span><br><span class="line">public void onLoadFailed(GlideException e) &#123;</span><br><span class="line">  onLoadFailed(e, Log.WARN);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">private void onLoadFailed(GlideException e, int maxLogLevel) &#123;</span><br><span class="line">  stateVerifier.throwIfRecycled();</span><br><span class="line">  int logLevel = glideContext.getLogLevel();</span><br><span class="line">  if (logLevel &lt;= maxLogLevel) &#123;</span><br><span class="line">    Log.w(GLIDE_TAG, &quot;Load failed for &quot; + model + &quot; with size [&quot; + width + &quot;x&quot; + height + &quot;]&quot;, e);</span><br><span class="line">    if (logLevel &lt;= Log.INFO) &#123;</span><br><span class="line">      e.logRootCauses(GLIDE_TAG);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  loadStatus = null;</span><br><span class="line">  status = Status.FAILED;</span><br><span class="line"></span><br><span class="line">  isCallingCallbacks = true;</span><br><span class="line">  try &#123;</span><br><span class="line">    //TODO: what if this is a thumbnail request?</span><br><span class="line">    if ((requestListener == null</span><br><span class="line">        || !requestListener.onLoadFailed(e, model, target, isFirstReadyResource()))   //å¯ä»¥çœ‹åˆ°listenceçš„æ¥å£è°ƒç”¨æ˜¯åœ¨è¿™é‡Œï¼Œè¿”å›å€¼å†³å®šäº†æ˜¯å¦å¾€ä¸‹è°ƒç”¨é€»è¾‘</span><br><span class="line">        &amp;&amp; (targetListener == null</span><br><span class="line">        || !targetListener.onLoadFailed(e, model, target, isFirstReadyResource()))) &#123;</span><br><span class="line">      setErrorPlaceholder();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; finally &#123;</span><br><span class="line">    isCallingCallbacks = false;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  notifyLoadFailed();  //è¿™é‡Œä¼šé‡è¯•ä¸€æ¬¡</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>å¯ä»¥çœ‹åˆ°è¿™é‡Œä¼šå…ˆæœ‰ä¸€ä¸ª<code>requestListener</code>çš„æ¥å£è°ƒç”¨ï¼Œè¿™é‡Œ<code>requestListener</code>å…¶å®å°±æ˜¯æˆ‘ä»¬çš„listenceç›‘å¬åŠŸèƒ½ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Glide.with(imageView).load(url).listener(new RequestListener&lt;Drawable&gt;() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public boolean onLoadFailed(@Nullable GlideException e, Object model, Target&lt;Drawable&gt; target, boolean isFirstResource) &#123;</span><br><span class="line">                return false;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            @Override</span><br><span class="line">            public boolean onResourceReady(Drawable resource, Object model, Target&lt;Drawable&gt; target, DataSource dataSource, boolean isFirstResource) &#123;</span><br><span class="line">                return false;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br></pre></td></tr></table></figure></p>
<p>åªæœ‰è¿”å›falseæ‰ä¼šå»è°ƒç”¨<code>setErrorPlaceholder()</code>æ–¹æ³•ï¼Œçœ‹ä¸€ä¸‹ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">private void setErrorPlaceholder() &#123;</span><br><span class="line">  if (!canNotifyStatusChanged()) &#123;</span><br><span class="line">    return;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  Drawable error = null;</span><br><span class="line">  if (model == null) &#123;</span><br><span class="line">    error = getFallbackDrawable();</span><br><span class="line">  &#125;</span><br><span class="line">  // Either the model isn&apos;t null, or there was no fallback drawable set.</span><br><span class="line">  if (error == null) &#123;</span><br><span class="line">    error = getErrorDrawable();</span><br><span class="line">  &#125;</span><br><span class="line">  // The model isn&apos;t null, no fallback drawable was set or no error drawable was set.</span><br><span class="line">  if (error == null) &#123;</span><br><span class="line">    error = getPlaceholderDrawable();</span><br><span class="line">  &#125;</span><br><span class="line">  target.onLoadFailed(error);  //targetå°±æ˜¯æˆ‘ä»¬è®¾ç½®è¿›å»çš„ImageView</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>åœ¨çœ‹ä¸€ä¸‹æˆ‘ä»¬çš„<code>onLoadFailed</code>å®ç°ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">public void onLoadFailed(@Nullable Drawable errorDrawable) &#123;</span><br><span class="line">  super.onLoadFailed(errorDrawable);</span><br><span class="line">  setResourceInternal(null);</span><br><span class="line">  setDrawable(errorDrawable);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>æ‰€ä»¥<code>setErrorPlaceholder</code>æ–¹æ³•çš„ä½œç”¨å°±æ˜¯æŠŠæˆ‘ä»¬è®¾ç½®çš„errorå›¾ç‰‡è®¾ç½®ç»™æˆ‘ä»¬æ”¾è¿›å»çš„ImageViewä¸Š<br>æˆ‘ä»¬å›åˆ°<code>onLoadFailed</code>æ–¹æ³•ä¸­ï¼Œå‘ç°æœ€åè°ƒç”¨äº†<code>notifyLoadFailed()</code>æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•æ˜¯å¹²å˜›çš„å‘¢ï¼Œçœ‹ä¸€ä¸‹æºç ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">private void notifyLoadFailed() &#123;</span><br><span class="line">  if (requestCoordinator != null) &#123;</span><br><span class="line">    requestCoordinator.onRequestFailed(this);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>æ˜¯ä¸€ä¸ªæ¥å£ï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹å®ƒçš„å®ç°,æ˜¯åœ¨<code>ErrorRequestCoordinator</code>ä¸­ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">if (!request.equals(error)) &#123;</span><br><span class="line">  if (!error.isRunning()) &#123;</span><br><span class="line">    error.begin();</span><br><span class="line">  &#125;</span><br><span class="line">  return;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if (parent != null) &#123;</span><br><span class="line">  parent.onRequestFailed(this);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>æˆ‘ä»¬å‘ç°è°ƒç”¨äº†ä¸€ä¸ªç†Ÿæ‚‰çš„æ–¹æ³•ï¼Œ<code>begin()</code>ï¼Œç ”ç©¶è¿‡æºç çš„éƒ½çŸ¥é“ï¼ŒGlideéƒ½ä¼šåœ¨è¿™ä¸ªæ¥å£å®ç°å¼€å§‹å¼‚æ­¥åŠ è½½çš„æ–¹æ³•ï¼Œæ‰€ä»¥åœ¨è¿™é‡Œåˆä¼šå»å¼€å§‹å¼‚æ­¥åŠ è½½å›¾ç‰‡</p>
<p>æ‰€ä»¥ï¼Œèµ°ä¸€åœˆä¸‹æ¥ï¼Œå¤§è‡´çš„æµç¨‹å°±æ˜¯è¿™æ ·å­ï¼š<br>åœ¨<code>SingleRequest</code>ç±»ä¸­å…ˆè°ƒç”¨<code>begin</code>å¼€å§‹å¼‚æ­¥åŠ è½½å›¾ç‰‡-&gt;åŠ è½½å¤±è´¥-&gt;<code>onLoadFailed()</code>-&gt;è°ƒç”¨<code>notifyLoadFailed()</code>æ–¹æ³•é‡è¯•(å†…éƒ¨ä¼šåˆ¤æ–­æ˜¯å¦éœ€è¦é‡è¯•)-&gt;éœ€è¦åŠ è½½é‡è¯•-&gt;<code>begin</code></p>
]]></content>
      
        <categories>
            
            <category> AndroidåŸºç¡€è¿›é˜¶ </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Android </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[ç©è½¬Classä¹‹Classçš„å„ç§éªšæ“ä½œ(åå°„å°è£…å¿…çœ‹)]]></title>
      <url>/androidclassstudy.html</url>
      <content type="html"><![CDATA[<p><strong>ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºåšä¸»åŸåˆ›æ–‡ç« ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„(www.huangjie.name)ï¼Œä¿æŠ¤åŸåˆ›ï¼Œä»æˆ‘åšèµ·.</strong></p>
<hr>
<blockquote>
<p>æ–‡ç« é¦–å‘äºæˆ‘çš„<a href="https://www.jianshu.com/u/2334b8b9f764" target="_blank" rel="noopener">ç®€ä¹¦</a>,æœ¬å¤„åªåšæ•´ç†å½’æ¡£ç”¨<br><a id="more"></a></p>
</blockquote>
<h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p>Classç±»è¡¨ç¤ºæ­£åœ¨è¿è¡Œçš„Javaåº”ç”¨ç¨‹åºä¸­çš„ç±»å’Œæ¥å£ï¼Œæšä¸¾å’ŒåŸºæœ¬æ•°æ®ç±»å‹ï¼Œæˆ‘ä»¬å¯ä»¥ä»ä¸­è·å–åˆ°ç±»çš„ä¸€åˆ‡ç›¸å…³ä¿¡æ¯ï¼ŒåŒ…æ‹¬å­—æ®µï¼Œæ–¹æ³•ï¼Œåç§°ï¼Œçˆ¶ç±»ï¼Œæ¥å£ç­‰</p>
<h2 id="å¸¸ç”¨æ–¹æ³•ä»‹ç»"><a href="#å¸¸ç”¨æ–¹æ³•ä»‹ç»" class="headerlink" title="å¸¸ç”¨æ–¹æ³•ä»‹ç»"></a>å¸¸ç”¨æ–¹æ³•ä»‹ç»</h2><h4 id="åç§°è·å–"><a href="#åç§°è·å–" class="headerlink" title="åç§°è·å–"></a>åç§°è·å–</h4><p>æ­¤ç±»æ–¹æ³•ç”¨äºè·å–ç±»çš„åç§°ä¿¡æ¯<br><strong>getName()æ–¹æ³•</strong></p>
<ul>
<li><p>å¦‚æœæ˜¯ä¸€ä¸ªå®ä½“ç±»ï¼Œåˆ™ä¼šè¿”å›å®Œæ•´åŒ…åè·¯å¾„åç§°,<br>ä¾‹å¦‚ä½äº<code>com.hj.testclass</code>åŒ…ä¸‹çš„<code>student</code>ç±»ï¼Œåˆ™ä¼šè¿”å›<code>com.hj.testclass.student</code></p>
</li>
<li><p>å¦‚æœæ˜¯ä¸€ä¸ªæ•°ç»„ç±»å‹ï¼Œåˆ™è¿”å›å†…éƒ¨åµŒå¥—æ·±åº¦çš„ä¸€ä¸ªæˆ–å¤šä¸ªâ€[â€œå­—ç¬¦ï¼Œåé¢æ‹¼æ¥ä¸ŠåŸºæœ¬æ•°æ®ç±»å‹çš„äºŒè¿›åˆ¶åç§°,äºŒè¿›åˆ¶åç§°è¡¨å¦‚ä¸‹ï¼š</p>
</li>
</ul>
<table>
<thead>
<tr>
<th>Element Type</th>
<th>Encoding</th>
</tr>
</thead>
<tbody>
<tr>
<td>boolean</td>
<td>Z</td>
</tr>
<tr>
<td>byte</td>
<td>B</td>
</tr>
<tr>
<td>char</td>
<td>C</td>
</tr>
<tr>
<td>class or interface</td>
<td>Lclassname</td>
</tr>
<tr>
<td>double</td>
<td>D</td>
</tr>
<tr>
<td>float</td>
<td>F</td>
</tr>
<tr>
<td>int</td>
<td>I</td>
</tr>
<tr>
<td>long</td>
<td>J</td>
</tr>
<tr>
<td>short</td>
<td>S</td>
</tr>
</tbody>
</table>
<p>ç¤ºä¾‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(new long[1][2][3]).getClass().getName()</span><br><span class="line">è¾“å‡º:</span><br><span class="line">[[[J</span><br></pre></td></tr></table></figure>
<ul>
<li>å¦‚æœæ˜¯åŸºæœ¬æ•°æ®ç±»å‹ï¼Œåˆ™ä¼šè¿”å›æ•°æ®ç±»å‹çš„å…³é”®å­—<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">byte.class.getName()</span><br><span class="line">è¾“å‡ºï¼š</span><br><span class="line">byte</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><strong>getSimpleName()æ–¹æ³•</strong><br>è¿”å›æºä»£ç ä¸­ç»™å‡ºçš„åŸºç¡€ç±»çš„ç®€å•åç§°ã€‚ å¦‚æœåŸºç¡€ç±»æ˜¯åŒ¿åçš„ï¼Œåˆ™è¿”å›ä¸€ä¸ªç©ºå­—ç¬¦ä¸²ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Student student = new Student();</span><br><span class="line">Class mClass = student.getClass();</span><br><span class="line">log(&quot;getSimpleName:&quot;+mClass.getSimpleName());</span><br><span class="line">è¾“å‡ºï¼š</span><br><span class="line">Student</span><br></pre></td></tr></table></figure></p>
<p><strong>getPackage()æ–¹æ³•</strong><br>è¿”å›åŒ…åä¿¡æ¯</p>
<h4 id="æ³¨è§£ç›¸å…³"><a href="#æ³¨è§£ç›¸å…³" class="headerlink" title="æ³¨è§£ç›¸å…³"></a>æ³¨è§£ç›¸å…³</h4><p>å¯è·å–æ­¤ç±»æ˜¯å¦æ˜¯æ³¨è§£ï¼Œæ˜¯å¦åŒ…å«æŸæ³¨è§£å¹¶è·å–åˆ°å…¶å¯¹è±¡ï¼Œè·å–å…¨éƒ¨æ³¨è§£</p>
<table>
<thead>
<tr>
<th>æ–¹æ³•</th>
<th>ä½œç”¨</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>getAnnotation(Class<a> annotationClass)</a></strong></td>
<td>è·å–ä¼ å…¥çš„æ³¨è§£å¯¹è±¡ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œåˆ™è¿”å›null</td>
</tr>
<tr>
<td><strong>getAnnotations()</strong></td>
<td>è¿”å›æ­¤ç±»ä¸Šçš„æ‰€æœ‰æ³¨è§£</td>
</tr>
<tr>
<td><strong>getAnnotationsByType(Class<a> annotationClass)</a></strong></td>
<td>è¿”å›ä¼ å…¥çš„æ³¨è§£å¯¹è±¡æ•°ç»„ï¼Œä¸getAnnotation()çš„åŒºåˆ«æ˜¯æ£€æµ‹ä¼ å…¥çš„æ³¨è§£æ˜¯å¦æ˜¯é‡å¤å…ƒç´ </td>
</tr>
<tr>
<td><strong>isAnnotation()</strong></td>
<td>åˆ¤æ–­è¿™ä¸ªç±»æ˜¯å¦æ˜¯ä¸€ä¸ªæ³¨è§£ç±»</td>
</tr>
<tr>
<td><strong>isAnnotationPresent(Class&lt;? extends Annotation&gt; annotationClass)</strong></td>
<td>æ˜¯å¦åŒ…å«ä¼ å…¥çš„æ³¨è§£ç±»,æ•ˆæœä¸getAnnotation()!=nullç›¸åŒ</td>
</tr>
</tbody>
</table>
<p>ä¸¾ä¸ªæ —å­ï¼š<br>æ–°å»ºä¸€ä¸ªæ³¨è§£å¯¹è±¡ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * Created by hj on 2019/1/10.</span><br><span class="line"> * è¯´æ˜ï¼š</span><br><span class="line"> */</span><br><span class="line">@Retention(RetentionPolicy.RUNTIME)</span><br><span class="line">public @interface MyAnnotation &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ–°å»ºä¸€ä¸ªStudentå¹¶åŠ å…¥<code>@MyAnnotation</code>æ³¨è§£ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * Created by hj on 2019/1/10.</span><br><span class="line"> * è¯´æ˜ï¼š</span><br><span class="line"> */</span><br><span class="line">@MyAnnotation</span><br><span class="line">public class Student&#123;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        Student student = new Student();</span><br><span class="line">        Class studentClass = student.getClass();</span><br><span class="line">        boolean isAnnotation = studentClass.isAnnotation();</span><br><span class="line">        log(studentClass.getSimpleName()+&quot;æ˜¯å¦æ˜¯æ³¨è§£ç±»:&quot;+isAnnotation);</span><br><span class="line">        boolean isContainAnnotation = studentClass.isAnnotationPresent(MyAnnotation.class);</span><br><span class="line">        log(studentClass.getSimpleName()+&quot;æ˜¯å¦åŒ…å«MyAnnotationæ³¨è§£ç±»:&quot;+isContainAnnotation);</span><br><span class="line">        Annotation annotation = studentClass.getAnnotation(MyAnnotation.class);</span><br><span class="line">        Annotation[] annotations = studentClass.getAnnotations();</span><br><span class="line">        if (annotation != null) &#123;</span><br><span class="line">            log(&quot;è·å–æŒ‡å®šçš„MyAnnotationç±»:&quot;+annotation.toString());</span><br><span class="line">        &#125;</span><br><span class="line">        if (annotations.length &gt; 0)&#123;</span><br><span class="line">            log(&quot;è·å–æ³¨è§£é›†åˆä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ :&quot;+annotations[0].toString());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private static void log(String value) &#123;</span><br><span class="line">        System.out.print(value);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>æ‰“å°ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Studentæ˜¯å¦æ˜¯æ³¨è§£ç±»:false</span><br><span class="line">Studentæ˜¯å¦åŒ…å«MyAnnotationæ³¨è§£ç±»:true</span><br><span class="line">è·å–æŒ‡å®šçš„MyAnnotationç±»:@jie.com.imageoptimize.mclass.MyAnnotation()</span><br><span class="line">è·å–æ³¨è§£é›†åˆä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ :@jie.com.imageoptimize.mclass.MyAnnotation()</span><br></pre></td></tr></table></figure></p>
<h4 id="æ„é€ æ–¹æ³•ç›¸å…³"><a href="#æ„é€ æ–¹æ³•ç›¸å…³" class="headerlink" title="æ„é€ æ–¹æ³•ç›¸å…³"></a>æ„é€ æ–¹æ³•ç›¸å…³</h4><p>åœ¨ä»‹ç»æ„é€ æ–¹æ³•ä¹‹å‰ï¼Œå…ˆä»‹ç»ä¸€ä¸ªç±»<code>Constructor</code>,å®ƒçš„ä½œç”¨æ˜¯æä¾›ä¸€ä¸ªç±»çš„å•ä¸ªæ„é€ æ–¹æ³•çš„ä¿¡æ¯è®¿é—®ï¼Œå¦‚æœä¸€ä¸ªç±»æœ‰ä¸¤ä¸ªæ„é€ æ–¹æ³•ï¼Œé‚£ä¹ˆè¿™ä¸ªç±»å°±ä¼šå¯¹åº”æœ‰ä¸¤ä¸ª<code>Constructor</code>ç±»ï¼Œå®ƒå¯ä»¥ä½¿ç”¨<code>newInstance</code>æ–¹æ³•æ¥è¿›è¡Œç±»çš„æ„é€ æ–¹æ³•å®ç°å¹¶è¿›è¡Œæ‰©å±•ï¼Œä½†å¦‚æœå‘ç”Ÿç¼©å°è½¬æ¢åˆ™ä¼šæŠ›å‡º<code>IllegalArgumentException</code>å¼‚å¸¸ï¼Œæ¯”å¦‚è¿™ä¸ªç±»æœ‰ä¸¤ä¸ªæ„é€ å‚æ•°å´åªä¼ å…¥ä¸€ä¸ªï¼Œå°±ä¼šæŠ›å¼‚å¸¸ã€‚<br>è·å–<code>Constructor</code>ä¿¡æ¯çš„æ–¹æ³•æœ‰ï¼š</p>
<table>
<thead>
<tr>
<th>æ–¹æ³•</th>
<th>ä½œç”¨</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>getConstructors()</strong></td>
<td>è¿”å›è¿™ä¸ªç±»çš„å…¬å…±æ„é€ å‡½æ•°çš„ Constructorå¯¹è±¡çš„æ•°ç»„</td>
</tr>
<tr>
<td><strong>getConstructor(Class&lt;?&gt;..parameterTypes)</strong></td>
<td>ä¼ å…¥ä¸€ä¸ªæŒ‡å®šçš„å‚æ•°ç±»å‹æ¥è·å–ç‰¹å®šçš„å…¬å…±æ„é€ æ–¹æ³•ç±»</td>
</tr>
<tr>
<td><strong>getDeclaredConstructors()</strong></td>
<td>ä¸getConstructorsçš„åŒºåˆ«æ˜¯è¿”å›æ‰€æœ‰çš„æ„é€ æ–¹æ³•æ•°ç»„ï¼Œä¸é™äºpublic protected private</td>
</tr>
<tr>
<td><strong>getDeclaredConstructor(Class&lt;?&gt;..parameterTypes)</strong></td>
<td>ä¸getConstructorçš„åŒºåˆ«æ˜¯ä¼šè¿”å›æ‰€æœ‰ç±»å‹çš„æ„é€ æ–¹æ³•</td>
</tr>
</tbody>
</table>
<p>æ¥ä¸‹æ¥ä»‹ç»ä¸€ä¸‹<code>Constructor</code>ç±»çš„<code>newInstance</code>æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•è¯´ç™½äº†å°±æ˜¯æ‰§è¡Œæ„é€ å‡½æ•°çš„ï¼Œä½ ä¼ å…¥ä¸€ä¸ªå½“å‰æ„é€ å‡½æ•°çš„ç±»å‹çš„å€¼è¿›å»ï¼Œé‚£ä¹ˆå°±ä¼šæ‰§è¡Œè¿™ä¸ªç±»çš„æ„é€ æ–¹æ³•ã€‚<br>ä¸‹é¢ä¸¾ä¸€ä¸ªåå°„è°ƒç”¨æ„é€ æ–¹æ³•çš„æ —å­ï¼š<br>æ–°å»ºä¸€ä¸ªStudentç±»ï¼Œåˆ†åˆ«æ·»åŠ ä¸¤ä¸ªç§æœ‰æ„é€ æ–¹æ³•ï¼Œä¸€ä¸ªå…¬æœ‰æ„é€ æ–¹æ³•ï¼Œå¹¶æ·»åŠ ä¸¤ä¸ªå‚æ•°ï¼Œåœ¨æ„é€ æ–¹æ³•å¤„æ‰§è¡Œæ‰“å°é€»è¾‘ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * Created by hj on 2019/1/10.</span><br><span class="line"> * è¯´æ˜ï¼š</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">public class Student &#123;</span><br><span class="line"></span><br><span class="line">    private String name;</span><br><span class="line">    private int age;</span><br><span class="line"></span><br><span class="line">    private Student() &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Student(String name) &#123;</span><br><span class="line">        this.name = name;</span><br><span class="line">        log(&quot;å…¬æœ‰æ„é€ æ–¹æ³•æ‰§è¡Œäº†ï¼Œæ‰“å°ä¼ å…¥çš„åç§°ä¸º:&quot;+name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private Student(int age)&#123;</span><br><span class="line">        this.age = age;</span><br><span class="line">        log(&quot;ç§æœ‰æ„é€ æ–¹æ³•æ‰§è¡Œäº†ï¼Œæ‰“å°ä¼ å…¥çš„å¹´é¾„ä¸º:&quot;+age);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        Student student = new Student();</span><br><span class="line">        Class mClass = student.getClass();</span><br><span class="line">        Constructor[] constructors = mClass.getConstructors();</span><br><span class="line">        log(&quot;è·å–&quot; + mClass.getSimpleName() + &quot;çš„å…¬å…±æ„é€ æ–¹æ³•æ•°é‡ä¸º:&quot; + constructors.length);</span><br><span class="line">        try &#123;</span><br><span class="line">            Constructor constructor = mClass.getConstructor(String.class);</span><br><span class="line"></span><br><span class="line">            constructor.newInstance(&quot;å¼ ä¸‰&quot;);</span><br><span class="line"></span><br><span class="line">        &#125; catch (NoSuchMethodException | IllegalAccessException | InstantiationException | InvocationTargetException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        Constructor[] declaredConstructors = mClass.getDeclaredConstructors();</span><br><span class="line">        log(&quot;è·å–&quot; + mClass.getSimpleName() + &quot;çš„æ‰€æœ‰æ„é€ æ–¹æ³•æ•°é‡ä¸º:&quot; + declaredConstructors.length);</span><br><span class="line">        try &#123;</span><br><span class="line">            Constructor constructor = mClass.getDeclaredConstructor(int.class);</span><br><span class="line"></span><br><span class="line">            constructor.newInstance(18);</span><br><span class="line"></span><br><span class="line">        &#125; catch (NoSuchMethodException | IllegalAccessException | InstantiationException | InvocationTargetException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private static void log(String value) &#123;</span><br><span class="line">        System.out.print(value);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰“å°ç»“æœå¦‚ä¸‹ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">è·å–Studentçš„å…¬å…±æ„é€ æ–¹æ³•æ•°é‡ä¸º:1</span><br><span class="line">å…¬æœ‰æ„é€ æ–¹æ³•æ‰§è¡Œäº†ï¼Œæ‰“å°ä¼ å…¥çš„åç§°ä¸º:å¼ ä¸‰</span><br><span class="line">è·å–Studentçš„æ‰€æœ‰æ„é€ æ–¹æ³•æ•°é‡ä¸º:3</span><br><span class="line">ç§æœ‰æ„é€ æ–¹æ³•æ‰§è¡Œäº†ï¼Œæ‰“å°ä¼ å…¥çš„å¹´é¾„ä¸º:18</span><br></pre></td></tr></table></figure></p>
<p>æ€ä¹ˆæ ·ï¼Œåå°„è°ƒç”¨ç±»çš„æ„é€ æ–¹æ³•æŠ€èƒ½getåˆ°äº†å—</p>
<h5 id="å­—æ®µç›¸å…³"><a href="#å­—æ®µç›¸å…³" class="headerlink" title="å­—æ®µç›¸å…³"></a>å­—æ®µç›¸å…³</h5><p>æ­¤ç±»å‹æ–¹æ³•æ˜¯ç”¨çš„æœ€å¤šçš„ä¸€ç§ï¼Œå¸Œæœ›å°ä¼™ä¼´ä»¬å¯ä»¥ç†Ÿç»ƒæŒæ¡<br>åœ¨ä»‹ç»å­—æ®µæ–¹æ³•ä¹‹å‰ï¼Œå…ˆä»‹ç»ä¸€ä¸ªç±»<code>Field</code>,å®ƒç”¨äºä¿å­˜ï¼Œä¿®æ”¹å­—æ®µçš„ä¿¡æ¯ï¼Œç”šè‡³å¯ä»¥ä¿®æ”¹å­—æ®µçš„è®¿é—®æƒé™,å¸¸ç”¨çš„æ–¹æ³•å¦‚ä¸‹:</p>
<table>
<thead>
<tr>
<th>æ–¹æ³•</th>
<th>ä½œç”¨</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>getName()</strong></td>
<td>è·å–å­—æ®µåç§°</td>
</tr>
<tr>
<td><strong>get()</strong></td>
<td>ä¼ å…¥éœ€è¦è·å–çš„å€¼çš„ç±»çš„å¯¹è±¡ï¼Œè·å–è¯¥å­—æ®µçš„å€¼,è¿”å›objectç±»å‹ï¼Œä½¿ç”¨çš„æ—¶å€™éœ€è¦åšç±»å‹åˆ¤æ–­</td>
</tr>
<tr>
<td><strong>getBoolean(),getInt()â€¦</strong></td>
<td>è·å–æŒ‡å®šç±»å‹çš„å­—æ®µå€¼</td>
</tr>
<tr>
<td><strong>set()ï¼ŒsetBoolean()â€¦</strong></td>
<td>å°†æŒ‡å®šçš„ç±»çš„æŒ‡å®šå€¼è®¾ç½®ä¸ºæ–°å€¼</td>
</tr>
<tr>
<td><strong>isAccessible()</strong></td>
<td>åˆ¤æ–­æ­¤å­—æ®µæ˜¯å¦æœ‰è®¿é—®æƒé™</td>
</tr>
<tr>
<td><strong>setAccessible()</strong></td>
<td>è®¾ç½®å­—æ®µçš„æƒé™ï¼Œä¸ºtrueä»£è¡¨å¯ä»¥è®¿é—®</td>
</tr>
</tbody>
</table>
<p>æ¥ä¸‹æ¥å†æ¥çœ‹çœ‹å¦‚ä½•ä½¿ç”¨Classæ¥è·å–å­—æ®µä¿¡æ¯:</p>
<table>
<thead>
<tr>
<th>æ–¹æ³•</th>
<th>ä½œç”¨</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>getFields()</strong></td>
<td>è·å–æ‰€æœ‰çš„å…¬å…±å­—æ®µ</td>
</tr>
<tr>
<td><strong>getField()</strong></td>
<td>ä¼ å…¥å­—æ®µçš„åç§°ï¼Œè¿”å›å…¬å…±å­—æ®µå¯¹è±¡</td>
</tr>
<tr>
<td><strong>getDeclaredFields()</strong></td>
<td>è·å–æ‰€æœ‰å­—æ®µï¼Œè¿”å›ä¸€ä¸ªFieldæ•°ç»„</td>
</tr>
<tr>
<td><strong>getDeclaredField</strong></td>
<td>ä¼ å…¥å­—æ®µçš„åç§°ï¼Œè¿”å›å­—æ®µå¯¹è±¡,æ— è®¿é—®é™åˆ¶</td>
</tr>
</tbody>
</table>
<p>ä¸‹é¢ä¸¾ä¸ªè·å–å­—æ®µåç§°å’Œå†…å®¹çš„ä¾‹å­ï¼Œå¹¶åˆ†äº«ä¸€ä¸ªå¸¸ç”¨çš„å¥—è·¯å†™æ³•ï¼Œä¸€èˆ¬çš„éƒ½å¯ä»¥æŒ‰ç…§è¿™ä¸ªå¥—è·¯æ¥å†™ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * Created by hj on 2019/1/10.</span><br><span class="line"> * è¯´æ˜ï¼š</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">public class Student &#123;</span><br><span class="line"></span><br><span class="line">    public String name;</span><br><span class="line">    private int age;</span><br><span class="line"></span><br><span class="line">    public Student(String name, int age) &#123;</span><br><span class="line">        this.name = name;</span><br><span class="line">        this.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        Student student = new Student(&quot;å¼ ä¸‰&quot;, 18);</span><br><span class="line">        setAllComponentsName(student);</span><br><span class="line">    &#125;</span><br><span class="line">   </span><br><span class="line">    private static void setAllComponentsName(Object f) &#123;</span><br><span class="line">        Field[] fields = f.getClass().getDeclaredFields();</span><br><span class="line">        for (Field field : fields) &#123;</span><br><span class="line">            // å¯¹äºæ¯ä¸ªå±æ€§ï¼Œè·å–å±æ€§å</span><br><span class="line">            String varName = field.getName();</span><br><span class="line">            try &#123;</span><br><span class="line">                // è·å–åŸæ¥çš„è®¿é—®æ§åˆ¶æƒé™</span><br><span class="line">                boolean accessFlag = field.isAccessible();</span><br><span class="line">                // ä¿®æ”¹è®¿é—®æ§åˆ¶æƒé™</span><br><span class="line">                field.setAccessible(true);</span><br><span class="line">                // è·å–åœ¨å¯¹è±¡fä¸­å±æ€§fields[i]å¯¹åº”çš„å¯¹è±¡ä¸­çš„å˜é‡</span><br><span class="line">                Object o = field.get(f);</span><br><span class="line">                if (!&quot;&quot;.equals(varName)) &#123;</span><br><span class="line">                    //è¿™é‡Œå¯ä»¥å¤„ç†ç›¸å…³é€»è¾‘</span><br><span class="line">                    if (o != null) &#123;</span><br><span class="line">                        if (o instanceof String) &#123;</span><br><span class="line">                            String value = (String) o;</span><br><span class="line">                            log(&quot;Stringç±»å‹å­—æ®µ:&quot; + value);</span><br><span class="line">                        &#125; else if (o instanceof Integer) &#123;</span><br><span class="line">                            int value = (int) o;</span><br><span class="line">                            log(&quot;intç±»å‹å­—æ®µ:&quot; + value);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                // æ¢å¤è®¿é—®æ§åˆ¶æƒé™</span><br><span class="line">                field.setAccessible(accessFlag);</span><br><span class="line">            &#125; catch (IllegalArgumentException | IllegalAccessException ex) &#123;</span><br><span class="line">                ex.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private static void log(String value) &#123;</span><br><span class="line">        System.out.print(value);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰“å°ç»“æœï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Stringç±»å‹å­—æ®µ:å¼ ä¸‰</span><br><span class="line">intç±»å‹å­—æ®µ:18</span><br></pre></td></tr></table></figure></p>
<p>ä¸€èˆ¬éƒ½æ˜¯å…ˆå°†æƒé™ä¿®æ”¹ä¸ºtrue,å†å»è¯»å–å­—æ®µå†…å®¹ï¼Œéšåè¿›è¡Œé€»è¾‘å¤„ç†ï¼Œæœ€åè®°å¾—å°†æƒé™æ”¹å›æ¥.</p>
<h5 id="æ–¹æ³•ç›¸å…³"><a href="#æ–¹æ³•ç›¸å…³" class="headerlink" title="æ–¹æ³•ç›¸å…³"></a>æ–¹æ³•ç›¸å…³</h5><p>æ­¤ç±»å‹æ–¹æ³•ä¹Ÿæ˜¯ç”¨çš„æ¯”è¾ƒå¤šçš„ä¸€ç§ï¼Œæ˜¯åå°„è°ƒç”¨æ–¹æ³•çš„å…³é”®<br>classä¸­å…³äºæ–¹æ³•çš„å°è£…éƒ½æ˜¯ç»™<code>Method</code>ç±»æ¥æ“ä½œçš„ï¼Œå®ƒå¯ä»¥è·å–ï¼Œä¿®æ”¹ï¼Œæ‰§è¡Œç±»çš„æ–¹æ³•ï¼Œæ ¸å¿ƒæ–¹æ³•å°±æ˜¯<code>invoke()</code>ï¼Œä½œç”¨æ˜¯æ‰§è¡Œæ–¹æ³•ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯éœ€è¦æ‰§è¡Œçš„æ–¹æ³•çš„ç±»å¯¹è±¡ï¼Œéšåæ˜¯éœ€è¦æ‰§è¡Œçš„æ–¹æ³•å‚æ•°å€¼ã€‚<br>è·å–<code>Method</code>å¯¹è±¡æœ‰å››ä¸ªæ–¹æ³•:</p>
<table>
<thead>
<tr>
<th>æ–¹æ³•</th>
<th>ä½œç”¨</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>getMethods()</strong></td>
<td>è·å–ç±»çš„æ‰€æœ‰å…¬å…±æ–¹æ³•</td>
</tr>
<tr>
<td><strong>getMethod()</strong></td>
<td>è·å–æŒ‡å®šå…¬å…±æ–¹æ³•ï¼Œä¼ å…¥ä¸€ä¸ªæ–¹æ³•çš„åç§°ä¸å‚æ•°çš„ç±»å‹</td>
</tr>
<tr>
<td><strong>getDeclaredMethods()</strong></td>
<td>è·å–ç±»çš„æ‰€æœ‰æ–¹æ³•</td>
</tr>
<tr>
<td><strong>getDeclaredMethod()</strong></td>
<td>è·å–ç±»çš„æŒ‡å®šæ–¹æ³•ï¼Œä¼ å…¥å‚æ•°åŒgetMethod()</td>
</tr>
</tbody>
</table>
<p>ä¸¾ä¸ªä¾‹å­ï¼Œå°†æœ¬æ¥ä¸ºå¼ ä¸‰çš„åç§°ä¿®æ”¹ä¸ºæå››ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * Created by hj on 2019/1/10.</span><br><span class="line"> * è¯´æ˜ï¼š</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">public class Student &#123;</span><br><span class="line"></span><br><span class="line">    public String name;</span><br><span class="line">    private int age;</span><br><span class="line"></span><br><span class="line">    public Student(String name, int age) &#123;</span><br><span class="line">        this.name = name;</span><br><span class="line">        this.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private void setName(String name)&#123;</span><br><span class="line">        this.name = name;</span><br><span class="line">        log(&quot;è®¾ç½®çš„åç§°ä¸ºï¼š&quot;+name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        Student student = new Student(&quot;å¼ ä¸‰&quot;, 18);</span><br><span class="line">        Class mClass = student.getClass();</span><br><span class="line">        try &#123;</span><br><span class="line">            Method method = mClass.getDeclaredMethod(&quot;setName&quot;,String.class);</span><br><span class="line">            method.invoke(student,&quot;æå››&quot;);</span><br><span class="line">        &#125; catch (NoSuchMethodException | IllegalAccessException | InvocationTargetException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    private static void log(String value) &#123;</span><br><span class="line">        System.out.print(value);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰“å°ç»“æœ:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">è®¾ç½®çš„åç§°ä¸ºï¼šæå››</span><br></pre></td></tr></table></figure></p>
<p>åœ¨é¡¹ç›®ä¸­ä½¿ç”¨ï¼Œå¯ä»¥å‚è€ƒä¸Šé¢çš„<code>Field</code>ç±»ï¼Œå…¶å®éƒ½æ˜¯å·®ä¸å¤šçš„ï¼Œä¸€é€šç™¾é€šã€‚</p>
<h5 id="æŠ½è±¡-ç»§æ‰¿-æ¥å£-æ³›å‹ç›¸å…³"><a href="#æŠ½è±¡-ç»§æ‰¿-æ¥å£-æ³›å‹ç›¸å…³" class="headerlink" title="æŠ½è±¡,ç»§æ‰¿,æ¥å£,æ³›å‹ç›¸å…³"></a>æŠ½è±¡,ç»§æ‰¿,æ¥å£,æ³›å‹ç›¸å…³</h5><p>æ­¤ç±»æ–¹æ³•è™½ç„¶ä¸å¸¸ç”¨åˆ°ï¼Œä½†åœ¨æŸäº›æƒ…å†µä¸‹èƒ½å‘æŒ¥æ„æƒ³ä¸åˆ°çš„ä½œç”¨ï¼Œåœ¨è®¸å¤šæ¡†æ¶çš„æºç ä¸­ä¹Ÿèƒ½çœ‹è§å®ƒä»¬çš„èº«å½±ï¼Œå¦‚<code>Gson</code>çš„<code>$Gson$Types</code>ç±»,<code>Retrofit</code>çš„<code>Util</code>ç±»ç­‰ï¼Œæ¥è·Ÿæˆ‘å­¦ä¹ ä¸€ä¸‹æŠŠã€‚</p>
<p><strong>æ³›å‹</strong><br>é¦–å…ˆè¯´è¯´è·å–ç±»çš„æ³›å‹è·å–ï¼Œå…ˆä»‹ç»ä¸€ä¸ªæ¥å£<code>Type</code>,å®ƒæ˜¯javaä¸­æ‰€æœ‰ç±»å‹çš„é€šç”¨æ¥å£ï¼Œç±»å‹åŒ…æ‹¬åŸå§‹ç±»å‹(class)ï¼Œå‚æ•°åŒ–ç±»å‹(ParameterizedType)ï¼Œæ•°ç»„ç±»å‹(GenericArrayType)ï¼Œç±»å‹å˜é‡(TypeVariable)å’ŒåŸºæœ¬æ•°æ®ç±»å‹ã€‚å†…éƒ¨å®ç°äº†ä¸€ä¸ªæ–¹æ³•<code>getTypeName()</code>,ç”¨äºè¿”å›ç±»å‹å‚æ•°ä¿¡æ¯ï¼ŒåŸºäºå®ƒå‘å¤–æ‰©å±•çš„æ¥å£æœ‰ï¼š</p>
<ul>
<li>ParameterizedType<br>è¡¨ç¤ºä¸€ä¸ªå‚æ•°åŒ–ç±»å‹ï¼Œè¯´ç®€å•ç‚¹å°±æ˜¯å¸¦æœ‰å‚æ•°ç±»å‹çš„ç±»å‹ï¼Œå¦‚Collection ,å¦‚æœå¸¦æœ‰äº†ç±»å‹ï¼Œå¦‚Collection<string>ï¼Œé‚£ä¹ˆå°±æ˜¯è¯´Stringå°†Collectionå‚æ•°åŒ–</string></li>
<li>GenericArrayType<br>è¡¨ç¤ºä¸€ä¸ªå‚æ•°åŒ–ç±»å‹æˆ–ç±»å‹å˜é‡çš„æ•°ç»„ç±»å‹ï¼Œç®€å•è¯´å°±æ˜¯æ³›å‹A<t>[]æˆ–æ³›å‹æ•°ç»„T[]</t></li>
<li>TypeVariable<br>æ‰€æœ‰ç±»å‹å˜é‡çš„çˆ¶æ¥å£,ä¹Ÿå°±æ˜¯æˆ‘ä»¬å®šä¹‰æŠ½è±¡ç±»ä¸­çš„é‚£ç§K,Eç­‰æ³›å‹å˜é‡ï¼Œå¯ä»¥æ³›æŒ‡ä»»ä½•ç±»</li>
<li>WildcardType<br>è¡¨ç¤ºä¸€ä¸ªé€šé…ç¬¦è¡¨è¾¾ï¼Œä¾‹å¦‚?,? extends Integer<br><code>Type</code>å¯ä»¥é€šè¿‡<code>class</code>çš„<code>getGenericInterfaces</code>æˆ–<code>getGenericSuperclass()</code>æ–¹æ³•æ¥è·å–<br>è¿™ä¹ˆè¯´æˆ–è®¸è¿˜æœ‰ç‚¹æŠ½è±¡ï¼Œ<code>ParameterizedType</code>ä¸<code>TypeVariable</code>çš„æ¦‚å¿µæˆ–è®¸è¿˜æ‹ä¸å¤ªæ¸…ã€‚ä¸‹é¢é€šè¿‡ç¤ºä¾‹æ¥åŠ æ·±ç†è§£<br>å…ˆæ¥è¯´è¯´ParameterizedType<br>ä¸¾ä¸ªä¾‹å­ï¼Œå…ˆå£°æ˜ä¸€ä¸ªå¸¦æ³›å‹çš„è¶…ç±»<code>Person</code></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * Created by hj on 2019/1/10.</span><br><span class="line"> * è¯´æ˜ï¼š</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">public class Person&lt;T&gt; &#123;</span><br><span class="line"></span><br><span class="line">    public T feature;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>éšåå®šä¹‰ä¸€ä¸ªå®ä½“ç±»<code>Feature</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * Created by hj on 2019/1/10.</span><br><span class="line"> * è¯´æ˜ï¼š</span><br><span class="line"> */</span><br><span class="line">public class Feature &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>æœ€åç”³æ˜ä¸€ä¸ª<code>Student</code>å¹¶ç»§æ‰¿<code>Person</code>,å°†<code>Feature</code>ä½œä¸º<code>T</code>ä¼ å…¥:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * Created by hj on 2019/1/10.</span><br><span class="line"> * è¯´æ˜ï¼š</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">public class Student extends Person&lt;Feature&gt; &#123;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        Student student = new Student();</span><br><span class="line">        Class mClass = student.getClass();</span><br><span class="line">        Type type = mClass.getGenericSuperclass();</span><br><span class="line">        //è¿™é‡Œè·å–çš„typeä¸ºPerson&lt;Feature&gt;ï¼Œæ‰€ä»¥å±äºParameterizedType</span><br><span class="line">        if (type instanceof ParameterizedType) &#123;</span><br><span class="line">            //çˆ¶ç±»çš„æ³›å‹å¯èƒ½æœ‰å¤šä¸ªï¼Œè¿™é‡Œåªå†™äº†ä¸€ä¸ªï¼Œæ‰€ä»¥å–ç¬¬ä¸€ä¸ªå°±è¡Œäº†ï¼Œè¿™é‡Œæ˜¯å–Person&lt;Feature&gt;ä¸­çš„Feature</span><br><span class="line">            Class tClass = (Class) ((ParameterizedType) type).getActualTypeArguments()[0];</span><br><span class="line">            log(tClass.getSimpleName());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    private static void log(String value) &#123;</span><br><span class="line">        System.out.print(value);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>å› ä¸º<code>Class</code>ç±»ä¹Ÿå®ç°äº†<code>Type</code>æ¥å£ï¼Œæ‰€ä»¥æ˜¯å¯ä»¥å¼ºåˆ¶è½¬åŒ–çš„<br>æ‰“å°ç»“æœå¦‚ä¸‹:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Feature</span><br></pre></td></tr></table></figure></p>
<p>å¯ä»¥çœ‹åˆ°åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œåªè¦æ˜¯<code>Person&lt;&gt;</code>ä¸­ä¼ å…¥çš„å‚æ•°æ˜¯ä¸€ä¸ªå‚æ•°ç±»å‹ï¼Œä¸ç®¡æ˜¯<code>å®ä½“ç±»</code>ï¼Œ<code>String</code>éƒ½è¡Œï¼Œåªè¦æ˜¯å‚æ•°è€Œæ²¡æœ‰æ³›æŒ‡æ„ä¹‰ï¼Œé‚£ä¹ˆå®ƒå°±å±äº<code>ParameterizedType</code>ç±»å‹<br>æ¥ä¸‹æ¥å°†ä»£ç ä¿®æ”¹ä¸€ä¸‹ï¼Œå°†<code>Feature</code>æ”¹ä¸º<code>T</code>,ä¿®æ”¹è·å–é€»è¾‘ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * Created by hj on 2019/1/10.</span><br><span class="line"> * è¯´æ˜ï¼š</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">public class Student&lt;T&gt; extends Person&lt;T&gt; &#123;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        Student student = new Student();</span><br><span class="line">        Class mClass = student.getClass();</span><br><span class="line">        Type type = mClass.getGenericSuperclass();</span><br><span class="line">       //æ­¤æ—¶è¿™é‡Œçš„typeä¸ºPerson&lt;T&gt;ï¼Œè€Œä¸æ˜¯Tï¼Œæ‰€ä»¥ä¾æ—§å±äºParameterizedType</span><br><span class="line">        if (type instanceof ParameterizedType) &#123;</span><br><span class="line">           //è¿™é‡Œæ˜¯ä»Person&lt;T&gt;ä¸­è·å–T</span><br><span class="line">            Type childType = ((ParameterizedType)type).getActualTypeArguments()[0];</span><br><span class="line">            if (childType instanceof TypeVariable)&#123;</span><br><span class="line">                log(((TypeVariable) childType).getName());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    private static void log(String value) &#123;</span><br><span class="line">        System.out.print(value);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>è¾“å‡ºåç§°ä¸º<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">T</span><br></pre></td></tr></table></figure></p>
<p>ä¸çŸ¥é“å°ä¼™ä¼´ä»¬æœ‰æ²¡æœ‰ç†è§£äº†ï¼Œå½“è·å–çš„ç±»å‹æ˜¯æ³›æŒ‡çš„ï¼Œå¦‚Tç­‰ï¼Œé‚£ä¹ˆå°±æ˜¯<code>TypeVariable</code>ç±»å‹ï¼Œå½“ç±»å‹æ˜¯å‚æ•°ç±»å‹çš„ï¼Œä¾‹å¦‚ç”±å­ç±»ä¼ å…¥çš„ï¼Œå…·ä½“åŒ–çš„ï¼Œé‚£ä¹ˆå°±æ˜¯<code>ParameterizedType</code>ç±»å‹ã€‚<br>æ¥ä¸‹æ¥çš„<code>GenericArrayType</code>å’Œ<code>WildcardType</code>å°±æ¯”è¾ƒå¥½ç†è§£äº†ï¼Œå°†ä»¥ä¸Šç¤ºä¾‹ä¸­çš„<code>Person&lt;T&gt;</code>æ”¹ä¸º<code>Person&lt;T[]&gt;</code>ï¼Œå°†ç»“æœè¾“å‡ºï¼Œä»£ç å¦‚ä¸‹ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * Created by hj on 2019/1/10.</span><br><span class="line"> * è¯´æ˜ï¼š</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">public class Student&lt;T&gt; extends Person&lt;T[]&gt; &#123;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        Student student = new Student();</span><br><span class="line">        Class mClass = student.getClass();</span><br><span class="line">        Type type = mClass.getGenericSuperclass();</span><br><span class="line">        if (type instanceof ParameterizedType) &#123;</span><br><span class="line">            //è¿™é‡Œè·å–åˆ°çš„ç±»å‹ä¸ºï¼šT[],æ˜¯ä¸€ä¸ªæ•°ç»„ç±»å‹ï¼Œæ‰€ä»¥æ˜¯GenericArrayType</span><br><span class="line">            Type childType = ((ParameterizedType)type).getActualTypeArguments()[0];</span><br><span class="line">            if (childType instanceof GenericArrayType)&#123;</span><br><span class="line">                log(childType.toString());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    private static void log(String value) &#123;</span><br><span class="line">        System.out.print(value);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>è¾“å‡ºåç§°ä¸ºï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">T[]</span><br></pre></td></tr></table></figure></p>
<p><code>WildcardType</code>å°±ä¸æ¼”ç¤ºäº†ï¼Œå°†<code>T</code>æ”¹ä¸ºå¸¦<code>ï¼Ÿ</code>çš„ç±»å‹å°±å¯ä»¥äº†ï¼Œå¦‚æœå°è£…ç±»å‹å®åœ¨å¤ªå¤æ‚ï¼Œæ•™å¤§å®¶ä¸€ä¸ªæŠ€å·§ï¼Œæ‰“ä¸ªæ–­ç‚¹ï¼Œå•¥ç±»å‹éƒ½å¸®ä½ æ˜¾ç¤ºå‡ºæ¥äº†ã€‚<br><img src="https://upload-images.jianshu.io/upload_images/3468978-115865cd6cbf0d07.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="æ–­ç‚¹è¯†åˆ«å‚æ•°ç±»å‹.png"><br>ä¸€çœ‹å°±çŸ¥é“æ˜¯ParameterizedTypeç±»å‹äº†ï¼Œå“ˆå“ˆå“ˆï¼Œæºœä¸æºœã€‚</p>
<p>è¿™é‡Œç»™å°ä¼™ä¼´ä¸€ä¸ªä½œä¸šï¼š<br><code>List&lt;? extends T&gt;[]</code>ä¸­çš„<code>List&lt;? extends T&gt;</code>,<code>? extends T</code>ï¼Œ<code>T</code> ,<code>List&lt;? extends T&gt;[]</code>åˆ†åˆ«ä»£è¡¨ä»€ä¹ˆç±»å‹å‘¢ï¼Ÿ</p>
<p><strong>ç»§æ‰¿</strong><br>è·å–çˆ¶çº§ç±»ä½¿ç”¨<code>Class.getSuperclass()</code>æ–¹æ³•å³å¯è·å–çˆ¶ç±»çš„<code>class</code></p>
<p><strong>æ¥å£</strong><br>è·å–æ¥å£ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œä¸€ä¸ªæ¥å£å®é™…ä¸Šä¹Ÿæ˜¯ä¸€ä¸ªClassç±»ï¼Œé€šè¿‡<code>getInterfaces()</code>è·å–åˆ°ä¸€ä¸ª<code>Class</code>æ•°ç»„ï¼Œè€Œæ¥å£é‡Œå£°æ˜çš„æ–¹æ³•å¯ä»¥é€šè¿‡è·å–<code>Method</code>çš„æ–¹å¼æ¥è·å–,<br>ä¸¾ä¸ªæ —å­ï¼Œå…ˆåˆ›å»ºä¸€ä¸ª<code>MyInterface</code>æ¥å£<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * Created by hj on 2019/1/11.</span><br><span class="line"> * è¯´æ˜ï¼š</span><br><span class="line"> */</span><br><span class="line">public interface MyInterface &#123;</span><br><span class="line">    void getName();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>åœ¨<code>Student</code>ç±»é‡Œå®ç°å¹¶è·å–ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * Created by hj on 2019/1/10.</span><br><span class="line"> * è¯´æ˜ï¼š</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">public class Student implements MyInterface&#123;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        Student student = new Student();</span><br><span class="line">        Class mClass = student.getClass();</span><br><span class="line">        Class interfaces = mClass.getInterfaces()[0];</span><br><span class="line">        try &#123;</span><br><span class="line">            Method methods = interfaces.getMethod(&quot;getName&quot;,null);</span><br><span class="line">            log(methods.getName());</span><br><span class="line">        &#125; catch (NoSuchMethodException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private static void log(String value) &#123;</span><br><span class="line">        System.out.print(value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void getName() &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>æ‰“å°å‡ºæ–¹æ³•åä¸ºï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">getName</span><br></pre></td></tr></table></figure></p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>åªè¦æ‹¿åˆ°Classç±»ï¼Œæˆ‘ä»¬å°±å¯ä»¥è·å–åˆ°å®ƒçš„çˆ¶ç±»ï¼Œæ¥å£ï¼Œæ–¹æ³•ï¼Œå­—æ®µï¼Œä»¥åŠæ³›å‹ï¼Œä»è€Œåšä¸€äº›è§£è€¦å°è£…ï¼Œæé«˜ç±»çš„è§£è€¦æ€§ã€‚æˆ–è€…åœ¨ä¸ä¿®æ”¹æºç çš„æƒ…å†µä¸‹æ‰§è¡Œæˆ–ä¿®æ”¹æºç ä¸­çš„æ–¹æ³•ï¼Œå­—æ®µï¼Œä»è€Œè¾¾åˆ°ç†æƒ³ä¸­çš„æ•ˆæœã€‚å°ä¼™ä¼´ä»¬å¿«å»ç»ƒä¹ ä¸€ä¸‹æŠŠã€‚</p>
]]></content>
      
        <categories>
            
            <category> AndroidåŸºç¡€è¿›é˜¶ </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Android </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Androidæ€§èƒ½ä¼˜åŒ–-å›¾ç‰‡ç¯‡]]></title>
      <url>/Android%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96-%E5%9B%BE%E7%89%87%E7%AF%87.html</url>
      <content type="html"><![CDATA[<p><strong>ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºåšä¸»åŸåˆ›æ–‡ç« ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„(www.huangjie.name)ï¼Œä¿æŠ¤åŸåˆ›ï¼Œä»æˆ‘åšèµ·.</strong></p>
<hr>
<blockquote>
<p>æ–‡ç« é¦–å‘äºæˆ‘çš„<a href="https://www.jianshu.com/u/2334b8b9f764" target="_blank" rel="noopener">ç®€ä¹¦</a>,æœ¬å¤„åªåšæ•´ç†å½’æ¡£ç”¨<br><a id="more"></a></p>
</blockquote>
<h3 id="1-drawableç›®å½•è¯¦è§£-mdpi-hdpi-xhdpi-xxhdpi-xxxhdpi"><a href="#1-drawableç›®å½•è¯¦è§£-mdpi-hdpi-xhdpi-xxhdpi-xxxhdpi" class="headerlink" title="(1)drawableç›®å½•è¯¦è§£(mdpi,hdpi,xhdpi,xxhdpi,xxxhdpi)"></a>(1)drawableç›®å½•è¯¦è§£(mdpi,hdpi,xhdpi,xxhdpi,xxxhdpi)</h3><h4 id="1-1ã€å›¾ç‰‡åœ¨å„ä¸ªç›®å½•ä¸­è¦å¦‚ä½•å­˜æ”¾ï¼Ÿï¼ˆå¿…é¡»ç†è§£ï¼‰"><a href="#1-1ã€å›¾ç‰‡åœ¨å„ä¸ªç›®å½•ä¸­è¦å¦‚ä½•å­˜æ”¾ï¼Ÿï¼ˆå¿…é¡»ç†è§£ï¼‰" class="headerlink" title="1.1ã€å›¾ç‰‡åœ¨å„ä¸ªç›®å½•ä¸­è¦å¦‚ä½•å­˜æ”¾ï¼Ÿï¼ˆå¿…é¡»ç†è§£ï¼‰"></a>1.1ã€å›¾ç‰‡åœ¨å„ä¸ªç›®å½•ä¸­è¦å¦‚ä½•å­˜æ”¾ï¼Ÿï¼ˆå¿…é¡»ç†è§£ï¼‰</h4><p>androidçš„drawableç›®å½•æœ‰ï¼š</p>
<ul>
<li>drawable-ldpi(ä½å¯†åº¦) </li>
<li>drawable-mdpi(ä¸­ç­‰å¯†åº¦)</li>
<li>drawable-hdpi(é«˜å¯†åº¦)</li>
<li>drawable-xhdpi(è¶…é«˜å¯†åº¦)</li>
<li>drawable-xxhdpi(è¶…è¶…é«˜å¯†åº¦)</li>
<li>drawable-xxxhdpi(è¶…è¶…è¶…é«˜å¯†åº¦)</li>
<li>drawable-nohdpi(æ— ç¼©æ”¾)</li>
<li>é»˜è®¤çš„drawable</li>
</ul>
<p>è€Œå®‰å“åŠ è½½å›¾ç‰‡çš„åŸç†æ˜¯æ ¹æ®æ‰‹æœºçš„å¯†åº¦(dpi)æ¥é€‰æ‹©ä¸åŒçš„æ–‡ä»¶å¤¹ä¸‹çš„å›¾ç‰‡,å¦‚æœæ²¡æœ‰ï¼Œå°±ä¼šä»åˆ«çš„å¯†åº¦æ–‡ä»¶å¤¹æ¥è·å–å›¾ç‰‡å¹¶æŒ‰ç…§ä¸€å®šæ¯”ä¾‹æ¥ç¼©æ”¾å±•ç¤ºå›¾ç‰‡ã€‚è·å–è®¾å¤‡å¯†åº¦çš„æ–¹æ³•ä¸ºï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">float xdpi = getResources().getDisplayMetrics().xdpi;</span><br><span class="line">float ydpi = getResources().getDisplayMetrics().ydpi;</span><br></pre></td></tr></table></figure></p>
<p>çŸ¥é“äº†dpi,å°±çŸ¥é“ä¼šå»å“ªä¸ªæ–‡ä»¶å¤¹è·å–å›¾ç‰‡äº†:<br>|  å¯¹åº”æ–‡ä»¶å¤¹ | å¯†åº¦èŒƒå›´ï¼ˆdpiï¼‰| ç¼©æ”¾æ¯”ä¾‹ |<br>| â€”â€”| â€”â€”| â€”â€”|<br>|  ldpi |  0~120     | 0.75 |<br>| mdpi |120~160 | 1(åŸºå‡†)|<br>| hdpi |160~240 | 1.5 |<br>| xhdpi |240~320 | 2.0 |<br>| xxhdpi |320~480 | 3.0 |<br>| xxxhdpi |480~640 | 4.0|<br>è€Œå½“å‰çš„ä¸»æµæœºå‹å¯†åº¦åŸºæœ¬éƒ½æ˜¯åœ¨320~480ä¹‹é—´ï¼Œä¸€èˆ¬æ”¾ä¸¤å¥—å›¾å°±å¤Ÿäº†ï¼Œä¸€å¥—æ”¾åˆ°xhdpi,ä¸€å¥—æ”¾åˆ°xxhdpi,é‚£ä¹ˆå¦‚æœæ˜¯ä¸€ä¸ªhdpiçš„æ‰‹æœºæ¥è¿è¡Œä¼šå‘ç”Ÿä»€ä¹ˆå‘¢ï¼Ÿå®‰å“æ˜¯æœ‰ä¸€å¥—å›¾ç‰‡åŒ¹é…è§„åˆ™çš„:</p>
<p>ä¸€ä¸ªhdpiå¯†åº¦çš„æ‰‹æœºï¼Œè‚¯å®šæ˜¯å…ˆå»åŒ¹é…<code>hdpi</code>ç›®å½•ä¸‹çš„å›¾ç‰‡ï¼Œå¦‚æœæ²¡æœ‰ï¼Œé‚£ä¹ˆå°±ä¼šå‘ä¸Šçº§å»æŸ¥æ‰¾ï¼Œåˆ†åˆ«æ˜¯<code>xhdpi</code>-&gt;<code>xxhdpi</code>-&gt;<code>xxxhdpi</code>-&gt;<code>nodpi</code>ï¼Œå¦‚æœéƒ½æ²¡æœ‰ï¼Œå°±ä¼šå¾€ä¸‹çº§ç›®å½•å»æŸ¥ï¼Œåˆ†åˆ«æ˜¯<code>mdpi</code>-&gt;<code>ldpi</code>,å¦‚æœè¿˜æ²¡æœ‰ï¼Œå°±ä¼šå»<code>drawable</code>ç›®å½•å»æŸ¥æ‰¾ï¼Œå¦‚æœè¿˜æ²¡æœ‰ï¼å°±ä¼šå¼€å¯è‡ªæ¯æ¨¡å¼ï¼Œå˜£ï¼ï¼(resouse not found)</p>
<h4 id="1-2ã€ç›¸åŒå›¾ç‰‡åœ¨ä¸åŒç›®å½•æ‰€å ç”¨èµ„æºåˆ†æ-äº†è§£å³å¯"><a href="#1-2ã€ç›¸åŒå›¾ç‰‡åœ¨ä¸åŒç›®å½•æ‰€å ç”¨èµ„æºåˆ†æ-äº†è§£å³å¯" class="headerlink" title="1.2ã€ç›¸åŒå›¾ç‰‡åœ¨ä¸åŒç›®å½•æ‰€å ç”¨èµ„æºåˆ†æ(äº†è§£å³å¯)"></a>1.2ã€ç›¸åŒå›¾ç‰‡åœ¨ä¸åŒç›®å½•æ‰€å ç”¨èµ„æºåˆ†æ(äº†è§£å³å¯)</h4><p>ä¸çŸ¥é“æœ‰æ²¡æœ‰æœ‹å‹åšè¿‡è¿™æ ·ä¸€ä¸ªå®éªŒï¼ŒæŠŠä¸€ä¸ªxhdpiå¯†åº¦çš„å›¾ç‰‡æ”¾åˆ°xxhdpiå¯†åº¦çš„æ–‡ä»¶å¤¹ä¸­å»åŠ è½½ä¼šå‘ç”Ÿä»€ä¹ˆ,å®ƒæ‰€å çš„å†…å­˜ä¼šæœ‰åŒºåˆ«å—ï¼Ÿ<br>ä¾‹å¦‚ä¸€ä¸ªåœ¨xhdpiä¸‹ä¸º200 <em> 200çš„å›¾ç‰‡ï¼Œxxhdpiå¯†åº¦ä¸‹ä¸º300 </em> 300,ä½†æ­¤æ—¶å›¾ç‰‡åªæœ‰200 <em> 200ï¼Œæ‰€ä»¥å®ƒä¼šæ”¾å¤§åˆ°300 </em> 300ï¼Œè¿™æ—¶å€™å›¾ç‰‡å°±ä¼šå‡ºç°æ¨¡ç³Šçš„æƒ…å†µäº†ï¼Œæ‰€ä»¥å¦‚æœä½ åœ¨é¡¹ç›®ä¸­å‘ç°å›¾ç‰‡æ¨¡ç³Šçš„æƒ…å†µå¯ä»¥æ£€æŸ¥ä¸‹å›¾ç‰‡çš„å°ºå¯¸æ˜¯å¦æ­£ç¡®ã€‚</p>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬æ¥åšä¸€ä¸ªå®éªŒ,ä½¿ç”¨ä¸€ä¸ªåå«<code>icon_database_xls</code>  <code>64 * 64 PNG</code>çš„å›¾ç‰‡ï¼Œå°†å®ƒæ”¾åˆ°<code>xhdpi</code>ç›®å½•ä¸­ï¼Œæ‰§è¡Œä¸‹é¢çš„ä»£ç è·å–å†…å­˜å ç”¨æƒ…å†µï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Bitmap bitmap = BitmapFactory.decodeResource(getResources(),R.mipmap.icon_database_xls);</span><br><span class="line">Log.i(&quot;HJ&quot;,bitmap.getByteCount()+&quot;&quot;);</span><br></pre></td></tr></table></figure></p>
<p>ç»“æœå¦‚ä¸‹ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2019-01-08 10:56:01.872 18507-18507/jie.com.imageoptimize I/HJ: 30976</span><br></pre></td></tr></table></figure></p>
<p>æ¥ä¸‹æ¥å°†å›¾ç‰‡æ”¾åˆ°<code>xxhdpi</code>ç›®å½•ä¸‹ï¼Œå†æ¬¡æ‰§è¡Œä»£ç :<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2019-01-08 10:56:32.123 18677-18677/jie.com.imageoptimize I/HJ: 13924</span><br></pre></td></tr></table></figure></p>
<p>å¯ä»¥çœ‹åˆ°ç»“æœå·®è·å·¨å¤§,æˆ‘ä»¬çŸ¥é“ï¼Œä¸€ä¸ªå›¾ç‰‡çš„å†…å­˜å ç”¨å…¬å¼ä¸ºï¼šå›¾ç‰‡å†…å­˜å®½åº¦ <em> å›¾ç‰‡å†…å­˜é«˜åº¦</em> æ¯åƒç´ å ç”¨çš„å†…å­˜ä½æ•°ï¼Œé‚£æˆ‘ä»¬çš„å†…å­˜å®½é«˜æ˜¯å¦‚ä½•è®¡ç®—çš„å‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥è¿½è¸ªframeworkçš„æºç ï¼Œè·¯å¾„ä¸º<code>/frameworks/base/core/jni/android/graphics/BitmapFactory.cpp</code>,æ‰¾åˆ°<code>doDecode</code>æ–¹æ³•ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">static jobject doDecode(JNIEnv* env, std::unique_ptr&lt;SkStreamRewindable&gt; stream,</span><br><span class="line">                        jobject padding, jobject options) &#123;</span><br><span class="line">    int sampleSize = 1;</span><br><span class="line">    bool onlyDecodeSize = false;</span><br><span class="line">    ... ...</span><br><span class="line">    float scale = 1.0f;</span><br><span class="line">    ... ...</span><br><span class="line">    if (options != NULL) &#123;</span><br><span class="line">        sampleSize = env-&gt;GetIntField(options, gOptions_sampleSizeFieldID);</span><br><span class="line">        if (sampleSize &lt;= 0) &#123;</span><br><span class="line">            sampleSize = 1;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        if (env-&gt;GetBooleanField(options, gOptions_justBoundsFieldID)) &#123;</span><br><span class="line">            onlyDecodeSize = true;</span><br><span class="line">        &#125;</span><br><span class="line">        ... ...</span><br><span class="line">        if (env-&gt;GetBooleanField(options, gOptions_scaledFieldID)) &#123;</span><br><span class="line">            const int density = env-&gt;GetIntField(options, gOptions_densityFieldID);</span><br><span class="line">            const int targetDensity = env-&gt;GetIntField(options, gOptions_targetDensityFieldID);</span><br><span class="line">            const int screenDensity = env-&gt;GetIntField(options, gOptions_screenDensityFieldID);</span><br><span class="line">            if (density != 0 &amp;&amp; targetDensity != 0 &amp;&amp; density != screenDensity) &#123;</span><br><span class="line">                scale = (float) targetDensity / density;  //ç¼©æ”¾æ¯”åœ¨è¿™é‡Œè®¡ç®—çš„</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    ... ...</span><br><span class="line"></span><br><span class="line">    if (scale != 1.0f) &#123;</span><br><span class="line">        willScale = true;</span><br><span class="line">        scaledWidth = static_cast&lt;int&gt;(scaledWidth * scale + 0.5f); //å†…å­˜å®½åº¦è®¡ç®—</span><br><span class="line">        scaledHeight = static_cast&lt;int&gt;(scaledHeight * scale + 0.5f); //å†…å­˜é«˜åº¦è®¡ç®—</span><br><span class="line">     &#125;</span><br></pre></td></tr></table></figure></p>
<p>ä»¥ä¸Šæºç æ€»ç»“ä¸ºï¼š<br>å†…å­˜å®½é«˜ = å›¾ç‰‡æœ¬èº«çš„å®½é«˜ * ï¼ˆè®¾å¤‡å¯†åº¦/ä½¿ç”¨çš„å¯†åº¦ï¼‰+ 0.5<br>æ‰€ä»¥ï¼Œå†…å­˜çš„å ç”¨ä¸å›¾ç‰‡æ‰€åœ¨çš„å¯†åº¦ç›®å½•æ˜¯æœ‰å¯†åˆ‡å…³ç³»çš„</p>
<h4 id="1-3ã€-drawable-xxhdpiä¸mipmap-xxhdpiçš„åŒºåˆ«-äº†è§£å³å¯"><a href="#1-3ã€-drawable-xxhdpiä¸mipmap-xxhdpiçš„åŒºåˆ«-äº†è§£å³å¯" class="headerlink" title="1.3ã€ drawable-xxhdpiä¸mipmap-xxhdpiçš„åŒºåˆ«(äº†è§£å³å¯)"></a>1.3ã€ drawable-xxhdpiä¸mipmap-xxhdpiçš„åŒºåˆ«(äº†è§£å³å¯)</h4><p>ä»æ–°ç‰ˆAndroid studioå¼€å§‹ï¼Œç³»ç»Ÿä¼šé»˜è®¤ç»™æˆ‘ä»¬åˆ›å»º<code>mipmap</code>æ–‡ä»¶å¤¹è€Œä¸æ˜¯<code>drawable</code>,å…ˆå‰æˆ‘ä¸€ç›´ä»¥ä¸ºè¿™ä¸ªç›®å½•åªæ˜¯æ”¾iconçš„(æµä¸‹äº†èœé€¼çš„å¿ƒé…¸æ³ªæ°´),åæ¥å‘ç°è¿™ä¸ªç›®å½•ä¸drawableéƒ½å¯ä»¥æ”¾å›¾ç‰‡ï¼Œè€Œä¸”è²Œä¼¼ä¹Ÿæ²¡æœ‰ä»»ä½•å·®åˆ«????ï¼Œä¸ºäº†å¼„æ¸…æ¥šï¼Œä¸Šç½‘æŸ¥äº†ä¸€ä¸‹ï¼Œå¤§æ„æ˜¯ä¼šå¯¹å›¾ç‰‡ç¼©æ”¾åšæ€§èƒ½ä¼˜åŒ–ï¼Œä¸è¿‡æˆ‘åœ¨å¹³å¸¸çš„ä½¿ç”¨ä¸­å¹¶æ²¡æœ‰å‘ç°æœ‰å¤ªå¤§çš„åŒºåˆ«ï¼Œå¯èƒ½æ˜¯é«˜ç‰ˆæœ¬drawableä¹Ÿåšäº†ä¼˜åŒ–æŠŠï¼Œæ‰€ä»¥è¿™ä¸ªç®€å•äº†è§£ä¸€ä¸‹å³å¯ã€‚</p>
<h3 id="2-Bitmapä¼˜åŒ–è¯¦è§£"><a href="#2-Bitmapä¼˜åŒ–è¯¦è§£" class="headerlink" title="(2)Bitmapä¼˜åŒ–è¯¦è§£"></a>(2)Bitmapä¼˜åŒ–è¯¦è§£</h3><h4 id="2-1ã€åŸºç¡€çŸ¥è¯†"><a href="#2-1ã€åŸºç¡€çŸ¥è¯†" class="headerlink" title="2.1ã€åŸºç¡€çŸ¥è¯†"></a>2.1ã€åŸºç¡€çŸ¥è¯†</h4><p>å®‰å“çš„å›¾ç‰‡åŠ è½½éƒ½ä¼šå¯¹åº”åˆ°bitmapå¯¹è±¡,å½“bitmapå ç”¨çš„å†…å­˜è¿‡é«˜ï¼Œè¶…è¿‡äº†androidä¸ºappåˆ†é…çš„æœ€å¤§å†…å­˜ï¼Œé‚£ä¹ˆå®ƒå°±ä¼šä¸å¼€å¿ƒï¼Œå®ƒå°±ä¼šOOMï¼Œæ‰€ä»¥æˆ‘ä»¬çš„å›¾ç‰‡ä¼˜åŒ–ï¼Œæœ¬è´¨å°±æ˜¯å†…å­˜ä¼˜åŒ–ã€‚<br>æˆ‘ä»¬å¸¸ç”¨çš„å›¾ç‰‡æ ¼å¼ä¸€èˆ¬æœ‰ä¸‰ç§:</p>
<ul>
<li>JPEG ä¸€ç§æœ‰æŸå‹ç¼©æ ¼å¼ï¼Œä¸æ”¯æŒé€æ˜é€šé“,æ‰€ä»¥æœ‰é€æ˜èƒŒæ™¯éœ€æ±‚çš„å›¾ç‰‡ä¸è¦ç”¨jpegæ ¼å¼ï¼Œå®ƒä¼šå˜æˆé»‘è‰²ï¼Œä¼šå˜é»‘ï¼ï¼ï¼ï¼Œä¼šå˜é»‘ï¼ï¼ï¼ï¼Œä¼šå˜é»‘ï¼ï¼ï¼</li>
<li>PNG   æ— æŸå‹ç¼©æ ¼å¼,æ”¯æŒé€æ˜é€šé“</li>
<li>WEBP  åŒæ—¶æ”¯æŒæ— æŸå’Œæœ‰æŸå‹ç¼©æ ¼å¼ï¼Œç„¶è€Œå…¼å®¹æ€§è¾ƒå·®ï¼Œéœ€è¦é€‚é…åº“<br> å¯å‚è€ƒ:<a href="https://github.com/EverythingMe/webp-android" target="_blank" rel="noopener">webp-android</a></li>
</ul>
<p>åœ¨ä»£ç ä¸­å¯ä»¥é€šè¿‡<code>Bitmap.CompressFormat</code>æ¥æŒ‡å®šç”Ÿæˆçš„å›¾ç‰‡æ ¼å¼<br>bitmapè¿˜å¯ä»¥é…ç½®åƒç´ å ç”¨å­—èŠ‚æ•°ï¼ˆä¸€ä¸ªå­—èŠ‚å¯¹åº”8ä½ï¼‰ï¼Œè¿™ä¸å†…å­˜å ç”¨æ¯æ¯ç›¸å…³ï¼Œå¯¹åº”<code>Bitmap.Config</code>ç±»ï¼š</p>
<ul>
<li>ALPHA_8   8ä½ALPHAé€šé“ï¼Œå³A=8ï¼Œä¸€ä¸ªåƒç´ å ç”¨ä¸€ä¸ªå­—èŠ‚ï¼Œå®ƒæ˜¯æ²¡æœ‰é¢œè‰²çš„ï¼Œåªæœ‰é€æ˜åº¦</li>
<li>ARGB_4444  16ä½ A=4,R=4,G=4,B=4,ä¸€ä¸ªåƒç´ å ç”¨å­—èŠ‚ = 4+4+4+4 = 16ä½ = 2ä¸ªå­—èŠ‚</li>
<li>ARGB_8888 32ä½ A=8,R=8,G=8,B=8,ä¸€ä¸ªåƒç´ å ç”¨å­—èŠ‚ = 8+8+8+8 = 32ä½ = 4ä¸ªå­—èŠ‚</li>
<li>RGB_565 16ä½ R=5,G=6,B=5,å› ä¸ºæ²¡æœ‰Aï¼Œæ‰€ä»¥å®ƒæ²¡æœ‰é€æ˜åº¦ï¼Œè®¡ç®—åŒä¸Šä¹Ÿæ˜¯å ç”¨2ä¸ªå­—èŠ‚<br>åƒå¹³å¸¸å¦‚æœæ²¡æœ‰é€æ˜åº¦è¦æ±‚ä½¿ç”¨<code>RGB_565</code>å³å¯<h4 id="2-2ã€ä¼˜åŒ–çš„æœ¬è´¨"><a href="#2-2ã€ä¼˜åŒ–çš„æœ¬è´¨" class="headerlink" title="2.2ã€ä¼˜åŒ–çš„æœ¬è´¨"></a>2.2ã€ä¼˜åŒ–çš„æœ¬è´¨</h4>å‰é¢å·²ç»æåˆ°æˆ‘ä»¬çš„å›¾ç‰‡ä¼˜åŒ–å®é™…æ˜¯å†…å­˜çš„ä¼˜åŒ–ï¼Œè€Œæˆ‘ä»¬çš„å†…å­˜è®¡ç®—å…¬å¼æ˜¯ï¼š<br>å†…å­˜å ç”¨å®½é«˜ç›¸ä¹˜ * æ¯åƒç´ å ç”¨çš„å†…å­˜ä½æ•°ï¼Œæ‰€ä»¥è¦ä¹ˆå°±å‡å°‘å›¾ç‰‡å†…å­˜å ç”¨å®½é«˜ï¼Œè¦ä¹ˆå°±å‡å°‘åƒç´ å ç”¨å†…å­˜æ•°ã€‚å‡å°‘åƒç´ å†…å­˜å ç”¨æ•°å¯ä»¥é€šè¿‡é…ç½®Bitmap.Configè§£å†³ï¼Œè€Œå‡å°‘å›¾ç‰‡å†…å­˜å ç”¨å®½é«˜ï¼Œå¯ä»¥æœ‰ä»¥ä¸‹å‡ ä¸ªæ–¹å¼ï¼š<br>1.ç¼©å°å›¾ç‰‡å®é™…å®½é«˜ï¼Œç¼©å°åˆ°æ­£å¥½æ­£å¸¸å±•ç¤º<br>2.åŒ¹é…åˆé€‚çš„åƒç´ å¯†åº¦<br>æ­¤å¤–è¿˜èƒ½ä¸»åŠ¨å›æ”¶å ç”¨çš„å†…å­˜ä»è€Œç¼“è§£å†…å­˜ç´§å¼ çš„é—®é¢˜ã€‚<h4 id="2-3ã€ä¼˜åŒ–æ–¹å¼"><a href="#2-3ã€ä¼˜åŒ–æ–¹å¼" class="headerlink" title="2.3ã€ä¼˜åŒ–æ–¹å¼"></a>2.3ã€ä¼˜åŒ–æ–¹å¼</h4>åˆ†æäº†ä¸€ä¸‹ä¼˜åŒ–çš„æœ¬è´¨é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥é’ˆå¯¹æ€§çš„ä½¿ç”¨ä»¥ä¸‹å‡ ç§æ–¹å¼æ¥è¿›è¡Œä¼˜åŒ–ï¼š<br><strong>1.é…ç½®BitmapConfigï¼ˆå‰é¢å·²ç»è®²åˆ°ï¼‰</strong><br><strong>2.æ‹¿åˆ°ä¸€ä¸ªå›¾ç‰‡ï¼Œé€šè¿‡<code>inJustDecodeBounds</code>ä¸æ¶ˆè€—å†…å­˜æ‹¿åˆ°å›¾ç‰‡çš„å®½é«˜ï¼Œç„¶åä½¿ç”¨<code>inSampleSize</code>æ¥è®¾ç½®å›¾ç‰‡çš„ç¼©æ”¾æ¯”ã€‚</strong><br>ç®€å•ç¤ºä¾‹ä»£ç :<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">BitmapFactory.Options options = new BitmapFactory.Options();</span><br><span class="line">options.inJustDecodeBounds = true;</span><br><span class="line">BitmapFactory.decodeResource(getResources(),R.mipmap.icon_database_xls,options);</span><br><span class="line">Log.i(&quot;HJ&quot;,&quot;åˆå§‹å›¾ç‰‡å®½:&quot;+options.outWidth);</span><br><span class="line">Log.i(&quot;HJ&quot;,&quot;åˆå§‹å›¾ç‰‡é«˜:&quot;+options.outHeight);</span><br><span class="line">options.inSampleSize = 2;</span><br><span class="line">options.inJustDecodeBounds = false;</span><br><span class="line">BitmapFactory.decodeResource(getResources(),R.mipmap.icon_database_xls,options);</span><br><span class="line">Log.i(&quot;HJ&quot;,&quot;ç¼©æ”¾åå›¾ç‰‡å®½:&quot;+options.outWidth);</span><br><span class="line">Log.i(&quot;HJ&quot;,&quot;ç¼©æ”¾åå›¾ç‰‡é«˜:&quot;+options.outHeight);</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>è¿è¡Œåï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">2019-01-08 17:07:50.935 25900-25900/jie.com.imageoptimize I/HJ: åˆå§‹å›¾ç‰‡å®½:64</span><br><span class="line">2019-01-08 17:07:50.935 25900-25900/jie.com.imageoptimize I/HJ: åˆå§‹å›¾ç‰‡é«˜:64</span><br><span class="line">2019-01-08 17:07:50.936 25900-25900/jie.com.imageoptimize I/HJ: ç¼©æ”¾åå›¾ç‰‡å®½:32</span><br><span class="line">2019-01-08 17:07:50.937 25900-25900/jie.com.imageoptimize I/HJ: ç¼©æ”¾åå›¾ç‰‡é«˜:32</span><br></pre></td></tr></table></figure></p>
<p>å¯ä»¥çœ‹åˆ°inSampleSizeè®¾ä¸º2ï¼Œå›¾ç‰‡çš„å®½å’Œé«˜éƒ½å˜æˆäº†åŸæ¥çš„ä¸€åŠï¼Œæ‰€ä»¥å¯å¾—ç¼©æ”¾å…¬å¼ä¸ºï¼š<br>åŸå§‹å›¾ç‰‡å®½åº¦/inSampleSize  = ç¼©æ”¾åçš„å›¾ç‰‡å®½åº¦ã€‚é«˜åº¦åŒç†ï¼Œæ‰€ä»¥å›¾ç‰‡çš„æ•´ä½“å¤§å°å˜ä¸ºäº†åŸæ¥çš„1/4ã€‚</p>
<p><strong>3.å‹ç¼©å›¾ç‰‡ï¼Œé™¤äº†å¤–éƒ¨å‹ç¼©ï¼Œå†…éƒ¨ä¹Ÿå¯ä»¥ä½¿ç”¨<code>compress()</code>æ¥å‹ç¼©å›¾ç‰‡ã€‚æˆ–è€…è‡ªå®šä¹‰å‹ç¼©ç®—æ³•ï¼Œä½¿ç”¨æ¯”è¾ƒå¹¿æ³›çš„æœ‰<a href="https://github.com/Curzibn/Luban" target="_blank" rel="noopener">Luban</a>ç®—æ³•</strong></p>
<p>compress()ç¤ºä¾‹ä»£ç ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Bitmap bitmap = BitmapFactory.decodeResource(getResources(), R.mipmap.icon_database_xls);</span><br><span class="line">ByteArrayOutputStream stream = new ByteArrayOutputStream();</span><br><span class="line">boolean compress = bitmap.compress(Bitmap.CompressFormat.PNG, 90, stream);</span><br></pre></td></tr></table></figure></p>
<p>ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯éœ€è¦ç”Ÿæˆçš„å›¾ç‰‡æ ¼å¼ï¼Œç¬¬äºŒä¸ªæ˜¯å‹ç¼©ç™¾åˆ†æ¯”ï¼Œç¬¬ä¸‰ä¸ªæ˜¯ç”Ÿæˆçš„è¾“å‡ºæµå®¹å™¨ã€‚è¯·æ³¨æ„ï¼Œæ­¤æ–¹æ³•<strong>åªä¼šå‹ç¼©å›¾ç‰‡å¤§å°ï¼Œä½†æ˜¯å¹¶ä¸ä¼šå‡å°‘å†…å­˜å ç”¨</strong>ã€‚</p>
<p><strong>4.ä¸»åŠ¨é‡Šæ”¾å†…å­˜ï¼Œç»‘å®šæ§ä»¶ç”Ÿå‘½å‘¨æœŸï¼Œåœ¨é”€æ¯çš„æ—¶å€™è°ƒç”¨<code>recycler()</code>æ–¹æ³•</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">if(bitmap != null &amp;&amp; !bitmap.isRecycled())&#123;  </span><br><span class="line">    bitmap.recycle(); </span><br><span class="line">    bitmap = null; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
]]></content>
      
        <categories>
            
            <category> AndroidåŸºç¡€è¿›é˜¶ </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Android </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[2018å¹´ç»ˆæ€»ç»“]]></title>
      <url>/2018%E5%B9%B4%E7%BB%88%E6%80%BB%E7%BB%93.html</url>
      <content type="html"><![CDATA[<p><strong>ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºåšä¸»åŸåˆ›æ–‡ç« ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„(www.huangjie.name)ï¼Œä¿æŠ¤åŸåˆ›ï¼Œä»æˆ‘åšèµ·.</strong></p>
<hr>
<h3 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h3><p>äººå•Šï¼Œæœ€æ€•ä¸€ç”Ÿç¢Œç¢Œæ— ä¸ºï¼Œä¸å…¶å¹³æ·¡ä¸­åº¦è¿‡ï¼Œä½•ä¸ä¸ºè‡ªå·±å®šä¸€ä¸ªå°ç›®æ ‡ï¼Œä½“éªŒå…ˆèµšä»–ä¸€ä¸ªäº¿çš„åˆºæ¿€æ¢¦æƒ³!!!!</p>
<p>ä»Šå¹´æˆ‘æ€»ç»“èµ·æ¥å°±æ˜¯:è“„åŠ¿å¾…å‘ä¸è“„è°‹å·²ä¹…,å—¯ï¼Œåˆ†åˆ«å¯¹åº”2018ä¸2019ï¼Œè°‹ï¼Œæ˜¯æˆ‘è—åœ¨å¿ƒä¸­çš„ä¸€ä¸ªç›®æ ‡<del>~</del></p>
<a id="more"></a>
<h4 id="é¢è¯•çš„æ•…äº‹"><a href="#é¢è¯•çš„æ•…äº‹" class="headerlink" title="é¢è¯•çš„æ•…äº‹"></a>é¢è¯•çš„æ•…äº‹</h4><p>2018å¹´åˆï¼Œè€ƒäº†é©¾ç…§ï¼Œå›åˆ°äº†å®¶ä¹¡é•¿æ²™å¼€å§‹äº†é•¿æ²™å¼€å‘ä¹‹æ—…ï¼Œè®°å¾—å¹´åˆçš„æ—¶å€™æŠ•çš„ç¬¬ä¸€å®¶å…¬å¸å°±æ˜¯ç°åœ¨çš„è¿™å®¶å…¬å¸ï¼Œå½“æ—¶æ˜¯æŠ€æœ¯æ€»ç›‘é¢è¯•çš„æˆ‘ï¼Œå¯¹æˆ‘å°è±¡æŒºå¥½çš„ï¼Œå½“åœºå°±å†³å®šå½•ç”¨äº†æˆ‘ï¼Œé—®æˆ‘ä»€ä¹ˆæ—¶å€™å¯ä»¥è¿‡æ¥ä¸Šç­ï¼Œæˆ‘å› ä¸ºæ˜¯ç¬¬ä¸€æ¬¡åœ¨é•¿æ²™é¢è¯•ï¼Œå¯¹é•¿æ²™çš„å¤§æ¦‚è–ªèµ„çŠ¶å†µä»¥åŠäº’è”ç½‘å‘å±•æƒ…å†µå¹¶ä¸æ˜¯ç‰¹åˆ«çš„äº†è§£ï¼Œæ‰€ä»¥æˆ‘æ‰“ç®—å†å»å…¶ä»–å…¬å¸çœ‹çœ‹ï¼Œå¯¹æ•´ä½“éƒ½äº†è§£ä¸€ä¸‹ï¼Œæˆ‘è¯´3å¤©åæ¥ä¸Šç­ï¼Œè¿™ä¸‰å¤©é‡Œï¼Œæˆ‘å»äº†è“æ€ç§‘æŠ€ï¼Œä¸–ç•Œ500å¼ºä¼ä¸šï¼Œé¢è¯•å®˜çœ‹åˆ°æˆ‘åªæœ‰2å¹´ç»éªŒï¼Œè¿ä¸€ä¸ªæŠ€æœ¯é—®é¢˜éƒ½æ²¡é—®å°±è®©æˆ‘å›å»ç­‰é€šçŸ¥ï¼Œè¯´å®è¯æˆ‘æ˜¯æ¯”è¾ƒä¼¤å¿ƒçš„ï¼Œå› ä¸ºæˆ‘è§‰å¾—å·¥ä½œå¹´é™ä¸ç­‰äºæŠ€æœ¯ï¼Œå·¥ä½œå¹´é™é•¿ä¸ä¸€å®šæŠ€æœ¯å°±ä¼šå¥½ï¼Œèµ·ç å¯ä»¥è¯•ä¸€è¯•å•Šï¼Œå¯èƒ½è¿™æ˜¯å¤§å…¬å¸çš„ä¸€ä¸ª<code>ç¡¬æ€§æ ‡å‡†</code>å§ï¼Œå“ï¼Œéƒ½æ²¡é¢†ç•¥è¿‡å¤§æµ·çš„æ³¢æ¶›æ±¹æ¶Œ,å°±è¢«æ‹æ­»åœ¨äº†æ²™æ»©ä¸Šã€‚éšåæˆ‘å»äº†ä¸€å®¶æ€»éƒ¨åœ¨åŒ—äº¬çš„é•¿æ²™åˆ†å…¬å¸ï¼Œæ˜¯åšæ™ºèƒ½åŒ–ç®¡ç†çš„ï¼Œé¢è¯•å®˜é—®äº†ä¸€äº›éå¸¸åŸºç¡€çš„é—®é¢˜ï¼Œç­”å®Œåç›´æ¥å’Œæ€»ç›‘è°ˆè–ªèµ„ï¼Œæ€»ç›‘è§‰å¾—æˆ‘è¦ä»·é«˜ï¼Œæˆ‘è¯´æˆ‘æœ€ä½è¦æ±‚å°±è¿™ä¸ªä»·ï¼Œä¸èƒ½å°‘ï¼Œéšåå°±GGäº†ï¼Œæˆ‘è§‰å¾—è¿™æˆ–è®¸å°±æ˜¯ä»–åœ¨é•¿æ²™å¼€åˆ†å…¬å¸çš„åŸå› å§ï¼Œæ‹›äººç›¸å¯¹äºåŒ—äº¬èƒ½èŠ‚çº¦æ›´å¤šçš„æˆæœ¬ï¼Œä½†ä½ è¿™ä»·æ ¼ä¹Ÿå‹å¾—å¤ªä½äº†å“â€¦é¢æ¥é¢å»æœ€åè¿˜æ˜¯ç¬¬ä¸€å®¶å…¬å¸æœ€æ»¡æ„ï¼Œäºæ˜¯ï¼Œæˆ‘æ¥åˆ°äº†ç°åœ¨çš„è¿™å®¶å…¬å¸â€”â€“é•¿æ²™å±…ç¾ç½‘ç»œç§‘æŠ€æœ‰é™å…¬å¸ï¼Œä¸»è¦æ˜¯åšå®¶å±…å»ºææ‹›å•†åŠ ç›Ÿçš„ï¼Œç°é‡‘æµéå¸¸çš„å……è¶³ï¼Œå…¬å¸ä¹ŸæŒºå¤§çš„ï¼Œæœ‰200å¤šå·äººï¼Œ4ä¸ªåŠå…¬åœºåœ°ã€‚</p>
<h4 id="æ–°å…¬å¸çš„å¥‹æ–—æ•…äº‹"><a href="#æ–°å…¬å¸çš„å¥‹æ–—æ•…äº‹" class="headerlink" title="æ–°å…¬å¸çš„å¥‹æ–—æ•…äº‹"></a>æ–°å…¬å¸çš„å¥‹æ–—æ•…äº‹</h4><p>å…¥èŒçš„ç¬¬ä¸€å¤©ï¼ŒæŠ€æœ¯æ€»ç›‘å°±æŠŠæˆ‘å«åˆ°ä¸€ä¸ªä¼šè®®å®¤è°ˆè¯ï¼Œæ€»ç›‘è¯´ï¼Œä½ æ˜¯è¿™å®¶å…¬å¸æ¥çš„ç¬¬ä¸€ä¸ªAndroidå¼€å‘ï¼Œå…¬å¸è®¡åˆ’åœ¨7æœˆä»½æ¨å‡ºä¸€æ¬¾app,è¦åœ¨å¹¿å·çš„å»ºåšä¼šä¸Šäº®ç›¸ï¼Œå¤©å•Šï¼Œé‚£å¯æ˜¯åå‡ ä¸‡äººéƒ½ä¼šæ¥å‚åŠ çš„å±•ä¼šï¼Œå¿…é¡»è¦ä¸‡æ— ä¸€å¤±ï¼Œé©¬è™ä¸å¾—ï¼Œå¯æ˜¯ï¼Œæ€»ç›‘é€æ¼ï¼Œç›®å‰å…¬å¸äº§å“ï¼Œæµ‹è¯•ï¼Œuiäººå‘˜è¿˜æ²¡æœ‰æ‹›åˆ°ä½â€¦â€¦emmmmmmm,æˆ‘æ‰¾ä¸åˆ°è¯­è¨€æ¥æè¿°æˆ‘å½“æ—¶çš„å¿ƒæƒ…ï¼Œä½†æ˜¯è¿™å®¶å…¬å¸ç»™æˆ‘çš„æ„Ÿè§‰è¿˜æ˜¯æŒºé è°±çš„ï¼Œä¸åƒæ˜¯é‚£ç§å‘äººçš„å…¬å¸ï¼Œæ‰€ä»¥æˆ‘æ‰¿è¯ºäº†è¦æ›¿å…¬å¸å¼€å‘å¥½è¿™ä¸€æ¬¾app.</p>
<p>åˆ°äº†3æœˆä»½ï¼Œäººå‘˜æœç„¶é™†é™†ç»­ç»­éƒ½æ‰¾é½äº†ï¼Œäºæ˜¯å¼€å§‹å¹²æ´»ã€‚ä½œä¸ºä¸€æ¬¾ä»0å¼€å‘çš„app,å¹¶ä¸”å…¬å¸åœ¨è¿™æ–¹é¢æ²¡æœ‰ä»»ä½•çš„çŸ¥è¯†å‚¨å¤‡ï¼Œå¯ä»¥æƒ³è±¡éš¾åº¦è¿˜æ˜¯æœ‰çš„ï¼Œå¼€å‘ä¸€æ¬¾app,é¦–å…ˆç¬¬ä¸€ä»¶äº‹å°±æ˜¯æŠŠæ¶å­æ­èµ·æ¥ï¼ŒåŸæ¥å…¬å¸çš„appæ¶æ„æ˜¯ä¸èƒ½ç”¨çš„ï¼Œé¡¹ç›®å¤ªæ—§ï¼Œæ¡†æ¶å¤ªè€äº†ï¼Œæ‰€ä»¥åªèƒ½é è‡ªå·±æ­å»ºã€‚</p>
<p>é¦–å…ˆç¡®å®šçš„æ˜¯MVPæ¨¡å¼ï¼Œè¿™æ²¡çš„è·‘ï¼Œç„¶åæŠŠActivityç­‰çš„ä¸€äº›åŸºç±»å†™å¥½ï¼Œéšåå¼€å§‹å°è£…ç½‘ç»œè¯·æ±‚ï¼Œæœ¬æ¥è€ƒè™‘ä½¿ç”¨<code>Retrofit</code>ï¼Œä½†æ˜¯è¿™æ¬¾æ¡†æ¶éœ€è¦å†æ¬¡å°è£…çš„ä¸œè¥¿è¿˜æ˜¯è›®å¤šçš„ï¼ŒåŸºäºå¿«é€Ÿå¼€å‘çš„åŸå› æˆ‘å°±ä½¿ç”¨äº†<code>OkGo</code>æ¡†æ¶ï¼Œå®ƒæŠŠæ‰€æœ‰çš„ä¸€åˆ‡éƒ½å¸®ä½ å°è£…å¥½äº†ï¼Œæˆ‘åœ¨ä¸Šå±‚å†™äº†ä¸€äº›ç®€å•çš„å°è£…å°±èƒ½ç›´æ¥ä½¿ç”¨äº†ã€‚éšåå°±æ˜¯å„ç§Utilså°è£…,UIå°è£…ï¼ŒæŠŠRxjava,Glideç­‰å¸¸ç”¨çš„æ¡†æ¶å¼„è¿›æ¥ï¼Œéšåçš„æ—¥å­å°±å¼€å§‹äº†ç–¯ç‹‚çš„ç ä»£ç ,é‚£æ®µæ—¶é—´åŸºæœ¬æ²¡æœ‰åœ¨9ç‚¹é’Ÿä¹‹å‰ä¸‹è¿‡ç­ï¼Œä¸€ç›´æŒç»­åˆ°é¡¹ç›®æˆåŠŸä¸Šçº¿ã€‚è™½ç„¶è¾›è‹¦ï¼Œä½†çœ‹åˆ°è‡ªå·±çš„appä»£ç é€æ¸çš„æˆç†Ÿå®Œå–„ï¼Œæˆå°±æ„Ÿä¹Ÿç‰¹åˆ«çš„å¼ºçƒˆï¼Œè€Œä¸”æ”¶è·ä¹Ÿæ˜¯æ»¡æ»¡çš„ï¼Œæ‡‚å¾—äº†å¦‚ä½•æ­å»ºå¥½çš„æ¶æ„ï¼Œå°è£…åŠŸåº•ä¹Ÿå¾—åˆ°äº†æé«˜ï¼Œæˆ–è®¸ï¼Œè¿™å°±æ˜¯ä¼ è¯´çš„é­”é¬¼å†ç»ƒå§</p>
<h4 id="Kotlinçš„æ•…äº‹"><a href="#Kotlinçš„æ•…äº‹" class="headerlink" title="Kotlinçš„æ•…äº‹"></a>Kotlinçš„æ•…äº‹</h4><p>éšç€é¡¹ç›®çš„æˆåŠŸä¸Šçº¿ï¼Œæ—¶é—´æ¸æ¸å˜å¾—å……è£•ï¼Œå…¬å¸å‰åä¹Ÿé™†ç»­æ‹›äº†ä¸€äº›Androidå¼€å‘è¿›æ¥ï¼Œæ€»ç›‘ææ‹”æˆ‘å½“äº†Androidç»„çš„ç»„é•¿ï¼Œæ¯å¤©å‘å¥¹æ±‡æŠ¥ä¸€äº›å¼€å‘å·¥ä½œï¼Œç”±äºé¡¹ç›®å¤„äºæ¨å¹¿é˜¶æ®µï¼ŒåæœŸéœ€æ±‚å¢é•¿ä¹åŠ›ï¼Œç•™ä¸‹çš„ç©ºä½™æ—¶é—´è¾ƒå¤šï¼Œæ€»ç›‘è¯´éœ€è¦å¢åŠ ç»„å‘˜çš„å·¥ä½œé¥±å’Œåº¦ï¼Œäºæ˜¯æˆ‘å°±å¼€å§‹äº†Kotlinçš„ä»£ç é‡æ„ï¼Œå¯¹äºKotlin,å…ˆå‰åªæ˜¯äº†è§£ä¸€ç‚¹ï¼Œä½†æ˜¯å½“æ·±å…¥ç ”ç©¶äº†è¿™é—¨è¯­è¨€ä¹‹åï¼Œæˆ‘æ„è¯†åˆ°å®ƒçš„ç¡®èƒ½ä¸ºå¼€å‘å¸¦æ¥å¾ˆå¤§çš„ä¾¿æ·ï¼ˆèƒ½å·æ‡’ï¼‰ã€‚ä½¿ç”¨äº†å®ƒä¹‹åï¼Œæˆ‘ä»¬æ¯ä¸€ä¸ªç±»å¹³å‡å°‘äº†ç™¾æ¥è¡Œä»£ç ï¼Œå¹¶ä¸”å…¶ä¸­çš„æ‰©å±•å‡½æ•°åŠŸèƒ½å®åœ¨æ˜¯ä¸èƒ½å¤ªèµã€‚ç”±äºä¸æ”¹é€»è¾‘ï¼Œåªæ˜¯å•çº¯çš„ç¿»è¯‘ï¼Œä¿®æ”¹é€Ÿåº¦ç‰¹åˆ«å¿«ï¼Œå½“æˆ‘ä»¬æŠŠæ‰€æœ‰ä»£ç éƒ½æ¢æˆKotlinä¹‹åï¼Œæˆ‘ä»¬å°±é’ˆå¯¹Kotlinçš„ç‰¹æ€§ä»åº•å±‚åˆ°åº”ç”¨å±‚æ¥äº†ä¸ªå¤§çš„å°è£…è°ƒæ•´ï¼Œè®©ä»£ç çœ‹èµ·æ¥å°±æ˜¯Kotlinç¼–ç¨‹ï¼Œè€Œä¸æ˜¯Javaç¿»è¯‘è¯­è¨€,è¿™æ ·ï¼Œæˆ‘çš„ç¬¬ä¸€ä¸ªçº¯Kotlinè¯­è¨€å¼€å‘çš„appå°±è¿™æ ·è¯ç”Ÿäº†.</p>
<h4 id="æ”¶è·"><a href="#æ”¶è·" class="headerlink" title="æ”¶è·"></a>æ”¶è·</h4><p>ä¹‹ååœ¨å…¬å¸çš„æ—¥å­å°±æ¯”è¾ƒå¹³æ·¡äº†ï¼Œå¼€å‘å®Œéœ€æ±‚ï¼Œå¦‚æœæœ‰å‰©ä½™çš„æ—¶é—´éƒ½æ˜¯å­¦ä¹ æ–°æŠ€æœ¯æ¥æå‡è‡ªå·±ï¼Œæœ€å¤§çš„æ”¶è·æ˜¯å­¦ä¹ äº†å°ç¨‹åºå¼€å‘ã€‚è€Œå›é¦–ä»Šå¹´ï¼Œåœ¨è‡ªå®šä¹‰View,å¤šçº¿ç¨‹å¼€å‘ï¼Œä»¥åŠè®¾è®¡æ¨¡å¼çš„ä½¿ç”¨ï¼Œç±»çš„å°è£…æ–¹é¢æŠ€èƒ½ä¸Šéƒ½æœ‰å¾ˆå¤§çš„æå‡ã€‚å¹¶ä¸”å­¦ä¼šäº†Kotlinï¼Œä¹Ÿå­¦ä¼šäº†çœ‹æºç ï¼Œä»Kotlinçš„æºç é‡Œå¯ä»¥çœ‹åˆ°è®¸å¤šKotlinçš„ä½¿ç”¨æŠ€å·§ï¼Œè¿™å¯¹äºæå‡Kotlinçš„ç†Ÿç»ƒåº¦éå¸¸æœ‰å¸®åŠ©ï¼Œå¹¶ä¸”ä¹ æƒ¯äº†ç ”ç©¶ç³»ç»Ÿæºç ï¼Œé™†é™†ç»­ç»­çœ‹äº†ä¸€äº›ç±»çš„æºç ï¼Œå‘ç°æºç çš„ä¸–ç•ŒçœŸçš„å¾ˆå¥‡å¦™ï¼Œä½¿ç”¨è¿™äº›ç±»æ—¶éƒ½æœ‰äº†ä¸ä¸€æ ·çš„æ„Ÿè§‰ï¼Œé€šé€äº†è®¸å¤šï¼Œæœç„¶ï¼Œæœ‰äº›ä¸œè¥¿çœ‹é€æ‰æ˜¯æœ€é‡è¦çš„ã€‚</p>
<h4 id="å±•æœ›"><a href="#å±•æœ›" class="headerlink" title="å±•æœ›"></a>å±•æœ›</h4><p>2019å¹´ï¼Œæˆ‘å·²ç»ç¡®å®šäº†æ¥ä¸‹æ¥éœ€è¦ç ”ç©¶çš„é¢†åŸŸï¼šå›¾å½¢å›¾åƒå’ŒéŸ³è§†é¢‘é¢†åŸŸï¼Œä¸ºæ­¤ï¼Œæˆ‘å†³å®šèŠ±ä¸€ä¸ªå¤šçš„æ—¶é—´å­¦ä¹ c++è¯­è¨€ï¼Œä»¥åº”å¯¹ä¹‹åçš„NDKå¼€å‘ï¼Œæ·±å…¥ç†è§£ç›¸æœºï¼Œç¾é¢œæ•ˆæœçš„å®ç°ï¼ŒAR/VRï¼Œè§†é¢‘è½¬ç ç­‰ç­‰é¢†åŸŸã€‚å¹¶ä¸”åŒæ—¶æå‡ä¸€ä¸‹H5/css/javaScriptçš„å¼€å‘æ°´å¹³ï¼Œè¿˜æœ‰Flutteræˆ‘ä¹Ÿæ˜¯æ¯”è¾ƒçœ‹å¥½çš„ï¼Œå¸Œæœ›èƒ½æœ‰ä¸ªæˆç»©ï¼Œå—¯ï¼Œå°±è¿™æ ·~~~~2019åŠ æ²¹!!!!</p>
]]></content>
      
        <categories>
            
            <category> æ„Ÿæ‚Ÿ </category>
            
        </categories>
        
        
    </entry>
    
    <entry>
      <title><![CDATA[Android/java å¤šçº¿ç¨‹(å…­)-AsyncTaskä½¿ç”¨è¯¦è§£åŠæºç åˆ†æ]]></title>
      <url>/Threadsource6.html</url>
      <content type="html"><![CDATA[<p><strong>ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºåšä¸»åŸåˆ›æ–‡ç« ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„(www.huangjie.name)ï¼Œä¿æŠ¤åŸåˆ›ï¼Œä»æˆ‘åšèµ·.</strong></p>
<hr>
<p>å¤šçº¿ç¨‹ç³»åˆ—å†å²æ–‡ç« :<br><a href="http://www.huangjie.name/Threadsourse.html">Android/java å¤šçº¿ç¨‹(ä¸€)-Threadçš„ä½¿ç”¨ä»¥åŠæºç åˆ†æ</a><br><a href="http://www.huangjie.name/multithreading2.html">Android/java å¤šçº¿ç¨‹(äºŒ)-Threadçš„å¥½å…„å¼ŸHandler</a><br><a href="http://www.huangjie.name/Threadsourse3.html">Android/java å¤šçº¿ç¨‹(ä¸‰)-HandlerThreadçš„ä½¿ç”¨åœºæ™¯åŠæºç è§£æ</a><br><a href="http://www.huangjie.name/Threadsourse4.html">Android/java å¤šçº¿ç¨‹(å››)-IntentService</a><br><a href="http://www.huangjie.name/Threadsource5.html">Android/java å¤šçº¿ç¨‹(äº”)-ThreadPoolExecutorçº¿ç¨‹æ± çš„ä½¿ç”¨</a><br><a id="more"></a></p>
<h3 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h3><p>ä¸€ä¸ªAndroidå°è£…å¥½çš„è½»é‡çº§å¼‚æ­¥æŠ½è±¡ç±»ï¼Œä½¿ç”¨çš„è¯éœ€è¦ç»§æ‰¿å¹¶é‡å†™éƒ¨åˆ†æ–¹æ³•</p>
<h3 id="ä½œç”¨"><a href="#ä½œç”¨" class="headerlink" title="ä½œç”¨"></a>ä½œç”¨</h3><p>æ–¹ä¾¿çš„å®ç°å¤šçº¿ç¨‹ï¼Œå¹¶èƒ½æ–¹ä¾¿çš„å®ç°ä¸»çº¿ç¨‹ä¸å·¥ä½œçº¿ç¨‹çš„é€šä¿¡ï¼Œå¹¶ä¸”é€»è¾‘éƒ½åœ¨ä¸€ä¸ªç±»ä¸­ï¼Œä¸åŒäºHandlerçš„å®ç°æœºåˆ¶åœ¨ä¸åŒçš„å›è°ƒä¸­ï¼Œå†…éƒ¨é‡‡ç”¨çº¿ç¨‹æ± ç®¡ç†ç­–ç•¥ï¼Œæ–¹ä¾¿ç®¡ç†</p>
<h3 id="ä½¿ç”¨ä»‹ç»"><a href="#ä½¿ç”¨ä»‹ç»" class="headerlink" title="ä½¿ç”¨ä»‹ç»"></a>ä½¿ç”¨ä»‹ç»</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">public abstract class AsyncTask&lt;Params, Progress, Result&gt; &#123;</span><br><span class="line">   ....</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°æœ‰ä¸‰ä¸ªæ³›å‹å‚æ•°ï¼Œå®ƒä»¬çš„ä½œç”¨åˆ†åˆ«æ˜¯ï¼š</p>
<ul>
<li>Params ä¼ é€’ç»™å¼‚æ­¥ä»»åŠ¡çš„å‚æ•°ç±»å‹ï¼Œå¯¹åº”execute()æ–¹æ³•å’ŒdoInBackground()ä¸­çš„å‚æ•°ç±»å‹</li>
<li>Progress è¿›åº¦è·Ÿæ–°å‚æ•°ç±»å‹,å¯¹åº”onProgressUpdate()æ–¹æ³•è¿”å›çš„å‚æ•°ç±»å‹</li>
<li>Result å¼‚æ­¥ä»»åŠ¡æ‰§è¡Œå®Œæ¯•çš„è¿”å›ç»“æœç±»å‹ï¼Œå¯¹åº”doInBackground()æ–¹æ³•çš„è¿”å›ç»“æœç±»å‹å’ŒonPostExecute()æ–¹æ³•çš„å‚æ•°ç±»å‹</li>
</ul>
<p>å¦‚æœä¸éœ€è¦ä½¿ç”¨åˆ°ï¼Œåˆ™å¯ä»¥ä½¿ç”¨<code>Void</code>ç±»ä»£æ›¿</p>
<p>ç®€å•ç¤ºä¾‹ï¼š</p>
<p>ç”³æ˜ä¸€ä¸ªå®ç°ç±»TestAsyncTaskï¼Œä¸»è¦æ‰“å°æ–¹æ³•çš„æ‰§è¡Œé¡ºåºä»¥åŠå‚æ•°åŠè¿è¡Œçš„çº¿ç¨‹åç§°<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * Created by hj on 2018/12/29.</span><br><span class="line"> * è¯´æ˜ï¼š</span><br><span class="line"> */</span><br><span class="line">public class TestAsyncTask extends AsyncTask&lt;String,Integer,Integer&gt; &#123;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void onPostExecute(Integer integer) &#123;</span><br><span class="line">        super.onPostExecute(integer);</span><br><span class="line">        Log.i(&quot;HJ&quot;,&quot;onPostExecuteæ–¹æ³•æ¥æ”¶çš„å‚æ•°å€¼:&quot;+integer+&quot;--&quot;+runThreadName());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void onPreExecute() &#123;</span><br><span class="line">        super.onPreExecute();</span><br><span class="line">        Log.i(&quot;HJ&quot;,&quot;onPreExecute&quot;+&quot;--&quot;+runThreadName());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void onProgressUpdate(Integer... values) &#123;</span><br><span class="line">        super.onProgressUpdate(values);</span><br><span class="line">        Log.i(&quot;HJ&quot;,&quot;onProgressUpdate:&quot;+ Arrays.toString(values)+&quot;--&quot;+runThreadName());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected Integer doInBackground(String... strings) &#123;</span><br><span class="line">        Log.i(&quot;HJ&quot;,&quot;doInBackground()&quot;+&quot;--&quot;+runThreadName());</span><br><span class="line">        publishProgress(50);</span><br><span class="line">        return 1;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private String runThreadName()&#123;</span><br><span class="line">        return &quot;è¿è¡Œåœ¨:&quot;+Thread.currentThread().getName()+&quot;çº¿ç¨‹&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>ä½¿ç”¨ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">//å¿…é¡»æ˜¯åœ¨ä¸»çº¿ç¨‹ä¸­</span><br><span class="line"> TestAsyncTask task = new TestAsyncTask();</span><br><span class="line">        task.execute();</span><br></pre></td></tr></table></figure></p>
<p>æ‰“å°ç»“æœï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">I/HJ: onPreExecute--è¿è¡Œåœ¨:mainçº¿ç¨‹</span><br><span class="line">I/HJ: doInBackground()--è¿è¡Œåœ¨:AsyncTask #1çº¿ç¨‹</span><br><span class="line">I/HJ: onProgressUpdate:[50]--è¿è¡Œåœ¨:mainçº¿ç¨‹</span><br><span class="line">I/HJ: onPostExecuteæ–¹æ³•æ¥æ”¶çš„å‚æ•°å€¼:1--è¿è¡Œåœ¨:mainçº¿ç¨‹</span><br></pre></td></tr></table></figure></p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œåªæœ‰doInBackground()æ–¹æ³•æ‰§è¡Œåœ¨å¼‚æ­¥çº¿ç¨‹ä¸­ï¼Œå…¶ä»–çš„æ–¹æ³•éƒ½æ˜¯è¿è¡Œåœ¨ä¸»çº¿ç¨‹ä¸­ï¼Œæ–¹æ³•æ‰§è¡Œé¡ºåºä¸ºï¼š<br>onPreExecute()â€”-&gt;doInBackground()â€”-&gt;è°ƒç”¨publishProgress()æ–¹æ³•â€”-&gt;onProgressUpdate()â€”â€”&gt;onPostExecute()</p>
<p>ä¸‹é¢ä»‹ç»ä¸€ä¸‹æ–¹æ³•çš„å…·ä½“ä½œç”¨:</p>
<ul>
<li>onPreExecute  åœ¨è¿›è¡Œå¼‚æ­¥ä»»åŠ¡å¤„ç†å‰çš„ä¸€äº›æ•°æ®å‡†å¤‡å·¥ä½œ</li>
<li>doInBackground å¤„ç†å¼‚æ­¥ä»»åŠ¡é€»è¾‘ï¼Œå†…éƒ¨å¯ä»¥è°ƒç”¨publishProgressæ›´æ–°è¿›åº¦</li>
<li>onProgressUpdate è¿›åº¦æ›´æ–°å›è°ƒ</li>
<li>onPostExecute  å¼‚æ­¥å¤„ç†å®Œæ¯•åçš„ç»“æœå›è°ƒ ï¼Œå¤„ç†uié€»è¾‘</li>
</ul>
<h3 id="æºç è§£æ"><a href="#æºç è§£æ" class="headerlink" title="æºç è§£æ"></a>æºç è§£æ</h3><p><code>AsyncTask</code>å†…éƒ¨çš„å®ç°åŸç†ä¸ºï¼šçº¿ç¨‹æ± +Handler</p>
<p>å…¶å†…éƒ¨æœ‰ä¸¤ä¸ªçº¿ç¨‹æ± ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">public static final Executor SERIAL_EXECUTOR = new SerialExecutor();</span><br><span class="line">private static volatile Executor sDefaultExecutor = SERIAL_EXECUTOR;</span><br><span class="line">public static final Executor THREAD_POOL_EXECUTOR;</span><br></pre></td></tr></table></figure></p>
<p><code>SERIAL_EXECUTOR</code>å¯¹åº”å†…éƒ¨çš„<code>SerialExecutor</code>å†…éƒ¨å®ç°ç±»ï¼Œä¸»è¦å®ç°äº†å¼‚æ­¥ä»»åŠ¡çš„é¡ºåºåˆ†å‘:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">private static class SerialExecutor implements Executor &#123;</span><br><span class="line">        final ArrayDeque&lt;Runnable&gt; mTasks = new ArrayDeque&lt;Runnable&gt;();</span><br><span class="line">        Runnable mActive;  //å½“å‰è¦å¤„ç†çš„å¼‚æ­¥ä»»åŠ¡</span><br><span class="line"></span><br><span class="line">        //ç»™executeæ–¹æ³•åŠ é”ä¿è¯äº†é¡ºåºæ‰§è¡Œ</span><br><span class="line">        public synchronized void execute(final Runnable r) &#123;</span><br><span class="line">           //å°†ä¸€ä¸ªrunnableæ·»åŠ è¿›åŒç«¯é˜Ÿåˆ—ä¸­</span><br><span class="line">            mTasks.offer(new Runnable() &#123;</span><br><span class="line">                public void run() &#123;</span><br><span class="line">                    try &#123;</span><br><span class="line">                        r.run();  //æ‰§è¡Œ</span><br><span class="line">                    &#125; finally &#123;</span><br><span class="line">                        scheduleNext();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">            if (mActive == null) &#123;</span><br><span class="line">                scheduleNext();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        //æ­¤æ–¹æ³•çš„ä½œç”¨æ˜¯å°†SerialExecutor æ± ä¸­çš„ä»»åŠ¡çš„ç¬¬ä¸€ä¸ªä»»åŠ¡èµ‹å€¼ç»™mActive ï¼Œå¹¶å‹å…¥åˆ°</span><br><span class="line">       //THREAD_POOL_EXECUTORçº¿ç¨‹æ± ä¸­</span><br><span class="line">        protected synchronized void scheduleNext() &#123;</span><br><span class="line">            //poll()æ–¹æ³•çš„ä½œç”¨æ˜¯åˆ é™¤é˜Ÿåˆ—ä¸­çš„ç¬¬ä¸€ä¸ªå¹¶è¿”å›ç»“æœ,å¦‚æœä¸ºnullåˆ™è¿”å›null</span><br><span class="line">            if ((mActive = mTasks.poll()) != null) &#123;</span><br><span class="line">                //å°†ç¬¬ä¸€ä¸ªä»»åŠ¡æ·»åŠ åˆ°THREAD_POOL_EXECUTORçº¿ç¨‹æ± ä¸­</span><br><span class="line">                THREAD_POOL_EXECUTOR.execute(mActive);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<p>è€ŒTHREAD_POOL_EXECUTORçš„å®ç°æ˜¯åœ¨è¿™é‡Œï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">static &#123;</span><br><span class="line">    ThreadPoolExecutor threadPoolExecutor = new ThreadPoolExecutor(</span><br><span class="line">            CORE_POOL_SIZE, MAXIMUM_POOL_SIZE, KEEP_ALIVE_SECONDS, TimeUnit.SECONDS,</span><br><span class="line">            sPoolWorkQueue, sThreadFactory);</span><br><span class="line">    threadPoolExecutor.allowCoreThreadTimeOut(true);</span><br><span class="line">    THREAD_POOL_EXECUTOR = threadPoolExecutor;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>å¯ä»¥çœ‹å‡ºå®ƒæ˜¯ä¸€ä¸ªå¸¸è§çš„å·¥ä½œçº¿ç¨‹æ± ï¼Œæ‰€ä»¥ï¼Œè¿™ä¸¤ä¸ªçº¿ç¨‹æ± ï¼Œä¸€ä¸ªè´Ÿè´£æ¶ˆæ¯çš„ä»»åŠ¡è°ƒåº¦ï¼Œä¿è¯æŒ‰ç…§é¡ºåºæ‰§è¡Œï¼Œå¦å¤–ä¸€ä¸ªåˆ™æ˜¯çœŸæ­£çš„å¼‚æ­¥ä»»åŠ¡å¤„ç†æ± </p>
<p>æ¥ä¸‹æ¥çœ‹ä¸€ä¸‹å®ƒçš„æ„é€ æ–¹æ³•ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">public AsyncTask(@Nullable Looper callbackLooper) &#123;</span><br><span class="line">        //åˆå§‹åŒ–ä¸€ä¸ªHandlerå¤„ç†ä¸»çº¿ç¨‹çš„é€šä¿¡</span><br><span class="line">        mHandler = callbackLooper == null || callbackLooper == Looper.getMainLooper()</span><br><span class="line">            ? getMainHandler()</span><br><span class="line">            : new Handler(callbackLooper);</span><br><span class="line">        //åˆå§‹åŒ–ä¸€ä¸ªå¯ä»¥å­˜å‚¨Paramså‚æ•°çš„callableå®ç°ï¼Œå…¶å®ä¹Ÿæ˜¯ </span><br><span class="line">       //THREAD_POOL_EXECUTOR.execute()çš„æ‰§è¡Œå›è°ƒ</span><br><span class="line">        mWorker = new WorkerRunnable&lt;Params, Result&gt;() &#123;</span><br><span class="line">            public Result call() throws Exception &#123;</span><br><span class="line">               //é‡Œé¢çš„å›è°ƒæ˜¯ä¸æ˜¯å¾ˆç†Ÿæ‚‰ï¼Œå’ŒHandlerThreadç±»ä¼¼</span><br><span class="line">                mTaskInvoked.set(true); //æ·»åŠ çº¿ç¨‹æ ‡è¯†,ç”¨äºpostResultIfNotInvokedæ–¹æ³•çš„æ£€æŸ¥</span><br><span class="line">                Result result = null;  //è¿™å°±æ˜¯onPostExecute()æ–¹æ³•çš„result</span><br><span class="line">                try &#123;</span><br><span class="line">                    Process.setThreadPriority(Process.THREAD_PRIORITY_BACKGROUND);</span><br><span class="line">                    //noinspection unchecked</span><br><span class="line">                    result = doInBackground(mParams); //doInBackgroundæ–¹æ³•åœ¨è¿™é‡Œæ‰§è¡Œäº†</span><br><span class="line">                    Binder.flushPendingCommands();</span><br><span class="line">                &#125; catch (Throwable tr) &#123;</span><br><span class="line">                    mCancelled.set(true); //æŠ›å¼‚å¸¸äº†å–æ¶ˆä»»åŠ¡</span><br><span class="line">                    throw tr;</span><br><span class="line">                &#125; finally &#123;</span><br><span class="line">                    postResult(result); //æ­¤æ–¹æ³•çš„ä½œç”¨æ˜¯å°†ç»“æœå‘é€åˆ°ä¸»çº¿ç¨‹</span><br><span class="line">                &#125;</span><br><span class="line">                return result;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">         //åˆå§‹åŒ–ä¸€ä¸ªFutureå›è°ƒï¼Œä¸»è¦ç”¨äºæ£€æŸ¥å¤„ç†ç»“æœæ˜¯å¦å‘é€</span><br><span class="line">        mFuture = new FutureTask&lt;Result&gt;(mWorker) &#123;</span><br><span class="line">            //done()æ–¹æ³•æ˜¯åœ¨callable()æ–¹æ³•ä¹‹åçš„å›è°ƒ</span><br><span class="line">            @Override</span><br><span class="line">            protected void done() &#123;</span><br><span class="line">                try &#123;</span><br><span class="line">                    //æ‰§è¡Œæ£€æŸ¥</span><br><span class="line">                    postResultIfNotInvoked(get());</span><br><span class="line">                &#125; catch (InterruptedException e) &#123;</span><br><span class="line">                    android.util.Log.w(LOG_TAG, e);</span><br><span class="line">                &#125; catch (ExecutionException e) &#123;</span><br><span class="line">                    throw new RuntimeException(&quot;An error occurred while executing doInBackground()&quot;,</span><br><span class="line">                            e.getCause());</span><br><span class="line">                &#125; catch (CancellationException e) &#123;</span><br><span class="line">                    postResultIfNotInvoked(null);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">//mWorker çš„å®ç°</span><br><span class="line">    private static abstract class WorkerRunnable&lt;Params, Result&gt; implements Callable&lt;Result&gt; &#123;</span><br><span class="line">        Params[] mParams;  //ä¿å­˜ä¼ å…¥çš„å‚æ•°</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<p>æ¥ä¸‹æ¥çœ‹çœ‹ä»¥ä¸Šæ£€æŸ¥çš„æ–¹æ³•çš„å®ç°ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">private void postResultIfNotInvoked(Result result) &#123;</span><br><span class="line">        //æ‰§è¡Œäº†mWorker é‡Œçš„call()å›è°ƒçš„éƒ½ä¼šå˜ä¸ºtrue,å¦‚æœä¸ºfalse,è¯´æ˜ä»»åŠ¡æ²¡æœ‰è¢«æ‰§è¡Œ</span><br><span class="line">        final boolean wasTaskInvoked = mTaskInvoked.get();</span><br><span class="line">        if (!wasTaskInvoked) &#123;</span><br><span class="line">            postResult(result);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //å°†æ­¤AsyncTaskå¯¹è±¡ä½œä¸ºmessageå‚æ•°å‘é€,æ¥æ”¶åˆ°ä¹‹åå°±ä¼šè°ƒç”¨finish()æ–¹æ³•ç»“æŸ</span><br><span class="line">    private Result postResult(Result result) &#123;</span><br><span class="line">        @SuppressWarnings(&quot;unchecked&quot;)</span><br><span class="line">        Message message = getHandler().obtainMessage(MESSAGE_POST_RESULT,</span><br><span class="line">                new AsyncTaskResult&lt;Result&gt;(this, result));</span><br><span class="line">        message.sendToTarget();</span><br><span class="line">        return result;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<p>å…¶ä¸­çš„getHandler()ä¸­çš„Handlerçš„å®ç°ç±»æ˜¯<code>InternalHandler</code>ï¼Œæ¥çœ‹çœ‹å®ƒçš„å®ç°ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">  private static class InternalHandler extends Handler &#123;</span><br><span class="line">      public InternalHandler(Looper looper) &#123;</span><br><span class="line">          super(looper);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      @SuppressWarnings(&#123;&quot;unchecked&quot;, &quot;RawUseOfParameterizedType&quot;&#125;)</span><br><span class="line">      @Override</span><br><span class="line">      public void handleMessage(Message msg) &#123;</span><br><span class="line">          </span><br><span class="line">          AsyncTaskResult&lt;?&gt; result = (AsyncTaskResult&lt;?&gt;) msg.obj;</span><br><span class="line">          switch (msg.what) &#123;</span><br><span class="line">              case MESSAGE_POST_RESULT:</span><br><span class="line">                  //result.mData[0]å°±æ˜¯ä»postResultå‘é€è¿‡æ¥çš„AsyncTaskå¯¹è±¡</span><br><span class="line">                  result.mTask.finish(result.mData[0]);  //å¤„ç†ç»“æœåˆ†å‘ï¼Œå›è°ƒå¯¹åº”çš„æ–¹æ³•</span><br><span class="line">                  break;</span><br><span class="line">              case MESSAGE_POST_PROGRESS:</span><br><span class="line">                  result.mTask.onProgressUpdate(result.mData);  //è¿™é‡Œå¤„ç†è¿›åº¦æ›´æ–°</span><br><span class="line">                  break;</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">private void finish(Result result) &#123;</span><br><span class="line">      // å…ˆåˆ¤æ–­æ˜¯å¦è°ƒç”¨äº†Cancelled()</span><br><span class="line">          // 1. è‹¥è°ƒç”¨äº†åˆ™æ‰§è¡Œæˆ‘ä»¬å¤å†™çš„onCancelledï¼ˆï¼‰</span><br><span class="line">          // å³ å–æ¶ˆä»»åŠ¡æ—¶çš„æ“ä½œ</span><br><span class="line">          if (isCancelled()) &#123;</span><br><span class="line">              onCancelled(result);</span><br><span class="line">          &#125; else &#123;</span><br><span class="line"></span><br><span class="line">          // 2. è‹¥æ— è°ƒç”¨Cancelled()ï¼Œåˆ™æ‰§è¡Œæˆ‘ä»¬å¤å†™çš„onPostExecute(result)</span><br><span class="line">          // å³æ›´æ–°UIæ“ä½œ</span><br><span class="line">              onPostExecute(result);</span><br><span class="line">          &#125;</span><br><span class="line">          // æ³¨ï¼šä¸ç®¡AsyncTaskæ˜¯å¦è¢«å–æ¶ˆï¼Œéƒ½ä¼šå°†AsyncTaskçš„çŠ¶æ€å˜æ›´ä¸ºï¼šFINISHED</span><br><span class="line">          mStatus = Status.FINISHED;</span><br><span class="line">      &#125;</span><br></pre></td></tr></table></figure></p>
<p>æœ€åæ¥çœ‹ä¸€ä¸‹æ‰§è¡Œæ–¹æ³•<code>execute()</code>:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"> @MainThread</span><br><span class="line"> public final AsyncTask&lt;Params, Progress, Result&gt; execute(Params... params) &#123;</span><br><span class="line">     return executeOnExecutor(sDefaultExecutor, params);</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line">@MainThread</span><br><span class="line"> public final AsyncTask&lt;Params, Progress, Result&gt; executeOnExecutor(Executor exec,</span><br><span class="line">         Params... params) &#123;</span><br><span class="line">     if (mStatus != Status.PENDING) &#123;</span><br><span class="line">         switch (mStatus) &#123;</span><br><span class="line">             case RUNNING:</span><br><span class="line">                 throw new IllegalStateException(&quot;Cannot execute task:&quot;</span><br><span class="line">                         + &quot; the task is already running.&quot;);</span><br><span class="line">             case FINISHED:</span><br><span class="line">                 throw new IllegalStateException(&quot;Cannot execute task:&quot;</span><br><span class="line">                         + &quot; the task has already been executed &quot;</span><br><span class="line">                         + &quot;(a task can be executed only once)&quot;);</span><br><span class="line">         &#125;</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     mStatus = Status.RUNNING;</span><br><span class="line"></span><br><span class="line">     onPreExecute();</span><br><span class="line"></span><br><span class="line">     mWorker.mParams = params; //mWorkerä¸­çš„å‚æ•°æ˜¯åœ¨è¿™é‡Œä¿å­˜çš„</span><br><span class="line">     exec.execute(mFuture);  //å°†mFutureå¯¹è±¡æ·»åŠ åˆ°THREAD_POOL_EXECUTOR çº¿ç¨‹æ± ä¸­ï¼ŒmFutureåœ¨æ„é€ æ–¹æ³•ä¸­åšäº†åˆå§‹åŒ–ã€‚</span><br><span class="line"></span><br><span class="line">     return this;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure></p>
<p>æ€»ç»“ï¼š<br>1.åˆå§‹åŒ–ä¸¤ä¸ªçº¿ç¨‹æ± ï¼Œä¸€ä¸ªè´Ÿè´£ä»»åŠ¡è°ƒåº¦<code>(SerialExecutor)</code>,ä¸€ä¸ªè´Ÿè´£ä»»åŠ¡å¤„ç†<code>THREAD_POOL_EXECUTOR</code><br>2.æ„é€ æ–¹æ³•ä¸­å®ä¾‹åŒ–äº†å­çº¿ç¨‹ä¸­çš„callableæ¥å£æ–¹æ³•ï¼Œä»<code>WorkerRunnable</code>ä¸­å–å‡º<code>Params</code>å¯¹è±¡å¹¶èµ‹å€¼ç»™<code>dodoInBackground(mParams)</code>æ–¹æ³•æ‰§è¡Œè€—æ—¶ä»»åŠ¡ã€‚<br>3.æ‰§è¡Œ<code>execute()</code>æ–¹æ³•å°†ä»»åŠ¡æäº¤åˆ°THREAD_POOL_EXECUTORçº¿ç¨‹æ± ä¸­ï¼Œå¹¶å°†Paramså‚æ•°èµ‹å€¼åˆ°äº†<code>WorkerRunnable</code>ä¸­ã€‚<br>4.è°ƒç”¨äº†<code>postResult(result)</code>,é€šè¿‡InternalHandler å°†æ¶ˆæ¯å›è°ƒåˆ°äº†ä¸»çº¿ç¨‹ï¼ˆæ‰§è¡Œäº†finish()æ–¹æ³•ï¼Œé‡Œé¢æœ‰onPostExecuteæ–¹æ³•),å®ç°äº†UIçš„æ›´æ–°</p>
]]></content>
      
        <categories>
            
            <category> å¤šçº¿ç¨‹ç¼–ç¨‹ </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Android </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Android/java å¤šçº¿ç¨‹(äº”)-ThreadPoolExecutorçº¿ç¨‹æ± çš„ä½¿ç”¨]]></title>
      <url>/Threadsource5.html</url>
      <content type="html"><![CDATA[<p><strong>ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºåšä¸»åŸåˆ›æ–‡ç« ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„(www.huangjie.name)ï¼Œä¿æŠ¤åŸåˆ›ï¼Œä»æˆ‘åšèµ·.</strong></p>
<hr>
<p>å¤šçº¿ç¨‹ç³»åˆ—å†å²æ–‡ç« :<br><a href="http://www.huangjie.name/Threadsourse.html">Android/java å¤šçº¿ç¨‹(ä¸€)-Threadçš„ä½¿ç”¨ä»¥åŠæºç åˆ†æ</a><br><a href="http://www.huangjie.name/multithreading2.html">Android/java å¤šçº¿ç¨‹(äºŒ)-Threadçš„å¥½å…„å¼ŸHandler</a><br><a href="http://www.huangjie.name/Threadsourse3.html">Android/java å¤šçº¿ç¨‹(ä¸‰)-HandlerThreadçš„ä½¿ç”¨åœºæ™¯åŠæºç è§£æ</a><br><a href="http://www.huangjie.name/Threadsourse4.html">Android/javaå¤šçº¿ç¨‹(å››)-IntentService</a><br><a id="more"></a></p>
<blockquote>
<p>å‰é¢å‡ ç¯‡æ–‡ç« ä¸»è¦éƒ½æ˜¯ä»‹ç»çš„å•ä¸ªçº¿ç¨‹çš„è¿ç”¨ä»¥åŠåŸç†ï¼Œè¿™ç¯‡æ–‡ç« å¼€å§‹è®²è§£å¤šä¸ªçº¿ç¨‹çš„è¿ç”¨</p>
<h3 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h3><p>çº¿ç¨‹æ± æ˜¯ä¸€ä¸ªèƒ½å¯¹å¤šä¸ªçº¿ç¨‹è¿›è¡Œç»Ÿä¸€ç®¡ç†çš„ä¸€å¥—æœºåˆ¶ï¼Œå®ƒå…·æœ‰è¯¸å¤šçš„ä¼˜ç‚¹ï¼š</p>
<ul>
<li>èƒ½å¯¹çº¿ç¨‹è¿›è¡Œå¤ç”¨ï¼Œå½“æœ‰ç©ºé—²çš„çº¿ç¨‹ï¼Œçº¿ç¨‹æ± ä¼šå¤ç”¨è¿™äº›çº¿ç¨‹è€Œä¸ä¼šå»é‡æ–°åˆ›å»ºï¼ŒèŠ‚çœäº†èµ„æº</li>
<li>èƒ½çµæ´»åˆ›å»ºå„ç§çº¿ç¨‹ä½¿ç”¨åœºæ™¯ï¼Œå†…éƒ¨å°è£…äº†å¸¸ç”¨çº¿ç¨‹æ± åˆ›å»ºé€»è¾‘ï¼Œå¹¶æ”¯æŒè‡ªå®šä¹‰çº¿ç¨‹æ± é€»è¾‘åˆ›å»º</li>
<li>èƒ½å‡†ç¡®çš„å¯¹æ¯ä¸€ä¸ªçº¿ç¨‹è¿›è¡Œç®¡ç†ï¼Œå¹¶èƒ½è¯»å–æ¯ä¸ªçº¿ç¨‹çš„ä¸€å†™åŸºç¡€ä¿¡æ¯ï¼Œæ–¹ä¾¿è¿›è¡Œä¸€äº›é€»è¾‘å¤„ç†</li>
</ul>
</blockquote>
<p>ç¼ºç‚¹ï¼š<br>çº¿ç¨‹ä¸­çš„æ•°æ®ä¼ é€’æ²¡æœ‰Handleræœºåˆ¶æ–¹ä¾¿</p>
<p>ä½¿ç”¨åœºæ™¯ï¼š<br>å…·æœ‰è¯¸å¤šè€—æ—¶ä»»åŠ¡çš„æƒ…å†µï¼Œå½“ç³»ç»Ÿä¸ºæ¯ä¸€ä¸ªä»»åŠ¡åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ï¼Œä¼šå ç”¨ç³»ç»Ÿçš„å¤§é‡èµ„æºï¼Œå®¹æ˜“å¼•èµ·ç•Œé¢çš„å¡é¡¿ï¼Œçº¿ç¨‹æ± çš„å¤ç”¨æœºåˆ¶å°±å¾ˆå¥½çš„è§£å†³äº†è¿™ä¸ªé—®é¢˜</p>
<h3 id="å¸¸ç”¨çš„çº¿ç¨‹æ± çš„ä½¿ç”¨"><a href="#å¸¸ç”¨çš„çº¿ç¨‹æ± çš„ä½¿ç”¨" class="headerlink" title="å¸¸ç”¨çš„çº¿ç¨‹æ± çš„ä½¿ç”¨"></a>å¸¸ç”¨çš„çº¿ç¨‹æ± çš„ä½¿ç”¨</h3><h5 id="è‡ªå®šä¹‰çº¿ç¨‹æ± "><a href="#è‡ªå®šä¹‰çº¿ç¨‹æ± " class="headerlink" title="è‡ªå®šä¹‰çº¿ç¨‹æ± "></a>è‡ªå®šä¹‰çº¿ç¨‹æ± </h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">public ThreadPoolExecutor(int corePoolSize,</span><br><span class="line">                          int maximumPoolSize,</span><br><span class="line">                          long keepAliveTime,</span><br><span class="line">                          TimeUnit unit,</span><br><span class="line">                          BlockingQueue&lt;Runnable&gt; workQueue,</span><br><span class="line">                          ThreadFactory threadFactory,</span><br><span class="line">                          RejectedExecutionHandler handler) &#123;</span><br><span class="line">    if (corePoolSize &lt; 0 ||</span><br><span class="line">        maximumPoolSize &lt;= 0 ||</span><br><span class="line">        maximumPoolSize &lt; corePoolSize ||</span><br><span class="line">        keepAliveTime &lt; 0)</span><br><span class="line">        throw new IllegalArgumentException();</span><br><span class="line">    if (workQueue == null || threadFactory == null || handler == null)</span><br><span class="line">        throw new NullPointerException();</span><br><span class="line">    this.corePoolSize = corePoolSize;</span><br><span class="line">    this.maximumPoolSize = maximumPoolSize;</span><br><span class="line">    this.workQueue = workQueue;</span><br><span class="line">    this.keepAliveTime = unit.toNanos(keepAliveTime);</span><br><span class="line">    this.threadFactory = threadFactory;</span><br><span class="line">    this.handler = handler;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¼ å…¥ä¸åŒçš„å‚æ•°ï¼Œå®ç°çš„æ•ˆæœä¹Ÿä¸åŒ,ä¸‹é¢è¯´ä¸€ä¸‹æ¯ä¸ªå‚æ•°çš„ä½œç”¨:</p>
<ul>
<li>corePoolSize æ ¸å¿ƒçº¿ç¨‹æ•°,ï¼Œå³ä½¿ç©ºé—²æ—¶ä»ä¿ç•™åœ¨æ± ä¸­çš„çº¿ç¨‹æ•°,é™¤éè®¾ç½®äº†<code>allowCoreThreadTimeOut</code></li>
<li>maximumPoolSize çº¿ç¨‹æ± ä¸­å…è®¸çš„æœ€å¤§çº¿ç¨‹æ•°</li>
<li>keepAliveTime é¡¾åæ€ä¹‰ï¼Œçº¿ç¨‹ç»ˆæ­¢å‰çš„å­˜æ´»æ—¶é—´ï¼Œå³å½“çº¿ç¨‹æ•°å¤§äºæ ¸å¿ƒçº¿ç¨‹æ•°(corePoolSize )æ—¶,å¤šä½™çš„ç©ºé—²çº¿ç¨‹åœ¨ç»ˆæ­¢ä¹‹å‰ç­‰å¾…æ–°ä»»åŠ¡çš„æœ€å¤§æ—¶é—´</li>
<li>TimeUnit  <code>keepAliveTime</code>çš„å•ä½</li>
<li>workQueue åœ¨æ‰§è¡Œä»»åŠ¡ä¹‹å‰ç”¨äºä¿å­˜ä»»åŠ¡çš„é˜Ÿåˆ—ã€‚ è¯¥é˜Ÿåˆ—å°†ä»…ä¿å­˜executeæ–¹æ³•æäº¤çš„Runnableä»»åŠ¡ã€‚</li>
<li>ThreadFactory  æ‰§è¡Œç¨‹åºåˆ›å»ºæ–°çº¿ç¨‹æ—¶ä½¿ç”¨çš„å·¥å‚</li>
<li>RejectedExecutionHandler  æ‰§è¡Œè¢«é˜»æ­¢æ—¶ä½¿ç”¨çš„å¤„ç†ç¨‹åº</li>
</ul>
<p>è¿™é‡Œè¯´ä¸€ä¸‹å„ä¸ªå‚æ•°çš„é…ç½®å¥—è·¯,å½“ä½¿ç”¨<code>execute(Runnable)</code>æ–¹æ³•æ·»åŠ ä¸€ä¸ªä»»åŠ¡åˆ°é˜Ÿåˆ—ä¸­ï¼Œå¦‚æœ<code>corePoolSize</code>æ¯”<code>maximumPoolSize</code>å°ï¼Œé˜Ÿåˆ—æ»¡äº†åå°±ä¼šå»åˆ›å»ºæ–°çš„çº¿ç¨‹,å½“<code>corePoolSize</code>ä¸<code>maximumPoolSize</code>ç›¸ç­‰æ—¶ï¼Œå°±ä¼šåˆ›å»ºä¸€ä¸ªå›ºå®šå¤§å°çš„æ ¸å¿ƒçº¿ç¨‹æ± ã€‚å¦‚æœå°†<code>maximumPoolSize</code>è®¾ç½®ä¸ºæ— é™å¤§(ä¾‹å¦‚nteger.MAX_VALUE)ï¼Œåˆ™æ˜¯åˆ›å»ºä¸€ä¸ªèƒ½å®¹çº³ä»»æ„æ•°é‡ä»»åŠ¡çš„çº¿ç¨‹æ± ã€‚<br><code>ThreadFactory</code>çš„ä½œç”¨æ˜¯ç”¨æ¥åˆ›å»ºæ–°çš„çº¿ç¨‹çš„ï¼Œå®ƒæ˜¯ä¸€ä¸ªæ¥å£,å®ç°å®ƒå³å¯åˆ›å»ºä¸€ä¸ªæ–°çš„çº¿ç¨‹ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">public interface ThreadFactory &#123;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * Constructs a new &#123;@code Thread&#125;.  Implementations may also initialize</span><br><span class="line">     * priority, name, daemon status, &#123;@code ThreadGroup&#125;, etc.</span><br><span class="line">     *</span><br><span class="line">     * @param r a runnable to be executed by new thread instance</span><br><span class="line">     * @return constructed thread, or &#123;@code null&#125; if the request to</span><br><span class="line">     *         create a thread is rejected</span><br><span class="line">     */</span><br><span class="line">    Thread newThread(Runnable r);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>é€šè¿‡å®ƒï¼Œä½ å¯ä»¥æŒ‡å®šçº¿ç¨‹çš„åç§°ï¼Œä¼˜å…ˆçº§ï¼Œå®ˆæŠ¤è¿›ç¨‹ç­‰ï¼Œå¦‚æœä¸è®¾ç½®ï¼Œåˆ™ä¼šé»˜è®¤ä½¿ç”¨<code>Executors.defaultThreadFactory()</code>ï¼Œå®ƒä¼šåˆ›å»ºä¸€ä¸ªä¸æ‰€æœ‰çº¿ç¨‹ä¸æ‰€æœ‰ç›¸åŒçš„<code>ThreadGroup</code>å¹¶ä¸”å…·æœ‰ç›¸åŒçš„ä¼˜å…ˆçº§å’Œéå®ˆæŠ¤è¿›ç¨‹çŠ¶æ€<code>NORM_PRIORITY</code>ã€‚<br><code>workQueue</code>æ˜¯ä¸€ä¸ªæ’é˜Ÿç­–ç•¥,ä¸€èˆ¬æœ‰ä¸‰ç§:</p>
<ul>
<li>ç›´æ¥åˆ‡æ¢ï¼šå¯¹åº”<code>SynchronousQueue</code>å®ç°ç±»ï¼Œå°†ä»»åŠ¡ç›´æ¥äº¤ç»™çº¿ç¨‹å¤„ç†ï¼Œä¸éœ€è¦å¦å¤–çš„æ§åˆ¶ï¼Œé€šå¸¸éœ€è¦é…ç½®ä¸€ä¸ªæ— é™åˆ¶çš„<code>maximumPoolSizes</code>ï¼Œä»¥é¿å…æ‹’ç»æ‰æ–°æäº¤çš„ä»»åŠ¡</li>
<li>æ— ç•Œé˜Ÿåˆ—:å¯¹åº”<code>LinkedBlockingDeque</code>å®ç°ç±»ï¼Œå®ƒæ²¡æœ‰é¢„å®šçš„å®¹é‡ï¼Œå½“æœ‰æ–°çš„ä»»åŠ¡ï¼Œä¼šåœ¨é˜Ÿåˆ—ä¸­ç­‰å¾…ï¼Œç›´åˆ°åŠ å…¥åˆ°corePoolSizeçš„çº¿ç¨‹ä¸­ï¼Œå¦‚æœcorePoolSizeçº¿ç¨‹ä¸€ç›´å¾ˆå¿™ï¼Œä¹Ÿä¸ä¼šå»åˆ›å»ºæ–°çš„çº¿ç¨‹ï¼Œæ­¤æ—¶ï¼Œæœ€å¤§å€¼æœ€å°å€¼å¯¹å®ƒæ²¡æœ‰ä»»ä½•çš„å½±å“ï¼Œæ¯ä¸ªä»»åŠ¡ä¸å…¶ä»–çš„ä»»åŠ¡éƒ½æ˜¯ç‹¬ç«‹çš„ï¼Œä¸ä¼šäº’ç›¸å½±å“</li>
<li>æœ‰è¾¹ç•Œçš„é˜Ÿåˆ—ï¼šä¾‹å¦‚<code>ArrayBlockingQueue</code>å®ç°ç±»,å®ƒæœ‰åŠ©äºåœ¨ä½¿ç”¨æœ‰é™çš„maxPoolSizeæ—¶é˜²æ­¢èµ„æºçš„è€—å°½ï¼Œä½†å®ƒæ›´éš¾è°ƒæ•´ä¸æ§åˆ¶ã€‚</li>
</ul>
<p>ä¸€èˆ¬æƒ…å†µä¸‹æˆ‘ä»¬éƒ½å¯ä»¥é€šè¿‡javaæä¾›çš„å·¥å‚æ¨¡å¼æ¥æ„é€ æˆ‘ä»¬çš„çº¿ç¨‹æ± ç­–ç•¥ï¼Œä¸»è¦æä¾›äº†ä»¥ä¸‹å‡ ç§æ–¹å¼:</p>
<h5 id="newFixedThreadPool"><a href="#newFixedThreadPool" class="headerlink" title="newFixedThreadPool"></a>newFixedThreadPool</h5><p>ç‰¹ç‚¹:</p>
<ul>
<li>çº¿ç¨‹é‡ç”¨ï¼Œå¦‚æœæ²¡æœ‰é‡ç”¨çš„çº¿ç¨‹ï¼Œå°†ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„çº¿ç¨‹æ·»åŠ åˆ°æ± ä¸­</li>
<li>é€‚åˆæ‰§è¡ŒçŸ­æœŸå¼‚æ­¥ä»»åŠ¡ç¨‹åºï¼Œé»˜è®¤ä¸º60ç§’çš„çº¿ç¨‹ç­‰å¾…æ—¶é—´ï¼Œè¶…è¿‡å°±ä¼šç»ˆæ­¢ä¸ç§»é™¤</li>
<li>é—²ç½®çš„çº¿ç¨‹ä¸ä¼šæ¶ˆè€—èµ„æº</li>
</ul>
<p>æºç é…ç½®ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">public static ExecutorService newCachedThreadPool() &#123;</span><br><span class="line">    return new ThreadPoolExecutor(0, Integer.MAX_VALUE,</span><br><span class="line">                                  60L, TimeUnit.SECONDS,</span><br><span class="line">                                  new SynchronousQueue&lt;Runnable&gt;());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>ä½¿ç”¨åœºæ™¯:<br>å®ƒåˆ›å»ºäº†ä¸€ä¸ªæ— é™æ‰©å¤§çš„çº¿ç¨‹æ± ï¼Œä½†æ²¡æœ‰æ ¸å¿ƒçº¿ç¨‹æ± ï¼Œå› æ­¤èµ„æºå ç”¨å°‘ï¼Œé€‚åˆå¤„ç†ä¸€äº›çŸ­æœŸçš„å¼‚æ­¥ä»»åŠ¡</p>
<h5 id="newFixedThreadPool-1"><a href="#newFixedThreadPool-1" class="headerlink" title="newFixedThreadPool"></a>newFixedThreadPool</h5><p>ç‰¹ç‚¹:</p>
<ul>
<li>åˆ›å»ºä¸€ä¸ªå›ºå®šæ•°é‡çš„çº¿ç¨‹æ± ï¼Œä¸èƒ½éšæ—¶çš„æ–°å»ºçº¿ç¨‹ï¼Œå¦‚æœé˜Ÿåˆ—å·²æ»¡ï¼Œæäº¤äº†æ–°ä»»åŠ¡ï¼Œå¿…é¡»ç­‰å¾…ä¸€ä¸ªå¯ç”¨çš„çº¿ç¨‹</li>
<li>çº¿ç¨‹ä¼šä¸€ç›´å­˜åœ¨ï¼Œç›´åˆ°è°ƒç”¨shutdownæ–¹æ³•</li>
</ul>
<p>æºç é…ç½®:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">public static ExecutorService newFixedThreadPool(int nThreads) &#123;</span><br><span class="line">    return new ThreadPoolExecutor(nThreads, nThreads,</span><br><span class="line">                                  0L, TimeUnit.MILLISECONDS,</span><br><span class="line">                                  new LinkedBlockingQueue&lt;Runnable&gt;());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>ä½¿ç”¨åœºæ™¯:<br>å®ƒåˆ›å»ºäº†ä¸€ä¸ªæ ¸å¿ƒçº¿ç¨‹æ•°ä¸æœ€å¤§çº¿ç¨‹æ•°ç›¸åŒçš„çº¿ç¨‹æ± ï¼Œé€‚ç”¨äºå·²çŸ¥ä»»åŠ¡æ•°é‡ï¼Œå¯¹çº¿ç¨‹æ•°é‡è¿›è¡Œé™åˆ¶çš„åœºæ™¯</p>
<h5 id="newWorkStealingPool"><a href="#newWorkStealingPool" class="headerlink" title="newWorkStealingPool"></a>newWorkStealingPool</h5><p>ç‰¹ç‚¹:</p>
<ul>
<li>åˆ›å»ºä½¿ç”¨æ‰€æœ‰ç»™å®šå¹¶è¡Œçº§åˆ«çš„çº¿ç¨‹æ± ï¼Œå¹¶ä¸”å¯ä»¥ä½¿ç”¨å¤šä¸ªé˜Ÿåˆ—æ¥å‡å°‘å ç”¨<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">public static ExecutorService newWorkStealingPool() &#123;</span><br><span class="line">    return new ForkJoinPool</span><br><span class="line">        (Runtime.getRuntime().availableProcessors(),</span><br><span class="line">         ForkJoinPool.defaultForkJoinWorkerThreadFactory,</span><br><span class="line">         null, true);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>ä½¿ç”¨åœºæ™¯:<br>å®ƒèƒ½åˆ›å»ºä¸€ä¸ªæ‹¥æœ‰å¤šä¸ªä»»åŠ¡é˜Ÿåˆ—çš„çº¿ç¨‹æ± ï¼Œå¯ä»¥å‡å°‘é“¾æ¥æ•°ã€‚å¹¶ä¸”å®ƒæ˜¯é»˜è®¤åˆ›å»ºå½“å‰å¯ç”¨cpuæ•°é‡çš„çº¿ç¨‹æ¥å¹¶è¡Œæ‰§è¡Œï¼Œå› æ­¤é€‚ç”¨äºéå¸¸è€—æ—¶çš„æ“ä½œï¼Œå¹¶ä¸”å¯ä»¥å¹¶è¡Œæ‰§è¡Œ</p>
<h5 id="newSingleThreadExecutor"><a href="#newSingleThreadExecutor" class="headerlink" title="newSingleThreadExecutor"></a>newSingleThreadExecutor</h5><p>ç‰¹ç‚¹ï¼š</p>
<ul>
<li>æœ‰ä¸”åªæœ‰ä¸€ä¸ªä»»åŠ¡å¤„äºæ´»åŠ¨çŠ¶æ€</li>
<li>å…ˆæäº¤çš„å…ˆæ‰§è¡Œï¼Œæœ‰ä»»åŠ¡é¡ºåº</li>
<li>å½“ä»»åŠ¡å‡ºç°å¼‚å¸¸ï¼Œä¼šå¦åˆ›å»ºä¸€ä¸ªæ–°çš„çº¿ç¨‹æ›¿æ¢<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">public static ExecutorService newSingleThreadExecutor() &#123;</span><br><span class="line">    return new FinalizableDelegatedExecutorService</span><br><span class="line">        (new ThreadPoolExecutor(1, 1,</span><br><span class="line">                                0L, TimeUnit.MILLISECONDS,</span><br><span class="line">                                new LinkedBlockingQueue&lt;Runnable&gt;()));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>ä½¿ç”¨åœºæ™¯:<br>å®ƒæ˜¯ä¸€ä¸ªå•ä¾‹çº¿ç¨‹ï¼Œå¹¶ä¸”æœ‰æ‰§è¡Œé¡ºåºï¼Œæ‰€ä»¥é€‚ç”¨äºæœ‰æ‰§è¡Œé¡ºåºçš„ä»»åŠ¡ï¼Œå¹¶ä¸”æœ‰ä¸”åªæœ‰ä¸€ä¸ªä»»åŠ¡æ˜¯æ‰§è¡Œä¸­çš„</p>
<h5 id="ScheduledThreadPoolExecutor"><a href="#ScheduledThreadPoolExecutor" class="headerlink" title="ScheduledThreadPoolExecutor"></a>ScheduledThreadPoolExecutor</h5><p>ç‰¹ç‚¹ï¼š</p>
<ul>
<li>èƒ½è®¾ç½®å»¶è¿Ÿæ—¶é—´ï¼Œèƒ½å®šæœŸæ‰§è¡Œ</li>
<li>ç©ºé—²çš„çº¿ç¨‹ä¼šä¿ç•™</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">public ScheduledThreadPoolExecutor(int corePoolSize) &#123;</span><br><span class="line">    super(corePoolSize, Integer.MAX_VALUE,</span><br><span class="line">          DEFAULT_KEEPALIVE_MILLIS, MILLISECONDS,</span><br><span class="line">          new DelayedWorkQueue());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨åœºæ™¯ï¼š<br>å®ƒå…·æœ‰å®šæ—¶ç‰¹æ€§ï¼Œå› æ­¤å¯ä»¥ç”¨æ¥æ‰§è¡Œå‘¨æœŸè¡Œçš„ä»»åŠ¡</p>
<p>äº”å¤§çº¿ç¨‹æ± ä»‹ç»å®Œæ¯•ï¼Œæ­¤å¤–è¿˜æœ‰å…¶ä»–çš„å¸¸ç”¨æ–¹æ³•:</p>
<ul>
<li><code>execute(Runnable command)</code> æäº¤ä»»åŠ¡ï¼Œåœ¨å°†æ¥çš„æŸä¸ªæ—¶é—´ç‚¹æ‰§è¡Œä»»åŠ¡</li>
<li><code>afterExecute(Runnale r,Throwable t)</code> åœ¨æŒ‡å®šçš„Runnaleæ‰§è¡Œåè°ƒç”¨æ­¤æ–¹æ³•</li>
<li><code>beforeExecute(Thread t,Runnable r)</code>åœ¨ç»™å®šçš„çº¿ç¨‹ä¸­æ‰§è¡Œç»™å®šçš„Runnableä¹‹å‰è°ƒç”¨æ–¹æ³•</li>
<li><code>funalize</code> å½“æ‰§è¡Œå™¨ä¸å†è¢«å¼•ç”¨å¹¶ä¸”æ²¡æœ‰çº¿ç¨‹æ—¶ï¼Œè°ƒç”¨<code>shundown</code></li>
<li>shundown å¯åŠ¨æœ‰åºå…³é—­ï¼Œå…ˆå‰æäº¤çš„ä»»åŠ¡ä¼šæ‰§è¡Œï¼Œæ‰§è¡Œå®Œæ¯•åå…³é—­</li>
<li><code>shundownNow</code> ä¸»åŠ¨åœæ­¢æ‰§è¡Œä¸­çš„ä»»åŠ¡ï¼Œå¹¶è¿”å›æ­£åœ¨æ‰§è¡Œç­‰å¾…çš„ä»»åŠ¡åˆ—è¡¨</li>
</ul>
]]></content>
      
        <categories>
            
            <category> å¤šçº¿ç¨‹ç¼–ç¨‹ </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Android </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Android/javaå¤šçº¿ç¨‹(å››)-IntentService]]></title>
      <url>/Threadsource4.html</url>
      <content type="html"><![CDATA[<p><strong>ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºåšä¸»åŸåˆ›æ–‡ç« ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„(www.huangjie.name)ï¼Œä¿æŠ¤åŸåˆ›ï¼Œä»æˆ‘åšèµ·.</strong></p>
<hr>
<p>å¾€æœŸæ–‡ç« :<br><a href="http://www.huangjie.name/Threadsourse.html">Android/java å¤šçº¿ç¨‹(ä¸€)-Threadçš„ä½¿ç”¨ä»¥åŠæºç åˆ†æ</a><br><a href="http://www.huangjie.name/multithreading2.html">Android/java å¤šçº¿ç¨‹(äºŒ)-Threadçš„å¥½å…„å¼ŸHandler</a><br><a href="http://www.huangjie.name/Threadsourse3.html">Android/java å¤šçº¿ç¨‹(ä¸‰)-HandlerThreadçš„ä½¿ç”¨åœºæ™¯åŠæºç è§£æ</a><br><a id="more"></a></p>
<h3 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h3><p>ä¸€ä¸ªæ–¹ä¾¿çš„èƒ½åœ¨å­çº¿ç¨‹ä¸­è¿è¡Œçš„æœåŠ¡ï¼Œä¸€ä¸ªIntentServiceå¯¹åº”ä¸€ä¸ªçº¿ç¨‹ï¼Œç”±äºæ˜¯å››å¤§ç»„ä»¶ï¼Œä¼˜å…ˆçº§æ¯”çº¿ç¨‹é«˜ï¼Œä¸æ˜“è¢«ç³»ç»Ÿå›æ”¶ï¼Œå¤„ç†å®Œä»»åŠ¡è¿˜èƒ½ä¸»åŠ¨å›æ”¶ï¼Œå› æ­¤ç”¨æ¥å¤„ç†åå°ä¸‹è½½ä»»åŠ¡æä¸ºé€‚åˆ</p>
<h3 id="ç®€å•ä½¿ç”¨"><a href="#ç®€å•ä½¿ç”¨" class="headerlink" title="ç®€å•ä½¿ç”¨"></a>ç®€å•ä½¿ç”¨</h3><p>å…ˆç»§æ‰¿æ­¤ç±»ï¼Œé‡å†™å¿…è¦çš„æ–¹æ³•ï¼Œæˆ‘ä»¬çš„é€»è¾‘å¤„ç†æ˜¯åœ¨<code>onHandleIntent()</code>æ–¹æ³•ä¸­<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * Created by hj on 2018/12/21.</span><br><span class="line"> * è¯´æ˜ï¼š</span><br><span class="line"> */</span><br><span class="line">public class MyIntentService extends IntentService &#123;</span><br><span class="line"></span><br><span class="line">    public MyIntentService() &#123;</span><br><span class="line">        super(&quot;MyIntentService&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void onHandleIntent(@Nullable Intent intent) &#123;</span><br><span class="line">        //æ ¸å¿ƒæ–¹æ³•ï¼Œå¤„ç†å¼‚æ­¥é€»è¾‘</span><br><span class="line">        Log.i(&quot;HJ&quot;,&quot;onHandleIntent&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public int onStartCommand(@Nullable Intent intent, int flags, int startId) &#123;</span><br><span class="line">        Log.i(&quot;HJ&quot;,&quot;onStartCommand&quot;);</span><br><span class="line">        return super.onStartCommand(intent, flags, startId);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void onCreate() &#123;</span><br><span class="line">        Log.i(&quot;HJ&quot;, &quot;onCreate&quot;);</span><br><span class="line">        super.onCreate();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void onDestroy() &#123;</span><br><span class="line">        Log.i(&quot;HJ&quot;,&quot;onDestroy&quot;);</span><br><span class="line">        super.onDestroy();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>åœ¨æ¸…å•æ–‡ä»¶ä¸­æ³¨å†Œ:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;service android:name=&quot;.MyIntentService&quot;&gt;</span><br><span class="line">    &lt;intent-filter&gt;</span><br><span class="line">        &lt;action android:name=&quot;com.jay.thread&quot;/&gt;</span><br><span class="line">    &lt;/intent-filter&gt;</span><br><span class="line">&lt;/service&gt;</span><br></pre></td></tr></table></figure></p>
<p>åœ¨Activityä¸­è¿è¡Œï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Intent intent = new Intent(&quot;com.jay.thread&quot;);</span><br><span class="line">intent.setPackage(getPackageName());</span><br><span class="line">startService(intent);</span><br></pre></td></tr></table></figure></p>
<p>æ‰“å°çš„ç»“æœå¦‚ä¸‹ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">2018-12-21 15:03:14.848 4241-4241/com.zj.example.customview.funnel I/HJ: onCreate</span><br><span class="line">2018-12-21 15:03:14.850 4241-4241/com.zj.example.customview.funnel I/HJ: onStartCommand</span><br><span class="line">2018-12-21 15:03:14.850 4241-4258/com.zj.example.customview.funnel I/HJ: onHandleIntent</span><br><span class="line">2018-12-21 15:03:16.225 4241-4241/com.zj.example.customview.funnel I/HJ: onDestroy</span><br></pre></td></tr></table></figure></p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œå®ƒçš„ç”Ÿå‘½å‘¨æœŸæ˜¯<code>onCreate()</code>-&gt;<code>onStartCommand()</code>-&gt;<code>onHandleIntent()</code>-&gt;<code>onDestroy()</code>,è€Œä¸”å½“å®ƒæŠŠ<code>onHandleIntent()</code>æ–¹æ³•é‡Œçš„é€»è¾‘å¤„ç†å®Œæ¯•åä¼šè‡ªåŠ¨è°ƒç”¨<code>onDestroy</code>æ¥ç»“æŸï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸éœ€è¦ä¸»åŠ¨æ¥å…³é—­å®ƒã€‚</p>
<p>è€Œä¸”è¯´åˆ°éšå¼å¯åŠ¨Serviceï¼Œè¿™é‡Œè¦å¨é€¼ä¸¤å¥ï¼Œå¦‚æœæˆ‘æŠŠä¸Šé¢çš„<code>intent.setPackage(getPackageName())</code>å»æ‰é‚£ä¹ˆåœ¨5.0ä»¥ä¸Šæœºå‹ä¼šé‡åˆ°è¿™ç§å¼‚å¸¸ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">Caused by: java.lang.IllegalArgumentException: Service Intent must be explicit: Intent &#123; act=com.jay.thread &#125;</span><br><span class="line">       at android.app.ContextImpl.validateServiceIntent(ContextImpl.java:1448)</span><br><span class="line">       at android.app.ContextImpl.startServiceCommon(ContextImpl.java:1489)</span><br><span class="line">       at android.app.ContextImpl.startService(ContextImpl.java:1461)</span><br><span class="line">       at android.content.ContextWrapper.startService(ContextWrapper.java:644)</span><br><span class="line">       at com.zj.example.customview.funnel.MainActivity.onCreate(MainActivity.java:34)</span><br><span class="line">       at android.app.Activity.performCreate(Activity.java:6975)</span><br><span class="line">       at android.app.Instrumentation.callActivityOnCreate(Instrumentation.java:1213)</span><br><span class="line">       at android.app.ActivityThread.performLaunchActivity(ActivityThread.java:2770)</span><br><span class="line">       at android.app.ActivityThread.handleLaunchActivity(ActivityThread.java:2892)Â </span><br><span class="line">       at android.app.ActivityThread.-wrap11(Unknown Source:0)Â </span><br><span class="line">       at android.app.ActivityThread$H.handleMessage(ActivityThread.java:1593)Â </span><br><span class="line">       at android.os.Handler.dispatchMessage(Handler.java:105)Â </span><br><span class="line">       at android.os.Looper.loop(Looper.java:164)Â </span><br><span class="line">       at android.app.ActivityThread.main(ActivityThread.java:6541)Â </span><br><span class="line">       at java.lang.reflect.Method.invoke(Native Method)Â </span><br><span class="line">       at com.android.internal.os.Zygote$MethodAndArgsCaller.run(Zygote.java:240)Â </span><br><span class="line">       at com.android.internal.os.ZygoteInit.main(ZygoteInit.java:767)</span><br></pre></td></tr></table></figure></p>
<p>åŸå› æ˜¯åœ¨5.0æºç ä¸­è°·æ­Œåšäº†é™åˆ¶ï¼Œå¦‚æœcomponentå’Œpackageéƒ½ä¸ºç©ºï¼Œé‚£ä¹ˆå°±ä¼šæŠ›å‡ºè¿™ä¸ªå¼‚å¸¸ï¼Œè¯¦è§æºç (æºç ä½ç½®ï¼šsdk/sources/android21/android/app/ContextImpl.javaï¼‰:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">private void validateServiceIntent(Intent service) &#123;</span><br><span class="line">       if (service.getComponent() == null &amp;&amp; service.getPackage() == null) &#123;</span><br><span class="line">           if (getApplicationInfo().targetSdkVersion &gt;= Build.VERSION_CODES.LOLLIPOP) &#123;</span><br><span class="line">               IllegalArgumentException ex = new IllegalArgumentException(</span><br><span class="line">                       &quot;Service Intent must be explicit: &quot; + service);</span><br><span class="line">               throw ex;</span><br><span class="line">           &#125; else &#123;</span><br><span class="line">               Log.w(TAG, &quot;Implicit intents with startService are not safe: &quot; + service</span><br><span class="line">                       + &quot; &quot; + Debug.getCallers(2, 3));</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure></p>
<p>So,æˆ‘ä»¬åªè¦ä¿è¯å…¶ä¸­ä¸€ä¸ªä¸ä¸ºç©ºå°±å¯ä»¥å•¦.</p>
<h3 id="æºç è§£æ"><a href="#æºç è§£æ" class="headerlink" title="æºç è§£æ"></a>æºç è§£æ</h3><p>æºç è¿˜æ˜¯æ¯”è¾ƒç®€å•ï¼Œå¯ä»¥å…ˆä»<code>onCreate()</code>æ–¹æ³•çœ‹èµ·ï¼Œå…·ä½“é€»è¾‘è§æ³¨é‡Šï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line">public abstract class IntentService extends Service &#123;</span><br><span class="line">    private volatile Looper mServiceLooper; //HandlerThreadä¸­çš„Looper</span><br><span class="line">    private volatile ServiceHandler mServiceHandler; //é€»è¾‘å¤„ç†Handler</span><br><span class="line">    private String mName; //çº¿ç¨‹åç§°</span><br><span class="line">    private boolean mRedelivery; //æ˜¯å¦ä¿è¯intentåœ¨æœåŠ¡è¢«æ€æ­»åèƒ½è¢«æ¥æ”¶åˆ°</span><br><span class="line"></span><br><span class="line">    //å­çº¿ç¨‹Handlerçš„é€»è¾‘å¤„ç†ç±»</span><br><span class="line">    private final class ServiceHandler extends Handler &#123;</span><br><span class="line">        public ServiceHandler(Looper looper) &#123;</span><br><span class="line">            super(looper);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        @Override</span><br><span class="line">        public void handleMessage(Message msg) &#123;</span><br><span class="line">            onHandleIntent((Intent)msg.obj); //onHandleIntentæ–¹æ³•å›è°ƒ</span><br><span class="line">            stopSelf(msg.arg1); //è‡ªåŠ¨å›æ”¶</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public IntentService(String name) &#123;</span><br><span class="line">        super();</span><br><span class="line">        mName = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">   </span><br><span class="line">   /**</span><br><span class="line">   *æ­¤æ–¹æ³•çš„ä½œç”¨ï¼šå¦‚æœä¸ºtrue,åˆ™å°†Service StartResultçŠ¶æ€ç½®ä¸ºSTART_REDELIVER_INTENT,è¿™æ ·å½“onHandleIntentæ–¹æ³•è¿˜æœªå›è°ƒçš„æ—¶å€™æœåŠ¡è¢«å›æ”¶ï¼Œé‡å¯çš„æ—¶å€™onHandleIntentæ–¹æ³•ä¼šè¢«å›è°ƒ,å‘é€ä¸Šä¸€æ¬¡å›æ”¶å‰çš„intent,å¦‚æœæœ‰å¤šä¸ªintent,å°†ä¼šå‘é€æœ€åä¸€ä¸ªæ„å›¾</span><br><span class="line">   *</span><br><span class="line">   **/</span><br><span class="line">    public void setIntentRedelivery(boolean enabled) &#123;</span><br><span class="line">        mRedelivery = enabled;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void onCreate()&#123;</span><br><span class="line">        super.onCreate();</span><br><span class="line">        //åˆ›å»ºHandlerThread å¹¶å°†çº¿ç¨‹å‘½åä¸ºIntentService+è‡ªå®šä¹‰åç§°çš„å½¢å¼</span><br><span class="line">        HandlerThread thread = new HandlerThread(&quot;IntentService[&quot; + mName + &quot;]&quot;);</span><br><span class="line">        thread.start();</span><br><span class="line"></span><br><span class="line">        mServiceLooper = thread.getLooper();</span><br><span class="line">        mServiceHandler = new ServiceHandler(mServiceLooper); //å°†HandlerThreadé‡Œåˆå§‹åŒ–çš„looperè®¾ç½®ç»™å­çº¿ç¨‹Handler</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void onStart(@Nullable Intent intent, int startId) &#123;</span><br><span class="line">        Message msg = mServiceHandler.obtainMessage();</span><br><span class="line">        msg.arg1 = startId;</span><br><span class="line">        msg.obj = intent;  //æˆ‘ä»¬åœ¨onHandleIntentæ–¹æ³•é‡Œæ¥æ”¶çš„intentæ˜¯åœ¨è¿™é‡Œèµ‹å€¼çš„</span><br><span class="line">        mServiceHandler.sendMessage(msg);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * You should not override this method for your IntentService. Instead,</span><br><span class="line">     * override &#123;@link #onHandleIntent&#125;, which the system calls when the IntentService</span><br><span class="line">     * receives a start request.</span><br><span class="line">     * @see android.app.Service#onStartCommand</span><br><span class="line">     */</span><br><span class="line">    @Override</span><br><span class="line">    public int onStartCommand(@Nullable Intent intent, int flags, int startId) &#123;</span><br><span class="line">        onStart(intent, startId);</span><br><span class="line">        //StartResultçŠ¶æ€è®¾ç½®æ˜¯åœ¨è¿™é‡Œ</span><br><span class="line">        return mRedelivery ? START_REDELIVER_INTENT : START_NOT_STICKY;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void onDestroy() &#123;</span><br><span class="line">        mServiceLooper.quit();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //è¿™é‡Œå°†è¿”å›å€¼ç½®ä¸ºäº†nullï¼Œæ‰€ä»¥ä¸å»ºè®®ä½¿ç”¨bindServiceçš„å½¢å¼æ¥å¯åŠ¨å®ƒï¼Œå¦‚æœéœ€è¦ï¼Œå»ºè®®ç›´æ¥ä½¿ç”¨Service</span><br><span class="line">    @Override</span><br><span class="line">    @Nullable</span><br><span class="line">    public IBinder onBind(Intent intent) &#123;</span><br><span class="line">        return null;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * This method is invoked on the worker thread with a request to process.</span><br><span class="line">     * Only one Intent is processed at a time, but the processing happens on a</span><br><span class="line">     * worker thread that runs independently from other application logic.</span><br><span class="line">     * So, if this code takes a long time, it will hold up other requests to</span><br><span class="line">     * the same IntentService, but it will not hold up anything else.</span><br><span class="line">     * When all requests have been handled, the IntentService stops itself,</span><br><span class="line">     * so you should not call &#123;@link #stopSelf&#125;.</span><br><span class="line">     *</span><br><span class="line">     * @param intent The value passed to &#123;@link</span><br><span class="line">     *               android.content.Context#startService(Intent)&#125;.</span><br><span class="line">     *               This may be null if the service is being restarted after</span><br><span class="line">     *               its process has gone away; see</span><br><span class="line">     *               &#123;@link android.app.Service#onStartCommand&#125;</span><br><span class="line">     *               for details.</span><br><span class="line">     */</span><br><span class="line">    @WorkerThread</span><br><span class="line">    protected abstract void onHandleIntent(@Nullable Intent intent);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>æˆ‘ä»¬åœ¨æºç ä¸­çœ‹åˆ°ï¼Œå†…éƒ¨å®ç°å…¶å®è¿˜æ˜¯<code>HandlerThread</code>+<code>Handler</code>çš„æ–¹å¼ï¼Œ<code>onCreate()</code>ä¸­åšäº†ä¸€äº›åˆå§‹åŒ–çš„æ“ä½œï¼Œåœ¨<code>onStart</code>ä¸­å°†<code>intent</code>ç”¨objçš„æ–¹å¼ä¼ é€’ç»™äº†<code>ServiceHandler</code>,ç„¶ååœ¨<code>handleMessage</code>ä¸­æ‹¿åˆ°intentå¹¶è°ƒç”¨äº†<code>onHandleIntent</code>å›è°ƒå‡ºæ¥ï¼Œè¿™æ ·ä¸€ä¸ªå®Œæ•´çš„çº¿ç¨‹æœ‰åºå¾ªç¯å°±å»ºç«‹äº†ï¼Œè€Œä¸”å› ä¸ºæ˜¯å››å¤§ç»„ä»¶ï¼Œå­˜æ´»ç‡æœ‰å¾ˆå¤§çš„æå‡ï¼Œè¿™æ˜¯ç›´æ¥ç”¨çº¿ç¨‹å®ç°æ‰€æ²¡æœ‰çš„ä¼˜åŠ¿</p>
<p>çœ‹å®Œäº†æºç ï¼Œæœ‰æ²¡æœ‰å¯¹HandlerThread+Handlerçš„åº”ç”¨è¿›ä¸€æ­¥åŠ æ·±å‘¢ï¼Ÿ</p>
]]></content>
      
        <categories>
            
            <category> å¤šçº¿ç¨‹ç¼–ç¨‹ </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Android </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Android/javaå¤šçº¿ç¨‹(ä¸‰)-HandlerThreadçš„ä½¿ç”¨åœºæ™¯åŠæºç è§£æ]]></title>
      <url>/Threadsource3.html</url>
      <content type="html"><![CDATA[<p><strong>ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºåšä¸»åŸåˆ›æ–‡ç« ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„(www.huangjie.name)ï¼Œä¿æŠ¤åŸåˆ›ï¼Œä»æˆ‘åšèµ·.</strong></p>
<hr>
<h3 id="HandlerThreadæ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#HandlerThreadæ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="HandlerThreadæ˜¯ä»€ä¹ˆï¼Ÿ"></a>HandlerThreadæ˜¯ä»€ä¹ˆï¼Ÿ</h3><p>ç‚¹å¼€ç±»æ¥¸ä¸€çœ¼ï¼Œè¿™è´§æ˜¯è¿™æ ·ä»‹ç»è‡ªå·±çš„ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">* Handy class for starting a new thread that has a looper. The looper can then be </span><br><span class="line">* used to create handler classes. Note that start() must still be called.</span><br></pre></td></tr></table></figure></p>
<p>å¤§æ„æ˜¯è¯´å®ƒæ˜¯ç”¨æ¥å¯åŠ¨å…·æœ‰ä¸€ä¸ªå†…éƒ¨å¾ªç¯çš„æ–°çº¿ç¨‹çš„ä¸€ä¸ªä¾¿åˆ©ç±»ã€‚<br>å†…éƒ¨å¾ªç¯ï¼ŸåŒæ—¶åç§°åˆæœ‰Handleråˆæœ‰Threadï¼Œçœ‹è¿‡æˆ‘è¿™ç¯‡æ–‡ç« çš„åŒå­¦ä¼°è®¡çŒœåˆ°äº†ï¼Œè¿™è´§ä¼°è®¡æ˜¯Handlerä¸Threadçš„äº²å„¿å­æ— ç–‘äº†,ä½†æ˜¯ä¸¤ä¸ªå¥½åŸºå‹å“ªæ¥çš„å„¿å­å‘¢ï¼Œå›§~~~~<br>å¾€æœŸç›®å½•ï¼š<br><a href="https://www.jianshu.com/p/853be38bcd0a" target="_blank" rel="noopener">Android/java å¤šçº¿ç¨‹(ä¸€)-Threadçš„ä½¿ç”¨ä»¥åŠæºç åˆ†æ</a><br><a href="https://www.jianshu.com/p/35ace3aa0022" target="_blank" rel="noopener">Android/java å¤šçº¿ç¨‹(äºŒ)-Threadçš„å¥½å…„å¼ŸHandler</a></p>
<p>æˆ‘åœ¨ä¸Šç¯‡æ–‡ç« ä»‹ç»Handlerçš„æ—¶å€™ä¸¾äº†ä¸€ä¸ªä¾‹å­ï¼Œåœ¨å­çº¿ç¨‹ä¸­ä½¿ç”¨Handlerï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">class MyThread extends Thread &#123;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void run() &#123;</span><br><span class="line">        Looper.prepare();</span><br><span class="line">        @SuppressLint(&quot;HandlerLeak&quot;)</span><br><span class="line">        Handler mHandler = new Handler()&#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void handleMessage(Message msg) &#123;</span><br><span class="line">                 //å¤„ç†é€»è¾‘</span><br><span class="line">                l(Thread.currentThread().getName());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        Message message = mHandler.obtainMessage(1);</span><br><span class="line">        mHandler.sendMessage(message);</span><br><span class="line">        Looper.loop();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>æ˜¯ä¸æ˜¯æ˜¾å¾—å·¨éº»çƒ¦ï¼Œè€Œä¸”å·¨ä¸‘ï¼Œ<code>HandlerThread</code>å°±æ˜¯ä¸ºäº†é˜²æ­¢æˆ‘ä»¬å†™å‡ºå¦‚æ­¤ä¸‘é™‹çš„ä»£ç è€Œç”Ÿçš„ï¼Œå®ƒçš„æœ¬è´¨åŸç†å…¶å®ä¹Ÿå°±æ˜¯ä»¥ä¸Šé‚£å‡ è¡Œä»£ç ã€‚ä¸ä¿¡ï¼Ÿï¼Œæˆ‘ä»¬æ¥ç…ç…</p>
<h3 id="HandlerThreadæºç "><a href="#HandlerThreadæºç " class="headerlink" title="HandlerThreadæºç "></a>HandlerThreadæºç </h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line">public class HandlerThread extends Thread &#123;</span><br><span class="line">    int mPriority; //çº¿ç¨‹ä¼˜å…ˆçº§</span><br><span class="line">    int mTid = -1; </span><br><span class="line">    Looper mLooper;</span><br><span class="line">    private @Nullable Handler mHandler;</span><br><span class="line"></span><br><span class="line">//æŒ‡å®šçº¿ç¨‹çš„åç§°ï¼Œé»˜è®¤çº¿ç¨‹ä¼˜å…ˆçº§ä¸ºDEFAULT,ä¹Ÿæ˜¯æœ€ä½çº§çš„</span><br><span class="line">    public HandlerThread(String name) &#123;</span><br><span class="line">        super(name);</span><br><span class="line">        mPriority = Process.THREAD_PRIORITY_DEFAULT;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">//æŒ‡å®šçº¿ç¨‹çš„åç§°ï¼ŒåŒæ—¶æŒ‡å®šçº¿ç¨‹çš„ä¼˜å…ˆçº§</span><br><span class="line">    public HandlerThread(String name, int priority) &#123;</span><br><span class="line">        super(name);</span><br><span class="line">        mPriority = priority;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    //è¿™é‡Œä¸»è¦å¤„ç†ä¸€äº›æ•°æ®çš„åˆå§‹åŒ–å•Šä¸€äº›å­çº¿ç¨‹çš„é€»è¾‘æ“ä½œå•¥çš„ï¼Œåœ¨run()æ–¹æ³•ä¸­å›è°ƒ</span><br><span class="line">    protected void onLooperPrepared() &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">   //ç†Ÿæ‚‰çš„run()æ–¹æ³•</span><br><span class="line">    @Override</span><br><span class="line">    public void run() &#123;</span><br><span class="line">        mTid = Process.myTid();</span><br><span class="line">        Looper.prepare();  //åˆ›å»ºLooper()</span><br><span class="line">        synchronized (this) &#123;</span><br><span class="line">            mLooper = Looper.myLooper();</span><br><span class="line">            notifyAll();  //åˆ°è¿™é‡ŒLooperå·²ç»åˆ›å»ºå®Œæ¯•ï¼Œå”¤é†’é˜»å¡çš„çº¿ç¨‹</span><br><span class="line">        &#125;</span><br><span class="line">        //è®¾ç½®çº¿ç¨‹ä¼˜å…ˆçº§</span><br><span class="line">        Process.setThreadPriority(mPriority);</span><br><span class="line">        onLooperPrepared(); //æ‰§è¡ŒonLooperPrepared()æ–¹æ³•</span><br><span class="line">        Looper.loop(); //å¼€å¯å¾ªç¯</span><br><span class="line">        mTid = -1;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    /**</span><br><span class="line">     * This method returns the Looper associated with this thread. If this thread not been started</span><br><span class="line">     * or for any reason isAlive() returns false, this method will return null. If this thread</span><br><span class="line">     * has been started, this method will block until the looper has been initialized.  </span><br><span class="line">     * @return The looper.</span><br><span class="line">     */</span><br><span class="line">    public Looper getLooper() &#123;</span><br><span class="line">        if (!isAlive()) &#123;</span><br><span class="line">            return null;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        // If the thread has been started, wait until the looper has been created.</span><br><span class="line">        synchronized (this) &#123;</span><br><span class="line">            while (isAlive() &amp;&amp; mLooper == null) &#123;</span><br><span class="line">                try &#123;</span><br><span class="line">                    wait();</span><br><span class="line">                &#125; catch (InterruptedException e) &#123;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        return mLooper;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * @return a shared &#123;@link Handler&#125; associated with this thread</span><br><span class="line">     * @hide</span><br><span class="line">     */</span><br><span class="line">    @NonNull</span><br><span class="line">    public Handler getThreadHandler() &#123;</span><br><span class="line">        if (mHandler == null) &#123;</span><br><span class="line">            mHandler = new Handler(getLooper());</span><br><span class="line">        &#125;</span><br><span class="line">        return mHandler;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line">   //éå®‰å…¨çš„ç»“æŸå¾ªç¯</span><br><span class="line">    public boolean quit() &#123;</span><br><span class="line">        Looper looper = getLooper();</span><br><span class="line">        if (looper != null) &#123;</span><br><span class="line">            looper.quit();</span><br><span class="line">            return true;</span><br><span class="line">        &#125;</span><br><span class="line">        return false;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">   ////å®‰å…¨çš„ç»“æŸå¾ªç¯</span><br><span class="line">    public boolean quitSafely() &#123;</span><br><span class="line">        Looper looper = getLooper();</span><br><span class="line">        if (looper != null) &#123;</span><br><span class="line">            looper.quitSafely();</span><br><span class="line">            return true;</span><br><span class="line">        &#125;</span><br><span class="line">        return false;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * Returns the identifier of this thread. See Process.myTid().</span><br><span class="line">     */</span><br><span class="line">    public int getThreadId() &#123;</span><br><span class="line">        return mTid;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç»“åˆæºç ï¼Œè¿™è´§å…¶å®ä¹Ÿå°±æ˜¯åœ¨run()ä¸­å¼€å¯äº†Looperå¾ªç¯ï¼Œå¹¶æä¾›äº†ä¸€ä¸ª<code>onLooperPrepared ()</code>æ–¹æ³•ä¾›æˆ‘ä»¬ä½¿ç”¨ï¼Œåšä¸€äº›åˆå§‹åŒ–çš„æ“ä½œã€‚<br>éœ€è¦æ³¨æ„çš„æ˜¯<code>quit()</code>æ–¹æ³•å’Œ<code>quitSafely()</code>çš„åŒºåˆ«ï¼Œ<code>quit()</code>æ˜¯ç«‹å³åœæ­¢Looperå¾ªç¯ï¼Œæ­¤æ—¶å¯èƒ½æœ‰æ¶ˆæ¯æœªå¤„ç†å°±GGäº†ï¼Œæ‰€ä»¥è¯´å®ƒçš„ä¸å®‰å…¨çš„ï¼Œè€Œ<code>quitSafely()</code>æ˜¯ç­‰å¾…æ¶ˆæ¯å¤„ç†å®Œæ¯•åæ‰åœæ­¢Looperå¾ªç¯ï¼Œæ‰€ä»¥è¯´å®ƒæ˜¯å®‰å…¨çš„ï¼Œå¦å¤–å¯ä»¥çœ‹åˆ°å®ƒæŒ‡å®šçº¿ç¨‹ä¼˜å…ˆçº§æ˜¯ä½¿ç”¨çš„<code>Process.setThreadPriority(mPriority)</code>æ–¹æ³•ï¼Œæ‰€æœ‰å®ƒçš„å¯é€‰å€¼æ˜¯ä»<code>Process()</code>é‡Œé¢è·å–</p>
<h3 id="HandlerThreadçš„ä½¿ç”¨åœºæ™¯"><a href="#HandlerThreadçš„ä½¿ç”¨åœºæ™¯" class="headerlink" title="HandlerThreadçš„ä½¿ç”¨åœºæ™¯"></a>HandlerThreadçš„ä½¿ç”¨åœºæ™¯</h3><h4 id="HandlerThreadå°æœ‹å‹çš„ä¼˜ç‚¹"><a href="#HandlerThreadå°æœ‹å‹çš„ä¼˜ç‚¹" class="headerlink" title="HandlerThreadå°æœ‹å‹çš„ä¼˜ç‚¹"></a>HandlerThreadå°æœ‹å‹çš„ä¼˜ç‚¹</h4><p>HandlerThreadé‡Œé¢çš„æœ¬è´¨å®é™…ä¸Šæ˜¯å­çº¿ç¨‹æ¶ˆæ¯è½®è¯¢æœºåˆ¶ï¼Œæˆ‘ä»¬èƒ½å¤Ÿä»ä¸­è·å–åˆ°ä¸€ä¸ªåœ¨å­çº¿ç¨‹ä¸­è½®è¯¢çš„Looperï¼Œå¦‚æœè®¾ç½®ç»™Handler,é‚£ä¹ˆè¿™ä¸ªHandlerå°±èƒ½åœ¨å­çº¿ç¨‹ä¸­å¤„ç†æ¶ˆæ¯ã€‚æ‰€ä»¥å®ƒç‰¹åˆ«é€‚åˆå¤„ç†å¤§é‡éœ€è¦æ’é˜Ÿç­‰å¾…æˆ–éœ€è¦é‡å¤æ“ä½œçš„åˆè€—æ—¶çš„é€»è¾‘ï¼Œå®ƒæ—¢èƒ½å¤Ÿæ–¹ä¾¿çš„é€šçŸ¥ä¸»çº¿ç¨‹æ›´æ–°UIï¼Œå†…éƒ¨åˆèƒ½æ–¹ä¾¿çš„åšçº¿ç¨‹çš„é˜Ÿåˆ—å¤„ç†ï¼Œæ‰€ä»¥å®ƒçš„ä½¿ç”¨è¿˜æ˜¯æ¯”è¾ƒå¹¿æ³›æ»´ã€‚</p>
<h4 id="ä¸¾ä¸ªæ —å­"><a href="#ä¸¾ä¸ªæ —å­" class="headerlink" title="ä¸¾ä¸ªæ —å­"></a>ä¸¾ä¸ªæ —å­</h4><p>å‡è®¾æœ‰è¿™ä¹ˆä¸ªéœ€æ±‚ï¼šéœ€è¦æ‰¹é‡ä¸‹è½½æ–‡ä»¶ï¼Œä¸€æ¬¡åªèƒ½ä¸‹è½½ä¸€ä¸ªï¼Œä¸‹è½½å®Œæ¯•åè‡ªåŠ¨ä¸‹è½½ä¸‹ä¸€ä¸ªï¼Œæˆ–è€…è¿™ä¸ªä¸‹è½½å¤±è´¥æˆ–æš‚åœè‡ªåŠ¨ä¸‹è½½ä¸‹ä¸€ä¸ª(æ˜¯ä¸æ˜¯æœ‰ç‚¹åƒæŸé›·çš„ä¸‹è½½åœºæ™¯)ï¼Œä¼ªå®ç°å¦‚ä¸‹ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * Created by hj on 2018/12/21.</span><br><span class="line"> * è¯´æ˜ï¼šæ¨¡æ‹Ÿçº¿ç¨‹ä¸‹è½½</span><br><span class="line"> */</span><br><span class="line">public class DownloadHandlerThread extends HandlerThread implements Handler.Callback &#123;</span><br><span class="line"></span><br><span class="line">    private Handler workHandler; //å¤„ç†ä¸‹è½½é€»è¾‘çš„Handler</span><br><span class="line">    private Handler uiHandler; //å¤„ç†UIåˆ·æ–°çš„Handler</span><br><span class="line"></span><br><span class="line">    public final static int READY = 0X110;</span><br><span class="line">    public final static int STAR = 0X111;</span><br><span class="line">    public final static int STOP = 0X112;</span><br><span class="line">    public final static int ERROR = 0X113;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    private int max;</span><br><span class="line">    private int index;</span><br><span class="line"></span><br><span class="line">    public DownloadHandlerThread() &#123;</span><br><span class="line">        super(&quot;download-thread&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void onLooperPrepared() &#123;</span><br><span class="line">        //åˆå§‹åŒ–</span><br><span class="line">        workHandler = new Handler(getLooper(), this);</span><br><span class="line">        if (uiHandler == null) &#123;</span><br><span class="line">            throw new NullPointerException(&quot;uiHandler is not null&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        uiHandler.sendEmptyMessage(READY); //é€šçŸ¥ä¸»çº¿ç¨‹Looperå·²ç»å‡†å¤‡å®Œæ¯•ï¼Œå¯ä»¥å¼€å§‹ä¸‹è½½äº†</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public boolean handleMessage(Message msg) &#123;</span><br><span class="line">        switch (msg.what) &#123;</span><br><span class="line">            case STAR: //å¼€å§‹ä¸‹è½½</span><br><span class="line">                index++; //è®°å½•å½“å‰ä¸‹è½½åˆ°äº†ç¬¬å‡ ä¸ª</span><br><span class="line">                String url = msg.getData().getString(&quot;url&quot;);</span><br><span class="line">                Log.i(&quot;HJ&quot;, &quot;å‡†å¤‡ä¸‹è½½ï¼š&quot; + url);</span><br><span class="line">                try &#123;</span><br><span class="line">                    sleep(2000); //æ¨¡æ‹Ÿä¸‹è½½</span><br><span class="line">                    if (index == 2) &#123;  //ä¸‹è½½åˆ°ç¬¬äºŒä¸ªçš„æ—¶å€™æ¨¡æ‹Ÿä¸‹è½½å¤±è´¥</span><br><span class="line">                        Log.i(&quot;HJ&quot;, &quot;ä¸‹è½½å‡ºé”™ï¼š&quot; + url);</span><br><span class="line">                        setErrorMessage(url);</span><br><span class="line">                        Log.i(&quot;HJ&quot;, &quot;å¼€å§‹ä¸‹è½½ä¸‹ä¸€ä¸ªåœ°å€&quot;);</span><br><span class="line">                    &#125; else &#123;</span><br><span class="line">                        Log.i(&quot;HJ&quot;, &quot;å½“å‰åœ°å€ä¸‹è½½å®Œæˆï¼š&quot; + url);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; catch (InterruptedException e) &#123;</span><br><span class="line">                    setErrorMessage(url);</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">                if (index == max) &#123; //å…¨éƒ¨ä¸‹è½½å®Œæ¯•</span><br><span class="line">                    workHandler.sendEmptyMessage(STOP);</span><br><span class="line">                &#125;</span><br><span class="line">                break;</span><br><span class="line">            case STOP: //å…¨éƒ¨ä¸‹è½½å®Œæˆ</span><br><span class="line">                </span><br><span class="line">                //é€€å‡ºLooperå¾ªç¯</span><br><span class="line">                if (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.JELLY_BEAN_MR2) &#123;</span><br><span class="line">                    quitSafely();</span><br><span class="line">                &#125; else &#123;</span><br><span class="line">                    quit();</span><br><span class="line">                &#125;</span><br><span class="line">                Log.i(&quot;HJ&quot;, &quot;å…¨éƒ¨ä¸‹è½½å®Œæˆ&quot;);</span><br><span class="line">                break;</span><br><span class="line">        &#125;</span><br><span class="line">        return false;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //å‘é€ä¸‹è½½é”™è¯¯æ¶ˆæ¯åˆ°ä¸»çº¿ç¨‹ç”¨äºåˆ·æ–°UI</span><br><span class="line">    private void setErrorMessage(String url) &#123;</span><br><span class="line">        Message errorMsg = new Message();</span><br><span class="line">        errorMsg.what = ERROR;</span><br><span class="line">        Bundle bundle = new Bundle();</span><br><span class="line">        bundle.putString(&quot;errorUrl&quot;, url);</span><br><span class="line">        errorMsg.setData(bundle);</span><br><span class="line">        uiHandler.sendMessage(errorMsg);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setUiHandler(Handler uiHandler) &#123;</span><br><span class="line">        this.uiHandler = uiHandler;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Handler getWorkHandler() &#123;</span><br><span class="line">        return workHandler;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setMax(int max) &#123;</span><br><span class="line">        this.max = max;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>åœ¨Activityä¸­ä½¿ç”¨ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">public class MainActivity extends AppCompatActivity &#123;</span><br><span class="line"></span><br><span class="line">    private Handler uiHandler; </span><br><span class="line">    //æ¨¡æ‹Ÿæ•°æ®æº</span><br><span class="line">    private String[] urls = new String[]&#123;</span><br><span class="line">            &quot;url-1&quot;, &quot;url-2&quot;, &quot;url-3&quot;, &quot;url-4&quot;, &quot;url-5&quot;</span><br><span class="line">    &#125;;</span><br><span class="line">    private DownloadHandlerThread mThread;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void onCreate(Bundle savedInstanceState) &#123;</span><br><span class="line">        super.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">        initUiHandler();</span><br><span class="line">        initDownLoad();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @SuppressLint(&quot;HandlerLeak&quot;)</span><br><span class="line">    private void initUiHandler() &#123;</span><br><span class="line">        uiHandler = new Handler() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void handleMessage(Message msg) &#123;</span><br><span class="line">                switch (msg.what) &#123;</span><br><span class="line">                    case DownloadHandlerThread.READY: //è·å–åˆ°workHandlerå·²ç»åˆå§‹åŒ–å®Œæ¯•ï¼Œå¯ä»¥è¿›è¡Œä¸‹è½½ä»»åŠ¡äº†</span><br><span class="line">                        Handler workHandler = mThread.getWorkHandler();</span><br><span class="line">                        mThread.setMax(urls.length);</span><br><span class="line">                        for (String url : urls) &#123;  //å¾ªç¯å°†MessageåŠ å…¥MessageQueueæ¶ˆæ¯æ± ä¸­</span><br><span class="line">                            Message message = new Message();</span><br><span class="line">                            message.what = DownloadHandlerThread.STAR;</span><br><span class="line">                            Bundle bundle = new Bundle();</span><br><span class="line">                            bundle.putString(&quot;url&quot;, url);</span><br><span class="line">                            message.setData(bundle);</span><br><span class="line">                            workHandler.sendMessage(message);</span><br><span class="line">                        &#125;</span><br><span class="line">                        break;</span><br><span class="line">                    case DownloadHandlerThread.ERROR:  //å¤„ç†ä¸‹è½½å¤±è´¥UIé€»è¾‘</span><br><span class="line">                        String url = msg.getData().getString(&quot;errorUrl&quot;);</span><br><span class="line">                        showShortToast(&quot;ä¸‹è½½å¤±è´¥é“¾æ¥:&quot; + url);</span><br><span class="line">                        Log.i(&quot;HJ&quot;,&quot;å±•ç¤ºä¸‹è½½å¤±è´¥UI&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&quot;);</span><br><span class="line">                        break;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private void showShortToast(String string) &#123;</span><br><span class="line">        Toast.makeText(this, string, Toast.LENGTH_SHORT).show();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private void initDownLoad() &#123;</span><br><span class="line">        mThread = new DownloadHandlerThread();</span><br><span class="line">        mThread.setUiHandler(uiHandler);</span><br><span class="line">        mThread.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>è¿è¡Œç»“æœå¦‚ä¸‹ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">2018-12-21 11:51:02.775 2390-2432/com.zj.example.customview.funnel I/HJ: å‡†å¤‡ä¸‹è½½ï¼šurl-1</span><br><span class="line">2018-12-21 11:51:04.775 2390-2432/com.zj.example.customview.funnel I/HJ: å½“å‰åœ°å€ä¸‹è½½å®Œæˆï¼šurl-1</span><br><span class="line">2018-12-21 11:51:04.775 2390-2432/com.zj.example.customview.funnel I/HJ: å‡†å¤‡ä¸‹è½½ï¼šurl-2</span><br><span class="line">2018-12-21 11:51:06.777 2390-2432/com.zj.example.customview.funnel I/HJ: ä¸‹è½½å‡ºé”™ï¼šurl-2</span><br><span class="line">2018-12-21 11:51:06.777 2390-2432/com.zj.example.customview.funnel I/HJ: å¼€å§‹ä¸‹è½½ä¸‹ä¸€ä¸ªåœ°å€</span><br><span class="line">2018-12-21 11:51:06.778 2390-2432/com.zj.example.customview.funnel I/HJ: å‡†å¤‡ä¸‹è½½ï¼šurl-3</span><br><span class="line">2018-12-21 11:51:06.779 2390-2390/com.zj.example.customview.funnel I/HJ: å±•ç¤ºä¸‹è½½å¤±è´¥UI&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span><br><span class="line">2018-12-21 11:51:08.778 2390-2432/com.zj.example.customview.funnel I/HJ: å½“å‰åœ°å€ä¸‹è½½å®Œæˆï¼šurl-3</span><br><span class="line">2018-12-21 11:51:08.778 2390-2432/com.zj.example.customview.funnel I/HJ: å‡†å¤‡ä¸‹è½½ï¼šurl-4</span><br><span class="line">2018-12-21 11:51:10.779 2390-2432/com.zj.example.customview.funnel I/HJ: å½“å‰åœ°å€ä¸‹è½½å®Œæˆï¼šurl-4</span><br><span class="line">2018-12-21 11:51:10.779 2390-2432/com.zj.example.customview.funnel I/HJ: å‡†å¤‡ä¸‹è½½ï¼šurl-5</span><br><span class="line">2018-12-21 11:51:12.783 2390-2432/com.zj.example.customview.funnel I/HJ: å½“å‰åœ°å€ä¸‹è½½å®Œæˆï¼šurl-5</span><br><span class="line">2018-12-21 11:51:12.783 2390-2432/com.zj.example.customview.funnel I/HJ: å…¨éƒ¨ä¸‹è½½å®Œæˆ</span><br></pre></td></tr></table></figure></p>
<p>å¯ä»¥çœ‹åˆ°<code>DownloadHandlerThread</code>ä¸»è¦æ‰¿è½½çš„åŠŸèƒ½å¦‚ä¸‹:</p>
<ul>
<li>åˆå§‹åŒ–ä¸€ä¸ªå­çº¿ç¨‹Handlerç”¨äºå¤„ç†å­çº¿ç¨‹çš„æ¶ˆæ¯é€šä¿¡</li>
<li>æ‰§è¡Œä¸‹è½½ä»»åŠ¡ä»¥åŠä¸ä¸»çº¿ç¨‹çš„uié€šä¿¡</li>
</ul>
<p>è¿™æ ·çš„å¤„ç†æ–¹å¼æå¤§çš„æ–¹ä¾¿äº†uiçº¿ç¨‹ä¸å­çº¿ç¨‹çš„é€šè®¯ï¼Œåªéœ€è¦ç”¨ä¸åŒçš„handlerå‘é€æ¶ˆæ¯å³å¯ï¼Œæ¥å†å¤šçš„handleréƒ½ä¸æ€•ã€‚è€Œä¸”è¿™åªéœ€è¦å¼€å¯ä¸€ä¸ªçº¿ç¨‹ï¼Œæå¤§çš„èŠ‚çœäº†å†…å­˜ç©ºé—´ï¼Œè€Œä¸”èƒ½è®©çº¿ç¨‹ä»»åŠ¡æœ‰åºè¿›è¡Œï¼Œæ–¹ä¾¿ç®¡ç†ã€‚</p>
<p>å»ºè®®å°†ä»¥ä¸Šä»£ç å¤åˆ¶è¿‡å»è·‘ä¸€è·‘ï¼Œè°ƒè¯•ä¸€ä¸‹ï¼Œè¿™æ ·èƒ½æ›´å¿«çš„ç†è§£HandlerThreadçš„é€šä¿¡ä»¥åŠå®ƒçš„ä¾¿æ·é€šä¿¡æœºåˆ¶ã€‚</p>
]]></content>
      
        <categories>
            
            <category> å¤šçº¿ç¨‹ç¼–ç¨‹ </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Android </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Android/java å¤šçº¿ç¨‹(äºŒ)-Threadçš„å¥½å…„å¼ŸHandler]]></title>
      <url>/multithreading2.html</url>
      <content type="html"><![CDATA[<p><strong>ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºåšä¸»åŸåˆ›æ–‡ç« ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„(www.huangjie.name)ï¼Œä¿æŠ¤åŸåˆ›ï¼Œä»æˆ‘åšèµ·.</strong></p>
<hr>
<blockquote>
<p>ä¸Šä¸€ç¯‡å¸¦å¤§å®¶äº†è§£äº†Threadçš„ä½¿ç”¨ä»¥åŠåŸºæœ¬çš„è¿è¡ŒåŸç†ï¼Œè¿™ä¸€ç¯‡å°±å¸¦å¤§å®¶äº†è§£ä¸‹Threadçš„å¥½å…„å¼ŸHandler</p>
</blockquote>
<a id="more"></a>
<p><a href="http://www.huangjie.name/Threadsourse.html">Android/java å¤šçº¿ç¨‹(ä¸€)-Threadçš„ä½¿ç”¨ä»¥åŠæºç åˆ†æ</a></p>
<h3 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h3><p>Handleræœºåˆ¶åœ¨å®‰å“ä¸­åº”ç”¨éå¸¸å¹¿æ³›ï¼Œåƒæˆ‘ä»¬å¸¸è§çš„ç”¨äºåœ¨å­çº¿ç¨‹ä¸­æ›´æ–°UIï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">public class MainActivity extends AppCompatActivity &#123;</span><br><span class="line"></span><br><span class="line">    @SuppressLint(&quot;HandlerLeak&quot;)</span><br><span class="line">    private Handler mHandler = new Handler()&#123;</span><br><span class="line">        @Override</span><br><span class="line">        public void handleMessage(Message msg) &#123;</span><br><span class="line">            //æ›´æ–°UI</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    </span><br><span class="line">    @Override</span><br><span class="line">    protected void onCreate(Bundle savedInstanceState) &#123;</span><br><span class="line">        super.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">        MyThread thread = new MyThread();</span><br><span class="line">        thread.start();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    class MyThread extends Thread &#123;</span><br><span class="line"></span><br><span class="line">        @Override</span><br><span class="line">        public void run() &#123;</span><br><span class="line">             //å¤„ç†å­çº¿ç¨‹é€»è¾‘</span><br><span class="line">            //....</span><br><span class="line">            //å‘é€æ¶ˆæ¯æ›´æ–°UI</span><br><span class="line">            Message message = mHandler.obtainMessage(1);</span><br><span class="line">            mHandler.sendMessage(message);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>ç”±æ­¤å¼•å‡ºä¸€äº›é—®é¢˜ï¼Œä¸ºä»€ä¹ˆ<code>sendMessage</code>ä¹‹å<code>handleMessage</code>æ–¹æ³•ä¼šè¢«æ‰§è¡Œ?.ä¸ºä»€ä¹ˆ<code>handleMessage</code>æ˜¯åœ¨ä¸»çº¿ç¨‹ä¸­?.å®ƒä»¬çš„æ¶ˆæ¯æ˜¯å¦‚ä½•ä¼ é€’çš„?.è¿™äº›ä¼šåœ¨ä¸‹é¢è®²è§£</p>
<p>ä¸”çœ‹è¿˜æœ‰ä¸€ç§ä½¿ç”¨æƒ…å†µï¼Œåœ¨å­çº¿ç¨‹ä¸­ä½¿ç”¨Handler:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">public class MainActivity extends AppCompatActivity &#123;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void onCreate(Bundle savedInstanceState) &#123;</span><br><span class="line">        super.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">        MyThread thread = new MyThread();</span><br><span class="line">        thread.start();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    class MyThread extends Thread &#123;</span><br><span class="line"></span><br><span class="line">        @Override</span><br><span class="line">        public void run() &#123;</span><br><span class="line">            Looper.prepare();</span><br><span class="line">            @SuppressLint(&quot;HandlerLeak&quot;)</span><br><span class="line">            Handler mHandler = new Handler()&#123;</span><br><span class="line">                @Override</span><br><span class="line">                public void handleMessage(Message msg) &#123;</span><br><span class="line">                     //å¤„ç†é€»è¾‘</span><br><span class="line">                    l(Thread.currentThread().getName());</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;;</span><br><span class="line">            Message message = mHandler.obtainMessage(1);</span><br><span class="line">            mHandler.sendMessage(message);</span><br><span class="line">            Looper.loop();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void l(String s) &#123;</span><br><span class="line">        Log.i(&quot;HJ&quot;, s);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>æ‰“å°ç»“æœå¦‚ä¸‹ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2018-12-20 10:48:21.682 1808-1824/? I/HJ: Thread-2</span><br></pre></td></tr></table></figure></p>
<p>å¦‚æœæˆ‘ä»¬ä¸ä½¿ç”¨<code>Looper.prepare()</code>å’Œ<code>Looper.loop()</code>æ–¹æ³•ï¼Œç›´æ¥è¿è¡Œï¼Œé‚£ä¹ˆä¼šæŠ›å‡ºä»¥ä¸‹å¼‚å¸¸ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">2018-12-20 11:00:49.654 2029-2045/com.zj.example.customview.funnel E/AndroidRuntime: FATAL EXCEPTION: Thread-2</span><br><span class="line">    Process: com.zj.example.customview.funnel, PID: 2029</span><br><span class="line">    java.lang.RuntimeException: Only one Looper may be created per thread</span><br><span class="line">        at android.os.Looper.prepare(Looper.java:95)</span><br><span class="line">        at android.os.Looper.prepare(Looper.java:90)</span><br><span class="line">        at com.zj.example.customview.funnel.MainActivity$MyThread.run(MainActivity.java:48)</span><br></pre></td></tr></table></figure></p>
<p>è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿï¼Œä¸ºä»€ä¹ˆå­çº¿ç¨‹ä¸èƒ½ç›´æ¥åˆ›å»ºHandlerå‘¢ï¼Ÿä½¿ç”¨äº†<code>Looper.prepare()</code>å’Œ<code>Looper.loop()</code>ä¸ºä»€ä¹ˆåˆå¯ä»¥äº†å‘¢ï¼Ÿï¼Œè¿™ä¸¤ä¸ªæ–¹æ³•åˆæ˜¯å¹²ä»€ä¹ˆç”¨çš„å‘¢ï¼Ÿè¯·çœ‹ä»¥ä¸‹æºç åˆ†æã€‚</p>
<h3 id="åŸç†åˆ†æ"><a href="#åŸç†åˆ†æ" class="headerlink" title="åŸç†åˆ†æ"></a>åŸç†åˆ†æ</h3><p>Handleræœºåˆ¶çš„æ ¸å¿ƒç±»ä¸»è¦æœ‰ä¸‰ä¸ªï¼Œ<code>Handler</code> ,<code>Message</code>,<code>Looper</code>,è€Œä¸<code>Looper</code>ç›¸å…³è”çš„ç±»è¿˜æœ‰<code>ThreadLocal</code>å’Œ<code>MessageQueue</code>,ä¸‹é¢æ¥ä¸€ä¸€ä»‹ç»ä¸‹å®ƒä»¬çš„ä½œç”¨:</p>
<h5 id="Message"><a href="#Message" class="headerlink" title="Message"></a>Message</h5><p>æ¶ˆæ¯çš„è½½ä½“ï¼Œå†…éƒ¨ä¸»è¦å­˜æ”¾ä¸€äº›æ¶ˆæ¯ç±»å‹ï¼Œå‚æ•°ä¸»è¦æœ‰ï¼š<br>ï¼ˆ1ï¼‰public int whatï¼šå˜é‡ï¼Œç”¨äºå®šä¹‰æ­¤Messageå±äºä½•ç§æ“ä½œ<br>ï¼ˆ2ï¼‰public Object objï¼šå˜é‡ï¼Œç”¨äºå®šä¹‰æ­¤Messageä¼ é€’çš„ä¿¡æ¯æ•°æ®ï¼Œé€šè¿‡å®ƒä¼ é€’ä¿¡æ¯<br>ï¼ˆ3ï¼‰public int arg1ï¼šå˜é‡ï¼Œä¼ é€’ä¸€äº›æ•´å‹æ•°æ®æ—¶ä½¿ç”¨<br>ï¼ˆ4ï¼‰public int arg2ï¼šå˜é‡ï¼Œä¼ é€’ä¸€äº›æ•´å‹æ•°æ®æ—¶ä½¿ç”¨<br>ï¼ˆ5ï¼‰public Handler getTarget()ï¼šæ™®é€šæ–¹æ³•ï¼Œå–å¾—æ“ä½œæ­¤æ¶ˆæ¯çš„Handlerå¯¹è±¡ã€‚<br>åœ¨è¯¥ç±»çš„ä½¿ç”¨ä¸Šï¼Œå°½é‡ä½¿ç”¨<code>obtain()</code>æ–¹æ³•æ¥è·å–ï¼Œè€Œéæ„é€ æ–¹æ³•ï¼Œè¿™æ ·å¯ä»¥èŠ‚çœå†…å­˜ã€‚è€Œåœ¨æ•°æ®ä¼ é€’æ–¹é¢ï¼Œå¦‚æœæ˜¯<code>int</code>ç±»å‹çš„ï¼Œå»ºè®®ä½¿ç”¨<code>arg1</code>å’Œ<code>arg2</code>,å…¶æ¬¡å†è€ƒè™‘ä½¿ç”¨<code>Bundle</code></p>
<h5 id="Looper"><a href="#Looper" class="headerlink" title="Looper"></a>Looper</h5><p>æ¶ˆæ¯é€šé“ï¼Œæ¶ˆæ¯æœºåˆ¶çš„ä¸»è¦é€»è¾‘å®ç°ç±»ï¼Œå†…éƒ¨æœ‰ä½¿ç”¨<code>ThreadLocal</code>ç”¨æ¥ä¿å­˜å½“å‰çº¿ç¨‹çš„<code>Looper</code>,ä½¿ç”¨<code>MessageQueue</code>ç”¨æ¥ç»´æŠ¤<code>Message</code>æ± ï¼Œè€Œæˆ‘ä»¬ä½¿ç”¨<code>Looper.prepare()</code>æ–¹æ³•å…¶å®ä¹Ÿå°±æ˜¯å°†æ­¤çº¿ç¨‹çš„<code>Looper</code>å¯¹è±¡åŠ å…¥åˆ°<code>ThreadLocal</code>ä¸­å»ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">public static void prepare() &#123;</span><br><span class="line">    prepare(true);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">private static void prepare(boolean quitAllowed) &#123;</span><br><span class="line">    if (sThreadLocal.get() != null) &#123;</span><br><span class="line">     //ä¸€ä¸ªçº¿ç¨‹åªèƒ½åˆ›å»ºä¸€ä¸ªLooper</span><br><span class="line">        throw new RuntimeException(&quot;Only one Looper may be created per thread&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    sThreadLocal.set(new Looper(quitAllowed));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>çœ‹æºç å°±çŸ¥é“ï¼Œå½“å‰çº¿ç¨‹ä¸­æœ‰ä¸”åªæœ‰ä¸€ä¸ªLooperï¼Œå½“æˆ‘ä»¬å†æ¬¡åˆ›å»ºï¼Œå°±ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œæ‰€ä»¥ä¸Šé¢æŠ›å¼‚å¸¸çš„åŸå› å°±æ˜¯åœ¨è¿™é‡Œã€‚</p>
<p>è€Œæˆ‘ä»¬çš„<code>loop()</code>æ–¹æ³•å°±æ˜¯æ¶ˆæ¯æœºåˆ¶çš„æ ¸å¿ƒï¼ŒåŸç†æ˜¯å®ç°äº†ä¸€ä¸ªæ— é™å¾ªç¯ï¼Œç”¨äºä»<code>MessageQueue</code>ä¸­å–å‡ºæ¶ˆæ¯åˆ†å‘åˆ°å„ä¸ª<code>Handler</code>ä¸­å»ï¼Œä»¥ä¸‹æ˜¯ç²¾ç®€æºç ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">public static void loop() &#123;</span><br><span class="line">        //ä»ThreadLocalä¸­å–å‡ºLooper</span><br><span class="line">        final Looper me = myLooper();</span><br><span class="line">        if (me == null) &#123;</span><br><span class="line">            throw new RuntimeException(&quot;No Looper; Looper.prepare() wasn&apos;t called on this thread.&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">       //ä»Looperä¸­è·å–åˆ°MessageQueue </span><br><span class="line">        final MessageQueue queue = me.mQueue;</span><br><span class="line"></span><br><span class="line">        ........</span><br><span class="line">        //åˆ›å»ºå¾ªç¯</span><br><span class="line">        for (;;) &#123;</span><br><span class="line">            //ä»MessageQueueä¸­ä¸€ä¸ªä¸€ä¸ªçš„å–å‡ºMessage</span><br><span class="line">            Message msg = queue.next(); // might block</span><br><span class="line">            if (msg == null) &#123;</span><br><span class="line">               //æ²¡æ¶ˆæ¯å–äº†å°±é€€å‡º</span><br><span class="line">                return;</span><br><span class="line">            &#125;</span><br><span class="line">           ...........</span><br><span class="line">            final long start = (slowDispatchThresholdMs == 0) ? 0 : SystemClock.uptimeMillis();</span><br><span class="line">            final long end;</span><br><span class="line">            try &#123;</span><br><span class="line">               //dispatchMessageæ–¹æ³•çš„è°ƒç”¨åœ¨è¿™</span><br><span class="line">                msg.target.dispatchMessage(msg);</span><br><span class="line">                end = (slowDispatchThresholdMs == 0) ? 0 : SystemClock.uptimeMillis();</span><br><span class="line">            &#125; finally &#123;</span><br><span class="line">                if (traceTag != 0) &#123;</span><br><span class="line">                    Trace.traceEnd(traceTag);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            .........</span><br><span class="line">           //å›æ”¶æ¶ˆæ¯ï¼ŒåŒæ—¶å°†Messageç½®ä¸ºç©ºæ¶ˆæ¯å¯¹è±¡ï¼Œå­˜å‚¨åœ¨æ¶ˆæ¯æ± ä¸­ï¼Œç”¨äºobtain()æ–¹æ³•å†æ¬¡è·å–</span><br><span class="line">            msg.recycleUnchecked();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<p>ç»¼åˆè¦ç‚¹å°±æ˜¯ä½¿ç”¨<code>loop()</code>æ¥å¼€å¯æ¶ˆæ¯åˆ†å‘ï¼Œå¹¶ä¸”ä½¿ç”¨<code>prepare</code>æ¥åˆ›å»ºLooperã€‚<strong>å¹¶ä¸”ä¸€ä¸ªçº¿ç¨‹åªèƒ½æœ‰ä¸€ä¸ªLooper</strong>ã€‚</p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œ<code>dispatchMessage</code>å°±æ˜¯åœ¨è¿™é‡Œå›è°ƒçš„ï¼Œé‚£è¿™ä¸ªtargetæ˜¯ä»€ä¹ˆä¸œè¥¿å‘¢ï¼Œå…¶å®å°±æ˜¯æˆ‘ä»¬çš„Handlerå¯¹è±¡ã€‚é‚£è¿™ä¸ªHandlerå¯¹è±¡æ˜¯åœ¨å“ªé‡Œèµ‹å€¼çš„å‘¢ï¼Œè¯·çœ‹Handleræºç </p>
<h5 id="Handler"><a href="#Handler" class="headerlink" title="Handler"></a>Handler</h5><p>é¦–å…ˆçœ‹æˆ‘ä»¬çš„æ„é€ æ–¹æ³•æœ€ç»ˆä¼šè°ƒç”¨åˆ°è¿™é‡Œï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">public Handler(Callback callback, boolean async) &#123;</span><br><span class="line">        if (FIND_POTENTIAL_LEAKS) &#123;</span><br><span class="line">            final Class&lt;? extends Handler&gt; klass = getClass();</span><br><span class="line">            if ((klass.isAnonymousClass() || klass.isMemberClass() || klass.isLocalClass()) &amp;&amp;</span><br><span class="line">                    (klass.getModifiers() &amp; Modifier.STATIC) == 0) &#123;</span><br><span class="line">                Log.w(TAG, &quot;The following Handler class should be static or leaks might occur: &quot; +</span><br><span class="line">                    klass.getCanonicalName());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">         //è¿™é‡Œå°±å°†Looperåˆ›å»ºå¥½äº†ï¼Œä¸»è¦è¿™é‡Œæ˜¯åœ¨ä¸»çº¿ç¨‹ä¸­</span><br><span class="line">        mLooper = Looper.myLooper();</span><br><span class="line">        if (mLooper == null) &#123;</span><br><span class="line">            throw new RuntimeException(</span><br><span class="line">                &quot;Can&apos;t create handler inside thread that has not called Looper.prepare()&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        mQueue = mLooper.mQueue;</span><br><span class="line">        mCallback = callback;</span><br><span class="line">        mAsynchronous = async;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>è¿™é‡Œä¸»è¦èµ·åˆ°ä»ThreadLocalä¸­è·å–Looperå¯¹è±¡çš„ä½œç”¨ã€‚çœ‹<code>Looper.myLooper()</code>æ–¹æ³•ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * Return the Looper object associated with the current thread.  Returns</span><br><span class="line"> * null if the calling thread is not associated with a Looper.</span><br><span class="line"> */</span><br><span class="line">public static @Nullable Looper myLooper() &#123;</span><br><span class="line">    return sThreadLocal.get();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>éšåæˆ‘ä»¬ä¼šè°ƒç”¨<code>sendMessage()</code>ç±»å‹çš„æ–¹æ³•æ¥å‘é€æ¶ˆæ¯ï¼Œæœ€ç»ˆéƒ½ä¼šè°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">private boolean enqueueMessage(MessageQueue queue, Message msg, long uptimeMillis) &#123;</span><br><span class="line">    msg.target = this; //è¿™é‡Œå°†Handlerèµ‹å€¼äº†</span><br><span class="line">    if (mAsynchronous) &#123;</span><br><span class="line">        msg.setAsynchronous(true);</span><br><span class="line">    &#125;</span><br><span class="line">    return queue.enqueueMessage(msg, uptimeMillis);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>æ³¨æ„çœ‹è¿™é‡Œ<code>msg.target = this</code>ï¼Œè¿™é‡Œå®ç°äº†å°†å½“å‰Handlerèµ‹å€¼åˆ°äº†Messageä¸­ã€‚éšåè°ƒç”¨äº†<code>enqueueMessage</code>æ–¹æ³•å°±å°†æ­¤MessageæŠ•å…¥åˆ°äº†æ¶ˆæ¯æ± <code>MessageQueue</code>ä¸­.åˆ°è¿™é‡Œï¼Œä¸€ç³»åˆ—çš„åˆå§‹åŒ–ä¸è°ƒç”¨éƒ½å®Œæˆäº†ã€‚</p>
<p>æ‰€ä»¥ï¼Œç»è¿‡ä»¥ä¸Šåˆ†æï¼Œæˆ‘ä»¬ä¹‹å‰çš„é—®é¢˜å°±è¿åˆƒè€Œè§£äº†ï¼Œä½†æ˜¯è¿˜æ˜¯æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬åœ¨ç¬¬ä¸€ä¸ªå®ä¾‹ä¸­å¹¶æ²¡æœ‰ä½¿ç”¨<code>Looper</code>çš„<code>prepare</code>å’Œ<code>loop</code>æ–¹æ³•ï¼Œé‚£æˆ‘ä»¬çš„æ¶ˆæ¯æœºåˆ¶ä¸ºä»€ä¹ˆä¼šç”Ÿæ•ˆå‘¢ï¼Œå…¶å®åœ¨æˆ‘ä»¬çš„appåˆ›å»ºçš„æ—¶å€™ç³»ç»Ÿå·²ç»é»˜è®¤ä¸ºæˆ‘ä»¬å¼€å¯äº†ï¼Œå¹¶ä¸”æ˜¯åœ¨ä¸»ç¨‹åºçš„æœ€åè°ƒç”¨çš„ï¼Œå¹¶æ²¡æœ‰åœ¨<code>onCreate()</code>æ–¹æ³•ä¸­,è€Œå…¶ä»–çš„ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ï¼Œæ˜¯é€šè¿‡AMSè¿›è¡Œå›è°ƒã€‚è¿™å°±ä¿è¯äº†æˆ‘ä»¬çš„å¾ªç¯ä¸ä¼šé€ æˆä¸»çº¿ç¨‹å¡é¡¿ï¼Œå…·ä½“çš„æºç è°ƒç”¨æ˜¯åœ¨<code>ActivityThread</code>ç±»ä¸­çš„<code>main</code>å‡½æ•°ä¸­:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">public static void main(String[] args) &#123;</span><br><span class="line">    SamplingProfilerIntegration.start();</span><br><span class="line"></span><br><span class="line">    // CloseGuard defaults to true and can be quite spammy.  We</span><br><span class="line">    // disable it here, but selectively enable it later (via</span><br><span class="line">    // StrictMode) on debug builds, but using DropBox, not logs.</span><br><span class="line">    CloseGuard.setEnabled(false);</span><br><span class="line"></span><br><span class="line">    Environment.initForCurrentUser();</span><br><span class="line"></span><br><span class="line">    // Set the reporter for event logging in libcore</span><br><span class="line">    EventLogger.setReporter(new EventLoggingReporter());</span><br><span class="line"></span><br><span class="line">    Security.addProvider(new AndroidKeyStoreProvider());</span><br><span class="line"></span><br><span class="line">    // Make sure TrustedCertificateStore looks in the right place for CA certificates</span><br><span class="line">    final File configDir = Environment.getUserConfigDirectory(UserHandle.myUserId());</span><br><span class="line">    TrustedCertificateStore.setDefaultUserDirectory(configDir);</span><br><span class="line"></span><br><span class="line">    Process.setArgV0(&quot;&lt;pre-initialized&gt;&quot;);</span><br><span class="line"></span><br><span class="line">    Looper.prepareMainLooper();  // //ä¸ºå½“å‰çº¿ç¨‹ï¼ˆä¸»çº¿ç¨‹ï¼‰åˆ›å»ºä¸€ä¸ªLooperå¯¹è±¡</span><br><span class="line"></span><br><span class="line">    ActivityThread thread = new ActivityThread();</span><br><span class="line">    thread.attach(false);</span><br><span class="line"></span><br><span class="line">    if (sMainThreadHandler == null) &#123;</span><br><span class="line">        sMainThreadHandler = thread.getHandler();  //ä¸ºå½“å‰çº¿ç¨‹è®¾ç½®Handler</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    AsyncTask.init();</span><br><span class="line"></span><br><span class="line">    if (false) &#123;</span><br><span class="line">        Looper.myLooper().setMessageLogging(new</span><br><span class="line">                LogPrinter(Log.DEBUG, &quot;ActivityThread&quot;));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Looper.loop();  // æ‰§è¡Œä»æ¶ˆæ¯é˜Ÿåˆ—ä¸­è·å–Messageï¼Œå¹¶è°ƒç”¨Handlerè¿›è¡Œå¤„ç†çš„æ— é™å¾ªç¯ï¼›æ‰€æœ‰å’Œä¸»çº¿ç¨‹ç›¸å…³çš„æ¶ˆæ¯å¤„ç†éƒ½åœ¨è¯¥æ–¹æ³•ä¸­æ‰§è¡Œ</span><br><span class="line"></span><br><span class="line">    throw new RuntimeException(&quot;Main thread loop unexpectedly exited&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>åˆ†æåˆ°è¿™ï¼ŒHandleræµç¨‹å…¶å®ä¹Ÿå·®ä¸å¤šäº†ï¼Œæœ€ååšä¸‹æ€»ç»“:</p>
<p>1.åœ¨ä¸»çº¿ç¨‹ä¸­åˆå§‹åŒ–äº†ä¸€ä¸ªHandler,æ­¤æ—¶Looper.loop()å·²ç»å¼€å¯ï¼Œé€šè¿‡Handleræ„é€ æ–¹æ³•åˆ›å»ºäº†ä¸€ä¸ªåœ¨ä¸»çº¿ç¨‹ä¸­çš„Looperï¼Œå¹¶ä¿å­˜åˆ°äº†ThreadLocalä¸­ï¼Œ<strong>æ­¤æ—¶ä¸»çº¿ç¨‹ä¸å…è®¸å†åˆ›å»ºç¬¬äºŒä¸ªLooper</strong>.</p>
<p>2.åœ¨å­çº¿ç¨‹ä¸­ä½¿ç”¨<code>sendMessage</code>æ–¹æ³•ï¼Œæ­¤æ—¶ä¼šè°ƒç”¨enqueueMessage()æ–¹æ³•å¹¶åˆ›å»ºä¸€ä¸ªMessage(æˆ–ä»æ± ä¸­å–å‡ºç©ºMessageå¯¹è±¡),ç„¶åæˆ‘ä»¬å°†éœ€è¦å‘é€çš„æ¶ˆæ¯ä¿å­˜åœ¨Messageä¸­ï¼Œ<strong>å¹¶å°†æ­¤Handlerä¿å­˜åˆ°Messageçš„targetå¯¹è±¡ä¸­</strong>ï¼Œç„¶åå‹å…¥åˆ°MessageQueueæ¶ˆæ¯æ± ä¸­</p>
<p>3.Looperä¸­ä¼šå¾ªç¯ä»MessageQueueä¸­å–å‡ºMessageå¯¹è±¡ï¼Œå¹¶å›è°ƒåˆ°targetå¯¹è±¡ä¸Šçš„Handlerçš„dispatchMessage()æ–¹æ³•ä¸­å»ï¼Œç”±äºLooper.loop()æ–¹æ³•æ˜¯åœ¨ä¸»çº¿ç¨‹ä¸­è°ƒç”¨ï¼Œæ‰€ä»¥dispatchMessage()æ–¹æ³•ä¹Ÿæ˜¯è¿è¡Œåœ¨ä¸»çº¿ç¨‹ä¸­ã€‚<strong>Looper.loop()æ–¹æ³•è¿è¡Œæ‰€åœ¨çš„çº¿ç¨‹å†³å®šdispatchMessage()æ–¹æ³•å›è°ƒçš„çº¿ç¨‹ï¼Œå¹¶ä¸”éœ€è¦ä¸Looper.prepare()æ–¹æ³•é…å¥—ä½¿ç”¨</strong></p>
]]></content>
      
        <categories>
            
            <category> å¤šçº¿ç¨‹ç¼–ç¨‹ </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Android </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Android/java å¤šçº¿ç¨‹(ä¸€)-Threadçš„ä½¿ç”¨ä»¥åŠæºç åˆ†æ]]></title>
      <url>/Threadsourse.html</url>
      <content type="html"><![CDATA[<p><strong>ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºåšä¸»åŸåˆ›æ–‡ç« ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„(www.huangjie.name)ï¼Œä¿æŠ¤åŸåˆ›ï¼Œä»æˆ‘åšèµ·.</strong></p>
<hr>
<blockquote>
<p>ä¸ƒç‰›äº‘è¿‡æœŸäº†ï¼Œå›¾ç‰‡ä¹Ÿå­˜ä¸äº†äº†ï¼Œä»¥åå†³å®šåœ¨ç®€ä¹¦ä¸Šå‘å¸ƒæ–‡ç« ï¼Œæ­¤åœ°åªåšä¿å­˜è®°å½•<br><a href="https://www.jianshu.com/u/2334b8b9f764" target="_blank" rel="noopener">æˆ‘çš„ç®€ä¹¦åœ°å€</a>,æ¬¢è¿æ¥é€›é€›å“Ÿ~</p>
</blockquote>
<a id="more"></a>
<h4 id="çº¿ç¨‹çš„æ¦‚å¿µä»¥åŠçŠ¶æ€"><a href="#çº¿ç¨‹çš„æ¦‚å¿µä»¥åŠçŠ¶æ€" class="headerlink" title="çº¿ç¨‹çš„æ¦‚å¿µä»¥åŠçŠ¶æ€"></a>çº¿ç¨‹çš„æ¦‚å¿µä»¥åŠçŠ¶æ€</h4><p>åœ¨å­¦ä¹ çº¿ç¨‹ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦æ™®åŠä¸€ä¸ªæ¦‚å¿µï¼Œæ¯ä¸€ä¸ªç¨‹åºè¿è¡Œéƒ½ä¼šæœ‰ä¸€ä¸ªçˆ¶è¿›ç¨‹ï¼Œæˆ‘ä»¬çš„çº¿ç¨‹å°±æ˜¯åœ¨æ­¤çˆ¶è¿›ç¨‹ä¸­è¿è¡Œï¼Œæ‹¿Androidæ¥è¯´ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œå¯åŠ¨ä¸€ä¸ªç¨‹åºï¼Œæ‰€æœ‰çš„ç»„ä»¶ç¨‹åºéƒ½è¿è¡Œåœ¨åŒä¸€ä¸ªè¿›ç¨‹ä¸­ï¼Œå¹¶ä¸”ä¼šåˆ›å»ºä¸€ä¸ªæ‰§è¡Œçº¿ç¨‹åœ¨è¯¥è¿›ç¨‹ä¸­ï¼Œä¿—ç§°â€ä¸»çº¿ç¨‹â€,å½“æˆ‘ä»¬åœ¨è¯¥çº¿ç¨‹ä¸­åšäº†è€—æ—¶çš„æ“ä½œé€ æˆäº†ç¨‹åºå¡é¡¿ï¼Œæˆ‘ä»¬å°±å«â€œçº¿ç¨‹é˜»å¡â€äº†,æ­¤æ—¶å°±åº”è¯¥å¦èµ·ä¸€ä¸ªçº¿ç¨‹æ¥æ‰§è¡Œè€—æ—¶æ“ä½œã€‚</p>
<p>è¦äº†è§£çº¿ç¨‹ä¸­æ–¹æ³•çš„ä½¿ç”¨ï¼Œå°±å¾—å…ˆäº†è§£çº¿ç¨‹çš„è¿è¡ŒçŠ¶æ€ï¼Œçº¿ç¨‹ä»åˆ›å»ºåˆ°æ‰§è¡Œå®Œæ¯•ï¼Œä¸€å…±æœ‰6ä¸ªçŠ¶æ€ï¼š</p>
<ul>
<li>NEW(çº¿ç¨‹åˆ›å»ºæœªå¯åŠ¨)</li>
<li>RUNNABLE(æ­£åœ¨æ‰§è¡Œä¸­çš„çº¿ç¨‹)</li>
<li>BLOCKED(è¢«é˜»å¡å¹¶ä¸”åœ¨ç­‰å¾…ç›‘è§†å™¨é”é‡Šæ”¾)</li>
<li>WAITING(ç­‰å¾…è¢«å”¤é†’)</li>
<li>TIMED_WAITING(ç­‰å¾…æˆ–ç¡çœ ä¸€å®šæ—¶é—´è¢«å”¤é†’)</li>
<li>TERMINATEDï¼ˆçº¿ç¨‹ç»ˆæ­¢ï¼Œæ¶ˆäº¡ï¼‰</li>
</ul>
<p>è¿™äº›çŠ¶æ€å¯¹åº”<code>Thread</code>æºç ä¸­çš„<code>State</code>æšä¸¾ï¼Œé€šè¿‡<code>getState()</code>æ–¹æ³•å¯ä»¥è·å–è¯¥çº¿ç¨‹çš„è¿è¡ŒçŠ¶æ€</p>
<p>å…¶ä¸­<code>BLOCKED</code>è¡¨ç¤ºç­‰å¾…ç›‘è§†å™¨é”çš„è¿‡ç¨‹ï¼Œé‚£ä¹ˆä»€ä¹ˆæ˜¯ç›‘è§†å™¨é”å‘¢ï¼Œç›‘è§†å™¨é”æ˜¯ä¸ºäº†è§£å†³çº¿ç¨‹ä¸å®‰å…¨è€Œè¯ç”Ÿçš„æ–¹æ³•ï¼Œå½“å¤šä¸ªè¿›ç¨‹åŒæ—¶æ“ä½œä¸€ä¸ªæ•°æ®ç»“æ„å¹¶ä¿®æ”¹æ—¶ï¼Œè¿™æ—¶æ•°æ®ç»“æ„æ˜¯ä¸ç¡®å®šçš„ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºâ€œçº¿ç¨‹ä¸å®‰å…¨â€,äºæ˜¯æˆ‘ä»¬ä½¿ç”¨<code>synchronized(åŒæ­¥é”)</code>å’Œ<code>locké”</code>ç­‰æœºåˆ¶æ¥è§£å†³è¿™ç§çº¿ç¨‹ä¸å®‰å…¨ï¼Œå¥—ä¸Šæ­¤é”ï¼Œå½“å‰æœ‰ä¸”åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½ä¿®æ”¹æ­¤æ•°æ®ç»“æ„ï¼Œå…¶ä»–çš„çº¿ç¨‹åˆ™éœ€è¦ç­‰å¾…ï¼Œè¿™å°±ä¿è¯äº†æ•°æ®ç»“æ„çš„ä¸€è‡´æ€§ï¼Œè€Œå…¶ä»–çº¿ç¨‹ä¼šè¿›å…¥ç­‰å¾…çš„çŠ¶æ€ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬çš„<code>BLOCKED</code>çŠ¶æ€ã€‚<br><code>synchronized</code>ä½¿ç”¨ç¤ºä¾‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">class MyThread extends Thread &#123;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void run() &#123;</span><br><span class="line">        synchronized (this) &#123;</span><br><span class="line">            //è¿™é‡Œå†™ä¿®æ”¹æ•°æ®æºçš„ä»£ç </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>lock</code>ä½¿ç”¨ç¤ºä¾‹ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">class MyThread extends Thread &#123;</span><br><span class="line">    private final ReentrantLock lock = new ReentrantLock ();</span><br><span class="line">    </span><br><span class="line">    @Override</span><br><span class="line">    public void run() &#123;</span><br><span class="line">        lock.lock();</span><br><span class="line">            //è¿™é‡Œå†™ä¿®æ”¹æ•°æ®æºçš„ä»£ç </span><br><span class="line">        lock.unlock();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>å½“ç„¶è¿™ä¸¤è€…çš„åº”ç”¨ä¸ä»…ä»…æ˜¯åœ¨çº¿ç¨‹ä¸­ï¼Œåœ¨å¿…è¦çš„æ–¹æ³•è°ƒç”¨ä¸Šä¹Ÿå¯ä½¿ç”¨</p>
<h4 id="çº¿ç¨‹çš„æºç ä»¥åŠæ–¹æ³•ä½¿ç”¨"><a href="#çº¿ç¨‹çš„æºç ä»¥åŠæ–¹æ³•ä½¿ç”¨" class="headerlink" title="çº¿ç¨‹çš„æºç ä»¥åŠæ–¹æ³•ä½¿ç”¨"></a>çº¿ç¨‹çš„æºç ä»¥åŠæ–¹æ³•ä½¿ç”¨</h4><p><code>Thread</code>æºç ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">public class Thread implements Runnable &#123;</span><br><span class="line"> ...........</span><br><span class="line">    /* Some of these are accessed directly by the VM; do not rename them. */</span><br><span class="line">    private volatile long nativePeer;</span><br><span class="line">    volatile ThreadGroup group;</span><br><span class="line">    volatile boolean daemon;</span><br><span class="line">    volatile String name;</span><br><span class="line">    volatile int priority;</span><br><span class="line">    volatile long stackSize;</span><br><span class="line">    Runnable target;</span><br><span class="line">    private static int count = 0;</span><br><span class="line">    private long threadInitNumber ;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * Normal thread local values.</span><br><span class="line">     */</span><br><span class="line">    ThreadLocal.Values localValues;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * Inheritable thread local values.</span><br><span class="line">     */</span><br><span class="line">    ThreadLocal.Values inheritableValues;</span><br><span class="line"></span><br><span class="line">    /** Callbacks to run on interruption. */</span><br><span class="line">    private final List&lt;Runnable&gt; interruptActions = new ArrayList&lt;Runnable&gt;();</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * Holds the class loader for this Thread, in case there is one.</span><br><span class="line">     */</span><br><span class="line">    private ClassLoader contextClassLoader;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * Holds the handler for uncaught exceptions in this Thread,</span><br><span class="line">     * in case there is one.</span><br><span class="line">     */</span><br><span class="line">    private UncaughtExceptionHandler uncaughtHandler;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * Holds the default handler for uncaught exceptions, in case there is one.</span><br><span class="line">     */</span><br><span class="line">    private static UncaughtExceptionHandler defaultUncaughtHandler;</span><br><span class="line"></span><br><span class="line">   .....</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>Threadå®ç°äº†Runnableæ¥å£ï¼Œå¹¶å£°æ˜äº†ä¸€äº›çº¿ç¨‹å¸¸ç”¨çš„ä¸€äº›å˜é‡:</p>
<ul>
<li><p>group<br>çº¿ç¨‹ç»„ï¼Œçº¿ç¨‹ç»„åŒ…å«å…¶ä»–çš„çº¿ç¨‹ç»„ï¼Œå½¢æˆäº†ä¸€ä¸ªæ ‘ç»“æ„ï¼Œé™¤äº†åˆå§‹çš„çº¿ç¨‹ç»„å¤–ï¼Œå…¶ä»–çš„çº¿ç¨‹ç»„éƒ½ä¼šæœ‰ä¸ªçˆ¶è¿›ç¨‹ï¼Œå…¶ä¸­çº¿ç¨‹èƒ½è®¿é—®å½“å‰çº¿ç¨‹ç»„çš„ä¿¡æ¯ï¼Œä½†ä¸èƒ½è®¿é—®çˆ¶çº¿ç¨‹ç»„çš„ä¿¡æ¯</p>
</li>
<li><p>daemon<br>æ˜¯å¦æ˜¯å®ˆæŠ¤çº¿ç¨‹ï¼Œå•¥æ˜¯å®ˆæŠ¤çº¿ç¨‹å‘¢ï¼Œå®ˆæŠ¤çº¿ç¨‹æ˜¯ä¾èµ–äºåˆ›å»ºå®ƒçš„çº¿ç¨‹çš„ä¸€ç§çº¿ç¨‹ï¼Œä¸æ™®é€šçº¿ç¨‹çš„åŒºåˆ«æ˜¯å½“åˆ›å»ºå®ƒçš„çº¿ç¨‹å…³é—­äº†é‚£å®ƒä¹Ÿä¼šå…³é—­ï¼Œè€Œæ™®é€šçº¿ç¨‹ä¸ä¼šï¼Œåƒæˆ‘ä»¬çš„åƒåœ¾æ”¶é›†å™¨çº¿ç¨‹å°±æ˜¯ä¸€ä¸ªå®ˆæŠ¤çº¿ç¨‹</p>
</li>
<li>threadInitNumber å½“å‰çº¿ç¨‹çš„æ ‡è¯†ç¬¦ï¼Œå®ƒæ˜¯æŒ‰ç…§çº¿ç¨‹çš„åˆ›å»ºé¡ºåºæ¥å åŠ çš„</li>
<li>name çº¿ç¨‹çš„åç§°ï¼ŒæœªæŒ‡å®šçš„è¯å°±ä»¥<code>&quot;Thread-&quot; + threadInitNumber</code>çš„é€»è¾‘å‘½å</li>
<li>priority<br>çº¿ç¨‹ä¼˜å…ˆçº§ï¼Œæœ‰ä¸‰ä¸ªçŠ¶æ€<code>MIN_PRIORITY</code>,<code>NORM_PRIORITY</code>,<code>MAX_PRIORITY</code>,åˆ†åˆ«å¯¹åº”ä½ï¼Œä¸­ï¼Œé«˜</li>
<li>stackSize å †æ ˆå¤§å°</li>
<li>target å½“å‰çš„ç›®æ ‡çº¿ç¨‹</li>
<li>contextClassLoader ç±»åŠ è½½å™¨ï¼Œç”¨äºä¿å­˜è¯¥çº¿ç¨‹çš„ä¿¡æ¯ï¼Œæ–­ç‚¹ç»­ä¼ ç­‰åŠŸèƒ½å¯ä»¥ç”¨åˆ°</li>
<li>uncaughtHandler<br>çº¿ç¨‹æœªæ•è·å¼‚å¸¸è°ƒç”¨ç±»ï¼Œå¦‚æœæ²¡æœ‰å¯¹å…¶è¿›è¡Œè®¾ç½®ï¼Œå°†ä¼šé»˜è®¤ä½¿ç”¨<code>defaultUncaughtHandler</code>æ¥å¤„ç†å¼‚å¸¸ï¼Œç”±äºæˆ‘ä»¬çš„ä¸»çº¿ç¨‹ä¹Ÿæ˜¯ä¸€ä¸ªThread,æ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡å®ç°<code>UncaughtExceptionHandler</code>æ¥å£å¹¶è°ƒç”¨<code>Thread.setDefaultUncaughtExceptionHandlerï¼ˆï¼‰</code>æ–¹æ³•å°†æˆ‘ä»¬è‡ªå®šä¹‰çš„å¼‚å¸¸æ•è·ç±»è®¾ç½®ç»™Thread,è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥æ•è·å…¨å±€çš„å¼‚å¸¸</li>
</ul>
<p>äº†è§£äº†ä¸€äº›å¸¸ç”¨å˜é‡åï¼Œæˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸‹å…¶ä¸­çš„ä¸€äº›å¸¸ç”¨æ–¹æ³•:</p>
<h5 id="start-æ–¹æ³•"><a href="#start-æ–¹æ³•" class="headerlink" title="start()æ–¹æ³•"></a>start()æ–¹æ³•</h5><p>ç”¨äºå¯åŠ¨ä¸€ä¸ªçº¿ç¨‹ï¼Œåªæœ‰è°ƒç”¨æ­¤æ–¹æ³•ï¼Œç³»ç»Ÿæ‰ä¼šæ–°å¼€å¯ä¸€ä¸ªçº¿ç¨‹å¹¶åˆ†é…ç»™å…¶å¿…è¦çš„èµ„æºã€‚æˆ‘ä»¬çœ‹ä¸€ä¸‹Threadçš„æ„é€ æ–¹æ³•ï¼Œå‘ç°æœ€ç»ˆéƒ½æ˜¯è°ƒç”¨äº†<code>init</code>æ–¹æ³•ï¼Œé‡Œé¢ä¹Ÿåªæ˜¯å¯¹åŸºæœ¬å˜é‡è¿›è¡Œåˆå§‹åŒ–ï¼Œå¹¶æ²¡æœ‰åˆ†é…åˆ°ä»»ä½•çš„èµ„æºï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">private void init(ThreadGroup g, Runnable target, String name, long stackSize) &#123;</span><br><span class="line">    Thread parent = currentThread();</span><br><span class="line">    if (g == null) &#123;</span><br><span class="line">        g = parent.getThreadGroup();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    g.addUnstarted();</span><br><span class="line">    this.group = g;</span><br><span class="line"></span><br><span class="line">    this.target = target;</span><br><span class="line">    this.priority = parent.getPriority();</span><br><span class="line">    this.daemon = parent.isDaemon();</span><br><span class="line">    setName(name);</span><br><span class="line"></span><br><span class="line">    init2(parent);</span><br><span class="line"></span><br><span class="line">    /* Stash the specified stack size in case the VM cares */</span><br><span class="line">    this.stackSize = stackSize;</span><br><span class="line">    tid = nextThreadID();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>æ‰€ä»¥ï¼Œæ–°å»ºä¸€ä¸ªçº¿ç¨‹ä¸ä¼šæ¶ˆè€—èµ„æºï¼Œåªæœ‰å½“staråæ‰ä¼šå»åˆ†é…å¿…è¦çš„èµ„æºï¼Œæ­¤æ—¶çº¿ç¨‹çŠ¶æ€ç”±<code>NEW</code>å˜ä¸ºäº†<code>RUNNABLE</code></p>
<h5 id="run-æ–¹æ³•"><a href="#run-æ–¹æ³•" class="headerlink" title="run()æ–¹æ³•"></a>run()æ–¹æ³•</h5><p>æ­¤æ–¹æ³•ç”¨äºå¤„ç†çº¿ç¨‹ä¸­æ‰§è¡Œçš„é€»è¾‘ï¼Œå¦‚æœç»§æ‰¿Threadç±»åˆ™å¿…é¡»é‡å†™è¯¥æ–¹æ³•</p>
<h5 id="sleep-æ–¹æ³•"><a href="#sleep-æ–¹æ³•" class="headerlink" title="sleep()æ–¹æ³•"></a>sleep()æ–¹æ³•</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sleep(long millis)     //å‚æ•°ä¸ºæ¯«ç§’</span><br><span class="line">sleep(long millis,int nanoseconds)    //ç¬¬ä¸€å‚æ•°ä¸ºæ¯«ç§’ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºçº³ç§’</span><br></pre></td></tr></table></figure>
<p>è®©çº¿ç¨‹ä¼‘çœ ä¸€æ®µæ—¶é—´ï¼Œç›¸å½“äºè®©çº¿ç¨‹è¿›å…¥é˜»å¡çŠ¶æ€ã€‚æ³¨æ„å³ä½¿çº¿ç¨‹ä¼‘çœ äº†å…¶é”æœºåˆ¶ä¾æ—§ç”Ÿæ•ˆï¼Œå…¶ä»–çš„çº¿ç¨‹ä¾æ—§ä¸èƒ½è®¿é—®å…¶è¢«é”çš„æ•°æ®ç»“æ„ï¼Œç›´åˆ°å…¶é‡Šæ”¾å¯¹è±¡é”ï¼Œæ­¤æ—¶çº¿ç¨‹çŠ¶æ€ç”±<code>RUNNABLE</code>è¿›å…¥<code>TIMED_WAITING</code></p>
<h5 id="yield-æ–¹æ³•"><a href="#yield-æ–¹æ³•" class="headerlink" title="yield()æ–¹æ³•"></a>yield()æ–¹æ³•</h5><p>è®©å½“å‰çº¿ç¨‹äº¤å‡ºç›¸åº”çš„æƒé™ï¼Œä¸ºå…¶ä»–çº¿ç¨‹è®©æ­¥ï¼Œè¿™æ˜¯é˜²æ­¢CPUè¿‡åº¦ä½¿ç”¨çš„ä¸€ç§æœ‰æ•ˆæ‰‹æ®µã€‚æ•ˆæœä¸<code>sleep</code>å·®ä¸å¤šï¼Œä½†ä¸èƒ½æŒ‡å®šå…·ä½“çš„æ—¶é—´ï¼Œå¹¶ä¸”å¹¶ä¸æ˜¯è®©çº¿ç¨‹è¿›å…¥åˆ°é˜»å¡çŠ¶æ€ï¼Œè€Œæ˜¯è¿›å…¥å°±ç»ªçŠ¶æ€.æ­¤æ—¶çº¿ç¨‹çŠ¶æ€ç”±<code>RUNNABLE</code>è¿›å…¥<code>WAITING</code></p>
<h5 id="join-æ–¹æ³•"><a href="#join-æ–¹æ³•" class="headerlink" title="join()æ–¹æ³•"></a>join()æ–¹æ³•</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">join()</span><br><span class="line">join(long millis)     //å‚æ•°ä¸ºæ¯«ç§’</span><br><span class="line">join(long millis,int nanoseconds)    //ç¬¬ä¸€å‚æ•°ä¸ºæ¯«ç§’ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºçº³ç§’</span><br></pre></td></tr></table></figure>
<p>æ­¤æ–¹æ³•æ˜¯è®©çº¿ç¨‹ä¼˜å…ˆæ¥æ‰§è¡Œï¼Œå…¶ä½™çš„çº¿ç¨‹ä¼šæš‚åœï¼Œç›´åˆ°æ­¤çº¿ç¨‹æ‰§è¡Œå®Œæ¯•æ‰ä¼šç»§ç»­æ‰§è¡Œã€‚ä½ å¯ä»¥å°†çº¿ç¨‹çœ‹æˆä¸€äº›æ­£å¸¸è¡Œé©¶çš„è½¦è¾†(åœ¨çº¿ç¨‹é˜Ÿåˆ—ä¸­)ï¼Œå½“ç»™å…¶ä¸­ä¸€è¾†è½¦ä½¿ç”¨äº†join(å¼¯é“è¶…è½¦),é‚£å…¶ä½™çš„è½¦ä¼šç»™å…¶è®©è¡Œï¼ˆçº¿ç¨‹è¿›å…¥æš‚åœçŠ¶æ€ï¼‰ï¼Œä¼˜å…ˆè®©å®ƒè¡Œé©¶(joinçš„çº¿ç¨‹è¿è¡Œ)ï¼Œç›´åˆ°å®ƒåˆ°è¾¾ç»ˆç‚¹(è¿è¡Œå®Œæˆ)ï¼Œæ‰ä¼šç»§ç»­è¡Œé©¶ï¼ˆç»§ç»­æ‰§è¡Œï¼‰<br>è€Œ<code>join</code>æºç ä¸­æ˜¯è°ƒç”¨çš„<code>wait()</code>æ–¹æ³•ï¼Œè€Œ<code>wait()</code>æ–¹æ³•èƒ½ä½¿çº¿ç¨‹è¿›å…¥é˜»å¡çŠ¶æ€å¹¶é‡Šæ”¾å¯¹è±¡é”ï¼Œæ‰€ä»¥<code>join</code>æ–¹æ³•ä¹Ÿæ˜¯èƒ½é‡Šæ”¾å¯¹è±¡é”çš„</p>
<h5 id="interruptï¼ˆï¼‰æ–¹æ³•"><a href="#interruptï¼ˆï¼‰æ–¹æ³•" class="headerlink" title="interruptï¼ˆï¼‰æ–¹æ³•"></a>interruptï¼ˆï¼‰æ–¹æ³•</h5><p>ä¸­æ–­çº¿ç¨‹ï¼Œæˆ‘ä»¬çŸ¥é“ï¼Œçº¿ç¨‹æ‰§è¡Œå®Œrunæ–¹æ³•é‡Œçš„é€»è¾‘å°±ä¼šè¿›å…¥ç»ˆæ­¢çŠ¶æ€ã€‚è°ƒç”¨æ­¤æ–¹æ³•ä¼šä½¿ä¸€ä¸ªé˜»å¡çš„çº¿ç¨‹æŠ›å‡º<code>InterruptedException</code>å¼‚å¸¸ï¼Œä»è€Œç»ˆæ­¢çº¿ç¨‹ï¼Œå¯ä»¥è°ƒç”¨<code>isInterrupted()</code>åˆ¤æ–­æ˜¯å¦ç»ˆæ­¢äº†çº¿ç¨‹ï¼Œä½†éé˜»å¡çº¿ç¨‹å¦‚ä½•ä¸­æ–­å‘¢ï¼Œè¯·çœ‹ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">class MyThread extends Thread&#123;</span><br><span class="line">        private volatile boolean isStop = false;</span><br><span class="line">        @Override</span><br><span class="line">        public void run() &#123;</span><br><span class="line">            int i = 0;</span><br><span class="line">            while(!isStop)&#123;</span><br><span class="line">                i++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">         </span><br><span class="line">        public void setStop(boolean stop)&#123;</span><br><span class="line">            this.isStop = stop;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<p>æˆ‘ä»¬å¯ä»¥è®¾ç½®ä¸€ä¸ªå˜é‡æ¥æ§åˆ¶æ˜¯å¦æ‰§è¡Œå®Œæ¯•ï¼Œä»è€Œç»“æŸçº¿ç¨‹ï¼Œæ­¤æ—¶çº¿ç¨‹çŠ¶æ€è¿›å…¥<code>TERMINATED</code>çŠ¶æ€</p>
]]></content>
      
        <categories>
            
            <category> å¤šçº¿ç¨‹ç¼–ç¨‹ </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Android </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[å®‰å“å°ç™½ä¹‹ndkç¼–è¯‘æ‰“åŒ…æˆsoä¾›ç¬¬ä¸‰æ–¹è°ƒç”¨]]></title>
      <url>/ndkbuildproject.html</url>
      <content type="html"><![CDATA[<p><strong>ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºåšä¸»åŸåˆ›æ–‡ç« ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„(www.huangjie.name)ï¼Œä¿æŠ¤åŸåˆ›ï¼Œä»æˆ‘åšèµ·.</strong></p>
<hr>
<blockquote>
<p>æœ¬æ–‡æ¥ç€ä¸Šç¯‡æ–‡ç« å†…å®¹æ¥,ä¸»è¦è®²è¿°å¦‚ä½•ç”Ÿæˆsoåº“ä»¥åŠå°†ç±»ç¼–è¯‘æˆjaråŒ…ä¾›ç¬¬ä¸‰æ–¹è°ƒç”¨<br><a href="http://www.huangjie.name/androidndkstudyfirst.html">å®‰å“å°ç™½ä¹‹ndkå…¥é—¨ç¯‡</a><br><a id="more"></a></p>
</blockquote>
<h4 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h4><p>åœ¨build.gradleä¸­<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">externalNativeBuild &#123;</span><br><span class="line">    cmake &#123;</span><br><span class="line">        cppFlags &quot;&quot;</span><br><span class="line">         //åœ¨è¿™é‡ŒæŒ‡å®šéœ€è¦ç”Ÿæˆä»€ä¹ˆç±»å‹çš„so</span><br><span class="line">        abiFilters &quot;armeabi&quot;,&quot;armeabi-v7a&quot;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>åœ¨CMakeListæ–‡ä»¶ä¸­å¯ä»¥æŒ‡å®šç”Ÿæˆçš„soåº“çš„åç§°<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">add_library( # Sets the name of the library.</span><br><span class="line">        native-lib  #ä¿®æ”¹æ­¤å¤„</span><br><span class="line"></span><br><span class="line">        # Sets the library as a shared library.</span><br><span class="line">        SHARED</span><br><span class="line"></span><br><span class="line">        # Provides a relative path to your source file(s).</span><br><span class="line">        src/main/cpp/native-lib.cpp)</span><br><span class="line"></span><br><span class="line">.....</span><br><span class="line">target_link_libraries( # Specifies the target library.</span><br><span class="line">        native-lib #ä¿®æ”¹æ­¤å¤„</span><br><span class="line"></span><br><span class="line">        # Links the target library to the log library</span><br><span class="line">        # included in the NDK.</span><br><span class="line">        $&#123;log-lib&#125;)</span><br></pre></td></tr></table></figure></p>
<p>æ³¨æ„<code>add_library</code>çš„åç§°å’Œ<code>target_link_libraries</code>çš„åç§°å¿…é¡»ç›¸åŒ<br>è¿˜æœ‰å¦å¤–ä¸€ç§é…ç½®<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">defaultConfig&#123;</span><br><span class="line">   ndk&#123;</span><br><span class="line">       //æŒ‡å®šç”Ÿæˆçš„soåº“åç§°</span><br><span class="line">       moduleName &quot;native&quot;</span><br><span class="line">      //åœ¨è¿™é‡ŒæŒ‡å®šéœ€è¦ç”Ÿæˆä»€ä¹ˆç±»å‹çš„so</span><br><span class="line">       abiFilters &quot;armeabi&quot;,&quot;armeabi-v7a&quot;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>å¯ä»¥ç›´æ¥åœ¨gradleä¸­éƒ½é…ç½®å¥½ï¼Œä¸éœ€è¦æ›´æ”¹CMakeList</p>
<p>é…ç½®å¥½åï¼Œç‚¹å‡»<code>Build</code>-&gt;<code>Make Project</code>ç­‰å¾…ç¼–è¯‘å®Œæˆ,å¦‚æœä½ æ˜¯é€šè¿‡ç¬¬ä¸€ç§æ–¹æ³•é…ç½®çš„ï¼Œé‚£ä¹ˆç”Ÿæˆçš„soåº“ä½äº<code>app</code>-&gt;<code>build</code>-&gt;<code>intermediates</code>-&gt;<code>cmake</code>-&gt;<code>debug</code>-&gt;<code>obj</code>ç›®å½•ä¸‹ï¼Œå¦‚æœæ˜¯ç¬¬äºŒç§æ–¹æ³•ï¼Œé‚£ä¹ˆsoåº“ä½äº<code>app</code>-&gt;<code>build</code>-&gt;<code>intermediates</code>-&gt;<code>ndk</code>-&gt;<code>debug</code>-&gt;<code>obj</code>ç›®å½•ä¸‹ã€‚</p>
<h4 id="ç”ŸæˆjaråŒ…"><a href="#ç”ŸæˆjaråŒ…" class="headerlink" title="ç”ŸæˆjaråŒ…"></a>ç”ŸæˆjaråŒ…</h4><p>çœ‹cppæ–‡ä»¶é‡Œçš„æ–¹æ³•å°±çŸ¥é“ï¼Œæ–¹æ³•å£°æ˜éƒ½æ˜¯ä¸åŒ…åç»‘å®šçš„ï¼Œé‚£æˆ‘è¦æ˜¯ç»™ç¬¬ä¸‰æ–¹appè°ƒç”¨å‘¢ï¼Œæ€»ä¸èƒ½è®©å®ƒä»¬ç”¨æˆ‘ä»¬çš„åŒ…åå§ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬å°±éœ€è¦å°†æˆ‘ä»¬çš„ç±»éƒ½æ‰“æˆjaråŒ…ä¾›ç¬¬ä¸‰æ–¹é—´æ¥è°ƒç”¨ï¼Œè®©ç¬¬ä¸‰æ–¹è°ƒç”¨æˆ‘ä»¬çš„ç±»ï¼Œæˆ‘ä»¬çš„ç±»æ¥è°ƒç”¨cä»£ç ï¼Œè¿™æ ·é—®é¢˜å°±è§£å†³å•¦ã€‚</p>
<p>1.è¦ç¼–è¯‘jaråŒ…ï¼Œå‰ææ¡ä»¶æ˜¯ä½ çš„è¿™ä¸ªé¡¹ç›®å¿…é¡»æ˜¯ä¸€ä¸ªç±»åº“ï¼Œä¹Ÿå°±æ˜¯library,åœ¨app gradle<br>çš„æœ€ä¸Šé¢æŸ¥çœ‹æ˜¯å¦ä¸º<code>apply plugin: &#39;com.android.library&#39;</code></p>
<p>2.åœ¨build defaultConfigç›®å½•é‡ŒåŠ å…¥ä»¥ä¸‹ä»£ç :<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">task makeJar(type: Copy) &#123;</span><br><span class="line">        //åˆ é™¤å­˜åœ¨çš„</span><br><span class="line">        delete &apos;build/libs/jar.jar&apos;</span><br><span class="line">        //è®¾ç½®æ‹·è´çš„æ–‡ä»¶</span><br><span class="line">        from(&apos;build/intermediates/bundles/debug/&apos;)</span><br><span class="line">        //æ‰“è¿›jaråŒ…åçš„æ–‡ä»¶ç›®å½•</span><br><span class="line">        into(&apos;build/libs/&apos;)</span><br><span class="line">        //å°†classes.jaræ”¾å…¥build/libs/ç›®å½•ä¸‹</span><br><span class="line">        //include ,excludeå‚æ•°æ¥è®¾ç½®è¿‡æ»¤</span><br><span class="line">        //ï¼ˆæˆ‘ä»¬åªå…³å¿ƒclasses.jarè¿™ä¸ªæ–‡ä»¶ï¼‰</span><br><span class="line">        include(&apos;classes.jar&apos;)</span><br><span class="line">        //é‡å‘½å</span><br><span class="line">        rename (&apos;classes.jar&apos;, &apos;jar.jar&apos;)</span><br><span class="line">    &#125;</span><br><span class="line">    makeJar.dependsOn(build)</span><br></pre></td></tr></table></figure></p>
<p>çœ‹æ³¨é‡Šï¼Œåå­—ä»»æ„å–ï¼Œç„¶åå†Terminalä¸­æ‰§è¡Œå‘½ä»¤<code>gradlew makeJar</code>, Terminalåœ¨AndroidStudioçš„å·¦ä¸‹è§’ã€‚<br>æ‰§è¡Œå®Œï¼Œæç¤ºBUILD SUCCESSFULåï¼Œåœ¨ä»¥ä¸‹è·¯å¾„å¯ä»¥æ‰¾åˆ°ç”Ÿæˆçš„jaråŒ…ï¼š<br><code>app/build/intermediates/bundles/debug/</code></p>
<h4 id="è°ƒç”¨"><a href="#è°ƒç”¨" class="headerlink" title="è°ƒç”¨"></a>è°ƒç”¨</h4><p>jaråŒ…å’Œsoåº“éƒ½ç”Ÿæˆå¥½åï¼Œå°±å¯ä»¥ä½¿ç”¨äº†ï¼Œå°†jaråŒ…æ”¾å…¥app-&gt;libsç›®å½•ï¼Œå°†soåº“æ”¾å…¥app-&gt;src-&gt;main-&gt;jinLibs<br><img src="https://upload-images.jianshu.io/upload_images/3468978-e6d758fb1916b250.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="s"><br>æ ¹æ®ä½ çš„éœ€è¦åœ¨jinLibsä¸­å»ºç«‹ä¸åŒçš„cpuæ¶æ„ç›®å½•ï¼Œä¸€èˆ¬åˆ›å»ºä¸€ä¸ªarmeabiå’Œarmeabi-v7aå°±å¯ä»¥äº†ï¼Œæ³¨æ„ä¸è¦å†™é”™ï¼ŒåŒæ—¶æ³¨æ„åœ¨gradleä¸­ç”³æ˜ä½ éœ€è¦çš„æ¶æ„ç±»å‹<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ndk&#123;</span><br><span class="line">      //åœ¨è¿™é‡ŒæŒ‡å®šéœ€è¦ç”Ÿæˆä»€ä¹ˆç±»å‹çš„so</span><br><span class="line">       abiFilters &quot;armeabi&quot;,&quot;armeabi-v7a&quot;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure></p>
<p>éƒ½é…ç½®å¥½åï¼Œé‡æ–°Sync Projectä¸‹é¡¹ç›®ï¼Œå°±èƒ½æ„‰å¿«çš„ä½¿ç”¨äº†ã€‚</p>
<p>åœ¨ä½¿ç”¨ä¸­ï¼Œæœ‰åŒå­¦ç»å¸¸ä¼šé‡åˆ°soåº“æ–‡ä»¶æ‰¾ä¸åˆ°çš„é—®é¢˜ï¼Œè¿™æ—¶ä½ å°±éœ€è¦æ£€æŸ¥ä½ çš„æ¶æ„ç›®å½•ä¸‹çš„soçš„æ•°é‡æ˜¯ä¸æ˜¯ç›¸åŒçš„ï¼Œåƒä¸‡ä¸è¦å‡ºç°å•ä¸ªç›®å½•æ²¡æœ‰çš„æƒ…å†µã€‚è¿™æ˜¯å› ä¸ºsoåº“éƒ½æ˜¯å‘ä¸‹å…¼å®¹ï¼Œå‡å¦‚ä¸€å°v7æ¶æ„çš„æ‰‹æœºï¼Œä½ æŠŠä¸¤ä¸ªéœ€è¦ä½¿ç”¨çš„soåº“éƒ½æ”¾åˆ°armeabiç›®å½•ä¸­ï¼Œæ²¡é—®é¢˜ï¼Œå› ä¸ºç³»ç»Ÿåœ¨v7ä¸­æ‰¾ä¸åˆ°ä¼šå»armeabiç›®å½•æ‰¾ã€‚ä½†æ˜¯å¦‚æœä½ å°†ä¸€ä¸ªsoæ”¾åˆ°armeabiå’Œarmeabi-v7aï¼Œå¦ä¸€ä¸ªåªæ”¾äº†åˆ°äº†armeabiï¼Œå½“ä¸€ä¸ªv7æ¶æ„çš„æ‰‹æœºä½¿ç”¨çš„æ—¶å€™ï¼Œå¦‚æœå‘ç°armeabi-v7ä¸­æ²¡æœ‰æ˜¯ä¸ä¼šå»armeabiä¸­æ‰¾çš„ï¼Œå› ä¸ºå¦ä¸€ä¸ªsoä¹Ÿæ”¾åˆ°äº†armeabi-v7ç›®å½•ä¸‹ï¼Œä»£è¡¨ä½ å…¼å®¹äº†armeabi-v7çš„æƒ…å†µï¼Œæ­¤æ—¶æ˜¯ä¸ä¼šå‘ä¸‹å…¼å®¹çš„ã€‚æ‰€ä»¥ï¼Œè§£å†³æ–¹æ¡ˆå°±æ˜¯è¦ä¹ˆåˆ é™¤v7é‡Œçš„so,è¦ä¹ˆæŠŠç¼ºå°‘çš„soè¡¥é½ã€‚</p>
]]></content>
      
        
    </entry>
    
    <entry>
      <title><![CDATA[å®‰å“å°ç™½ä¹‹ndkå…¥é—¨ç¯‡]]></title>
      <url>/androidndkstudyfirst.html</url>
      <content type="html"><![CDATA[<p><strong>ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºåšä¸»åŸåˆ›æ–‡ç« ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„(www.huangjie.name)ï¼Œä¿æŠ¤åŸåˆ›ï¼Œä»æˆ‘åšèµ·.</strong></p>
<hr>
<blockquote>
<p>æœ¬æ–‡æ˜¯æœ¬äººæ€»ç»“ndkçš„ä¸€ä¸ªå…¥é—¨ç¯‡ï¼Œå¸Œæœ›å¯¹å­¦ä¹ ndkçš„åŒå­¦æœ‰æ‰€å¸®åŠ©å“¦<br><a id="more"></a></p>
</blockquote>
<h4 id="1-ç¯å¢ƒæ­å»º"><a href="#1-ç¯å¢ƒæ­å»º" class="headerlink" title="1.ç¯å¢ƒæ­å»º"></a>1.ç¯å¢ƒæ­å»º</h4><p>å¼€å‘å·¥å…·ï¼šAndroidStudio<br>æ‰“å¼€AndroidStudioï¼Œè¿›å…¥<code>settings</code>,æ‰¾åˆ°<code>Android SDK</code>ç›®å½•ï¼Œç‚¹å‡»<code>SDK tools</code>ï¼Œåˆ†åˆ«æ‰¾åˆ°å¦‚å›¾ä¸‰ä¸ªé…ç½®ï¼Œå‹¾ä¸Šï¼Œä¸‹è½½ã€‚<br><img src="https://upload-images.jianshu.io/upload_images/3468978-d330db63b148bb2c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ç¯å¢ƒæ­å»º"><br>åˆ†åˆ«ä»‹ç»ä¸€ä¸‹ï¼š</p>
<ul>
<li>cmake<br>ç±»ä¼¼äºAndroid studioä¸­çš„gradle,æ˜¯å¯¹ndkçš„ä¸€ä¸ªé…ç½®ç®¡ç†</li>
<li>LLDB<br>c/c++çš„ä¸€ä¸ªè°ƒè¯•å·¥å…·ï¼Œå®‰è£…åå¯ä»¥å¯¹c/c++ä»£ç è¿›è¡Œdebug</li>
<li>NDK<br>ndkçš„å¼€å‘å·¥å…·åŒ…</li>
</ul>
<p>å®‰è£…å®Œæˆåï¼Œæ–°å»ºä¸€ä¸ªå·¥ç¨‹ï¼Œæ³¨æ„å‹¾é€‰ä¸‹æ–¹çš„<code>include c++ support</code>,ä¸€è·¯<code>next</code>ï¼Œç›´åˆ°é¡¹ç›®æ„å»ºå®Œæˆï¼Œè¿™æ ·ï¼Œæˆ‘ä»¬çš„æ•´ä½“çš„ndké¡¹ç›®å¼€å‘ç¯å¢ƒå°±é…ç½®å¥½äº†ã€‚</p>
<h4 id="2-é…ç½®æ–‡ä»¶ä»‹ç»"><a href="#2-é…ç½®æ–‡ä»¶ä»‹ç»" class="headerlink" title="2.é…ç½®æ–‡ä»¶ä»‹ç»"></a>2.é…ç½®æ–‡ä»¶ä»‹ç»</h4><p>é¡¹ç›®æ„å»ºå®Œæ¯•åï¼Œæˆ‘ä»¬ä¼šå‘ç°å¤šäº†é…ç½®å’Œæ–‡ä»¶ï¼Œå¦‚å›¾ï¼š<br><img src="https://upload-images.jianshu.io/upload_images/3468978-b0d32f23e2b25a5d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…ç½®"></p>
<p>å…ˆä»‹ç»ä¸€ä¸‹è¿™å‡ ä¸ªå‚æ•°çš„ä½œç”¨ï¼š<br>ç‚¹å¼€<code>CMakeLists.txt</code>ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"># For more information about using CMake with Android Studio, read the</span><br><span class="line"># documentation: https://d.android.com/studio/projects/add-native-code.html</span><br><span class="line"></span><br><span class="line"># Sets the minimum version of CMake required to build the native library.</span><br><span class="line"></span><br><span class="line">cmake_minimum_required(VERSION 3.4.1)</span><br><span class="line"></span><br><span class="line"># Creates and names a library, sets it as either STATIC</span><br><span class="line"># or SHARED, and provides the relative paths to its source code.</span><br><span class="line"># You can define multiple libraries, and CMake builds them for you.</span><br><span class="line"># Gradle automatically packages shared libraries with your APK.</span><br><span class="line"></span><br><span class="line"># é…ç½®soåº“ä¿¡æ¯</span><br><span class="line">add_library( # Sets the name of the library.</span><br><span class="line">            # ç”Ÿæˆçš„soåº“åç§°ï¼Œæ­¤å¤„ç”Ÿæˆçš„soæ–‡ä»¶åç§°æ˜¯libnative-lib.so</span><br><span class="line">             native-lib</span><br><span class="line"></span><br><span class="line">             # Sets the library as a shared library.</span><br><span class="line">             # STATICï¼šé™æ€åº“ï¼Œæ˜¯ç›®æ ‡æ–‡ä»¶çš„å½’æ¡£æ–‡ä»¶ï¼Œåœ¨é“¾æ¥å…¶å®ƒç›®æ ‡çš„æ—¶å€™ä½¿ç”¨</span><br><span class="line">             # SHAREDï¼šåŠ¨æ€åº“ï¼Œä¼šè¢«åŠ¨æ€é“¾æ¥ï¼Œåœ¨è¿è¡Œæ—¶è¢«åŠ è½½</span><br><span class="line">             # MODULEï¼šæ¨¡å—åº“ï¼Œæ˜¯ä¸ä¼šè¢«é“¾æ¥åˆ°å…¶å®ƒç›®æ ‡ä¸­çš„æ’ä»¶ï¼Œä½†æ˜¯å¯èƒ½ä¼šåœ¨è¿è¡Œæ—¶ä½¿ç”¨dlopen-ç³»åˆ—çš„å‡½æ•°åŠ¨æ€é“¾æ¥</span><br><span class="line">             SHARED</span><br><span class="line"></span><br><span class="line">             # Provides a relative path to your source file(s).</span><br><span class="line">             # èµ„æºæ–‡ä»¶ï¼Œå¯ä»¥å¤šä¸ªï¼Œ</span><br><span class="line">             # èµ„æºè·¯å¾„æ˜¯ç›¸å¯¹è·¯å¾„ï¼Œç›¸å¯¹äºæœ¬CMakeLists.txtæ‰€åœ¨ç›®å½•</span><br><span class="line">             src/main/cpp/native-lib.cpp )</span><br><span class="line"></span><br><span class="line"># Searches for a specified prebuilt library and stores the path as a</span><br><span class="line"># variable. Because CMake includes system libraries in the search path by</span><br><span class="line"># default, you only need to specify the name of the public NDK library</span><br><span class="line"># you want to add. CMake verifies that the library exists before</span><br><span class="line"># completing its build.</span><br><span class="line"></span><br><span class="line"># ä»ç³»ç»ŸæŸ¥æ‰¾ä¾èµ–åº“</span><br><span class="line">find_library( # Sets the name of the path variable.</span><br><span class="line">              # androidç³»ç»Ÿæ¯ä¸ªç±»å‹çš„åº“ä¼šå­˜æ”¾ä¸€ä¸ªç‰¹å®šçš„ä½ç½®ï¼Œè€Œlogåº“å­˜æ”¾åœ¨log-libä¸­</span><br><span class="line">              log-lib</span><br><span class="line"></span><br><span class="line">              # Specifies the name of the NDK library that</span><br><span class="line">              # you want CMake to locate.</span><br><span class="line">              # androidç³»ç»Ÿåœ¨cç¯å¢ƒä¸‹æ‰“logåˆ°logcatçš„åº“</span><br><span class="line">              log )</span><br><span class="line"></span><br><span class="line"># Specifies libraries CMake should link to your target library. You</span><br><span class="line"># can link multiple libraries, such as libraries you define in this</span><br><span class="line"># build script, prebuilt third-party libraries, or system libraries.</span><br><span class="line"></span><br><span class="line"># é…ç½®åº“çš„é“¾æ¥ï¼ˆä¾èµ–å…³ç³»ï¼‰</span><br><span class="line">target_link_libraries( # Specifies the target library.</span><br><span class="line"></span><br><span class="line">                       # ç›®æ ‡åº“</span><br><span class="line">                       native-lib</span><br><span class="line"></span><br><span class="line">                       # Links the target library to the log library</span><br><span class="line">                       # included in the NDK.</span><br><span class="line">                       # ä¾èµ–äº</span><br><span class="line">                       $&#123;log-lib&#125; )</span><br></pre></td></tr></table></figure></p>
<p>çœ‹æ³¨é‡Šå°±èƒ½æ˜ç™½æ¯ä¸ªæ–¹æ³•å‚æ•°ä»£è¡¨ä»€ä¹ˆæ„æ€äº†ï¼Œå¦‚æœä½ è§‰å¾—é‡Œé¢æ³¨é‡Šå¤ªå¤šï¼Œçœ‹èµ·æ¥ä¸æ˜¯å¾ˆé¡ºçœ¼ï¼Œå¯ä»¥ä¸‹è½½<code>CMake simple highligher</code>æ’ä»¶æ¥æé«˜ä»£ç äº®åº¦<br><img src="https://upload-images.jianshu.io/upload_images/3468978-3a20de031b648789.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="cmakehigh.png"><br><img src="https://upload-images.jianshu.io/upload_images/3468978-b01cf2af3cc17232.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="æ•ˆæœå›¾"><br>å…³äºcmakeçš„é…ç½®è¿˜æœ‰è®¸å¤šï¼Œè¿™é‡Œåªæ˜¯å…ˆç®€å•ä»‹ç»ä¸€ä¸ªã€‚<br>æˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸‹build.gradleä¸­çš„é…ç½®æ–¹æ³•çš„ä½œç”¨,åœ¨<code>defultConfig</code>ä¸­æœ‰ä¸ªè¿™ä¸ªå‚æ•°ï¼Œ<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">externalNativeBuild &#123;</span><br><span class="line">           cmake &#123;</span><br><span class="line">               cppFlags &quot;&quot;</span><br><span class="line">                abiFilters &apos;armeabi&apos;,&apos;arm64-v8a&apos;, &apos;armeabi-v7a&apos;, &apos;x86&apos;, &apos;x86_64&apos;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br></pre></td></tr></table></figure></p>
<p>æˆ‘ä»¬ä¸»è¦å…³æ³¨ <code>abiFilters</code>ï¼Œå®ƒæ˜¯ç”¨æ¥è®¾ç½®ç¼–è¯‘ç”Ÿæˆä»€ä¹ˆç±»å‹çš„soçš„ï¼Œæˆ‘ä»¬çš„cupæ¶æ„ä¸»è¦æœ‰ä»¥ä¸‹å‡ ç§:</p>
<ul>
<li>armeabi</li>
<li>armeabi-v7a</li>
<li>arm64-v8a</li>
<li>x86</li>
<li>x86_64</li>
<li>mips</li>
<li>mips_64<br>å…¶ä¸­ï¼Œ<code>armeabi-v7a</code>æ˜¯ç›®å‰å¤§éƒ¨åˆ†æ‰‹æœºçš„ä¸»æµæ¶æ„ï¼Œå®ƒæ˜¯åŸºäº<code>armeabi</code>çš„ä¸€ç§å‡çº§æ¶æ„ï¼Œå› æ­¤ï¼Œå®ƒä»¬æ˜¯äº’ç›¸å…¼å®¹çš„ï¼Œä½†ç›®å‰å„æ‰‹æœºå‚å•†çš„æ——èˆ°çº§ï¼Œéƒ½å·²ç»å¼€å§‹é‡‡ç”¨<code>arm64-v8a</code>çš„cpu,ä¸è¿‡ä¸è¦æ…Œï¼Œå®ƒä¹Ÿæ˜¯å…¼å®¹<code>armeabi</code>çš„ï¼Œæ‰€ä»¥ï¼Œå¦‚æœæˆ‘ä»¬åªéœ€è¦å¼€å‘æ™®é€šåº”ç”¨çš„è¯ï¼Œæˆ‘ä»¬åªéœ€è¦å…³æ³¨<code>armeabi</code>å’Œ<code>armeabi-v7a</code>å°±å¯ä»¥äº†ï¼Œè€Œåƒ<code>x86</code>ç­‰è¿™ç§ç±»å‹çš„æ¶æ„å¤šç”¨äºå¹³æ¿ç­‰è®¾å¤‡ï¼Œå› æ­¤æˆ‘ä»¬åªéœ€è¦äº†è§£å³å¯ã€‚<br>ä¸æ­¤ç›¸åŒçš„è¿˜æœ‰ä¸€ä¸ªé…ç½®ï¼š<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ndk&#123;</span><br><span class="line">            abiFilters &quot;armeabi&quot;,&quot;armeabi-v7a&quot;</span><br><span class="line">       &#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>å®ƒä¹Ÿæ˜¯ç”¨æ¥é…ç½®éœ€è¦ä»€ä¹ˆç±»å‹çš„soçš„ï¼Œä½†å®ƒæ˜¯è´Ÿè´£æ‰“åŒ…åˆ°apké‡Œæœ‰ä»€ä¹ˆç±»å‹çš„so,è€Œä¸æ˜¯ç¼–è¯‘å‡ºä»€ä¹ˆso,ä¸¤è€…è¿˜æ˜¯æœ‰åŒºåˆ«çš„ã€‚ä¾‹å¦‚æˆ‘åœ¨<code>cmake</code>é‡Œè®¾ç½®ä¸€ä¸ª â€œarmeabiâ€,â€armeabi-v7aâ€ï¼Œåœ¨<code>ndk</code>é‡Œè®¾ç½®ä¸€ä¸ªarmeabiï¼Œæˆ‘<code>make project</code>ä¸€ä¸‹ï¼Œå®ƒä¼šç”Ÿæˆä¸¤ä¸ªcpuç±»å‹çš„so,ä½†æ˜¯æˆ‘è¿è¡Œæ‰“åŒ…apkï¼Œåœ¨apkçš„libç›®å½•é‡Œå°±åªæœ‰ä¸€ä¸ªarmeabiçš„soäº†ï¼Œæ‰€ä»¥ï¼š<br>å½“æˆ‘ä»¬ä¸éœ€è¦ç¼–è¯‘soåº“æ—¶ï¼Œä¾‹å¦‚å¼•ç”¨çš„ç¬¬ä¸‰æ–¹åº“ï¼Œå¯ä»¥ä½¿ç”¨<code>ndk</code>æ¥è¿‡æ»¤ï¼Œå®Œå…¨ä¸éœ€è¦<code>cmake</code><br>æ¥ä¸‹æ¥è¯´ä¸€ä¸‹<code>android</code>ä¸‹çš„æ–¹æ³•ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">externalNativeBuild &#123;</span><br><span class="line">        cmake &#123;</span><br><span class="line">            path &quot;CMakeLists.txt&quot;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<p>å…¶å®å¾ˆæ˜¾ç„¶ï¼Œå®ƒå°±æ˜¯æŒ‡å®šæˆ‘ä»¬çš„<code>CMakeLists</code>æ–‡ä»¶è·¯å¾„çš„ï¼Œå½“ç„¶æˆ‘ä»¬çš„è¿™ä¸ªè·¯å¾„æ˜¯å¯ä»¥æ›´æ”¹çš„ã€‚<br>è¿™é‡Œæ•™å¤§å®¶ä¸€ä¸ªå°æŠ€å·§ï¼Œåœ¨cmdä¸­æ‰§è¡Œï¼š<code>adb shell</code> <code>cat  /proc/cpuinfo</code>å¯ä»¥æŸ¥çœ‹å½“å‰æ‰‹æœºçš„cpuæ¶æ„å“¦ï¼Œæ•ˆæœå›¾å¦‚ä¸‹ï¼š<br><img src="https://upload-images.jianshu.io/upload_images/3468978-13a9d77a060d8557.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="adb"><br><code>CPU architecture: 8</code>è¯´æ˜æˆ‘çš„æ‰‹æœºæ˜¯<code>arm64-v8a</code>æ¶æ„</p>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬æ¥çœ‹cppæ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶æ˜¯å¹²å˜›çš„å‘¢ï¼Œå®ƒæ˜¯cé‡Œ.hæ–‡ä»¶çš„å®ç°çš„æºæ–‡ä»¶ï¼Œä½ å¯ä»¥æŠŠå®ƒçœ‹ä½œæ˜¯ä¸javaäº¤äº’çš„æ¡¥æ¢ï¼Œé‡Œé¢åŒ…å«äº†javaå±‚éœ€è¦è°ƒç”¨åˆ°çš„å‡½æ•°æ–¹æ³•ï¼Œç‚¹å¼€å¯ä»¥çœ‹åˆ°ä»¥ä¸‹å‡½æ•°ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;jni.h&gt;</span><br><span class="line">#include &lt;string&gt;</span><br><span class="line"></span><br><span class="line">extern &quot;C&quot; JNIEXPORT jstring JNICALL</span><br><span class="line">Java_com_jie_ndkdemo_MainActivity_stringFromJNI(</span><br><span class="line">        JNIEnv *env,</span><br><span class="line">        jobject /* this */) &#123;</span><br><span class="line">    std::string hello = &quot;Hello from C++&quot;;</span><br><span class="line">    return env-&gt;NewStringUTF(hello.c_str());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>ä¸»è¦æ˜¯çœ‹è¿™ä¸ªå‡½æ•°ï¼š<br><code>Java_com_jie_ndkdemo_MainActivity_stringFromJNI</code>,å®ƒæ˜¯æœ‰æ ¼å¼è¦æ±‚çš„ï¼Œç”±Java<em>åŒ…å</em>ç±»å_å‡½æ•°åç»„æˆï¼Œå®šä¹‰çš„æ—¶å€™ä¸€å®šè¦æŒ‰ç…§è¿™ä¸ªæ ¼å¼æ¥ï¼Œå…¶ä¸­ï¼Œ<code>MainActivity</code>æ˜¯æˆ‘å£°æ˜nativeæ–¹æ³•çš„ç±»çš„ç±»åã€‚</p>
]]></content>
      
        <categories>
            
            <category> ndk </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Android </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Kotliné«˜é˜¶å‡½æ•°ä½¿ç”¨(äºŒ)]]></title>
      <url>/kotlin-%E9%AB%98%E9%98%B6%E5%87%BD%E6%95%B0%E7%9A%84%E4%BD%BF%E7%94%A8.html</url>
      <content type="html"><![CDATA[<p><strong>ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºåšä¸»åŸåˆ›æ–‡ç« ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„(www.huangjie.name)ï¼Œä¿æŠ¤åŸåˆ›ï¼Œä»æˆ‘åšèµ·.</strong></p>
<hr>
<blockquote>
<p>ä¸Šä¸€ç¯‡æ–‡ç« å¸¦å¤§å®¶è®¤è¯†åˆ°äº†ä»€ä¹ˆæ˜¯é«˜é˜¶å‡½æ•°ï¼Œé‚£è¿™ä¸€ç« å°±å¸¦å¤§å®¶çœ‹çœ‹é«˜é˜¶å‡½æ•°çš„å®é™…ä½¿ç”¨åœºæ™¯å§</p>
</blockquote>
<a id="more"></a>
<h4 id="æé—®"><a href="#æé—®" class="headerlink" title="æé—®"></a>æé—®</h4><p>æˆ‘ä»¬æƒ³ä¸€æƒ³ï¼Œé«˜é˜¶å‡½æ•°å¸¦ç»™æˆ‘ä»¬çš„æ˜¯ä»€ä¹ˆï¼Œæˆ‘ä»¬ä¸ºä»€ä¹ˆè¦ä½¿ç”¨å®ƒå‘¢ï¼Ÿå› ä¸ºä»–å¯ä»¥è®©æˆ‘ä»¬çš„æ–¹æ³•æ›´ç®€å•é«˜æ•ˆï¼Œèƒ½å»æ‰å†—ä½™çš„æ ·æ¿ä»£ç ï¼Œè®©æˆ‘ä»¬å…³æ³¨çš„é€»è¾‘æ›´æ¸…æ™°çš„å±•ç°åœ¨æˆ‘ä»¬çš„é¢å‰ï¼Œæ‰€ä»¥é«˜é˜¶å‡½æ•°ä¸€å®šæ˜¯ç”¨åœ¨æˆ‘ä»¬çš„æ–¹æ³•å®ç°ä¸Šï¼Œè€Œå®˜æ–¹apiå…¶å®å·²ç»å°†æˆ‘ä»¬å¸¸ç”¨çš„å¿«æ·æ“ä½œç”¨é«˜é˜¶å‡½æ•°ç»™å°è£…å¥½äº†ï¼Œæ¯”å¦‚<code>with</code>,<code>apply</code>ç­‰æ“ä½œç¬¦ï¼Œæ‰€ä»¥å‰©ä¸‹çš„å°±æ˜¯æ¥å£è°ƒç”¨äº†ã€‚</p>
<p>ä¸çŸ¥é“å¤§å®¶ç”¨Kotlinå®ç°è¿‡OnClickListeneræ¥å£æ²¡æœ‰ï¼Œæœ‰3ç§å†™æ³•ï¼š</p>
<p>é’é“œç‰ˆ:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">view.setOnClickListener(object :View.OnClickListener&#123;</span><br><span class="line">           override fun onClick(v: View?) &#123;</span><br><span class="line">                 //å•Šï¼æˆ‘è¢«ç‚¹å‡»äº†</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;)</span><br></pre></td></tr></table></figure></p>
<p>é»„é‡‘ç‰ˆ<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">view.setOnClickListener &#123; v -&gt;</span><br><span class="line">            &#123;</span><br><span class="line">                //å•Šï¼æˆ‘è¢«ç‚¹å‡»äº†  </span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure></p>
<p>é’»çŸ³ç‰ˆ<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">view.setOnClickListener &#123;</span><br><span class="line">               //å•Šï¼æˆ‘è¢«ç‚¹å‡»äº†  </span><br><span class="line">       &#125;</span><br></pre></td></tr></table></figure></p>
<p>æˆ‘ä»¬ä¸€å¯¹æ¯”å‘ç°ï¼Œä»£ç æ˜¯ä¸€æ­¥ä¸€æ­¥è¢«çœç•¥çš„ï¼Œé¦–å…ˆæ˜¯çœç•¥äº†æ¥å£å£°æ˜(è½¬åŒ–ä¸ºäº†lambda)ï¼Œå…¶æ¬¡æ˜¯çœç•¥äº†lambdaçš„èŠ±æ‹¬å·(Kotlinçš„ç‰¹æ€§ï¼Œå½“å‚æ•°åªæœ‰ä¸€ä¸ªlambdaå‚æ•°çš„æ—¶å€™ï¼Œæ‹¬å·å¯ä»¥çœç•¥),æ‰€ä»¥æˆ‘ä»¬è¦å®ç°çš„æ˜¯å¦‚ä½•å°†æ¥å£å£°æ˜è½¬åŒ–ä¸ºlambda,å“ˆå“ˆï¼Œè¿™ä¸æ­£æ˜¯æˆ‘ä»¬é«˜é˜¶å‡½æ•°æ‰€æ“…é•¿çš„å—</p>
<h4 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h4><p>è™½ç„¶æˆ‘ä»¬ä¸èƒ½ç›´æ¥çœ‹åˆ°kotlinå†…éƒ¨çš„é«˜é˜¶å‡½æ•°çš„å®ç°æ–¹å¼ï¼Œä½†æ˜¯æˆ‘ä»¬æŒ‰ä½<code>ctrl</code>é”®å°†é¼ æ ‡ç§»åˆ°æ–¹æ³•ä¸Šæ˜¯å¯ä»¥çœ‹åˆ°é«˜é˜¶å‡½æ•°çš„å£°æ˜æ–¹å¼çš„ï¼Œå¦‚ä½ æ‰€è§æ˜¯è¿™æ ·çš„ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">public final fun setOnClickListener( l: ((v: View!) â†’ Unit)! ): Unit</span><br></pre></td></tr></table></figure></p>
<p>çœ‹è¿‡æˆ‘ä¸Šç¯‡æ–‡ç« çš„ä¸€çœ¼å°±èƒ½çœ‹æ˜ç™½ï¼Œè¿™æ˜¯å£°æ˜äº†ä¸€ä¸ªä»¥viewä¸ºå‚æ•°çš„æ— è¿”å›å€¼çš„é«˜é˜¶å‡½æ•°ï¼Œä½†ä»–æ˜¯å¦‚ä½•å®ç°çš„å‘¢ï¼Œè¯·çœ‹ä»¥ä¸‹ä»£ç ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">public final fun setOnClickListener( l: ((v: View!) â†’ Unit)! ): Unit&#123;</span><br><span class="line">    //å°†æ¥å£å®ç°å¹¶èµ‹å€¼ç»™å…¨å±€å˜é‡æ¥å£æ–¹ä¾¿æ¥å£æ–¹æ³•è°ƒç”¨</span><br><span class="line">    mOnClickListener = object :View.OnClickListener&#123;</span><br><span class="line">                  override fun onClick(v: View?) &#123;</span><br><span class="line">                           l.invoke(v) //å…³é”®æ˜¯è¿™å¥</span><br><span class="line">                  &#125;</span><br><span class="line">              &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>åŸç†å°±æ˜¯å†…éƒ¨å°†æ¥å£ç»™å®ä¾‹åŒ–ï¼Œç„¶åå°†é€»è¾‘é€šè¿‡invokeæ–¹æ³•ä»£ç†å‡ºå»ï¼Œè¿™æ ·æˆ‘ä»¬ç‚¹å‡»äº‹ä»¶å†…éƒ¨å°±ä¼šèµ°invokeæ–¹æ³•å•¦ã€‚è€Œinvokeå®é™…æ˜¯ä¸€ä¸ªæ¥å£(ç¿»è¯‘æˆjavaä»£ç ä½ å°±æ˜ç™½å•¦),æ‰€ä»¥æˆ‘ä»¬åœ¨æ–¹æ³•å¤–é¢å®ç°çš„å…¶å®æ˜¯invokeçš„æ¥å£å®ç°é€»è¾‘ï¼Œæ³¨æ„ï¼Œè¿™ç§æ¥å£çš„å®ç°æ–¹å¼åªèƒ½åœ¨æ¥å£åªæœ‰ä¸€ä¸ªæ–¹æ³•çš„æ—¶å€™å“¦ï¼Œå› ä¸ºinvokeåªæœ‰ä¸€ä¸ªï¼Œå“ˆå“ˆï¼Œæ€ä¹ˆæ ·ï¼ŒsetOnClickListenerçš„å¤„ç†é€»è¾‘å°ä¼™ä¼´ä»¬æ˜ç™½äº†å—ï¼Œä¸¾ä¸€åä¸‰çš„äº‹æƒ…å°±äº¤ç»™å„ä½å‹¤å¥‹çš„å°ä¼™ä¼´äº†.</p>
]]></content>
      
        <categories>
            
            <category> Kotlin </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Android </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Kotliné«˜é˜¶å‡½æ•°ä½¿ç”¨(ä¸€)]]></title>
      <url>/Kotlin-Higher-order-function1.html</url>
      <content type="html"><![CDATA[<p><strong>ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºåšä¸»åŸåˆ›æ–‡ç« ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„(www.huangjie.name)ï¼Œä¿æŠ¤åŸåˆ›ï¼Œä»æˆ‘åšèµ·.</strong></p>
<hr>
<blockquote>
<p>ç”¨è¿‡Kotlinçš„åŒå­¦éƒ½çŸ¥é“ï¼Œé‚£äº›æ‰©å±•æ–¹æ³•ç”¨èµ·æ¥ç®€ç›´ä¸è¦å¤ªçˆ½ï¼Œé‚£ä¹ˆè¿™äº›æ‰©å±•æ–¹æ³•æ˜¯æ€ä¹ˆå®šä¹‰å®ç°çš„å‘¢ï¼Œæœ¬æ–‡ä»‹ç»äº†Kotliné«˜é˜¶å‡½æ•°çš„ä½¿ç”¨,å¸¦ä½ å®ç°è‡ªå·±çš„è¶…æºœæ‰©å±•æ–¹æ³•ï¼Œå¹¶ä¸”èƒ½è®©ä½ èƒ½çœ‹æ‡‚æ‰©å±•æ–¹æ³•æºç ï¼Œé˜…è¯»æœ¬æ–‡éœ€è¦æœ‰ä¸€å®šçš„KotlinåŸºç¡€ï¼Œè¯·è°¨æ…é˜…è¯».</p>
</blockquote>
<a id="more"></a>
<h4 id="1-å®šä¹‰-ä»€ä¹ˆæ˜¯é«˜é˜¶å‡½æ•°"><a href="#1-å®šä¹‰-ä»€ä¹ˆæ˜¯é«˜é˜¶å‡½æ•°" class="headerlink" title="1.å®šä¹‰:ä»€ä¹ˆæ˜¯é«˜é˜¶å‡½æ•°"></a>1.å®šä¹‰:ä»€ä¹ˆæ˜¯é«˜é˜¶å‡½æ•°</h4><p>é«˜é˜¶å‡½æ•°å°±æ˜¯ä»¥å¦ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°æˆ–è¿”å›å€¼çš„å‡½æ•°ï¼ŒKotlinå¯ä»¥ä»¥lambdaæˆ–å‚æ•°å¼•ç”¨ä½œä¸ºå‚æ•°æˆ–è¿”å›å€¼ï¼Œæ‰€ä»¥ï¼Œä»»ä½•ä»¥lambdaæˆ–å‡½æ•°å¼•ç”¨ä½œä¸ºå‚æ•°æˆ–è¿”å›å€¼çš„éƒ½æ˜¯é«˜é˜¶å‡½æ•°</p>
<h4 id="2-å‡½æ•°ç±»å‹"><a href="#2-å‡½æ•°ç±»å‹" class="headerlink" title="2.å‡½æ•°ç±»å‹"></a>2.å‡½æ•°ç±»å‹</h4><p>è¦ä½¿ç”¨Kotlinçš„é«˜é˜¶å‡½æ•°å°±å¿…é¡»éµå¾ªå®ƒçš„å‡½æ•°ç±»å‹<br>å…ˆæ¥çœ‹ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œè¿™æ˜¯ä¸€ä¸ªç®€å•çš„å‡½æ•°ç±»å‹ç”³æ˜<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">val sum = &#123; x: Int, y: Int -&gt; x + y &#125;</span><br></pre></td></tr></table></figure></p>
<p>ä¹‹æ‰€ä»¥èƒ½è¿™ä¹ˆå†™å¾—ç›ŠäºKotlinçš„ç±»å‹æ¨å¯¼ï¼Œå®ƒçš„æ˜¾ç¤ºå†™æ³•æ˜¯è¿™æ ·çš„ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var sum:(Int,Int)-&gt; Int = &#123;x , y-&gt; x + y&#125;</span><br></pre></td></tr></table></figure></p>
<p><code>(Int,Int)</code>æ˜¯å‚æ•°ç±»å‹ï¼Œ<code>-&gt;</code>åé¢çš„å€¼<code>Int</code>æ˜¯è¿”å›ç±»å‹,ç»„åˆåœ¨ä¸€èµ·å°±æ„æˆäº†ä¸€ä¸ªå‡½æ•°ç±»å‹,ä»¥ä¸Šå±äºæœ‰å‚æœ‰è¿”å›å€¼ç±»å‹ï¼Œä¸‹é¢åˆ—ä¸¾å…¶ä»–å‡ ç§ç±»å‹</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">var action:() -&gt;Unit = &#123;&#125; //æ— å‚æ— è¿”å›å€¼</span><br><span class="line">var a = &#123;&#125; //ç±»å‹æ¨å¯¼åçš„ç®€åŒ–å†™æ³•</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var action:(Int) -&gt;Unit = &#123;&#125; //æœ‰å‚æ— è¿”å›å€¼</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var action:() -&gt; Int = &#123;&#125; //æ— å‚æœ‰è¿”å›å€¼</span><br></pre></td></tr></table></figure>
<h4 id="3-ä½¿ç”¨é«˜é˜¶å‡½æ•°-å°†å‡½æ•°ç±»å‹ä½œä¸ºå‚æ•°"><a href="#3-ä½¿ç”¨é«˜é˜¶å‡½æ•°-å°†å‡½æ•°ç±»å‹ä½œä¸ºå‚æ•°" class="headerlink" title="3.ä½¿ç”¨é«˜é˜¶å‡½æ•°(å°†å‡½æ•°ç±»å‹ä½œä¸ºå‚æ•°)"></a>3.ä½¿ç”¨é«˜é˜¶å‡½æ•°(å°†å‡½æ•°ç±»å‹ä½œä¸ºå‚æ•°)</h4><p>ç›´æ¥çœ‹ä»£ç <br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"> fun getNumResult(result: (Int, Int) -&gt; Int): Int &#123;</span><br><span class="line">        return result(1,2)                                                                                                                       </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">//è°ƒç”¨</span><br><span class="line">var value = getNumResult&#123; a, b -&gt; a + b &#125;</span><br><span class="line">==&gt; value = 3</span><br><span class="line"></span><br><span class="line">var value = getNumResult&#123; a, b -&gt; a * b &#125;</span><br><span class="line">==&gt; value = 2</span><br></pre></td></tr></table></figure></p>
<p>ä¾ç…§å‡½æ•°ç±»å‹æ‰€ç¤ºï¼Œaå’Œbå¯¹åº”ä¸¤ä¸ªIntç±»å‹çš„å‚æ•°ï¼Œè¿™ä¸ªåç§°å¯ä»¥ä»»æ„å®šä¹‰ï¼Œa+bä¸ºè¿”å›å€¼ï¼Œéšåreturn äº†ä¸€ä¸ªlambdaçš„è¿”å›å€¼ï¼Œçœ‹èµ·æ¥æ˜¯ä¸æ˜¯å¾ˆå¼ºå¤§,è€Œä¸”ä¾ç…§Kotlinçš„ç‰¹æ€§ï¼Œå½“å‚æ•°åªæœ‰ä¸€ä¸ªlambdaå‚æ•°çš„æ—¶å€™ï¼Œæ‹¬å·å¯ä»¥çœç•¥ï¼Œå› æ­¤å°±å˜æˆäº†å®ä¾‹ä¸­çš„é‚£æ ·ç®€æ´çš„è°ƒç”¨</p>
<p>åƒKotlinä¸­çš„filterç­‰æ“ä½œç¬¦ï¼Œéƒ½æ˜¯è¿™æ ·å®šä¹‰å®ç°çš„ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥ç ”ç©¶ä¸‹</p>
<p>çœ‹åˆ°è¿™é‡Œï¼Œå¯èƒ½æœ‰åŒå­¦ä¼šé—®äº†ï¼ŒKotlinä¸æ˜¯å·ç§°ä¸JAVAå…¼å®¹å—ï¼Œé‚£å†Javaä¸­å¦‚ä½•è°ƒç”¨å‘¢ï¼Œè¿™å°±è¦ä»Kotlinå‡½æ•°çš„ç”ŸæˆåŸç†è¯´èµ·äº†ï¼ŒKotlinçš„è¿™äº›å‡½æ•°ç±»å‹å…¶å®ä¼šè¢«ç”³æ˜æˆæ™®é€šçš„æ¥å£ï¼Œä¸€ä¸ªå‡½æ•°ç±»å‹çš„å‚æ•°å°±ä¼šå˜æˆFunction1çš„å®ç°ï¼ŒNä¸ªå‡½æ•°ç±»å‹çš„å‚æ•°å°±æ˜¯FunctionNï¼Œè¿™ä¸ªæ¥å£å®šä¹‰äº†ä¸€ä¸ªinvokeæ–¹æ³•ï¼Œè°ƒç”¨è¯¥æ–¹æ³•å°±ä¼šæ‰§è¡Œå‡½æ•°ï¼ŒSo,æˆ‘ä»¬å¯ä»¥è¿™ä¹ˆå†™:</p>
<p>Java8: å› ä¸ºæ”¯æŒlambdaï¼Œæ‰€ä»¥ä¾æ—§å¯ä»¥è¿™æ ·å†™<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">int value = getNumResult(a ,b - &gt;a + b);</span><br></pre></td></tr></table></figure></p>
<p>Java8ä»¥ä¸‹ç‰ˆæœ¬<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">int value = getNumResult(</span><br><span class="line">    new Function2&lt;Integer, Integer, Integer&gt;() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public Integer invoke(Integer a, Integer b) &#123;</span><br><span class="line">                return a + b;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure></p>
<p>æ³¨æ„ï¼Œå¦‚æœå®šä¹‰çš„è¿”å›å€¼æ˜¯Unit,ä¾‹å¦‚forEaché«˜é˜¶å‡½æ•°ï¼Œåœ¨Javaä¸­å°±å¿…é¡»æ˜¾ç¤ºè¿”å›ä¸€ä¸ªUnitå¯¹è±¡,å› ä¸ºUnitæ˜¯ä¸€ä¸ªå•ä¾‹å¯¹è±¡ï¼Œå› æ­¤å¯ä»¥è¿™æ ·å®šä¹‰è¿”å›<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">return Unit.INSTANCEï¼›</span><br></pre></td></tr></table></figure></p>
<h4 id="4-ä½¿ç”¨é«˜é˜¶å‡½æ•°-å°†å‡½æ•°ç±»å‹ä½œä¸ºè¿”å›å€¼"><a href="#4-ä½¿ç”¨é«˜é˜¶å‡½æ•°-å°†å‡½æ•°ç±»å‹ä½œä¸ºè¿”å›å€¼" class="headerlink" title="4.ä½¿ç”¨é«˜é˜¶å‡½æ•°(å°†å‡½æ•°ç±»å‹ä½œä¸ºè¿”å›å€¼)"></a>4.ä½¿ç”¨é«˜é˜¶å‡½æ•°(å°†å‡½æ•°ç±»å‹ä½œä¸ºè¿”å›å€¼)</h4><p>é¡¾åæ€ä¹‰ï¼Œç›¸ä¿¡åŒå­¦ä»¬æŠŠä½œä¸ºå‚æ•°çš„é«˜é˜¶å‡½æ•°ç†è§£é€äº†è¿™ä¸ªå¾ˆå¥½ç†è§£ï¼Œç¤ºä¾‹å¦‚ä¸‹:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">//å®šä¹‰ä¸€ä¸ªç±»ç”¨äºè£…è½½å‚æ•°</span><br><span class="line">class Num(var num: Int)</span><br><span class="line"></span><br><span class="line">//æ­¤æ–¹æ³•çš„ä½œç”¨æ˜¯å¦‚æœtypeç­‰äº1ï¼Œé‚£ä¹ˆå°±ä»Numç±»ä¸­å–å‡ºnumè¿›è¡Œä¹˜æ³•æ“ä½œï¼Œå¦‚æœä¸ç­‰äºä¸€ï¼Œå°±è¿›è¡Œç›¸åŠ æ“ä½œ</span><br><span class="line">    fun getNum(type: Int): (Num) -&gt; Int &#123;</span><br><span class="line">        if (type == 1) &#123;</span><br><span class="line">          //è¿™æ˜¯ä¸€ç§å†™æ³•</span><br><span class="line">            return &#123; entity -&gt;</span><br><span class="line">                entity.num * entity.num</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">         //è¿™æ˜¯å¦ä¸€ç§ç®€å†™ï¼Œå¯ä»¥ç”¨itä»£æ›¿entityå‚æ•°</span><br><span class="line">            return &#123;</span><br><span class="line">                it.num + it.num</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">ä½¿ç”¨:</span><br><span class="line">var ride = getNum(1) //ä¼ é€’ä¸€ä¸ª1è¿›å»ä»£è¡¨ä½¿ç”¨ä¹˜æ³•</span><br><span class="line">var result = ride(Num(3)) //å¾—åˆ°ä¸€ä¸ªä»¥Numä½œä¸ºå‚æ•°çš„é«˜é˜¶å‡½æ•°</span><br><span class="line">==&gt; result = 9</span><br><span class="line"></span><br><span class="line">var sum = getNum(2)</span><br><span class="line">var result = sum(Num(3))</span><br><span class="line">==&gt; result = 6</span><br></pre></td></tr></table></figure>
]]></content>
      
        <categories>
            
            <category> Kotlin </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Android </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[gitlabåŠ jitpackæ­å»ºå…è´¹ç§æœ‰ä¾èµ–åº“]]></title>
      <url>/gitlabab-jitpack%E7%A7%81%E6%9C%89%E4%BE%9D%E8%B5%96%E5%BA%93%E6%90%AD%E5%BB%BA.html</url>
      <content type="html"><![CDATA[<p><strong>ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºåšä¸»åŸåˆ›æ–‡ç« ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„(www.huangjie.name)ï¼Œä¿æŠ¤åŸåˆ›ï¼Œä»æˆ‘åšèµ·.</strong></p>
<hr>
<blockquote>
<p>ä¸€ç›´æƒ³ä¸ºå…¬å¸é¡¹ç›®æ­å»ºä¸€ä¸ªä¾èµ–åº“ï¼Œå¯ä»¥ç›´æ¥åƒå¼•å…¥ç¬¬ä¸‰æ–¹å¼€æºé¡¹ç›®ä¸€æ ·å»å¼•ç”¨å®ƒï¼Œæ–¹ä¾¿é›†æˆåˆ°å…¶ä»–çš„é¡¹ç›®ä¸­å»ï¼Œè¶ç€è¿™ä¸ªå‘¨æœ«å°†å‡ å¤§ä¾èµ–åº“å¹³å°éƒ½ç ”ç©¶äº†ä¸€ç•ªï¼Œé¡ºä¾¿åšä¸€ä¸ªæ€»ç»“<br><a id="more"></a></p>
</blockquote>
<h4 id="é€‰æ‹©æ‰˜ç®¡å¹³å°"><a href="#é€‰æ‹©æ‰˜ç®¡å¹³å°" class="headerlink" title="é€‰æ‹©æ‰˜ç®¡å¹³å°"></a>é€‰æ‹©æ‰˜ç®¡å¹³å°</h4><p> æ­å»ºå…¬å¸ä¾èµ–åº“çš„å‰ææ˜¯é¡¹ç›®éå…¬å¼€ï¼Œå¿…é¡»èƒ½æ‰˜ç®¡ç§æœ‰é¡¹ç›®ï¼ŒåŒæ—¶éœ€è¦å…è´¹ï¼Œå¯¹æ¯”ç°åœ¨æ¯”è¾ƒç«çš„åªæœ‰ä¸¤ä¸ªï¼š</p>
<ul>
<li><a href="https://gitlab.com" target="_blank" rel="noopener">gitlab</a></li>
</ul>
<pre><code>GitLab æ˜¯ä¸€ä¸ªç”¨äºä»“åº“ç®¡ç†ç³»ç»Ÿçš„å¼€æºé¡¹ç›®ï¼Œä½¿ç”¨Gitä½œä¸ºä»£ç ç®¡ç†å·¥å…·ï¼Œå¹¶åœ¨æ­¤åŸºç¡€ä¸Šæ­å»ºèµ·æ¥çš„webæœåŠ¡ã€‚å®‰è£…æ–¹æ³•æ˜¯å‚è€ƒGitLabåœ¨GitHubä¸Šçš„Wikié¡µé¢ã€‚
</code></pre><ul>
<li><a href="https://coding.net/" target="_blank" rel="noopener">Coding</a></li>
</ul>
<pre><code>æœ‰äººè¯´Codingå°±æ˜¯ä¸­å›½çš„github,ä½†ä»æœ€è¿‘çš„äº§å“æ¼”å˜æ–¹å‘çœ‹ï¼Œcodingæ›´æƒ³åšçš„æ˜¯å›¢é˜Ÿä»£ç äº‘ç«¯æœåŠ¡ï¼Œé€šè¿‡å®ƒå¯ä»¥äº‘ç«¯ä¸€é”®éƒ¨ç½²ä»£ç 
</code></pre><p>ä¸¤è€…ç›¸æ¯”è¾ƒï¼Œè™½ç„¶Codingæ˜¯å›½å†…äº§å“ï¼Œä¸Šæ‰‹ç¨‹åº¦ä¸Šå…·æœ‰ä¸€å®šçš„ä¼˜åŠ¿ï¼Œä½†æ˜¯äº§å“å¹¶æ²¡æœ‰gitlabå‘å±•çš„æˆç†Ÿï¼Œæ•…ç¬”è€…é€‰æ‹©äº†gitlabæ¥æ‰˜ç®¡ç§æœ‰é¡¹ç›®</p>
<h4 id="é€‰æ‹©æ„å»ºå·¥å…·"><a href="#é€‰æ‹©æ„å»ºå·¥å…·" class="headerlink" title="é€‰æ‹©æ„å»ºå·¥å…·"></a>é€‰æ‹©æ„å»ºå·¥å…·</h4><p>ç›®å‰å·²çŸ¥æœ‰ä»¥ä¸‹å¹³å°ä¾›é€‰æ‹©ï¼š</p>
<ul>
<li><p><a href="https://bintray.com/signup/oss" target="_blank" rel="noopener">Bintray</a><br>ä¼˜ç‚¹ï¼šå“åº”å¿«ï¼Œç»“æ„æ¸…æ™°ï¼Œå½“éƒ¨ç½²å‡ºé”™èƒ½è¿…é€Ÿæ‰“å°logï¼Œåˆ†æé”™è¯¯åŸå› <br>ç¼ºç‚¹: éœ€è¦ç¿»å¢™ï¼Œé…ç½®ç¨æ˜¾å¤æ‚</p>
<p>  é…ç½®å¯å‚è€ƒ:<a href="https://www.jianshu.com/p/5a3d485fda1d" target="_blank" rel="noopener">å‘å¸ƒ Android Library åˆ° JCenter ä»å…¥é—¨åˆ°æ”¾å¼ƒ</a></p>
</li>
<li><p><a href="https://jitpack.io" target="_blank" rel="noopener">jitpack</a><br>ä¼˜ç‚¹: é…ç½®ç®€å•,æ”¯æŒåº¦å¹¿æ³›<br>ç¼ºç‚¹: ç®¡ç†å¹³å°è¾ƒç®€å•</p>
</li>
<li>ä½¿ç”¨<a href="https://www.sonatype.com/download-oss-sonatype" target="_blank" rel="noopener">Nexus Repository Manager OSS 3.x</a>æ¥æ­å»ºç§æœ‰mavenæœåŠ¡<br>ä¼˜ç‚¹:è¾ƒä¸ºå¼€æ”¾ï¼Œå®Œå…¨æœ¬åœ°æœåŠ¡å™¨è¿è¡Œ<br>ç¼ºç‚¹ï¼šéœ€è¦å¯¹gradleè¿›è¡Œå¤æ‚çš„é…ç½®,éœ€è¦æœ¬åœ°æœåŠ¡å™¨</li>
</ul>
<p>ç»¼åˆè€ƒè™‘ï¼Œå†³å®šç”¨jitpackæ¥æ­å»º</p>
<h4 id="å‡†å¤‡å·¥ä½œ"><a href="#å‡†å¤‡å·¥ä½œ" class="headerlink" title="å‡†å¤‡å·¥ä½œ"></a>å‡†å¤‡å·¥ä½œ</h4><ol>
<li>æ³¨å†Œä¸€ä¸ªgitlabè´¦å·</li>
<li>æ³¨å†Œä¸€ä¸ªjitpackè´¦å·</li>
<li>åœ¨gitlabä¸­åˆ›å»ºä¸€ä¸ªç§æœ‰é¡¹ç›®,å¹¶ç”Ÿæˆä¸€ä¸ªAccess Tokens(Setting-&gt;Access Tokens),å¦‚æœæ˜¯ç®¡ç†è€…æŠŠæƒé™å…¨éƒ¨å‹¾ä¸Šï¼ŒExpires atä¸éœ€è¦å¡«ï¼Œç‚¹å‡»ç”Ÿæˆè®°ä¸‹å¯†é’¥(æˆ‘æ¯”è¾ƒæ‡’å°±ä¸æ”¾ç¤ºä¾‹å›¾äº†)</li>
<li>è¿›å…¥jitpackçš„è®¾ç½®ç•Œé¢ï¼ˆç‚¹å‡»ç”¨æˆ·åå¯è¿›å…¥ï¼‰,çœ‹åˆ°GitLabä¸€æ ï¼Œå°†æ­¤ä»¤ç‰Œè¾“å…¥</li>
<li>å›åˆ°jitpacké¦–é¡µå·¦è¾¹Repositoriesé‡Œåº”è¯¥å°±å¯ä»¥çœ‹åˆ°æˆ‘ä»¬å…ˆå‰åˆ›å»ºçš„ç§æœ‰é¡¹ç›®äº†</li>
</ol>
<h4 id="ä¸Šä¼ libraryåŒ…"><a href="#ä¸Šä¼ libraryåŒ…" class="headerlink" title="ä¸Šä¼ libraryåŒ…"></a>ä¸Šä¼ libraryåŒ…</h4><ol>
<li><p>åˆ›å»ºä¸€ä¸ªé¡¹ç›®ï¼Œæ·»åŠ ä¸€ä¸ªlibraryåŒ…</p>
</li>
<li><p>åœ¨æ­¤libraryçš„gradleé‡ŒåŠ å…¥</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">apply plugin: <span class="string">'com.github.dcendents.android-maven'</span></span><br><span class="line">group=<span class="string">'com.gitlab.UserName'</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>å…¶ä¸­UserNameæ˜¯ä½ çš„ç”¨æˆ·å</p>
<p> 3 åœ¨æ ¹ç›®å½•çš„gradleä¸­åŠ å…¥<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dependencies&#123;</span><br><span class="line">    classpath <span class="string">'com.github.dcendents:android-maven-gradle-plugin:2.0'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>æ³¨æ„çœ‹ä½ çš„gradleç‰ˆæœ¬ï¼Œå¦‚æœæ˜¯4.1+å°±ä½¿ç”¨2.0ï¼Œå¦‚æœæ˜¯4.4+å°±ä½¿ç”¨2.1<br>é…ç½®å®Œæ¯•ï¼Œä½¿ç”¨gitæäº¤åˆ°gitlab,æ€ä¹ˆæäº¤ä¸éœ€è¦æˆ‘è¯´äº†å§ï¼Œå°±æ˜¯å¹³å¸¸æäº¤ä»£ç åˆ°githubä¸Šä¸€æ ·</p>
<p> 4 ç‰ˆæœ¬æ§åˆ¶<br>  æäº¤æˆåŠŸåå¯ä»¥åœ¨gitlabä¸­ç”Ÿæˆä¸€ä¸ªtagï¼Œtagçš„åç§°å°±æ˜¯ä½ åœ¨é¡¹ç›®ä¸­å¼•ç”¨çš„åç§°</p>
<p> 5 åˆ·æ–°jitpack, é¡¹ç›®ç»“æ„å¦‚å›¾:<br>  <img src="http://p2p0lrpx1.bkt.clouddn.com/jitpack1.png-gif" alt=""><br>  ç‚¹å‡»<code>Get it</code>å³å¯è·å–ä½ çš„é…ç½®åœ°å€äº†ï¼Œå¤åˆ¶å®ƒ</p>
<h4 id="é¡¹ç›®ä¸­ä½¿ç”¨"><a href="#é¡¹ç›®ä¸­ä½¿ç”¨" class="headerlink" title="é¡¹ç›®ä¸­ä½¿ç”¨"></a>é¡¹ç›®ä¸­ä½¿ç”¨</h4><p>ç›´æ¥åœ¨é¡¹ç›®çš„build.gradleä¸­è´´ä¸Šè¿™ä¸ªåœ°å€ï¼Œbuildâ€¦â€¦â€¦â€¦ å’¦ï¼Œæ€ä¹ˆå¤±è´¥äº†ï¼Œåˆ«æ€¥ï¼Œè¿™æ˜¯å› ä¸ºæƒé™é—®é¢˜é€ æˆçš„ã€‚ç”±äºæˆ‘ä»¬åœ¨gitlabä¸Šåˆ›å»ºçš„æ˜¯ç§æœ‰é¡¹ç›®ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦åœ¨é¡¹ç›®ä¸­é…ç½®ä¸€ä¸‹ä»¤ç‰Œ:<br>æ‰“å¼€é¡¹ç›®çš„<code>gradle.properties</code>,åŠ ä¸Š<code>authToken=ä½ çš„ä»¤ç‰Œåœ°å€</code>,éšååœ¨é¡¹ç›®æ ¹ç›®å½•åŠ ä¸Š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">allprojects &#123;</span><br><span class="line">    repositories &#123;</span><br><span class="line">       ........</span><br><span class="line">        maven &#123; url <span class="string">'https://jitpack.io'</span></span><br><span class="line">            credentials &#123; username authToken &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>é‡æ–°rebuildä¸€ä¸‹ï¼Œç¼–è¯‘æˆåŠŸï¼Œè¯•è¯•åœ¨é¡¹ç›®ä¸­ä½¿ç”¨libraryä¸­çš„ä»£ç ï¼Œå¤§åŠŸå‘Šæˆï¼Œæ€ä¹ˆæ ·ï¼Œé…ç½®æ˜¯ä¸æ˜¯è¶…çº§ç®€å•</p>
]]></content>
      
        <categories>
            
            <category> å®‰å“æ‚è®° </category>
            
        </categories>
        
        
        <tags>
            
            <tag> tools </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Kotlinç³»åˆ—å­¦ä¹ èµ„æ–™æ•´ç†]]></title>
      <url>/Kotlin%E7%B3%BB%E5%88%97-%E5%9F%BA%E6%9C%AC%E8%AF%AD%E6%B3%95.html</url>
      <content type="html"><![CDATA[<p><strong>ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºåšä¸»åŸåˆ›æ–‡ç« ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„(www.huangjie.name)ï¼Œä¿æŠ¤åŸåˆ›ï¼Œä»æˆ‘åšèµ·.</strong></p>
<hr>
<blockquote>
<p>æ—¶è‡³ä»Šæ—¥,Kotlinåœ¨Androidå¼€å‘ä¸­è¶Šæ¥è¶Šå—æ¬¢è¿,å®ƒçš„é«˜æ•ˆæ€§ï¼Œç®€ä»‹æ€§,ä»¥åŠæ›´é«˜çš„å®¹é”™ç‡ä¸ç¦è®©æˆ‘æ„Ÿå¹:ä¸€å…¥Kotlinæ·±ä¼¼æµ·ï¼Œä»æ­¤Javaæ˜¯è·¯äººï¼Œ<br>å…¥äº†Kotlinçš„é—¨ï¼Œä¿è¯è®©ä½ å›ä¸å»,å“ˆå“ˆå“ˆï¼Œè¿˜ç­‰ä»€ä¹ˆ,å¿«æ¥å’Œæˆ‘ä¸€èµ·å­¦ä¹ KotlinæŠŠ<br> <a id="more"></a></p>
</blockquote>
<h4 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h4><p>ç½‘ä¸ŠKotlinçš„èµ„æ–™å¾ˆå¤šï¼Œæˆ‘ä¹Ÿä¸é‡å¤é€ â€˜èµ„æ–™â€™äº†ï¼Œè·Ÿç€æˆ‘çš„èµ„æ–™ç´¢å¼•æ¥ï¼Œä¸€æ­¥ä¸€æ­¥çš„å­¦ä¹ ï¼Œç›¸ä¿¡ä½ å¾ˆå¿«å°±èƒ½ç†Ÿç»ƒä½¿ç”¨äº†</p>
<h5 id="å®˜ç½‘æ•™ç¨‹"><a href="#å®˜ç½‘æ•™ç¨‹" class="headerlink" title="å®˜ç½‘æ•™ç¨‹"></a>å®˜ç½‘æ•™ç¨‹</h5><p><a href="https://github.com/JetBrains/kotlin" target="_blank" rel="noopener">Kotlinå¼€æºåœ°å€</a></p>
<p><a href="http://www.kotlincn.net/docs/reference/" target="_blank" rel="noopener">Kotlinä¸­æ–‡æ–‡æ¡£</a><br>æ­¤æ–‡æ¡£åº”ä»”ç»†ç†Ÿè¯»ä¸‰éï¼Œç¡®ä¿æ¯ä¸€ç« èŠ‚éƒ½æœ‰ä¸€ä¸ªå¤§æ¦‚çš„å°è±¡ï¼Œæ–¹ä¾¿ä»¥åç¿»é˜…ï¼ŒåŒæ—¶è¿™ä¹Ÿæ˜¯æœ€é‡è¦çš„èµ„æ–™,åº”ä¿å­˜åˆ°ä¹¦ç­¾.<br>è¯»è¯­æ³•æ˜¯åº”è¯¥è”æƒ³ä¸€ä¸‹ä½¿ç”¨javaä¼šå¦‚ä½•å®ç°ï¼Œæ€è€ƒä¸€ä¸‹Kotlinçš„å¥½å¤„ï¼Œä¸‹æ¬¡é‡è§æ­¤åœºæ™¯å°±ä¼šè”æƒ³åˆ°éœ€è¦ä½¿ç”¨è¿™ä¸ªApiæ¥ç¼–å†™ä»£ç äº†.</p>
<p><a href="https://github.com/enbandari/Kotlin-Tutorials" target="_blank" rel="noopener">è§†é¢‘æ•™ç¨‹</a></p>
<h4 id="ç»ƒä¹ "><a href="#ç»ƒä¹ " class="headerlink" title="ç»ƒä¹ "></a>ç»ƒä¹ </h4><p>ç†Ÿæ‚‰äº†æ–‡æ¡£åå°±å¯ä»¥å»Kotlinå®˜ç½‘å»åœ¨çº¿ç»ƒä¹ ä¸€ä¸‹è¯­æ³•å•¦ï¼Œç”¨æ¥å·©å›ºä½ çš„çŸ¥è¯†ç‚¹ã€‚<br>åœ°å€:<a href="https://try.kotlinlang.org/#/Examples/Hello,%20world!/Simplest%20version/Simplest%20version.kt" target="_blank" rel="noopener">Hello,Kotlin</a><br>å¯ä»¥ç‚¹å‡»<code>Kotlin Koans</code>æ¥åšä¸Šé¢çš„ç»ƒä¹ é¢˜ï¼Œè®©ä½ å®è·µå„ç§Apiçš„ä½¿ç”¨</p>
<h4 id="å‚è€ƒä»£ç "><a href="#å‚è€ƒä»£ç " class="headerlink" title="å‚è€ƒä»£ç "></a>å‚è€ƒä»£ç </h4><p>å½“ä½ ä½¿ç”¨Kotlinå¾—å¿ƒåº”æ‰‹ä¹‹å,å°±å¯ä»¥å‚è€ƒä¸€ä¸‹åˆ«äººæ˜¯æ€ä¹ˆä½¿ç”¨Kotlinæ¥ç¼–å†™ä»£ç çš„ï¼Œè¿™é‡Œåˆ—ä¸¾å‡ ä¸ªå¯å‚è€ƒçš„å¼€æºé¡¹ç›®</p>
<p><a href="https://github.com/git-xuhao/KotlinMvp" target="_blank" rel="noopener">åŸºäºKotlin+MVP+Retrofit+RxJava+Glide ç­‰æ¶æ„å®ç°çš„çŸ­è§†é¢‘ç±»çš„APPç»ƒæ‰‹é¡¹ç›®ï¼ŒUI ç®€çº¦é£æ ¼ï¼Œä»£ç è¯¦ç»†æ³¨é‡Š</a></p>
<p><a href="https://github.com/antoniolg/Kotlin-for-Android-Developers" target="_blank" rel="noopener">Kotlin for Android Developers (the book)</a><br>å›½å¤–æŸKotlinä¹¦ç±ä¸­çš„ç¤ºä¾‹ä»£ç ..</p>
<p><a href="https://github.com/LRH1993/Eyepetizer-in-Kotlin" target="_blank" rel="noopener">ä»¿å¼€çœ¼è§†é¢‘</a></p>
<p><a href="https://github.com/githubwing/GankClient-Kotlin" target="_blank" rel="noopener">ä½¿ç”¨å¹²è´§é›†ä¸­è¥Apiå®ç°çš„App</a></p>
<p><a href="https://github.com/Yalantis/kotlin-mvp-example" target="_blank" rel="noopener">Kotlinçš„MVPç¤ºä¾‹</a></p>
<h4 id="ç»“æŸ"><a href="#ç»“æŸ" class="headerlink" title="ç»“æŸ"></a>ç»“æŸ</h4><p>æœ€åè¯´ä¸‹é€šè¿‡ä¹¦ç±çš„é˜…è¯»å¯ä»¥è®©ä½ çš„çŸ¥è¯†ç‚¹æ›´æˆä½“ç³»,æ¨è<code>Kotlinå®æˆ˜</code>è¿™æœ¬ä¹¦ï¼Œå†…å®¹ä¸é”™,æ¨è</p>
]]></content>
      
        <categories>
            
            <category> Kotlin </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Android </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[å®‰å“é«˜çº§å¸ƒå±€-flexboxLayoutï¼šæœ€èªæ˜çš„å¸ƒå±€]]></title>
      <url>/%E5%AE%89%E5%8D%93%E9%AB%98%E7%BA%A7%E5%B8%83%E5%B1%80-flexboxLayout-%E6%9C%80%E8%81%AA%E6%98%8E%E7%9A%84%E5%B8%83%E5%B1%80.html</url>
      <content type="html"><![CDATA[<p><strong>ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºåšä¸»åŸåˆ›æ–‡ç« ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„(www.huangjie.name)ï¼Œä¿æŠ¤åŸåˆ›ï¼Œä»æˆ‘åšèµ·.</strong></p>
<hr>
<blockquote>
<p>ps:æœ€è¿‘ç”±äºè¿æ¥å¤–æ¥ç¡¬ç›˜çš„æ•°æ®çº¿è½æœ‹å‹å®¶äº†ï¼Œè€Œæˆ‘hexoæ–‡æ¡£éƒ½å­˜åœ¨å¤–æ¥ç¡¬ç›˜ä¸Šäº†ï¼Œå¯¼è‡´è®¸ä¹…éƒ½æ²¡å†™æ–‡ç« å•¦ï¼Œè¿˜åˆ«è¯´ï¼Œæ‰‹è¿˜æœ‰ç‚¹ç—’ï¼Œä»¥åè¿˜æ˜¯å°½é‡ä¿æŒæ¯å‘¨ä¸€æ›´</p>
</blockquote>
<a id="more"></a>
<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>ä»Šå¤©ç»™å¤§å®¶ä»‹ç»çš„æ˜¯è°·æ­Œå¼€æºçš„æ–°çš„ä¸€ç§å¸ƒå±€ï¼Œå¦‚æœç”¨csså†™è¿‡flexboxå¸ƒå±€çš„æœ‹å‹ä¸€å®šä¸ä¼šé™Œç”Ÿ,æ²¡é”™ï¼Œ<code>FlexboxLayou</code>tå¯ä»¥è¯´æ˜¯<code>Android</code>ç‰ˆçš„<code>flexbox</code>å¸ƒå±€ï¼Œå®ƒçš„ä½œç”¨æ˜¯å¯ä»¥è®©å­å¸ƒå±€è½»æ¾å¡«å……çˆ¶å¸ƒå±€ï¼Œå¹¶ä¸”å¯ä»¥å¯¹å­å¸ƒå±€è¿›è¡Œæ’åºï¼Œè®¾ç½®å¯ä»¥è®©å­å¸ƒå±€è‡ªåŠ¨â€˜æ¢è¡Œâ€™,å®ƒè¿˜èƒ½å¤ŸæŒ‡å®šå­å¸ƒå±€çš„æ’åˆ—æ–¹å‘,ç›¸å½“äºä¸€ä¸ªåŠ å¼ºç‰ˆçš„<code>LinearLayout</code>ï¼Œæ€ä¹ˆæ ·ï¼Œä½ æ˜¯ä¸æ˜¯è¿«ä¸åŠå¾…æƒ³è¯•è¯•äº†ï¼Ÿ</p>
<h2 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h2><p><code>FlexboxLayout</code>å¼€æºåœ°å€ï¼š<a href="https://github.com/google/flexbox-layout" target="_blank" rel="noopener">https://github.com/google/flexbox-layout</a></p>
<p>åœ¨<code>build.gradle</code>ä¸­æ·»åŠ ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">    implementation <span class="string">'com.google.android:flexbox:0.3.2'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>åœ¨xmlä¸­ä½¿ç”¨ï¼š<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">&lt;com.google.android.flexbox.FlexboxLayout xmlns:android=<span class="string">"http://schemas.android.com/apk/res/android"</span></span><br><span class="line">    android:layout_width=<span class="string">"match_parent"</span></span><br><span class="line">    android:layout_height=<span class="string">"match_parent"</span></span><br><span class="line">    &gt;</span><br><span class="line"></span><br><span class="line">    &lt;TextView</span><br><span class="line">        android:layout_width=<span class="string">"100dp"</span></span><br><span class="line">        android:layout_height=<span class="string">"20dp"</span></span><br><span class="line">        android:background=<span class="string">"#43eeff"</span></span><br><span class="line">        android:gravity=<span class="string">"center"</span></span><br><span class="line">        android:text=<span class="string">"1"</span> /&gt;</span><br><span class="line"></span><br><span class="line">    &lt;TextView</span><br><span class="line">        android:layout_width=<span class="string">"100dp"</span></span><br><span class="line">        android:layout_height=<span class="string">"20dp"</span></span><br><span class="line">        android:background=<span class="string">"#ef3344"</span></span><br><span class="line">        android:gravity=<span class="string">"center"</span></span><br><span class="line">        android:text=<span class="string">"2"</span> /&gt;</span><br><span class="line"></span><br><span class="line">    &lt;TextView</span><br><span class="line">        android:layout_width=<span class="string">"100dp"</span></span><br><span class="line">        android:layout_height=<span class="string">"20dp"</span></span><br><span class="line">        android:background=<span class="string">"#ee998f"</span></span><br><span class="line">        android:gravity=<span class="string">"center"</span></span><br><span class="line">        android:text=<span class="string">"3"</span> /&gt;</span><br><span class="line"></span><br><span class="line">    &lt;TextView</span><br><span class="line">        android:layout_width=<span class="string">"100dp"</span></span><br><span class="line">        android:layout_height=<span class="string">"50dp"</span></span><br><span class="line">        android:background=<span class="string">"#eeff22"</span></span><br><span class="line">        android:gravity=<span class="string">"center"</span></span><br><span class="line">        android:text=<span class="string">"4"</span> /&gt;</span><br><span class="line"></span><br><span class="line">&lt;/com.google.android.flexbox.FlexboxLayout&gt;</span><br></pre></td></tr></table></figure></p>
<p>æˆ‘ä»¬ä»€ä¹ˆå±æ€§éƒ½ä¸åŠ ,å¯ä»¥çœ‹åˆ°æ•ˆæœæ˜¯è¿™æ ·çš„ï¼š<br><img src="http://p07lh1fh6.bkt.clouddn.com/flexboxlayout_noshuxin.png-suofang" alt=""></p>
<p>å’¦ï¼Œå¥½åƒå¹¶æ²¡æœ‰æ¢è¡Œï¼Œåˆ«æ€¥ï¼Œè¿™å…¶å®æ˜¯<code>flexboxLayout</code>é»˜è®¤å±æ€§çš„ä¸€ä¸ªæ•ˆæœï¼Œä¸‹é¢æˆ‘ä»¬å°±æ¥å­¦ä¹ å®ƒçš„ä¸€äº›å¸¸ç”¨å±æ€§å§ï¼š</p>
<h4 id="flexDirection"><a href="#flexDirection" class="headerlink" title="flexDirection"></a>flexDirection</h4><p><code>flexDirection</code>å±æ€§å†³å®šå­å¸ƒå±€çš„æ’åˆ—æ–¹å‘ã€‚ç±»ä¼¼LinearLayout çš„ <code>orientation</code>å±æ€§ï¼Œä¸è¿‡,flexboxLayoutçš„å±æ€§æ›´åŠ å¼ºå¤§,å®ƒé™¤äº†å†³å®šå­å¸ƒå±€çš„æ’åˆ—æ–¹å‘,è¿˜å¯ä»¥å†³å®šå­å¸ƒå±€çš„èµ·ç‚¹ä½ç½®ï¼š</p>
<ul>
<li>rowï¼ˆé»˜è®¤å€¼ï¼‰ï¼šå­å¸ƒå±€ä¸ºæ°´å¹³æ–¹å‘ï¼Œèµ·ç‚¹åœ¨å·¦ç«¯</li>
<li>row_reverseï¼šå­å¸ƒå±€ä¸ºæ°´å¹³æ–¹å‘ï¼Œèµ·ç‚¹åœ¨å³ç«¯ã€‚</li>
<li>columnï¼šå­å¸ƒå±€ä¸ºå‚ç›´æ–¹å‘ï¼Œèµ·ç‚¹åœ¨ä¸Šæ²¿</li>
<li>column_reverseï¼šå­å¸ƒå±€ä¸ºå‚ç›´æ–¹å‘ï¼Œèµ·ç‚¹åœ¨ä¸‹æ²¿</li>
</ul>
<p>ä½¿ç”¨<code>column_reverse</code>æ•ˆæœå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p><img src="http://p07lh1fh6.bkt.clouddn.com/flexboxlayout_column_reverse.png-suofang" alt=""></p>
<h4 id="flexWrap"><a href="#flexWrap" class="headerlink" title="flexWrap"></a>flexWrap</h4><p><code>flexWrap</code>æ˜¯ä¸€ä¸ªéå¸¸æœ‰ç”¨çš„å±æ€§ï¼Œå®ƒå¯ä»¥è®©æ§ä»¶è‡ªåŠ¨æ¢è¡Œ,</p>
<ul>
<li>nowrap ï¼ˆé»˜è®¤ï¼‰ï¼šä¸æ¢è¡Œ</li>
<li>wrapï¼šæŒ‰æ­£æ–¹å‘æ¢è¡Œ</li>
<li>wrap_reverseï¼šæŒ‰åæ–¹å‘æ¢è¡Œ</li>
</ul>
<p>ä½¿ç”¨<code>wrap</code>å±æ€§æ•ˆæœå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p><img src="http://p07lh1fh6.bkt.clouddn.com/flexboxlayout_warp.png-suofang" alt=""></p>
<h4 id="justifyContent"><a href="#justifyContent" class="headerlink" title="justifyContent"></a>justifyContent</h4><p><code>justifyContent</code>å®šä¹‰äº†å­æ§ä»¶çš„å¯¹é½æ–¹å¼ï¼ŒæŠŠå®ƒçœ‹æˆ<code>gravity</code>å±æ€§ï¼Œå­æ§ä»¶ä¸ºä¸€ä¸ªæ•´ä½“å°±å¥½ç†è§£äº†ï¼Œå±æ€§å¦‚ä¸‹ï¼š</p>
<ul>
<li>flex_start(é»˜è®¤):å·¦å¯¹é½</li>
<li>flex_endï¼šå³å¯¹é½</li>
<li>centerï¼šå±…ä¸­</li>
<li>space_betweenï¼šä¸¤ç«¯å¯¹é½ï¼Œæ¯ä¸ªå­æ§ä»¶ä¹‹é—´çš„è·ç¦»ç›¸ç­‰</li>
<li>space_aroundï¼šæ¯ä¸ªå­æ§ä»¶çš„ä¸¤ä¾§ç›¸ç­‰,é¡¹ç›®ä¹‹é—´çš„é—´éš”æ¯”é¡¹ç›®ä¸è¾¹æ¡†çš„é—´éš”å¤§ä¸€å€ã€‚</li>
</ul>
<p>å¦‚ä¸‹æ˜¯è®¾ç½®äº†<code>space_around</code>çš„æ•ˆæœï¼š</p>
<p><img src="http://p07lh1fh6.bkt.clouddn.com/flexboxlayout_space_around.png-suofang" alt=""></p>
<h4 id="alignItems"><a href="#alignItems" class="headerlink" title="alignItems"></a>alignItems</h4><p><code>alignltems</code>ç”¨äºè®¾ç½®å­å¸ƒå±€çš„å¯¹é½æ–¹å¼,å±æ€§å¦‚ä¸‹ï¼š</p>
<ul>
<li>flex-startï¼šé¡¶ç«¯å¯¹é½ã€‚ï¼šç¬¬ä¸€è¡Œå†…å®¹çš„çš„åŸºçº¿å¯¹é½ã€‚</li>
<li>flex_endï¼šåº•éƒ¨å¯¹é½ã€‚</li>
<li>stretch ï¼ˆé»˜è®¤ï¼‰ï¼šå¦‚æœitemæ²¡æœ‰è®¾ç½®é«˜åº¦ï¼Œåˆ™å……æ»¡å®¹å™¨é«˜åº¦ã€‚</li>
<li>centerï¼šå±…ä¸­å¯¹é½</li>
<li>baselineï¼šç¬¬ä¸€è¡Œå†…å®¹çš„åŸºçº¿å¯¹é½ã€‚</li>
</ul>
<p>è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬ä¸€å¼€å§‹ä»€ä¹ˆä¹Ÿä¸è®¾ç½®å­å¸ƒå±€ä¼šå¡«å……çˆ¶å¸ƒå±€çš„åŸå› ã€‚è¿™é‡Œè¿˜è¯´ä¸‹baselineå±æ€§ï¼Œç”¨è¿‡TextViewä¸€å®šå¯¹åŸºçº¿ä¸ä¼šé™Œç”Ÿ,å¦‚æœå­æ§ä»¶æœ‰æ–‡å­—ï¼ŒåŸºçº¿å¯¹é½å¯ä»¥ä¿è¯æ–‡å­—å¯¹é½è€Œä¸å¿…ç†ä¼šåŒ…è£¹å®ƒçš„æ§ä»¶æ˜¯æ€æ ·çš„ã€‚<br>è§‚çœ‹ä¸‹å›¾å¯ä»¥æœ‰åŠ©äºç†è§£ï¼š<br><img src="https://user-gold-cdn.xitu.io/2017/3/21/f471cc42ef5f9fdd3222b45972694493" alt=""></p>
<h4 id="alignContent"><a href="#alignContent" class="headerlink" title="alignContent"></a>alignContent</h4><p><code>alignContent</code>å¯ä»¥æ§åˆ¶å¤šè¡Œçš„å¯¹é½æ–¹å¼ï¼Œå¦‚æœå­å¸ƒå±€åªæœ‰ä¸€è¡Œåˆ™ä¸èµ·ä½œç”¨ï¼Œå±æ€§å¦‚ä¸‹ï¼š</p>
<ul>
<li>stretch ï¼ˆé»˜è®¤å€¼ï¼‰ï¼šå……æ»¡äº¤å‰è½´çš„é«˜åº¦ï¼ˆæµ‹è¯•å‘ç°ï¼Œéœ€è¦alignItems çš„å€¼ä¹Ÿä¸ºstretch æ‰æœ‰æ•ˆï¼‰ã€‚</li>
<li>flex_startï¼šä¸äº¤å‰è½´çš„èµ·ç‚¹å¯¹é½ã€‚</li>
<li>flex_endï¼šä¸äº¤å‰è½´çš„ç»ˆç‚¹å¯¹é½ã€‚</li>
<li>centerï¼šä¸äº¤å‰è½´çš„ä¸­ç‚¹å¯¹é½ã€‚</li>
<li>space_betweenï¼šä¸äº¤å‰è½´ä¸¤ç«¯å¯¹é½ï¼Œè½´çº¿ä¹‹é—´çš„é—´éš”å¹³å‡åˆ†å¸ƒã€‚</li>
<li>space_aroundï¼šæ¯æ ¹è½´çº¿ä¸¤ä¾§çš„é—´éš”éƒ½ç›¸ç­‰ã€‚æ‰€ä»¥ï¼Œè½´çº¿ä¹‹é—´çš„é—´éš”æ¯”è½´çº¿ä¸è¾¹æ¡†çš„é—´éš”å¤§ä¸€å€ã€‚</li>
</ul>
<h3 id="å­å¸ƒå±€å±æ€§"><a href="#å­å¸ƒå±€å±æ€§" class="headerlink" title="å­å¸ƒå±€å±æ€§"></a>å­å¸ƒå±€å±æ€§</h3><p>å­å¸ƒå±€ä¹Ÿæœ‰éå¸¸ç»™åŠ›çš„å±æ€§,çˆ¶ä¸å­å¸ƒå±€çš„ç»“åˆä½¿å¾—æ’ç‰ˆéå¸¸çµæ´»</p>
<h4 id="layout-flexBasisPercent"><a href="#layout-flexBasisPercent" class="headerlink" title="layout_flexBasisPercent"></a>layout_flexBasisPercent</h4><p><code>ayout_flexBasisPercent</code>çš„å€¼ä¸ºä¸€ä¸ªç™¾åˆ†æ¯”ï¼Œè¡¨ç¤ºè®¾ç½®å­å…ƒç´ çš„é•¿åº¦ä¸ºå®ƒçˆ¶å®¹å™¨é•¿åº¦çš„ç™¾åˆ†æ¯”,é»˜è®¤å€¼æ˜¯auto,å³å…ƒç´ æœ¬æ¥çš„å¤§å°ã€‚<br>å¦‚å›¾ï¼Œæˆ‘è®¾ç½®æ¯ä¸ªå­å¸ƒå±€çš„å®½åº¦ä¸€æ ·ï¼Œç¬¬ä¸€ä¸ªå­å¸ƒå±€æˆ‘è®¾ç½®50%çš„ç™¾åˆ†æ¯”ï¼Œæ•ˆæœå¦‚å›¾ï¼š</p>
<p><img src="http://p07lh1fh6.bkt.clouddn.com/flexboxlayout_presenter.png-suofang" alt=""></p>
<h4 id="layout-order"><a href="#layout-order" class="headerlink" title="layout_order"></a>layout_order</h4><p><code>layout_order</code>å±æ€§ç”¨äºç»™å­å¸ƒå±€æ’åºï¼Œé»˜è®¤æ˜¯æŒ‰ç…§ä»ä¸Šåˆ°ä¸‹ä¾æ¬¡æ’åˆ—çš„ï¼Œå¦‚æœåŠ å…¥è¯¥å€¼ï¼Œå€¼è¶Šå°ä½ç½®å°±ä¼šè¶Šé å‰</p>
<h4 id="layout-flexGrow"><a href="#layout-flexGrow" class="headerlink" title="layout_flexGrow"></a>layout_flexGrow</h4><p><code>layout_flexGrow</code>ç”¨äºå®šä¹‰å­å¸ƒå±€çš„æ”¾å¤§æ¯”ä¾‹ï¼Œå…¶å®å°±æ˜¯<code>LinearLayout</code>çš„<code>weight</code>å±æ€§ï¼Œç›¸ä¿¡è¿™ä¸ªä¸ç”¨è¿‡å¤šä»‹ç»å§</p>
<h4 id="layout-flexShrink"><a href="#layout-flexShrink" class="headerlink" title="layout_flexShrink"></a>layout_flexShrink</h4><p><code>layout_flexShrink</code>å®šä¹‰äº†é¡¹ç›®çš„ç¼©å°æ¯”ä¾‹ï¼Œé»˜è®¤ä¸º1ï¼Œå³å¦‚æœç©ºé—´ä¸è¶³ï¼Œè¯¥é¡¹ç›®å°†ç¼©å°ã€‚å¦‚æœæ‰€æœ‰é¡¹ç›®çš„ layout_flexShrink å±æ€§éƒ½ä¸º1ï¼Œå½“ç©ºé—´ä¸è¶³æ—¶ï¼Œéƒ½å°†ç­‰æ¯”ä¾‹ç¼©å°ã€‚å¦‚æœä¸€ä¸ªé¡¹ç›®çš„flex-shrinkå±æ€§ä¸º0ï¼Œå…¶ä»–é¡¹ç›®éƒ½ä¸º1ï¼Œåˆ™ç©ºé—´ä¸è¶³æ—¶ï¼Œå‰è€…ä¸ç¼©å°ã€‚è´Ÿå€¼å¯¹è¯¥å±æ€§æ— æ•ˆã€‚</p>
<h4 id="layout-alignSelf"><a href="#layout-alignSelf" class="headerlink" title="layout_alignSelf"></a>layout_alignSelf</h4><p><code>layout_alignSelf</code>å±æ€§å…è®¸å•ä¸ªå­å…ƒç´ æœ‰ä¸å…¶ä»–å­å…ƒç´ ä¸ä¸€æ ·çš„å¯¹é½æ–¹å¼ï¼Œå¯è¦†ç›– alignItems å±æ€§ã€‚é»˜è®¤å€¼ä¸ºautoï¼Œè¡¨ç¤ºç»§æ‰¿çˆ¶å…ƒç´ çš„alignItems å±æ€§ï¼Œå¦‚æœæ²¡æœ‰çˆ¶å…ƒç´ ï¼Œåˆ™ç­‰åŒäºstretchã€‚å±æ€§ä½œç”¨åŒ<code>alignItems</code>ä¸€æ ·ã€‚</p>
<p>flexboxLayoutå¤§éƒ¨åˆ†å¸¸ç”¨çš„å±æ€§å°±ä»‹ç»åˆ°è¿™é‡Œï¼Œæ­¤å¸ƒå±€å¯ä»¥è½»æ¾å®Œæˆç±»ä¼¼æ·»åŠ tagä¾¿ç­¾çš„å¸ƒå±€æ ·å¼ï¼Œä¹Ÿå¯ä»¥æŠŠå®ƒå½“æˆç™¾åˆ†æ¯”å¸ƒå±€æ¥ç”¨ï¼Œç”šè‡³å¯ä»¥ä¸RecyclerViewæ­é…å®Œæˆå›¾ç‰‡æµæ•ˆæœï¼Œå› æ­¤ç†Ÿç»ƒæŒæ¡è¿™ä¸ªå¸ƒå±€è¿˜æ˜¯æœ‰å¿…è¦çš„ï¼Œè·Ÿç€æ–‡ç« çš„è®²è§£å¤šæ•²æ•²ä»£ç ï¼Œç›¸ä¿¡ä½ å¾ˆå¿«å°±ä¼šä¸Šæ‰‹çš„ã€‚</p>
]]></content>
      
        <categories>
            
            <category> AndroidåŸºç¡€è¿›é˜¶ </category>
            
            <category> å®‰å“æ§ä»¶ </category>
            
        </categories>
        
        
    </entry>
    
    <entry>
      <title><![CDATA[è®°ä¸€æ¬¡é‡æ„é¡¹ç›®å¿ƒå¾—]]></title>
      <url>/refactoring-project-learned.html</url>
      <content type="html"><![CDATA[<p><strong>ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºåšä¸»åŸåˆ›æ–‡ç« ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„(www.huangjie.name)ï¼Œä¿æŠ¤åŸåˆ›ï¼Œä»æˆ‘åšèµ·.</strong></p>
<hr>
<blockquote>
<p>è¿™æ¬¡èŠ±æ—¶é—´é‡æ„äº†ä¸‹ä¸€å¹´å‰çš„è‡ªå®šä¹‰é”®ç›˜é¡¹ç›®,æ”¶è·äº†è®¸å¤šï¼Œå¿ä¸ä½æƒ³å†™å‡ºæ¥åˆ†äº«ä¸€ä¸‹,é¡¹ç›®åœ°å€<a href="https://github.com/Jay-huangjie/EasyKeyBoardView" target="_blank" rel="noopener">EasyKeyBoardView</a>,è¯¥åº“æ—¨åœ¨å¸®åŠ©å¼€å‘è€…æ›´å¿«çš„å®ç°è‡ªå®šä¹‰é”®ç›˜ï¼Œæ— éœ€å…³æ³¨é”®ç›˜è‡ªèº«çš„å®ç°é€»è¾‘ï¼Œè¯¦ç»†ç”¨æ³•è§<a href="https://github.com/Jay-huangjie/EasyKeyBoardView/blob/master/README.md" target="_blank" rel="noopener">README.md</a></p>
</blockquote>
<a id="more"></a>
<h3 id="å¦‚ä½•é‡æ„é¡¹ç›®"><a href="#å¦‚ä½•é‡æ„é¡¹ç›®" class="headerlink" title="å¦‚ä½•é‡æ„é¡¹ç›®"></a>å¦‚ä½•é‡æ„é¡¹ç›®</h3><p>å¯¹äºä¸€ä¸ªå¼€æºé¡¹ç›®æ¥è¯´ï¼Œé¦–å…ˆè¦å¼„æ¸…æ¥šå®ƒçš„æ„ä¹‰åœ¨å“ªé‡Œï¼Œå®ƒçš„ç›®çš„åœ¨å“ªé‡Œï¼Œä¿—è¯è¯´ï¼Œç¨‹åºå‘˜éƒ½æ˜¯æ‡’æƒ°çš„ï¼Œä¸ºäº†å·æ‡’ï¼Œç¨‹åºå‘˜åˆ›é€ äº†è¶Šæ¥è¶Šæ–¹ä¾¿çš„å·¥å…·æ¥å¸®è‡ªå·±å·æ‡’ï¼Œè¿™å°±æ˜¯ä¸€ç§è¿›æ­¥ã€‚</p>
<p>åŸºäºæ­¤ï¼Œæˆ‘åˆ†æäº†ä¸‹è‡ªå®šä¹‰é”®ç›˜çš„ä½¿ç”¨åœºæ™¯ï¼Œå‘ç°é”®ç›˜çš„ä½¿ç”¨é€»è¾‘æ˜¯å·®ä¸å¤šçš„ï¼Œæ— éæ˜¯UIåŠä¸€äº›åŠŸèƒ½ç‚¹ä¸Šçš„ä¸åŒï¼Œä½†ç»ˆç©¶æ˜¯ä¸€ä¸ªé”®ç›˜ï¼Œè¾“å…¥åŠŸèƒ½æ˜¯åˆšéœ€ï¼Œæ‰€ä»¥ç®€åŒ–è¾“å…¥åŠŸèƒ½å°±æ˜¯è¿™ä¸ªåº“çš„æ„ä¹‰æ‰€åœ¨äº†ã€‚</p>
<p>è€Œè¿™æ¬¡æˆ‘å‘ç°ï¼Œä¸€æ¬¾ä¼˜è´¨çš„å¼€æºé¡¹ç›®å¿…é¡»è¦æœ‰é«˜åº¦çš„æ‰©å±•æ€§ï¼Œåº”æ­¤å°†åŠŸèƒ½æ¨¡å—åŒ–æ˜¯æˆ‘æ­¤æ¬¡å­¦ä¹ åˆ°çš„é‡è¦æŠ€èƒ½ï¼Œæ¯ä¸€ä¸ªç±»éƒ½æœ‰ç€å®ƒè‡ªå·±çš„åŠŸèƒ½ï¼Œç„¶åå†å°†è¿™äº›ç±»ç»„è£…èµ·æ¥å°±å˜æˆäº†ä¸€å°çµæ´»è¿ä½œçš„æœºå™¨ã€‚<br>è€Œå…¶ä¸­é‚£äº›ç‚¹å¯å¯¹å¤–ä¿®æ”¹ï¼Œé‚£äº›ä¸èƒ½ï¼Œè¿™éƒ½éœ€è¦è‡ªå·±åˆ¤æ–­çš„ã€‚</p>
<h3 id="å­¦ä¹ åˆ°çš„æŠ€èƒ½"><a href="#å­¦ä¹ åˆ°çš„æŠ€èƒ½" class="headerlink" title="å­¦ä¹ åˆ°çš„æŠ€èƒ½"></a>å­¦ä¹ åˆ°çš„æŠ€èƒ½</h3><p>æ›´å¿«çš„é…ç½®ï¼šä¸Šä¼ é¡¹ç›®åˆ°<code>JitPack</code><br>ç›¸æ¯”äº<code>jcenter</code>,æˆ‘å‘ç°<code>JitPack</code>å¯è°“æ˜¯ç¥å™¨ï¼Œ1åˆ†é’Ÿå°±å¯å®ç°ä»£ç ä¸Šä¼ ï¼Œå¼ºçƒˆæ¨èï¼Œä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ï¼š<br>é¦–å…ˆè¿›å…¥å®ƒçš„githubåœ°å€:<a href="https://github.com/jitpack/jitpack.io" target="_blank" rel="noopener">jitpack.io</a>,æ‰¾åˆ°å®ƒçš„æœ€æ–°ç‰ˆæ’ä»¶ç‰ˆæœ¬ï¼Œåœ¨è¦ä¸Šä¼ çš„é¡¹ç›®çš„root build.gradleä¸­æ·»åŠ æ’ä»¶ï¼Œå¤§æ¦‚é•¿è¿™æ ·ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">       classpath <span class="string">'com.android.tools.build:gradle:3.0.0'</span></span><br><span class="line">       classpath <span class="string">'com.github.dcendents:android-maven-gradle-plugin:2.0'</span> <span class="comment">// è¿™æ˜¯æˆªè‡³ç›®å‰æœ€æ–°ç‰ˆçš„æ’ä»¶</span></span><br><span class="line">       <span class="comment">// <span class="doctag">NOTE:</span> Do not place your application dependencies here; they belong</span></span><br><span class="line">       <span class="comment">// in the individual module build.gradle files</span></span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure></p>
<p>ç„¶ååœ¨ä½ è¦ä¸Šä¼ çš„libraryåŒ…ä¸­çš„build.gradleæ–‡ä»¶ä¸­æ·»åŠ ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">apply plugin: <span class="string">'com.github.dcendents.android-maven'</span></span><br><span class="line">group=<span class="string">'com.github.Jay-huangjie'</span>  <span class="comment">//è¿™é‡Œå†™ä½ è‡ªå·±çš„githubåå­—ï¼Œåˆ«å†™æˆ‘çš„å•Š</span></span><br></pre></td></tr></table></figure></p>
<p>é‡æ–°ç¼–è¯‘ä¸€ä¸‹ï¼Œç„¶åå°†ä»£ç ä¸Šä¼ åˆ°github,ä¸Šä¼ æˆåŠŸåè¿›å…¥é¡¹ç›®ä¸»é¡µï¼Œç‚¹å‡»releasesåˆ›å»ºä¸€ä¸ªç‰ˆæœ¬ï¼Œreleasesæˆ–tagéƒ½è¡Œï¼Œå¦‚å›¾ï¼š<br><img src="http://p2p0lrpx1.bkt.clouddn.com/release.png-gif" alt=""></p>
<p>åˆ›å»ºå¥½åè¿›å…¥jitPackå®˜ç½‘ï¼š<a href="https://jitpack.io/" target="_blank" rel="noopener">https://jitpack.io/</a>;<br>åœ¨è¾“å…¥æ¡†ä¸­è¾“å…¥ä½ çš„é¡¹ç›®åœ°å€ï¼Œä¾‹å¦‚æˆ‘çš„é¡¹ç›®åœ°å€å°±æ˜¯<a href="https://github.com/Jay-huangjie/EasyKeyBoardView" target="_blank" rel="noopener">https://github.com/Jay-huangjie/EasyKeyBoardView</a>,å¾—åˆ°å¦‚å›¾æ‰€ç¤ºçš„ä¿¡æ¯ï¼š<br><img src="http://p2p0lrpx1.bkt.clouddn.com/jitpack1.png-gif" alt=""><br>ç‚¹å‡»<code>Get it</code>æŒ‰é’®å³å¯è·å–ä½ çš„åœ°å€å•¦ï¼Œå¹¶ä¸”ï¼Œé€šè¿‡æ­¤åœ°å€ä¸‹è½½çš„æ˜¯ä½ çš„libraryåŒ…è€Œä¸æ˜¯æ•´ä¸ªé¡¹ç›®ï¼Œæ‰€ä»¥ä½ å¯ä»¥å°†åº“çš„demoä¹Ÿä¸€èµ·ä¸Šä¼ åˆ°githubä¸Šï¼Œæ˜¯ä¸æ˜¯éå¸¸çš„æ–¹ä¾¿ç®€å•å‘¢</p>
]]></content>
      
        <categories>
            
            <category> å®‰å“æ‚è®° </category>
            
        </categories>
        
        
    </entry>
    
    <entry>
      <title><![CDATA[okhttp3Wikiæ–‡æ¡£è¯‘æ–‡]]></title>
      <url>/okhttp3-wiki-chinese.html</url>
      <content type="html"><![CDATA[<p><strong>ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºåšä¸»åŸåˆ›æ–‡ç« ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„(www.huangjie.name)ï¼Œä¿æŠ¤åŸåˆ›ï¼Œä»æˆ‘åšèµ·.</strong></p>
<hr>
<blockquote>
<p>æœ¬æ–‡æä¾›ä¸€äº›okhttp3çš„æ–‡æ¡£ç¿»è¯‘,è‹±æ–‡æ–‡æ¡£åœ°å€:<a href="https://github.com/square/okhttp/wiki" target="_blank" rel="noopener">https://github.com/square/okhttp/wiki</a></p>
</blockquote>
<a id="more"></a>
<h3 id="Calls-è°ƒç”¨"><a href="#Calls-è°ƒç”¨" class="headerlink" title="Calls(è°ƒç”¨)"></a>Calls(è°ƒç”¨)</h3><p>HTTPå®¢æˆ·ç«¯çš„å·¥ä½œæ˜¯æ¥å—ä½ çš„è¯·æ±‚å¹¶äº§ç”Ÿå“åº”ã€‚è¿™åœ¨ç†è®ºä¸Šå¾ˆç®€å•ï¼Œä½†åœ¨å®è·µä¸­ä¼šå˜å¾—æ£˜æ‰‹ã€‚</p>
<h4 id="Requests"><a href="#Requests" class="headerlink" title="Requests"></a><a href="http://square.github.io/okhttp/3.x/okhttp/okhttp3/Request.html" target="_blank" rel="noopener">Requests</a></h4><p>æ¯ä¸ªHTTPè¯·æ±‚éƒ½åŒ…å«ä¸€ä¸ªURLï¼Œä¸€ä¸ªæ–¹æ³•ï¼ˆå¦‚GETæˆ–POSTï¼‰å’Œä¸€ä¸ªå¤´éƒ¨åˆ—è¡¨(headers)ã€‚è¯·æ±‚ä¹Ÿå¯èƒ½åŒ…å«ä¸€ä¸ªè¯·æ±‚ä½“(body)ï¼šç‰¹å®šå†…å®¹ç±»å‹çš„æ•°æ®æµã€‚</p>
<h4 id="Responses"><a href="#Responses" class="headerlink" title="Responses"></a><a href="http://square.github.io/okhttp/3.x/okhttp/okhttp3/Response.html" target="_blank" rel="noopener">Responses</a></h4><p>æ¯ä¸€ä¸ªHTTPå“åº”ä¸­éƒ½åŒ…å«ä¸€ä¸ªçŠ¶æ€ç ï¼ˆå¦‚200ä»£è¡¨æˆåŠŸï¼Œ404ä»£è¡¨æœªæ‰¾â€‹â€‹åˆ°ï¼‰ï¼Œä¸€ä¸ªå“åº”å¤´åˆ—è¡¨ï¼ˆheadersï¼‰å’Œä¸€ä¸ªå¯é€‰çš„å“åº”ä½“ï¼ˆbodyï¼‰ã€‚</p>
<h4 id="é‡å†™è¯·æ±‚"><a href="#é‡å†™è¯·æ±‚" class="headerlink" title="é‡å†™è¯·æ±‚"></a>é‡å†™è¯·æ±‚</h4><p>å½“ä½ çš„OkHttpå‘é€ä¸€ä¸ªHTTPè¯·æ±‚ï¼Œä½ åœ¨æè¿°ä¸€ä¸ªé«˜å±‚æ¬¡çš„è¦æ±‚ï¼šâ€œç»™æˆ‘è·å–è¿™ä¸ªç½‘å€ä¸­çš„è¿™äº›è¯·æ±‚å¤´ã€‚â€å¯¹äºæ­£ç¡®æ€§å’Œæ•ˆç‡ï¼ŒOkHttpå‘é€å‰ä¼šé‡å†™ä½ çš„è¯·æ±‚ã€‚</p>
<p>OkHttpå¯ä»¥åœ¨åŸå…ˆçš„è¯·æ±‚ä¸­æ·»åŠ è¯·æ±‚å¤´ï¼ˆheadersï¼‰ï¼ŒåŒ…æ‹¬Content-Length, Transfer-Encoding, User-Agent, Host, Connection, å’Œ Content-Typeã€‚é™¤éè¯·æ±‚å¤´å·²ç»å­˜åœ¨å‹ç¼©å“åº”ï¼Œå¦åˆ™å®ƒè¿˜å°†æ·»åŠ ä¸€ä¸ªAccept-Encodingè¯·æ±‚å¤´ã€‚å¦‚æœä½ æœ‰cookiesï¼ŒOkHttpè¿˜å°†æ·»åŠ ä¸€ä¸ªCookieè¯·æ±‚å¤´ã€‚</p>
<p>ä¸€äº›è¯·æ±‚ä¼šæœ‰ä¸€ä¸ªç¼“å­˜çš„å“åº”ã€‚å½“è¿™ä¸ªç¼“å­˜çš„å“åº”ä¸æ˜¯æœ€æ–°çš„æ—¶å€™ï¼ŒOkHttpä¼šå‘é€ä¸€ä¸ªæœ‰æ¡ä»¶çš„GETæ¥ä¸‹è½½æ›´æ–°çš„å“åº”ï¼Œå¦‚æœå®ƒæ¯”ç¼“å­˜è¿˜æ–°ã€‚å®ƒå°†ä¼šæ·»åŠ éœ€è¦çš„è¯·æ±‚å¤´ï¼Œå¦‚IF-Modified-Sinceå’ŒIf-None-Matchã€‚</p>
<h4 id="é‡å†™å“åº”"><a href="#é‡å†™å“åº”" class="headerlink" title="é‡å†™å“åº”"></a>é‡å†™å“åº”</h4><p>å¦‚æœä½¿ç”¨é€æ˜å‹ç¼©ï¼ŒOkHttpå°†åˆ é™¤ç›¸åº”çš„å“åº”å¤´Content-Encodingï¼ŒContent-Lengthå› ä¸ºå®ƒä»¬ä¸é€‚ç”¨äºè§£å‹ç¼©çš„å“åº”ä¸»ä½“ã€‚</p>
<p>å¦‚æœæ¡ä»¶GETæˆåŠŸï¼Œåˆ™æ¥è‡ªç½‘ç»œå’Œç¼“å­˜çš„å“åº”å°†æŒ‰ç…§è§„èŒƒçš„æŒ‡ç¤ºè¿›è¡Œåˆå¹¶ã€‚</p>
<h4 id="åç»­è¯·æ±‚"><a href="#åç»­è¯·æ±‚" class="headerlink" title="åç»­è¯·æ±‚"></a>åç»­è¯·æ±‚</h4><p>å½“æ‚¨è¯·æ±‚çš„URLå·²ç»ç§»åŠ¨æ—¶ï¼ŒWebæœåŠ¡å™¨å°†è¿”å›ä¸€ä¸ªå“åº”ä»£ç ï¼Œ302ä»¥æŒ‡ç¤ºæ–‡æ¡£çš„æ–°URLã€‚OkHttpå°†æŒ‰ç…§é‡å®šå‘æ¥æ£€ç´¢æœ€ç»ˆå“åº”ã€‚<br>å¦‚æœå“åº”å‘å‡ºæˆæƒè´¨è¯¢ï¼Œåˆ™OkHttpä¼šè¯¢é—®<a href="http://square.github.io/okhttp/3.x/okhttp/okhttp3/Authenticator.html" target="_blank" rel="noopener">Authenticator</a>ï¼ˆå¦‚æœå·²é…ç½®ï¼‰ä»¥æ»¡è¶³è´¨è¯¢ã€‚å¦‚æœè®¤è¯è€…æä¾›è¯ä¹¦ï¼Œåˆ™è¯·æ±‚å°†ä¼šå¸¦ç€è¯ä¹¦è¿›è¡Œé‡è¯•ã€‚</p>
<h4 id="é‡è¯•è¯·æ±‚"><a href="#é‡è¯•è¯·æ±‚" class="headerlink" title="é‡è¯•è¯·æ±‚"></a>é‡è¯•è¯·æ±‚</h4><p>æœ‰æ—¶è¿æ¥å¤±è´¥ï¼šè¦ä¹ˆæ˜¯è¿æ¥æ± å·²ç»è¿‡æ—¶å’Œæ–­å¼€ï¼Œæˆ–æ˜¯WebæœåŠ¡å™¨æœ¬èº«æ— æ³•è¾¾æˆã€‚å¦‚æœæœ‰ä¸€ä¸ªæ˜¯å¯ç”¨çš„ï¼ŒOkHttpå°†ä¼šä½¿ç”¨ä¸åŒçš„è·¯ç”±è¿›è¡Œè¯·æ±‚é‡è¯•ã€‚</p>
<h4 id="å‘¼å«"><a href="#å‘¼å«" class="headerlink" title="å‘¼å«"></a><a href="http://square.github.io/okhttp/3.x/okhttp/okhttp3/Call.html" target="_blank" rel="noopener">å‘¼å«</a></h4><p>éšç€é‡å†™ï¼Œé‡å®šå‘ï¼Œåç»­å’Œé‡è¯•ï¼Œä½ ç®€å•çš„è¦æ±‚å¯èƒ½ä¼šäº§ç”Ÿå¾ˆå¤šè¯·æ±‚å’Œå“åº”ã€‚OkHttpä½¿ç”¨å‘¼å«ï¼ˆCallï¼‰å¹¶é€šè¿‡è®¸å¤šå¿…è¦çš„ä¸­é—´è¯·æ±‚å’Œå“åº”æ¥æ»¡è¶³ä½ è¯·æ±‚çš„ä»»åŠ¡æ¨¡å‹ã€‚é€šå¸¸æƒ…å†µï¼Œè¿™æ˜¯ä¸æ˜¯å¾ˆå¤šï¼å¦‚æœæ‚¨çš„ç½‘å€è¢«é‡å®šå‘ï¼Œæˆ–è€…å¦‚æœæ‚¨æ•…éšœè½¬ç§»åˆ°å¦ä¸€ä¸ªIPåœ°å€ï¼Œä½†å®ƒä¼šæ¬£æ…°çš„çŸ¥é“ä½ çš„ä»£ç ä¼šç»§ç»­å·¥ä½œã€‚</p>
<p>é€šè¿‡ä»¥ä¸‹ä¸¤ç§æ–¹å¼è¿›è¡Œå‘¼å«ï¼š </p>
<ul>
<li>åŒæ­¥ï¼šç›´åˆ°å“åº”,ä½ çš„çº¿ç¨‹å—æ˜¯å¯è¯»çš„ã€‚ </li>
<li>å¼‚æ­¥ï¼šä½ åœ¨ä»»ä½•çº¿ç¨‹è¿›è¡Œæ’é˜Ÿè¯·æ±‚ï¼Œå¹¶ä¸”å½“å“åº”æ˜¯å¯è¯»çš„æ—¶å€™ï¼Œä½ ä¼šåœ¨å¦ä¸€ä¸ªçº¿ç¨‹å¾—åˆ°å›è°ƒã€‚</li>
</ul>
<p>å‘¼å«ï¼ˆCallsï¼‰å¯ä»¥åœ¨ä»»ä½•çº¿ç¨‹ä¸­å–æ¶ˆã€‚å¦‚æœå®ƒå°šæœªå®Œæˆï¼Œå®ƒå°†ä½œä¸ºå¤±è´¥çš„å‘¼å«ï¼ˆCallsï¼‰ï¼å½“å‘¼å«ï¼ˆCallï¼‰è¢«å–æ¶ˆçš„æ—¶å€™ï¼Œå¦‚æœä»£ç è¯•å›¾è¿›è¡Œå†™è¯·æ±‚ä½“ï¼ˆrequest bodyï¼‰æˆ–è¯»å–å“åº”ä½“ï¼ˆresponse bodyï¼‰ä¼šé­å—IOExceptionå¼‚å¸¸ã€‚</p>
<h4 id="è°ƒåº¦"><a href="#è°ƒåº¦" class="headerlink" title="è°ƒåº¦"></a>è°ƒåº¦</h4><p>å¯¹äºåŒæ­¥å‘¼å«ï¼Œæ‚¨éœ€è¦è‡ªå¸¦çº¿ç¨‹ï¼Œå¹¶è´Ÿè´£ç®¡ç†å¤šå°‘ä¸ªåŒæ—¶å‘å‡ºçš„è¯·æ±‚ã€‚åŒæ—¶è¿æ¥çš„åƒåœ¾èµ„æºè¿‡å¤š; å¤ªå°‘çš„å±å®³ç­‰å¾…æ—¶é—´ã€‚</p>
<p>å¯¹äºå¼‚æ­¥è°ƒç”¨ï¼Œ<a href="http://square.github.io/okhttp/3.x/okhttp/okhttp3/Dispatcher.html" target="_blank" rel="noopener">Dispatcher</a>å®ç°æœ€å¤§åŒæ—¶è¯·æ±‚çš„ç­–ç•¥ã€‚æ‚¨å¯ä»¥è®¾ç½®æ¯ä¸ªç½‘ç»œæœåŠ¡å™¨çš„æœ€å¤§æ•°é‡ï¼ˆé»˜è®¤å€¼æ˜¯5ï¼‰ï¼Œæ€»ä½“ï¼ˆé»˜è®¤å€¼æ˜¯64ï¼‰ã€‚</p>
<h3 id="Connections-è¿æ¥"><a href="#Connections-è¿æ¥" class="headerlink" title="Connections(è¿æ¥)"></a>Connections(è¿æ¥)</h3><p>è™½ç„¶æ‚¨åªæä¾›äº†URLï¼Œä½†æ˜¯OkHttpè®¡åˆ’ä½¿ç”¨ä¸‰ç§ç±»å‹è¿æ¥åˆ°ä½ çš„webæœåŠ¡å™¨ï¼šURL, Address, å’Œ Route</p>
<h4 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h4><p>URLï¼ˆå¦‚<a href="https://github.com/square/okhttpï¼‰æ˜¯HTTPå’ŒInternetçš„åŸºç¡€ã€‚é™¤äº†ä½œä¸ºç½‘ç»œä¸Šæ‰€æœ‰å†…å®¹çš„é€šç”¨åˆ†æ•£å‘½åæ–¹æ¡ˆä¹‹å¤–ï¼Œä»–ä»¬è¿˜æŒ‡å®šå¦‚ä½•è®¿é—®ç½‘ç»œèµ„æºã€‚" target="_blank" rel="noopener">https://github.com/square/okhttpï¼‰æ˜¯HTTPå’ŒInternetçš„åŸºç¡€ã€‚é™¤äº†ä½œä¸ºç½‘ç»œä¸Šæ‰€æœ‰å†…å®¹çš„é€šç”¨åˆ†æ•£å‘½åæ–¹æ¡ˆä¹‹å¤–ï¼Œä»–ä»¬è¿˜æŒ‡å®šå¦‚ä½•è®¿é—®ç½‘ç»œèµ„æºã€‚</a></p>
<p>ç½‘å€æ˜¯æŠ½è±¡çš„ï¼š</p>
<ul>
<li>ä»–ä»¬æŒ‡å®šçš„è°ƒç”¨å¯èƒ½æ˜¯æ˜æ–‡ï¼ˆhttpï¼‰æˆ–åŠ å¯†ï¼ˆhttpsï¼‰ï¼Œä½†ä¸åº”è¯¥ä½¿ç”¨å“ªäº›åŠ å¯†ç®—æ³•ã€‚ä»–ä»¬ä¹Ÿæ²¡æœ‰æŒ‡å®šå¦‚ä½•éªŒè¯å¯¹ç­‰æ–¹çš„è¯ä¹¦ï¼ˆHostnameVerifierï¼‰æˆ–å“ªäº›è¯ä¹¦å¯ä»¥ä¿¡ä»»ï¼ˆSSLSocketFactoryï¼‰ã€‚ä»–ä»¬ä¹Ÿæ˜¯å…·ä½“çš„ï¼šæ¯ä¸ªURLæ ‡è¯†ä¸€ä¸ªç‰¹å®šçš„è·¯å¾„ï¼ˆå¦‚/square/okhttpï¼‰å’ŒæŸ¥è¯¢ï¼ˆå¦‚?q=sharks&amp;lang=enï¼‰ã€‚æ¯ä¸ªç½‘ç»œæœåŠ¡å™¨éƒ½æœ‰è®¸å¤šç½‘å€ã€‚</li>
<li>å®ƒä»¬ä¸æŒ‡å®šæ˜¯å¦åº”è¯¥ä½¿ç”¨ç‰¹å®šçš„ä»£ç†æœåŠ¡å™¨ï¼Œæˆ–è€…å¦‚ä½•ä½¿ç”¨è¯¥ä»£ç†æœåŠ¡å™¨è¿›è¡Œèº«ä»½éªŒè¯ã€‚</li>
</ul>
<p>ä»–ä»¬ä¹Ÿæ˜¯å…·ä½“çš„ï¼šæ¯ä¸ªURLæ ‡è¯†ä¸€ä¸ªç‰¹å®šçš„è·¯å¾„ï¼ˆå¦‚/square/okhttpï¼‰å’ŒæŸ¥è¯¢ï¼ˆå¦‚?q=sharks&amp;lang=enï¼‰ã€‚æ¯ä¸ªç½‘ç»œæœåŠ¡å™¨éƒ½æœ‰è®¸å¤šç½‘å€ã€‚</p>
<h4 id="Addresses"><a href="#Addresses" class="headerlink" title="Addresses"></a>Addresses</h4><p>åœ°å€æŒ‡å®šä¸€ä¸ªç½‘ç»œæœåŠ¡å™¨ï¼ˆå¦‚github.comï¼‰ä»¥åŠè¿æ¥åˆ°è¯¥æœåŠ¡å™¨æ‰€éœ€çš„æ‰€æœ‰é™æ€é…ç½®ï¼šç«¯å£å·ï¼ŒHTTPSè®¾ç½®å’Œé¦–é€‰ç½‘ç»œåè®®ï¼ˆå¦‚HTTP / 2æˆ–SPDYï¼‰ã€‚</p>
<p>å…±äº«ç›¸åŒåœ°å€çš„URLä¹Ÿå¯èƒ½å…±äº«ç›¸åŒçš„åº•å±‚TCPå¥—æ¥å­—è¿æ¥ã€‚å…±äº«è¿æ¥å…·æœ‰æ˜¾ç€çš„æ€§èƒ½ä¼˜åŠ¿ï¼šæ›´ä½çš„å»¶è¿Ÿï¼Œæ›´é«˜çš„ååé‡ï¼ˆç”±äº<a href="http://www.igvita.com/2011/10/20/faster-web-vs-tcp-slow-start/" target="_blank" rel="noopener">TCPå¯åŠ¨ç¼“æ…¢</a>ï¼‰å’Œä¿å­˜çš„ç”µæ± ã€‚OkHttpä½¿ç”¨<a href="http://square.github.io/okhttp/3.x/okhttp/okhttp3/ConnectionPool.html" target="_blank" rel="noopener">ConnectionPool</a>è‡ªåŠ¨é‡ç”¨HTTP / 1.xè¿æ¥å¹¶å¤ç”¨HTTP / 2å’ŒSPDYè¿æ¥ã€‚</p>
<p>åœ¨OkHttpåœ°å€çš„ä¸€äº›å­—æ®µæ¥è‡ªURLï¼ˆæ–¹æ¡ˆï¼Œä¸»æœºåï¼Œç«¯å£ï¼‰ï¼Œå…¶ä½™æ¥è‡ª<a href="http://square.github.io/okhttp/3.x/okhttp/okhttp3/OkHttpClient.html" target="_blank" rel="noopener">OkHttpClient</a>ã€‚</p>
<h4 id="Routes"><a href="#Routes" class="headerlink" title="Routes"></a>Routes</h4><p>è·¯ç”±æä¾›å®é™…è¿æ¥åˆ°WebæœåŠ¡å™¨æ‰€éœ€çš„åŠ¨æ€ä¿¡æ¯ã€‚è¿™æ˜¯è¦å°è¯•çš„ç‰¹å®šIPåœ°å€ï¼ˆé€šè¿‡DNSæŸ¥è¯¢å‘ç°ï¼‰ï¼Œè¦ä½¿ç”¨çš„ç¡®åˆ‡ä»£ç†æœåŠ¡å™¨ï¼ˆå¦‚æœæ­£åœ¨ä½¿ç”¨<a href="http://developer.android.com/reference/java/net/ProxySelector.html" target="_blank" rel="noopener">ProxySelector</a>ï¼‰ä»¥åŠè¦åå•†å“ªä¸ªç‰ˆæœ¬çš„TLSï¼ˆç”¨äºHTTPSè¿æ¥ï¼‰ã€‚</p>
<p>å•ä¸ªåœ°å€å¯èƒ½æœ‰å¾ˆå¤šè·¯çº¿ã€‚ä¾‹å¦‚ï¼Œæ‰˜ç®¡åœ¨å¤šä¸ªæ•°æ®ä¸­å¿ƒä¸­çš„WebæœåŠ¡å™¨å¯èƒ½ä¼šåœ¨å…¶DNSå“åº”ä¸­äº§ç”Ÿå¤šä¸ªIPåœ°å€ã€‚</p>
<h4 id="Connections"><a href="#Connections" class="headerlink" title="Connections"></a>Connections</h4><p>å½“ä½ ç”¨OkHttpè¯·æ±‚ä¸€ä¸ªURLçš„æ—¶å€™ï¼Œå®ƒçš„åŠŸèƒ½å¦‚ä¸‹ï¼š</p>
<p>å®ƒä½¿ç”¨URLå¹¶é…ç½®OkHttpClientæ¥åˆ›å»ºä¸€ä¸ªåœ°å€ã€‚è¯¥åœ°å€æŒ‡å®šæˆ‘ä»¬å°†å¦‚ä½•è¿æ¥åˆ°WebæœåŠ¡å™¨ã€‚<br>å®ƒå°è¯•ä»è¿æ¥æ± ä¸­æ£€ç´¢å…·æœ‰è¯¥åœ°å€çš„è¿æ¥ã€‚<br>å¦‚æœåœ¨æ± ä¸­æ‰¾ä¸åˆ°è¿æ¥ï¼Œåˆ™é€‰æ‹©è¦å°è¯•çš„è·¯ç”±ã€‚è¿™é€šå¸¸æ„å‘³ç€å‘å‡ºDNSè¯·æ±‚æ¥è·å–æœåŠ¡å™¨çš„IPåœ°å€ã€‚ç„¶åæ ¹æ®éœ€è¦é€‰æ‹©TLSç‰ˆæœ¬å’Œä»£ç†æœåŠ¡å™¨ã€‚<br>å¦‚æœæ˜¯æ–°è·¯ç”±ï¼Œåˆ™é€šè¿‡æ„å»ºç›´æ¥å¥—æ¥å­—è¿æ¥ï¼ŒTLSéš§é“ï¼ˆç”¨äºé€šè¿‡HTTPä»£ç†çš„HTTPSï¼‰æˆ–ç›´æ¥TLSè¿æ¥è¿›è¡Œè¿æ¥ã€‚å®ƒæ ¹æ®éœ€è¦è¿›è¡ŒTLSæ¡æ‰‹ã€‚<br>å®ƒå‘é€HTTPè¯·æ±‚å¹¶è¯»å–å“åº”ã€‚<br>å¦‚æœè¿æ¥æœ‰é—®é¢˜ï¼ŒOkHttpä¼šé€‰æ‹©å¦å¤–ä¸€ä¸ªè·¯å¾„ï¼Œç„¶åé‡è¯•ã€‚è¿™å…è®¸OkHttpåœ¨æœåŠ¡å™¨åœ°å€çš„å­é›†æ— æ³•è®¿é—®æ—¶æ¢å¤ã€‚å½“æ± è¿æ¥å¤±æ•ˆæˆ–å°è¯•çš„TLSç‰ˆæœ¬ä¸å—æ”¯æŒæ—¶ï¼Œè¿™ä¹Ÿå¾ˆæœ‰ç”¨ã€‚</p>
<p>ä¸€æ—¦æ¥æ”¶åˆ°å“åº”ï¼Œè¿æ¥å°†è¢«è¿”å›åˆ°æ± ä¸­ï¼Œä»¥ä¾¿å°†æ¥å¯ä»¥é‡å¤ä½¿ç”¨ã€‚ç»è¿‡ä¸€æ®µæ—¶é—´çš„ä¸æ´»åŠ¨ä¹‹åï¼Œè¿æ¥è¢«ä»æ± ä¸­é€å‡ºã€‚</p>
<h3 id="Recipes-æ–¹æ³•"><a href="#Recipes-æ–¹æ³•" class="headerlink" title="Recipes(æ–¹æ³•)"></a>Recipes(æ–¹æ³•)</h3><p>æˆ‘ä»¬å·²ç»å†™äº†ä¸€äº›æ–¹æ³•ï¼Œæ¼”ç¤ºäº†å¦‚ä½•è§£å†³OkHttpå¸¸è§é—®é¢˜ã€‚é€šè¿‡é˜…è¯»ä»–ä»¬äº†è§£ä¸€åˆ‡æ˜¯å¦‚ä½•æ­£å¸¸å·¥ä½œçš„ã€‚å¯ä»¥è‡ªç”±å‰ªåˆ‡å’Œç²˜è´´è¿™äº›ä¾‹å­ã€‚</p>
<h4 id="åŒæ­¥è·å–-Synchronous-Get"><a href="#åŒæ­¥è·å–-Synchronous-Get" class="headerlink" title="åŒæ­¥è·å–(Synchronous Get)"></a>åŒæ­¥è·å–(Synchronous Get)</h4><p>ä¸‹è½½æ–‡ä»¶ï¼Œæ‰“å°å…¶å¤´éƒ¨ï¼Œå¹¶ä»¥å­—ç¬¦ä¸²å½¢å¼æ‰“å°å…¶å“åº”ä½“ã€‚</p>
<p>è¯¥<code>string()</code>æ–¹æ³•åœ¨å“åº”ä½“ä¸­æ˜¯æ–¹ä¾¿å¿«æ·çš„å°å‹æ–‡ä»¶ã€‚ä½†æ˜¯ï¼Œå¦‚æœå“åº”ä½“è¾ƒå¤§ï¼ˆå¤§äº1 MIBä»¥ä¸Šï¼‰ï¼Œå®ƒä¼šå°†æ•´ä¸ªè¾ƒå¤§æ–‡ä»¶åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œæ‰€ä»¥åº”è¯¥é¿å…<code>string()</code> ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ›´å€¾å‘äºå°†å“åº”ä½“ä½œä¸ºæµè¿›è¡Œå¤„ç†ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> OkHttpClient client = <span class="keyword">new</span> OkHttpClient();</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">  Request request = <span class="keyword">new</span> Request.Builder()</span><br><span class="line">      .url(<span class="string">"https://publicobject.com/helloworld.txt"</span>)</span><br><span class="line">      .build();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">try</span> (Response response = client.newCall(request).execute()) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!response.isSuccessful()) <span class="keyword">throw</span> <span class="keyword">new</span> IOException(<span class="string">"Unexpected code "</span> + response);</span><br><span class="line"></span><br><span class="line">    Headers responseHeaders = response.headers();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; responseHeaders.size(); i++) &#123;</span><br><span class="line">      System.out.println(responseHeaders.name(i) + <span class="string">": "</span> + responseHeaders.value(i));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    System.out.println(response.body().string());</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="å¼‚æ­¥è·å–-Asynchronous-Get"><a href="#å¼‚æ­¥è·å–-Asynchronous-Get" class="headerlink" title="å¼‚æ­¥è·å–(Asynchronous Get)"></a>å¼‚æ­¥è·å–(Asynchronous Get)</h4><p>ä¸‹è½½ä¸€ä¸ªå·¥ä½œçº¿ç¨‹çš„æ–‡ä»¶ï¼Œå½“å“åº”æ˜¯å¯è¯»çš„æ—¶å€™ï¼Œè·å–å›è°ƒï¼ˆCallbackï¼‰ã€‚å½“å“åº”å¤´å·²ç»å‡†å¤‡å¥½åï¼Œå°†äº§ç”Ÿå›è°ƒï¼ˆCallbackï¼‰ã€‚è¯»å–å“åº”ä½“å¯èƒ½ä¸€ç›´é˜»å¡ã€‚ç›®å‰OkHttpä¸æä¾›å¼‚æ­¥APIæ¥æ¥æ”¶å“åº”ä½“çš„éƒ¨ä½ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> OkHttpClient client = <span class="keyword">new</span> OkHttpClient();</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    Request request = <span class="keyword">new</span> Request.Builder()</span><br><span class="line">        .url(<span class="string">"http://publicobject.com/helloworld.txt"</span>)</span><br><span class="line">        .build();</span><br><span class="line"></span><br><span class="line">    client.newCall(request).enqueue(<span class="keyword">new</span> Callback() &#123;</span><br><span class="line">      <span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onFailure</span><span class="params">(Call call, IOException e)</span> </span>&#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onResponse</span><span class="params">(Call call, Response response)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> (ResponseBody responseBody = response.body()) &#123;</span><br><span class="line">          <span class="keyword">if</span> (!response.isSuccessful()) <span class="keyword">throw</span> <span class="keyword">new</span> IOException(<span class="string">"Unexpected code "</span> + response);</span><br><span class="line"></span><br><span class="line">          Headers responseHeaders = response.headers();</span><br><span class="line">          <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>, size = responseHeaders.size(); i &lt; size; i++) &#123;</span><br><span class="line">            System.out.println(responseHeaders.name(i) + <span class="string">": "</span> + responseHeaders.value(i));</span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">          System.out.println(responseBody.string());</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="è®¿é—®å¤´"><a href="#è®¿é—®å¤´" class="headerlink" title="è®¿é—®å¤´"></a>è®¿é—®å¤´</h4><p>å…¸å‹çš„HTTPå¤´å·¥ä½œå°±åƒä¸€ä¸ªMap<string, string=""> ï¼šæ¯ä¸ªå­—æ®µéƒ½æœ‰ä¸€ä¸ªå€¼æˆ–æ— å€¼ã€‚ä½†æ˜¯ï¼Œä¸€äº›å¤´éƒ¨(headers)å…è®¸å¤šä¸ªå€¼ï¼Œæ¯”å¦‚Guavaçš„Multimapã€‚ä¾‹å¦‚ï¼Œå®ƒå…±åŒä¸ºä¸€ä¸ªHTTPå“åº”æä¾›å¤šä¸ªVaryå¤´ã€‚OkHttpçš„APIï¼Œè¯•å›¾ä½¿è¿™ä¸¤ç§æƒ…å†µä¸‹éƒ½èƒ½èˆ’é€‚ä½¿ç”¨ã€‚</string,></p>
<p>å½“å†™è¯·æ±‚å¤´ï¼Œç”¨header(name, value)æ¥ä¸ºå”¯ä¸€å‡ºç°çš„nameè®¾ç½®valueã€‚å¦‚æœå®ƒæœ¬èº«å­˜åœ¨å€¼ï¼Œåœ¨æ·»åŠ æ–°çš„valueä¹‹å‰ï¼Œä»–ä»¬ä¼šè¢«ç§»é™¤ã€‚ä½¿ç”¨addHeader(name, value)æ¥æ·»åŠ å¤´éƒ¨ä¸éœ€è¦ç§»é™¤å½“å‰å­˜åœ¨çš„headersã€‚</p>
<p>å½“è¯»å–å“åº”å¤´ï¼Œç”¨header(name)è¿”å›æœ€åè®¾ç½®nameçš„valueã€‚å¦‚æœæ²¡æœ‰valueï¼Œheader(name)å°†è¿”å›nullã€‚å¯ä»¥ä½¿ç”¨headers(name)æ¥è¯»å–æ‰€æœ‰åˆ—è¡¨å­—æ®µçš„å€¼ï¼Œã€‚</p>
<p>è¦è®¿é—®æ‰€æœ‰çš„å¤´éƒ¨ï¼Œç”¨Headersç±»ï¼Œå®ƒæ”¯æŒç´¢å¼•è®¿é—®ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> OkHttpClient client = <span class="keyword">new</span> OkHttpClient();</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">  Request request = <span class="keyword">new</span> Request.Builder()</span><br><span class="line">      .url(<span class="string">"https://api.github.com/repos/square/okhttp/issues"</span>)</span><br><span class="line">      .header(<span class="string">"User-Agent"</span>, <span class="string">"OkHttp Headers.java"</span>)</span><br><span class="line">      .addHeader(<span class="string">"Accept"</span>, <span class="string">"application/json; q=0.5"</span>)</span><br><span class="line">      .addHeader(<span class="string">"Accept"</span>, <span class="string">"application/vnd.github.v3+json"</span>)</span><br><span class="line">      .build();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">try</span> (Response response = client.newCall(request).execute()) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!response.isSuccessful()) <span class="keyword">throw</span> <span class="keyword">new</span> IOException(<span class="string">"Unexpected code "</span> + response);</span><br><span class="line"></span><br><span class="line">    System.out.println(<span class="string">"Server: "</span> + response.header(<span class="string">"Server"</span>));</span><br><span class="line">    System.out.println(<span class="string">"Date: "</span> + response.header(<span class="string">"Date"</span>));</span><br><span class="line">    System.out.println(<span class="string">"Vary: "</span> + response.headers(<span class="string">"Vary"</span>));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="æäº¤ä¸€ä¸ªæ–‡æœ¬-Posting-a-String"><a href="#æäº¤ä¸€ä¸ªæ–‡æœ¬-Posting-a-String" class="headerlink" title="æäº¤ä¸€ä¸ªæ–‡æœ¬(Posting a String)"></a>æäº¤ä¸€ä¸ªæ–‡æœ¬(Posting a String)</h4><p>ä½¿ç”¨HTTP POSTçš„è¯·æ±‚ä½“å‘é€åˆ°æœåŠ¡ã€‚ä¸‹é¢ä¾‹å­postäº†ä¸€ä¸ªmarkdownæ–‡æ¡£åˆ°ä¸€ä¸ªçš„WebæœåŠ¡ï¼ˆå°†markdownä½œä¸ºHTMLï¼‰ã€‚ç”±äºæ•´ä¸ªè¯·æ±‚ä½“æ˜¯åŒæ—¶åœ¨å†…å­˜ä¸­ï¼Œåº”é¿å…ä½¿ç”¨æ­¤APIå‘é€è¾ƒå¤§ï¼ˆå¤§äº1 MIBï¼‰çš„æ–‡ä»¶ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> MediaType MEDIA_TYPE_MARKDOWN</span><br><span class="line">    = MediaType.parse(<span class="string">"text/x-markdown; charset=utf-8"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> OkHttpClient client = <span class="keyword">new</span> OkHttpClient();</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">  String postBody = <span class="string">""</span></span><br><span class="line">      + <span class="string">"Releases\n"</span></span><br><span class="line">      + <span class="string">"--------\n"</span></span><br><span class="line">      + <span class="string">"\n"</span></span><br><span class="line">      + <span class="string">" * _1.0_ May 6, 2013\n"</span></span><br><span class="line">      + <span class="string">" * _1.1_ June 15, 2013\n"</span></span><br><span class="line">      + <span class="string">" * _1.2_ August 11, 2013\n"</span>;</span><br><span class="line"></span><br><span class="line">  Request request = <span class="keyword">new</span> Request.Builder()</span><br><span class="line">      .url(<span class="string">"https://api.github.com/markdown/raw"</span>)</span><br><span class="line">      .post(RequestBody.create(MEDIA_TYPE_MARKDOWN, postBody))</span><br><span class="line">      .build();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">try</span> (Response response = client.newCall(request).execute()) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!response.isSuccessful()) <span class="keyword">throw</span> <span class="keyword">new</span> IOException(<span class="string">"Unexpected code "</span> + response);</span><br><span class="line"></span><br><span class="line">    System.out.println(response.body().string());</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="å‘å¸ƒä¸€ä¸ªæµ-Post-Streaming"><a href="#å‘å¸ƒä¸€ä¸ªæµ-Post-Streaming" class="headerlink" title="å‘å¸ƒä¸€ä¸ªæµ(Post Streaming)"></a>å‘å¸ƒä¸€ä¸ªæµ(Post Streaming)</h4><p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬POSTè¯·æ±‚ä½“ä½œä¸ºstreamã€‚å°†æ­£åœ¨ç”Ÿæˆè¯·æ±‚ä½“çš„å†…å®¹å†™å…¥åˆ°streamä¸­ã€‚ä¸‹é¢ä¾‹å­streamsç›´æ¥è¿›å…¥<a href="https://github.com/square/okio" target="_blank" rel="noopener">Okio</a>ç¼“å†²æ°´æ§½ã€‚ä½ çš„ç¨‹åºå¯èƒ½æ›´å–œæ¬¢ä½¿ç”¨OutputStreamï¼Œä½ å¯ä»¥é€šè¿‡BufferedSink.outputStreamï¼ˆï¼‰è·å¾— OutputStreamã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> MediaType MEDIA_TYPE_MARKDOWN</span><br><span class="line">    = MediaType.parse(<span class="string">"text/x-markdown; charset=utf-8"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> OkHttpClient client = <span class="keyword">new</span> OkHttpClient();</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">  RequestBody requestBody = <span class="keyword">new</span> RequestBody() &#123;</span><br><span class="line">    <span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> MediaType <span class="title">contentType</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> MEDIA_TYPE_MARKDOWN;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">writeTo</span><span class="params">(BufferedSink sink)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">      sink.writeUtf8(<span class="string">"Numbers\n"</span>);</span><br><span class="line">      sink.writeUtf8(<span class="string">"-------\n"</span>);</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">2</span>; i &lt;= <span class="number">997</span>; i++) &#123;</span><br><span class="line">        sink.writeUtf8(String.format(<span class="string">" * %s = %s\n"</span>, i, factor(i)));</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> String <span class="title">factor</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">2</span>; i &lt; n; i++) &#123;</span><br><span class="line">        <span class="keyword">int</span> x = n / i;</span><br><span class="line">        <span class="keyword">if</span> (x * i == n) <span class="keyword">return</span> factor(x) + <span class="string">" Ã— "</span> + i;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> Integer.toString(n);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  Request request = <span class="keyword">new</span> Request.Builder()</span><br><span class="line">      .url(<span class="string">"https://api.github.com/markdown/raw"</span>)</span><br><span class="line">      .post(requestBody)</span><br><span class="line">      .build();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">try</span> (Response response = client.newCall(request).execute()) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!response.isSuccessful()) <span class="keyword">throw</span> <span class="keyword">new</span> IOException(<span class="string">"Unexpected code "</span> + response);</span><br><span class="line"></span><br><span class="line">    System.out.println(response.body().string());</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="å‘å¸ƒæ–‡ä»¶-Posting-a-File"><a href="#å‘å¸ƒæ–‡ä»¶-Posting-a-File" class="headerlink" title="å‘å¸ƒæ–‡ä»¶(Posting a File)"></a>å‘å¸ƒæ–‡ä»¶(Posting a File)</h4><p>å°†æ–‡ä»¶ä½œä¸ºè¯·æ±‚ä½“æ˜¯å¾ˆå®¹æ˜“çš„ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> MediaType MEDIA_TYPE_MARKDOWN</span><br><span class="line">    = MediaType.parse(<span class="string">"text/x-markdown; charset=utf-8"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> OkHttpClient client = <span class="keyword">new</span> OkHttpClient();</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">  File file = <span class="keyword">new</span> File(<span class="string">"README.md"</span>);</span><br><span class="line"></span><br><span class="line">  Request request = <span class="keyword">new</span> Request.Builder()</span><br><span class="line">      .url(<span class="string">"https://api.github.com/markdown/raw"</span>)</span><br><span class="line">      .post(RequestBody.create(MEDIA_TYPE_MARKDOWN, file))</span><br><span class="line">      .build();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">try</span> (Response response = client.newCall(request).execute()) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!response.isSuccessful()) <span class="keyword">throw</span> <span class="keyword">new</span> IOException(<span class="string">"Unexpected code "</span> + response);</span><br><span class="line"></span><br><span class="line">    System.out.println(response.body().string());</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="å‘å¸ƒè¡¨å•-Posting-form-parameters"><a href="#å‘å¸ƒè¡¨å•-Posting-form-parameters" class="headerlink" title="å‘å¸ƒè¡¨å•(Posting form parameters)"></a>å‘å¸ƒè¡¨å•(Posting form parameters)</h4><p>ä½¿ç”¨<code>FormBody.Builder</code>å»ºç«‹ä¸€ä¸ªè¯·æ±‚ä½“ï¼Œå®ƒå°±åƒä¸€ä¸ªHTMLçš„<code>&lt;form&gt;</code>æ ‡è®°ã€‚<code>Names</code>å’Œ<code>values</code>å°†ä½¿ç”¨<code>HTML</code>å…¼å®¹çš„è¡¨å•URLç¼–ç è¿›è¡Œç¼–ç ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> OkHttpClient client = <span class="keyword">new</span> OkHttpClient();</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">  RequestBody formBody = <span class="keyword">new</span> FormBody.Builder()</span><br><span class="line">      .add(<span class="string">"search"</span>, <span class="string">"Jurassic Park"</span>)</span><br><span class="line">      .build();</span><br><span class="line">  Request request = <span class="keyword">new</span> Request.Builder()</span><br><span class="line">      .url(<span class="string">"https://en.wikipedia.org/w/index.php"</span>)</span><br><span class="line">      .post(formBody)</span><br><span class="line">      .build();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">try</span> (Response response = client.newCall(request).execute()) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!response.isSuccessful()) <span class="keyword">throw</span> <span class="keyword">new</span> IOException(<span class="string">"Unexpected code "</span> + response);</span><br><span class="line"> </span><br><span class="line">    System.out.println(response.body().string());</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="å‘å¸ƒmultipartè¯·æ±‚-Posting-a-multipart-request"><a href="#å‘å¸ƒmultipartè¯·æ±‚-Posting-a-multipart-request" class="headerlink" title="å‘å¸ƒmultipartè¯·æ±‚(Posting a multipart request)"></a>å‘å¸ƒmultipartè¯·æ±‚(Posting a multipart request)</h4><p><code>MultipartBody.Builder</code>å¯ä»¥æ„å»ºä¸HTMLæ–‡ä»¶ä¸Šä¼ è¡¨å•å…¼å®¹çš„å¤æ‚è¯·æ±‚ä¸»ä½“ã€‚multipartè¯·æ±‚ä½“çš„æ¯ä¸€éƒ¨åˆ†æœ¬èº«å°±æ˜¯è¯·æ±‚ä½“ï¼Œå¹¶ä¸”å¯ä»¥å®šä¹‰è‡ªå·±çš„å¤´éƒ¨ã€‚å¦‚æœå­˜åœ¨ï¼Œè¿™äº›å¤´åº”è¯¥æè¿°çš„éƒ¨åˆ†è¯·æ±‚ä½“ï¼Œå¦‚å®ƒçš„<code>Content-Disposition</code>ã€‚å¦‚æœ<code>Content-Length</code>å’Œ <code>Content-Type</code>å¤´éƒ¨å¯ä»¥ä½¿ç”¨ï¼Œåˆ™ä»–ä»¬ä¼šè‡ªåŠ¨æ·»åŠ ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The imgur client ID for OkHttp recipes. If you're using imgur for anything other than running</span></span><br><span class="line"><span class="comment"> * these examples, please request your own client ID! https://api.imgur.com/oauth2</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String IMGUR_CLIENT_ID = <span class="string">"..."</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> MediaType MEDIA_TYPE_PNG = MediaType.parse(<span class="string">"image/png"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> OkHttpClient client = <span class="keyword">new</span> OkHttpClient();</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">  <span class="comment">// Use the imgur image upload API as documented at https://api.imgur.com/endpoints/image</span></span><br><span class="line">  RequestBody requestBody = <span class="keyword">new</span> MultipartBody.Builder()</span><br><span class="line">      .setType(MultipartBody.FORM)</span><br><span class="line">      .addFormDataPart(<span class="string">"title"</span>, <span class="string">"Square Logo"</span>)</span><br><span class="line">      .addFormDataPart(<span class="string">"image"</span>, <span class="string">"logo-square.png"</span>,</span><br><span class="line">          RequestBody.create(MEDIA_TYPE_PNG, <span class="keyword">new</span> File(<span class="string">"website/static/logo-square.png"</span>)))</span><br><span class="line">      .build();</span><br><span class="line"></span><br><span class="line">  Request request = <span class="keyword">new</span> Request.Builder()</span><br><span class="line">      .header(<span class="string">"Authorization"</span>, <span class="string">"Client-ID "</span> + IMGUR_CLIENT_ID)</span><br><span class="line">      .url(<span class="string">"https://api.imgur.com/3/image"</span>)</span><br><span class="line">      .post(requestBody)</span><br><span class="line">      .build();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">try</span> (Response response = client.newCall(request).execute()) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!response.isSuccessful()) <span class="keyword">throw</span> <span class="keyword">new</span> IOException(<span class="string">"Unexpected code "</span> + response);</span><br><span class="line"></span><br><span class="line">    System.out.println(response.body().string());</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="ç”¨Moshiè§£æJSONå“åº”"><a href="#ç”¨Moshiè§£æJSONå“åº”" class="headerlink" title="ç”¨Moshiè§£æJSONå“åº”"></a>ç”¨<code>Moshi</code>è§£æJSONå“åº”</h4><p><a href="https://github.com/square/moshi" target="_blank" rel="noopener">Moshi</a>æ˜¯ä¸€ä¸ªä¾¿æ·çš„APIï¼Œç”¨äºåœ¨JSONå’ŒJavaå¯¹è±¡ä¹‹é—´è¿›è¡Œè½¬æ¢ã€‚è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨å®ƒæ¥è§£ç æ¥è‡ªGitHub APIçš„JSONå“åº”ã€‚</p>
<p>è¯·æ³¨æ„ï¼Œ<code>ResponseBody.charStream()</code>ä½¿ç”¨<code>Content-Type</code>å“åº”å¤´æ¥é€‰æ‹©è§£ç å“åº”ä¸»ä½“æ—¶ä½¿ç”¨å“ªä¸ªå­—ç¬¦é›†ã€‚å¦‚æœæ²¡æœ‰æŒ‡å®šå­—ç¬¦é›†ï¼Œå®ƒé»˜è®¤ä¸º<code>UTF-8</code>ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> OkHttpClient client = <span class="keyword">new</span> OkHttpClient();</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> Moshi moshi = <span class="keyword">new</span> Moshi.Builder().build();</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> JsonAdapter&lt;Gist&gt; gistJsonAdapter = moshi.adapter(Gist.class);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">  Request request = <span class="keyword">new</span> Request.Builder()</span><br><span class="line">      .url(<span class="string">"https://api.github.com/gists/c2a7c39532239ff261be"</span>)</span><br><span class="line">      .build();</span><br><span class="line">  <span class="keyword">try</span> (Response response = client.newCall(request).execute()) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!response.isSuccessful()) <span class="keyword">throw</span> <span class="keyword">new</span> IOException(<span class="string">"Unexpected code "</span> + response);</span><br><span class="line"></span><br><span class="line">    Gist gist = gistJsonAdapter.fromJson(response.body().source());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (Map.Entry&lt;String, GistFile&gt; entry : gist.files.entrySet()) &#123;</span><br><span class="line">      System.out.println(entry.getKey());</span><br><span class="line">      System.out.println(entry.getValue().content);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Gist</span> </span>&#123;</span><br><span class="line">  Map&lt;String, GistFile&gt; files;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">GistFile</span> </span>&#123;</span><br><span class="line">  String content;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="å“åº”ç¼“å­˜"><a href="#å“åº”ç¼“å­˜" class="headerlink" title="å“åº”ç¼“å­˜"></a>å“åº”ç¼“å­˜</h4><p>è¦ç¼“å­˜å“åº”ï¼Œä½ éœ€è¦æœ‰ä¸€ä¸ªç¼“å­˜ç›®å½•æ¥è¿›è¡Œè¯»å–å’Œå†™å…¥ï¼Œå¹¶é™åˆ¶ç¼“å­˜çš„å¤§å°ã€‚ç¼“å­˜ç›®å½•åº”è¯¥æ˜¯ç§æœ‰çš„ï¼Œä¸è¢«ä¿¡ä»»çš„åº”ç”¨ç¨‹åºä¸èƒ½å¤Ÿé˜…è¯»å…¶å†…å®¹ï¼</p>
<p>å¤šä¸ªç¼“å­˜åŒæ—¶è®¿é—®ç›¸åŒçš„ç¼“å­˜ç›®å½•ï¼Œè¿™æ˜¯é”™è¯¯çš„ã€‚å¤§å¤šæ•°åº”ç”¨ç¨‹åºåº”è¯¥è°ƒç”¨ä¸€æ¬¡new OkHttpClient()ï¼Œåœ¨ä»»ä½•åœ°æ–¹éƒ½ä½¿ç”¨ç›¸åŒçš„å®ä¾‹å’Œè‡ªå·±çš„ç¼“å­˜é…ç½®ã€‚å¦åˆ™ï¼Œè¿™ä¸¤ä¸ªç¼“å­˜å®ä¾‹å°†è¸©åˆ°å¯¹æ–¹ï¼Œç ´åå“åº”ç¼“å­˜ï¼Œè¿™å¯èƒ½ä½¿ä½ çš„ç¨‹åºå´©æºƒã€‚</p>
<p>å“åº”ç¼“å­˜ä½¿ç”¨HTTPå¤´è¿›è¡Œé…ç½®ã€‚æ‚¨å¯ä»¥æ·»åŠ è¯·æ±‚å¤´Cache-Control: max-stale=3600ï¼Œè¿™æ ·OkHttpçš„ç¼“å­˜å°±ä¼šéµå¾ªä»–ä»¬ã€‚ä½ çš„ç½‘ç»œæœåŠ¡å™¨å¯ä»¥é€šè¿‡è‡ªå·±çš„å“åº”å¤´é…ç½®ç¼“å­˜å¤šé•¿æ—¶é—´çš„å“åº”ï¼Œå¦‚Cache-Control: max-age=9600ã€‚æœ‰ç¼“å­˜å¤´å¼ºåˆ¶ç¼“å­˜çš„å“åº”ï¼Œå¼ºåˆ¶ç½‘ç»œå“åº”ï¼Œæˆ–å¼ºåˆ¶ä½¿ç”¨æ¡ä»¶GETéªŒè¯çš„ç½‘ç»œå“åº”ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> OkHttpClient client;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">CacheResponse</span><span class="params">(File cacheDirectory)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">  <span class="keyword">int</span> cacheSize = <span class="number">10</span> * <span class="number">1024</span> * <span class="number">1024</span>; <span class="comment">// 10 MiB</span></span><br><span class="line">  Cache cache = <span class="keyword">new</span> Cache(cacheDirectory, cacheSize);</span><br><span class="line"></span><br><span class="line">  client = <span class="keyword">new</span> OkHttpClient.Builder()</span><br><span class="line">      .cache(cache)</span><br><span class="line">      .build();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">  Request request = <span class="keyword">new</span> Request.Builder()</span><br><span class="line">      .url(<span class="string">"http://publicobject.com/helloworld.txt"</span>)</span><br><span class="line">      .build();</span><br><span class="line"></span><br><span class="line">  String response1Body;</span><br><span class="line">  <span class="keyword">try</span> (Response response1 = client.newCall(request).execute()) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!response1.isSuccessful()) <span class="keyword">throw</span> <span class="keyword">new</span> IOException(<span class="string">"Unexpected code "</span> + response1);</span><br><span class="line"></span><br><span class="line">    response1Body = response1.body().string();</span><br><span class="line">    System.out.println(<span class="string">"Response 1 response:          "</span> + response1);</span><br><span class="line">    System.out.println(<span class="string">"Response 1 cache response:    "</span> + response1.cacheResponse());</span><br><span class="line">    System.out.println(<span class="string">"Response 1 network response:  "</span> + response1.networkResponse());</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  String response2Body;</span><br><span class="line">  <span class="keyword">try</span> (Response response2 = client.newCall(request).execute()) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!response2.isSuccessful()) <span class="keyword">throw</span> <span class="keyword">new</span> IOException(<span class="string">"Unexpected code "</span> + response2);</span><br><span class="line"></span><br><span class="line">    response2Body = response2.body().string();</span><br><span class="line">    System.out.println(<span class="string">"Response 2 response:          "</span> + response2);</span><br><span class="line">    System.out.println(<span class="string">"Response 2 cache response:    "</span> + response2.cacheResponse());</span><br><span class="line">    System.out.println(<span class="string">"Response 2 network response:  "</span> + response2.networkResponse());</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  System.out.println(<span class="string">"Response 2 equals Response 1? "</span> + response1Body.equals(response2Body));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨<code>CacheControl.FORCE_NETWORK</code>å¯ä»¥ç¦æ­¢ä½¿ç”¨ç¼“å­˜çš„å“åº”ã€‚ä½¿<code>ç”¨</code>CacheControl.FORCE_CACHE<code>å¯ä»¥ç¦æ­¢ä½¿ç”¨ç½‘ç»œã€‚è­¦å‘Šï¼šå¦‚æœæ‚¨ä½¿ç”¨FORCE_CACHE</code>å’Œå“åº”æ¥è‡ªç½‘ç»œï¼ŒOkHttpå°†ä¼šè¿”å›ä¸€ä¸ª504ä¸å¯æ»¡è¶³è¯·æ±‚çš„å“åº”ã€‚</p>
<h4 id="å–æ¶ˆCall"><a href="#å–æ¶ˆCall" class="headerlink" title="å–æ¶ˆCall"></a>å–æ¶ˆCall</h4><p>é€šè¿‡<code>Call.cancel()</code>æ¥ç«‹å³åœæ­¢æ­£åœ¨è¿›è¡Œçš„Callã€‚å¦‚æœä¸€ä¸ªçº¿ç¨‹ç›®å‰æ­£åœ¨å†™è¯·æ±‚æˆ–è¯»å“åº”ï¼Œå®ƒè¿˜å°†æ”¶åˆ°ä¸€ä¸ª<code>IOException</code>å¼‚å¸¸ã€‚å½“ä¸€ä¸ªCallä¸éœ€è¦æ—¶ï¼Œä½¿ç”¨å–æ¶ˆCallæ¥ä¿æŠ¤ç½‘ç»œ; ä¾‹å¦‚ï¼Œå½“ç”¨æˆ·ä»åº”ç”¨ç¨‹åºå¯¼èˆªç¦»å¼€ã€‚åŒæ­¥å’Œå¼‚æ­¥è°ƒç”¨å¯ä»¥è¢«å–æ¶ˆã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> ScheduledExecutorService executor = Executors.newScheduledThreadPool(<span class="number">1</span>);</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> OkHttpClient client = <span class="keyword">new</span> OkHttpClient();</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">  Request request = <span class="keyword">new</span> Request.Builder()</span><br><span class="line">      .url(<span class="string">"http://httpbin.org/delay/2"</span>) <span class="comment">// This URL is served with a 2 second delay.</span></span><br><span class="line">      .build();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">final</span> <span class="keyword">long</span> startNanos = System.nanoTime();</span><br><span class="line">  <span class="keyword">final</span> Call call = client.newCall(request);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Schedule a job to cancel the call in 1 second.</span></span><br><span class="line">  executor.schedule(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">    <span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      System.out.printf(<span class="string">"%.2f Canceling call.%n"</span>, (System.nanoTime() - startNanos) / <span class="number">1e9f</span>);</span><br><span class="line">      call.cancel();</span><br><span class="line">      System.out.printf(<span class="string">"%.2f Canceled call.%n"</span>, (System.nanoTime() - startNanos) / <span class="number">1e9f</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, <span class="number">1</span>, TimeUnit.SECONDS);</span><br><span class="line"></span><br><span class="line">  System.out.printf(<span class="string">"%.2f Executing call.%n"</span>, (System.nanoTime() - startNanos) / <span class="number">1e9f</span>);</span><br><span class="line">  <span class="keyword">try</span> (Response response = call.execute()) &#123;</span><br><span class="line">    System.out.printf(<span class="string">"%.2f Call was expected to fail, but completed: %s%n"</span>,</span><br><span class="line">        (System.nanoTime() - startNanos) / <span class="number">1e9f</span>, response);</span><br><span class="line">  &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">    System.out.printf(<span class="string">"%.2f Call failed as expected: %s%n"</span>,</span><br><span class="line">        (System.nanoTime() - startNanos) / <span class="number">1e9f</span>, e);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="è¶…æ—¶"><a href="#è¶…æ—¶" class="headerlink" title="è¶…æ—¶"></a>è¶…æ—¶</h4><p>å½“æ— æ³•è®¿é—®æŸ¥è¯¢æ—¶ï¼Œå°†è°ƒç”¨è¶…æ—¶å¤±è´¥ã€‚è¶…æ—¶åœ¨ç½‘ç»œåˆ’åˆ†ä¸­å¯ä»¥æ˜¯ç”±äºå®¢æˆ·ç«¯è¿æ¥é—®é¢˜ï¼ŒæœåŠ¡å™¨å¯ç”¨æ€§çš„é—®é¢˜ï¼Œæˆ–ä¸¤è€…ä¹‹é—´çš„ä»»ä½•ä¸œè¥¿ã€‚OkHttpæ”¯æŒè¿æ¥ï¼Œè¯»å–å’Œå†™å…¥è¶…æ—¶ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> OkHttpClient client;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ConfigureTimeouts</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">  client = <span class="keyword">new</span> OkHttpClient.Builder()</span><br><span class="line">      .connectTimeout(<span class="number">10</span>, TimeUnit.SECONDS)</span><br><span class="line">      .writeTimeout(<span class="number">10</span>, TimeUnit.SECONDS)</span><br><span class="line">      .readTimeout(<span class="number">30</span>, TimeUnit.SECONDS)</span><br><span class="line">      .build();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">  Request request = <span class="keyword">new</span> Request.Builder()</span><br><span class="line">      .url(<span class="string">"http://httpbin.org/delay/2"</span>) <span class="comment">// This URL is served with a 2 second delay.</span></span><br><span class="line">      .build();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">try</span> (Response response = client.newCall(request).execute()) &#123;</span><br><span class="line">    System.out.println(<span class="string">"Response completed: "</span> + response);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="æ¯ä¸ªå‘¼å«é…ç½®"><a href="#æ¯ä¸ªå‘¼å«é…ç½®" class="headerlink" title="æ¯ä¸ªå‘¼å«é…ç½®"></a>æ¯ä¸ªå‘¼å«é…ç½®</h4><p>æ‰€æœ‰çš„HTTPå®¢æˆ·ç«¯éƒ½åœ¨<code>OkHttpClient</code>ä¸­é…ç½®ï¼Œè¿™åŒ…æ‹¬ä»£ç†è®¾ç½®ï¼Œè¶…æ—¶å’Œç¼“å­˜ã€‚å½“ä½ éœ€è¦æ”¹å˜å•ä¸€Callçš„é…ç½®æ—¶ï¼Œè°ƒç”¨<code>OkHttpClient.newBuilder()</code>ã€‚è¿™å°†è¿”å›å…±äº«ç›¸åŒçš„è¿æ¥æ± ï¼Œè°ƒåº¦å’Œé…ç½®çš„åŸå®¢æˆ·ç«¯çš„å»ºé€ å™¨ã€‚åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åšäº†500æ¯«ç§’è¶…æ—¶ï¼Œå¦å¤–ä¸€ä¸ª3000æ¯«ç§’è¶…æ—¶è¯·æ±‚ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> OkHttpClient client = <span class="keyword">new</span> OkHttpClient();</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">  Request request = <span class="keyword">new</span> Request.Builder()</span><br><span class="line">      .url(<span class="string">"http://httpbin.org/delay/1"</span>) <span class="comment">// This URL is served with a 1 second delay.</span></span><br><span class="line">      .build();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Copy to customize OkHttp for this request.</span></span><br><span class="line">  OkHttpClient client1 = client.newBuilder()</span><br><span class="line">      .readTimeout(<span class="number">500</span>, TimeUnit.MILLISECONDS)</span><br><span class="line">      .build();</span><br><span class="line">  <span class="keyword">try</span> (Response response = client1.newCall(request).execute()) &#123;</span><br><span class="line">    System.out.println(<span class="string">"Response 1 succeeded: "</span> + response);</span><br><span class="line">  &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">    System.out.println(<span class="string">"Response 1 failed: "</span> + e);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Copy to customize OkHttp for this request.</span></span><br><span class="line">  OkHttpClient client2 = client.newBuilder()</span><br><span class="line">      .readTimeout(<span class="number">3000</span>, TimeUnit.MILLISECONDS)</span><br><span class="line">      .build();</span><br><span class="line">  <span class="keyword">try</span> (Response response = client2.newCall(request).execute()) &#123;</span><br><span class="line">    System.out.println(<span class="string">"Response 2 succeeded: "</span> + response);</span><br><span class="line">  &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">    System.out.println(<span class="string">"Response 2 failed: "</span> + e);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="è®¤è¯å¤„ç†"><a href="#è®¤è¯å¤„ç†" class="headerlink" title="è®¤è¯å¤„ç†"></a>è®¤è¯å¤„ç†</h4><p>OkHttpèƒ½å¤Ÿè‡ªåŠ¨é‡è¯•æœªç»æˆæƒçš„è¯·æ±‚ã€‚å½“å“åº”æ˜¯<code>401 Not Authorized</code>ï¼Œä¸€ä¸ª<code>Authenticator</code>è¢«è¦æ±‚æä¾›å‡­æ®ã€‚åº”è¯¥å»ºç«‹ä¸€ä¸ªåŒ…å«ç¼ºå°‘å‡­æ®çš„æ–°è¦æ±‚ã€‚å¦‚æœæ²¡æœ‰å‡­è¯å¯ç”¨ï¼Œåˆ™è¿”å›nullè·³è¿‡é‡è¯•ã€‚</p>
<p>ä½¿ç”¨<code>Response.challengesï¼ˆï¼‰</code>è·å¾—ä»»ä½•è®¤è¯æŒ‘æˆ˜æ–¹æ¡ˆå’Œé¢†åŸŸã€‚å½“å®Œæˆä¸€ä¸ªåŸºæœ¬çš„æŒ‘æˆ˜ï¼Œç”¨<code>Credentials.basic(username, password)</code>ç¼–ç è¯·æ±‚å¤´ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> OkHttpClient client;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">Authenticate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  client = <span class="keyword">new</span> OkHttpClient.Builder()</span><br><span class="line">      .authenticator(<span class="keyword">new</span> Authenticator() &#123;</span><br><span class="line">        <span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> Request <span class="title">authenticate</span><span class="params">(Route route, Response response)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">          <span class="keyword">if</span> (response.request().header(<span class="string">"Authorization"</span>) != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>; <span class="comment">// Give up, we've already attempted to authenticate.</span></span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">          System.out.println(<span class="string">"Authenticating for response: "</span> + response);</span><br><span class="line">          System.out.println(<span class="string">"Challenges: "</span> + response.challenges());</span><br><span class="line">          String credential = Credentials.basic(<span class="string">"jesse"</span>, <span class="string">"password1"</span>);</span><br><span class="line">          <span class="keyword">return</span> response.request().newBuilder()</span><br><span class="line">              .header(<span class="string">"Authorization"</span>, credential)</span><br><span class="line">              .build();</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">      .build();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">  Request request = <span class="keyword">new</span> Request.Builder()</span><br><span class="line">      .url(<span class="string">"http://publicobject.com/secrets/hellosecret.txt"</span>)</span><br><span class="line">      .build();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">try</span> (Response response = client.newCall(request).execute()) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!response.isSuccessful()) <span class="keyword">throw</span> <span class="keyword">new</span> IOException(<span class="string">"Unexpected code "</span> + response);</span><br><span class="line"></span><br><span class="line">    System.out.println(response.body().string());</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>ä¸ºäº†é¿å…éªŒè¯æ—¶ä¸å·¥ä½œçš„é‡è¯•ï¼Œä½ å¯ä»¥è¿”å›nullæ”¾å¼ƒã€‚ä¾‹å¦‚ï¼Œå½“è¿™äº›ç¡®åˆ‡çš„å‡­æ®å·²ç»å°è¯•,æ‚¨å¯ä»¥è·³è¿‡é‡è¯•ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (credential.equals(response.request().header(<span class="string">"Authorization"</span>))) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">null</span>; <span class="comment">// å¦‚æœæˆ‘ä»¬å·²ç»ä½¿ç”¨è¿™äº›å‡­æ®å¤±è´¥ï¼Œä¸é‡è¯•</span></span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure></p>
<p>å½“ä½ çš„åº”ç”¨å°è¯•çš„æ¬¡æ•°è¶…è¿‡äº†é™åˆ¶çš„æ¬¡æ•°æ—¶ï¼Œä½ å¯ä»¥è·³è¿‡é‡è¯•ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (responseCount(response) &gt;= <span class="number">3</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>; <span class="comment">//å¦‚æœæˆ‘ä»¬å·²ç»å¤±è´¥äº†3æ¬¡ï¼Œæ”¾å¼ƒã€‚ .</span></span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></p>
<p>è¿™ä¸Šé¢çš„ä»£ç ä¾èµ–äºä¸‹é¢çš„<code>responseCount()</code>æ–¹æ³•ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">responseCount</span><span class="params">(Response response)</span> </span>&#123;</span><br><span class="line">   <span class="keyword">int</span> result = <span class="number">1</span>;</span><br><span class="line">   <span class="keyword">while</span> ((response = response.priorResponse()) != <span class="keyword">null</span>) &#123;</span><br><span class="line">     result++;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span> result;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="Interceptors-æ‹¦æˆªå™¨"><a href="#Interceptors-æ‹¦æˆªå™¨" class="headerlink" title="Interceptors(æ‹¦æˆªå™¨)"></a>Interceptors(æ‹¦æˆªå™¨)</h3><p>æ‹¦æˆªå™¨æ˜¯ä¸€ä¸ªå¼ºå¤§çš„æœºåˆ¶ï¼Œå®ƒå¯ä»¥ç›‘æ§ï¼Œé‡å†™å’Œé‡è¯•Callsã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•è®°å½•ä¼ å‡ºè¯·æ±‚å’Œå“åº”ä¼ å…¥çš„æ‹¦æˆªå™¨ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LoggingInterceptor</span> <span class="keyword">implements</span> <span class="title">Interceptor</span> </span>&#123;</span><br><span class="line">  <span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> Response <span class="title">intercept</span><span class="params">(Interceptor.Chain chain)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    Request request = chain.request();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">long</span> t1 = System.nanoTime();</span><br><span class="line">    logger.info(String.format(<span class="string">"Sending request %s on %s%n%s"</span>,</span><br><span class="line">        request.url(), chain.connection(), request.headers()));</span><br><span class="line"></span><br><span class="line">    Response response = chain.proceed(request);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">long</span> t2 = System.nanoTime();</span><br><span class="line">    logger.info(String.format(<span class="string">"Received response for %s in %.1fms%n%s"</span>,</span><br><span class="line">        response.request().url(), (t2 - t1) / <span class="number">1e6</span>d, response.headers()));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> response;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>è°ƒç”¨<code>chain.proceed(request)</code>æ˜¯æ¯ä¸ªæ‹¦æˆªå™¨å®ç°çš„å…³é”®éƒ¨åˆ†ã€‚è¿™ä¸ªçœ‹èµ·æ¥å¾ˆç®€å•çš„æ–¹æ³•å°±æ˜¯æ‰€æœ‰HTTPå·¥ä½œå‘ç”Ÿçš„åœ°æ–¹ï¼Œäº§ç”Ÿæ»¡è¶³è¯·æ±‚çš„å“åº”ã€‚</p>
<p>æ‹¦æˆªå™¨å¯ä»¥è¢«é“¾æ¥ã€‚å‡è®¾ä½ æœ‰ä¸€ä¸ªå‹ç¼©æ‹¦æˆªå™¨å’Œä¸€ä¸ªæ ¡éªŒå’Œæ‹¦æˆªå™¨ï¼šä½ éœ€è¦å†³å®šæ•°æ®æ˜¯å‹ç¼©çš„ï¼Œç„¶åè¿›è¡Œæ ¡éªŒå’Œï¼Œæˆ–è€…æ ¡éªŒå’Œå‹ç¼©ã€‚OkHttpä½¿ç”¨åˆ—è¡¨æ¥è·Ÿè¸ªæ‹¦æˆªå™¨ï¼Œæ‹¦æˆªå™¨æ˜¯æŒ‰é¡ºåºè°ƒç”¨çš„ã€‚<br><img src="https://raw.githubusercontent.com/wiki/square/okhttp/interceptors@2x.png" alt=""></p>
<h4 id="åº”ç”¨ç¨‹åºæ‹¦æˆªå™¨"><a href="#åº”ç”¨ç¨‹åºæ‹¦æˆªå™¨" class="headerlink" title="åº”ç”¨ç¨‹åºæ‹¦æˆªå™¨"></a>åº”ç”¨ç¨‹åºæ‹¦æˆªå™¨</h4><p>æ‹¦æˆªå™¨å¯ä»¥æ³¨å†Œä¸ºåº”ç”¨æ‹¦æˆªå™¨æˆ–ç½‘ç»œæ‹¦æˆªå™¨ã€‚æˆ‘ä»¬å°†ä½¿ç”¨<code>LoggingInterceptor</code>æ¥åŒºåˆ«ã€‚</p>
<p>é€šè¿‡åœ¨<code>OkHttpClient.Builder</code>ä¸Šè°ƒç”¨<code>addInterceptorï¼ˆï¼‰</code>æ¥æ³¨å†Œåº”ç”¨ç¨‹åºæ‹¦æˆªå™¨ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">OkHttpClient client = <span class="keyword">new</span> OkHttpClient.Builder()</span><br><span class="line">    .addInterceptor(<span class="keyword">new</span> LoggingInterceptor())</span><br><span class="line">    .build();</span><br><span class="line"></span><br><span class="line">Request request = <span class="keyword">new</span> Request.Builder()</span><br><span class="line">    .url(<span class="string">"http://www.publicobject.com/helloworld.txt"</span>)</span><br><span class="line">    .header(<span class="string">"User-Agent"</span>, <span class="string">"OkHttp Example"</span>)</span><br><span class="line">    .build();</span><br><span class="line"></span><br><span class="line">Response response = client.newCall(request).execute();</span><br><span class="line">response.body().close();</span><br></pre></td></tr></table></figure></p>
<p>è¯¥URLï¼š<a href="http://www.publicobject.com/helloworld.txt" target="_blank" rel="noopener">http://www.publicobject.com/helloworld.txt</a> é‡å®šå‘åˆ°<a href="https://publicobject.com/helloworld.txt" target="_blank" rel="noopener">https://publicobject.com/helloworld.txt</a>, OkHttpè‡ªåŠ¨é‡å®šå‘ã€‚æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºæ‹¦æˆªå™¨è¢«è°ƒç”¨ä¸€æ¬¡ï¼Œè¿”å›çš„å“åº”chain.proceed()å…·æœ‰é‡å®šå‘çš„å“åº”ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">INFO: Sending request http:<span class="comment">//www.publicobject.com/helloworld.txt on null</span></span><br><span class="line">User-Agent: OkHttp Example</span><br><span class="line"></span><br><span class="line">INFO: Received response <span class="keyword">for</span> https:<span class="comment">//publicobject.com/helloworld.txt in 1179.7ms</span></span><br><span class="line">Server: nginx/<span class="number">1.4</span>.6 (Ubuntu)</span><br><span class="line">Content-Type: text/plain</span><br><span class="line">Content-Length: <span class="number">1759</span></span><br><span class="line">Connection: keep-alive</span><br></pre></td></tr></table></figure></p>
<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬è¢«é‡å®šå‘äº†ï¼Œå› ä¸º<code>response.request().url()</code>ä¸åŒäº<code>request.url()</code>ã€‚è¿™ä¸¤ä¸ªæ—¥å¿—è¯­å¥è®°å½•ä¸¤ä¸ªä¸åŒçš„URLã€‚</p>
<h4 id="ç½‘ç»œæ‹¦æˆªå™¨"><a href="#ç½‘ç»œæ‹¦æˆªå™¨" class="headerlink" title="ç½‘ç»œæ‹¦æˆªå™¨"></a>ç½‘ç»œæ‹¦æˆªå™¨</h4><p>æ³¨å†Œç½‘ç»œæ‹¦æˆªå™¨å¾ˆç±»ä¼¼ã€‚è°ƒç”¨<code>addNetworkInterceptor()</code>ä»£æ›¿<code>addInterceptor()</code>ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">OkHttpClient client = <span class="keyword">new</span> OkHttpClient.Builder()</span><br><span class="line">    .addNetworkInterceptor(<span class="keyword">new</span> LoggingInterceptor())</span><br><span class="line">    .build();</span><br><span class="line"></span><br><span class="line">Request request = <span class="keyword">new</span> Request.Builder()</span><br><span class="line">    .url(<span class="string">"http://www.publicobject.com/helloworld.txt"</span>)</span><br><span class="line">    .header(<span class="string">"User-Agent"</span>, <span class="string">"OkHttp Example"</span>)</span><br><span class="line">    .build();</span><br><span class="line"></span><br><span class="line">Response response = client.newCall(request).execute();</span><br><span class="line">response.body().close();</span><br></pre></td></tr></table></figure></p>
<p>å½“æˆ‘ä»¬è¿è¡Œè¿™ä¸ªä»£ç æ—¶ï¼Œæ‹¦æˆªå™¨è¿è¡Œä¸¤æ¬¡ã€‚ä¸€æ¬¡ä¸ºæœ€åˆçš„è¯·æ±‚<code>http://www.publicobject.com/helloworld.txt</code>ï¼Œå¦ä¸€ä¸ªä¸ºé‡å®šå‘<code>https://publicobject.com/helloworld.txt</code>ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">INFO: Sending request http:<span class="comment">//www.publicobject.com/helloworld.txt on Connection&#123;www.publicobject.com:80, proxy=DIRECT hostAddress=54.187.32.157 cipherSuite=none protocol=http/1.1&#125;</span></span><br><span class="line">User-Agent: OkHttp Example</span><br><span class="line">Host: www.publicobject.com</span><br><span class="line">Connection: Keep-Alive</span><br><span class="line">Accept-Encoding: gzip</span><br><span class="line"></span><br><span class="line">INFO: Received response <span class="keyword">for</span> http:<span class="comment">//www.publicobject.com/helloworld.txt in 115.6ms</span></span><br><span class="line">Server: nginx/<span class="number">1.4</span>.6 (Ubuntu)</span><br><span class="line">Content-Type: text/html</span><br><span class="line">Content-Length: <span class="number">193</span></span><br><span class="line">Connection: keep-alive</span><br><span class="line">Location: https:<span class="comment">//publicobject.com/helloworld.txt</span></span><br><span class="line"></span><br><span class="line">INFO: Sending request https:<span class="comment">//publicobject.com/helloworld.txt on Connection&#123;publicobject.com:443, proxy=DIRECT hostAddress=54.187.32.157 cipherSuite=TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA protocol=http/1.1&#125;</span></span><br><span class="line">User-Agent: OkHttp Example</span><br><span class="line">Host: publicobject.com</span><br><span class="line">Connection: Keep-Alive</span><br><span class="line">Accept-Encoding: gzip</span><br><span class="line"></span><br><span class="line">INFO: Received response <span class="keyword">for</span> https:<span class="comment">//publicobject.com/helloworld.txt in 80.9ms</span></span><br><span class="line">Server: nginx/<span class="number">1.4</span>.6 (Ubuntu)</span><br><span class="line">Content-Type: text/plain</span><br><span class="line">Content-Length: <span class="number">1759</span></span><br><span class="line">Connection: keep-alive</span><br></pre></td></tr></table></figure></p>
<p>ç½‘ç»œè¯·æ±‚è¿˜åŒ…å«å¾ˆå¤šæ•°æ®ï¼Œå¦‚<code>OkHttp</code>åŠ å…¥<code>Accept-Encoding: gzip</code>å¤´éƒ¨é€šçŸ¥æ”¯æŒå‹ç¼©å“åº”ã€‚ç½‘ç»œæ‹¦æˆªå™¨çš„é“¾å…·æœ‰éç©ºçš„è¿æ¥ï¼Œå®ƒå¯ç”¨äºè¯¢é—®IPåœ°å€å’Œè¿æ¥åˆ°ç½‘ç»œæœåŠ¡å™¨çš„TLSé…ç½®ã€‚</p>
<h4 id="åº”ç”¨ç¨‹åºå’Œç½‘ç»œæ‹¦æˆªä¹‹é—´è¿›è¡Œé€‰æ‹©"><a href="#åº”ç”¨ç¨‹åºå’Œç½‘ç»œæ‹¦æˆªä¹‹é—´è¿›è¡Œé€‰æ‹©" class="headerlink" title="åº”ç”¨ç¨‹åºå’Œç½‘ç»œæ‹¦æˆªä¹‹é—´è¿›è¡Œé€‰æ‹©"></a>åº”ç”¨ç¨‹åºå’Œç½‘ç»œæ‹¦æˆªä¹‹é—´è¿›è¡Œé€‰æ‹©</h4><p>æ¯ä¸ªæ‹¦æˆªå™¨é“¾(interceptor chain)éƒ½å…·æœ‰ç›¸å¯¹ä¼˜åŠ¿ã€‚</p>
<h5 id="åº”ç”¨æ‹¦æˆªå™¨"><a href="#åº”ç”¨æ‹¦æˆªå™¨" class="headerlink" title="åº”ç”¨æ‹¦æˆªå™¨"></a>åº”ç”¨æ‹¦æˆªå™¨</h5><ul>
<li>ä¸å¿…æ‹…å¿ƒåƒé‡å®šå‘å’Œé‡è¯•çš„ä¸­é—´å“åº”ã€‚</li>
<li>æ€»æ˜¯è¢«è°ƒç”¨ä¸€æ¬¡ï¼Œå³ä½¿HTTPå“åº”æ¥è‡ªç¼“å­˜æœåŠ¡ã€‚</li>
<li>è§‚å¯Ÿåº”ç”¨ç¨‹åºçš„åŸæ„ã€‚ä¸å…³å¿ƒOkHttpæ³¨å…¥çš„å¤´æ–‡ä»¶ï¼Œå¦‚ If-None-Matchã€‚</li>
<li>å…è®¸çŸ­è·¯å’Œä¸è°ƒç”¨Chain.proceedï¼ˆï¼‰ ã€‚</li>
<li>å…è®¸é‡è¯•ï¼Œå¹¶å¤šæ¬¡è°ƒç”¨Chain.proceedï¼ˆï¼‰ ã€‚</li>
</ul>
<h5 id="ç½‘ç»œæ‹¦æˆªå™¨-1"><a href="#ç½‘ç»œæ‹¦æˆªå™¨-1" class="headerlink" title="ç½‘ç»œæ‹¦æˆªå™¨"></a>ç½‘ç»œæ‹¦æˆªå™¨</h5><ul>
<li>èƒ½å¤Ÿæ“ä½œåƒé‡å®šå‘å’Œé‡è¯•çš„ä¸­é—´å“åº”ã€‚</li>
<li>åœ¨çŸ­è·¯ç½‘ç»œä¸Šä¸è°ƒç”¨ç¼“å­˜çš„å“åº”ã€‚</li>
<li>è§‚å¯Ÿåœ¨ç½‘ç»œä¸Šä¼ è¾“çš„æ•°æ®ã€‚</li>
<li>è®¿é—®Connectionæ‰¿è½½è¯·æ±‚ã€‚</li>
</ul>
<h4 id="é‡å†™è¯·æ±‚-1"><a href="#é‡å†™è¯·æ±‚-1" class="headerlink" title="é‡å†™è¯·æ±‚"></a>é‡å†™è¯·æ±‚</h4><p>æ‹¦æˆªå™¨å¯ä»¥æ·»åŠ ï¼Œåˆ é™¤æˆ–æ›¿æ¢è¯·æ±‚å¤´ã€‚ä»–ä»¬è¿˜å¯ä»¥è½¬æ¢è¯·æ±‚ä½“ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ è¿æ¥åˆ°å·²çŸ¥æ”¯æŒå®ƒçš„ç½‘ç»œæœåŠ¡å™¨ï¼Œä½ å¯ä»¥ä½¿ç”¨åº”ç”¨ç¨‹åºæ‹¦æˆªå™¨æ·»åŠ è¯·æ±‚ä½“çš„å‹ç¼©ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** This interceptor compresses the HTTP request body. Many webservers can't handle this! */</span></span><br><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">GzipRequestInterceptor</span> <span class="keyword">implements</span> <span class="title">Interceptor</span> </span>&#123;</span><br><span class="line">  <span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> Response <span class="title">intercept</span><span class="params">(Interceptor.Chain chain)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    Request originalRequest = chain.request();</span><br><span class="line">    <span class="keyword">if</span> (originalRequest.body() == <span class="keyword">null</span> || originalRequest.header(<span class="string">"Content-Encoding"</span>) != <span class="keyword">null</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> chain.proceed(originalRequest);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Request compressedRequest = originalRequest.newBuilder()</span><br><span class="line">        .header(<span class="string">"Content-Encoding"</span>, <span class="string">"gzip"</span>)</span><br><span class="line">        .method(originalRequest.method(), gzip(originalRequest.body()))</span><br><span class="line">        .build();</span><br><span class="line">    <span class="keyword">return</span> chain.proceed(compressedRequest);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">private</span> RequestBody <span class="title">gzip</span><span class="params">(<span class="keyword">final</span> RequestBody body)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> RequestBody() &#123;</span><br><span class="line">      <span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> MediaType <span class="title">contentType</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> body.contentType();</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">contentLength</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span>; <span class="comment">// We don't know the compressed length in advance!</span></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">writeTo</span><span class="params">(BufferedSink sink)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        BufferedSink gzipSink = Okio.buffer(<span class="keyword">new</span> GzipSink(sink));</span><br><span class="line">        body.writeTo(gzipSink);</span><br><span class="line">        gzipSink.close();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="é‡å†™å“åº”-1"><a href="#é‡å†™å“åº”-1" class="headerlink" title="é‡å†™å“åº”"></a>é‡å†™å“åº”</h4><p>ç›¸å¯¹åº”çš„ï¼Œæ‹¦æˆªå™¨ä¹Ÿå¯ä»¥é‡å†™å“åº”å¤´å’Œè½¬æ¢å“åº”ä½“ã€‚é€šå¸¸ä¸è¦é‡å†™è¯·æ±‚å¤´ï¼Œå› ä¸ºå®ƒå¯èƒ½è¿åäº†WebæœåŠ¡å™¨çš„æœŸæœ›å¯¼è‡´æ›´å±é™©ï¼</p>
<p>åœ¨ä¸€ä¸ªæ£˜æ‰‹çš„æƒ…å†µä¸‹ï¼Œå¦‚æœå·²ç»åšå¥½åº”å¯¹çš„åæœï¼Œé‡å†™å“åº”å¤´æ˜¯è§£å†³é—®é¢˜çš„æœ‰æ•ˆæ–¹å¼ã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥ä¿®å¤æœåŠ¡å™¨çš„é…ç½®é”™è¯¯çš„Cache-Controlå“åº”å¤´ä»¥ä¾¿æ›´å¥½åœ°å“åº”ç¼“å­˜ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** Dangerous interceptor that rewrites the server's cache-control header. */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Interceptor REWRITE_CACHE_CONTROL_INTERCEPTOR = <span class="keyword">new</span> Interceptor() &#123;</span><br><span class="line">  <span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> Response <span class="title">intercept</span><span class="params">(Interceptor.Chain chain)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    Response originalResponse = chain.proceed(chain.request());</span><br><span class="line">    <span class="keyword">return</span> originalResponse.newBuilder()</span><br><span class="line">        .header(<span class="string">"Cache-Control"</span>, <span class="string">"max-age=60"</span>)</span><br><span class="line">        .build();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p>é€šå¸¸æ­¤æ–¹æ³•æ•ˆæœæœ€å¥½ï¼Œå®ƒè¡¥å……äº†åœ¨WebæœåŠ¡å™¨ä¸Šç›¸åº”çš„ä¿®å¤ï¼</p>
<h4 id="å¯ç”¨æ€§"><a href="#å¯ç”¨æ€§" class="headerlink" title="å¯ç”¨æ€§"></a>å¯ç”¨æ€§</h4><p>OkHttpçš„æ‹¦æˆªå™¨éœ€è¦OkHttp 2.2æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚ä¸å¹¸çš„æ˜¯ï¼Œæ‹¦æˆªå™¨ä¸é€‚<code>OkUrlFactory</code>ç”¨äºæ„å»ºå®ƒçš„åº“ï¼ŒåŒ…æ‹¬<a href="http://square.github.io/retrofit/" target="_blank" rel="noopener">Retrofitâ‰¤1.8</a>å’Œ<a href="http://square.github.io/picasso/" target="_blank" rel="noopener">Picassoâ‰¤2.4</a>ã€‚</p>
<h3 id="HTTPS"><a href="#HTTPS" class="headerlink" title="HTTPS"></a>HTTPS</h3><p>OkHttpè¯•å›¾å¹³è¡¡ä¸¤ä¸ªç›¸äº’ç«äº‰çš„æ‹…å¿§ï¼š</p>
<ul>
<li>è¿æ¥åˆ°å°½å¯èƒ½å¤šçš„ä¸»æœºã€‚è¿™åŒ…æ‹¬è¿è¡Œæœ€æ–°ç‰ˆæœ¬çš„<a href="https://boringssl.googlesource.com/boringssl/" target="_blank" rel="noopener">boringssl</a>çš„é«˜çº§ä¸»æœºï¼Œä»¥åŠè¿è¡Œæ—§ç‰ˆæœ¬<a href="https://www.openssl.org/" target="_blank" rel="noopener">OpenSSL</a>çš„è¿‡æ—¶ä¸»æœºã€‚</li>
<li>è¿æ¥çš„å®‰å…¨æ€§ã€‚è¿™åŒ…æ‹¬éªŒè¯å…·æœ‰è¯ä¹¦çš„è¿œç¨‹ç½‘ç»œæœåŠ¡å™¨ä»¥åŠä¸å¼ºå¯†ç äº¤æ¢çš„æ•°æ®çš„ç§å¯†æ€§ã€‚<br>åå•†è¿æ¥åˆ°HTTPSæœåŠ¡å™¨æ—¶ï¼ŒOkHttpéœ€è¦çŸ¥é“æä¾›å“ªäº›<a href="http://square.github.io/okhttp/3.x/okhttp/okhttp3/TlsVersion.html" target="_blank" rel="noopener">TLS</a>ç‰ˆæœ¬å’Œ<a href="http://square.github.io/okhttp/3.x/okhttp/okhttp3/CipherSuite.html" target="_blank" rel="noopener">å¯†ç å¥—ä»¶</a>ã€‚å¸Œæœ›æœ€å¤§åŒ–è¿æ¥çš„å®¢æˆ·ç«¯å°†åŒ…æ‹¬è¿‡æ—¶çš„TLSç‰ˆæœ¬å’Œå¼±è®¾è®¡å¯†ç å¥—ä»¶ã€‚ä¸€ä¸ªæƒ³è¦æœ€å¤§é™åº¦åœ°æé«˜å®‰å…¨æ€§çš„ä¸¥æ ¼çš„å®¢æˆ·ç«¯å°†ä»…é™äºæœ€æ–°çš„TLSç‰ˆæœ¬å’Œæœ€å¼ºçš„å¯†ç å¥—ä»¶ã€‚</li>
</ul>
<p><a href="http://square.github.io/okhttp/3.x/okhttp/okhttp3/ConnectionSpec.html" target="_blank" rel="noopener">ConnectionSpec</a>å®ç°ç‰¹å®šçš„å®‰å…¨æ€§å’Œè¿æ¥æ€§å†³å®šã€‚OkHttpåŒ…å«ä¸‰ä¸ªå†…ç½®çš„è¿æ¥è§„èŒƒï¼š</p>
<ul>
<li><code>MODERN_TLS</code>æ˜¯è¿æ¥åˆ°ç°ä»£HTTPSæœåŠ¡å™¨çš„å®‰å…¨é…ç½®ã€‚</li>
<li><code>COMPATIBLE_TLS</code>æ˜¯ä¸€ç§è¿æ¥åˆ°å®‰å…¨ä½†ä¸æ˜¯å½“å‰HTTPSæœåŠ¡å™¨çš„å®‰å…¨é…ç½®ã€‚</li>
<li><code>CLEARTEXT</code>æ˜¯ç”¨äº<code>http://</code>URL çš„ä¸å®‰å…¨é…ç½®ã€‚</li>
</ul>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒOkHttpå°†å°è¯•<code>MODERN_TLS</code>è¿æ¥ï¼Œ<code>COMPATIBLE_TLS</code>å¦‚æœç°ä»£é…ç½®å¤±è´¥ï¼Œåˆ™å›é€€è¿æ¥ã€‚</p>
<p>æ¯ä¸ªè§„èŒƒä¸­çš„TLSç‰ˆæœ¬å’Œå¯†ç å¥—ä»¶å¯éšæ¯ä¸ªç‰ˆæœ¬è€Œæ”¹å˜ã€‚ä¾‹å¦‚ï¼Œåœ¨OkHttp 2.2ä¸­ï¼Œæˆ‘ä»¬æ”¾å¼ƒäº†å¯¹SSL 3.0çš„æ”¯æŒæ¥å“åº”<code>POODLE</code>æ”»å‡»ã€‚è€Œåœ¨OkHttp 2.3æˆ‘ä»¬æ”¾å¼ƒäº†å¯¹<code>RC4</code>çš„æ”¯æŒã€‚ä¸æ‚¨çš„æ¡Œé¢ç½‘ç»œæµè§ˆå™¨ä¸€æ ·ï¼Œä¿æŒOkHttpçš„æœ€æ–°çŠ¶æ€æ˜¯ä¿æŒå®‰å…¨çš„æœ€ä½³æ–¹å¼ã€‚</p>
<p>æ‚¨å¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰çš„TLSç‰ˆæœ¬å’Œå¯†ç å¥—ä»¶æ¥æ„å»ºè‡ªå·±çš„è¿æ¥è§„èŒƒã€‚ä¾‹å¦‚ï¼Œè¿™ç§é…ç½®ä»…é™äºä¸‰ä¸ªå¤‡å—å¥½è¯„çš„å¯†ç å¥—ä»¶ã€‚å®ƒçš„ç¼ºç‚¹æ˜¯å®ƒéœ€è¦Android 5.0+å’Œä¸€ä¸ªç±»ä¼¼çš„å½“å‰ç½‘ç»œæœåŠ¡å™¨ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">ConnectionSpec spec = <span class="keyword">new</span> ConnectionSpec.Builder(ConnectionSpec.MODERN_TLS)  </span><br><span class="line">    .tlsVersions(TlsVersion.TLS_1_2)</span><br><span class="line">    .cipherSuites(</span><br><span class="line">          CipherSuite.TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,</span><br><span class="line">          CipherSuite.TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,</span><br><span class="line">          CipherSuite.TLS_DHE_RSA_WITH_AES_128_GCM_SHA256)</span><br><span class="line">    .build();</span><br><span class="line"></span><br><span class="line">OkHttpClient client = <span class="keyword">new</span> OkHttpClient.Builder() </span><br><span class="line">    .connectionSpecs(Collections.singletonList(spec))</span><br><span class="line">    .build();</span><br></pre></td></tr></table></figure>
<h4 id="è¯ä¹¦é”å®š"><a href="#è¯ä¹¦é”å®š" class="headerlink" title="è¯ä¹¦é”å®š"></a>è¯ä¹¦é”å®š</h4><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒOkHttpä¿¡ä»»ä¸»æœºå¹³å°çš„è¯ä¹¦æƒé™ã€‚è¿™ä¸€æˆ˜ç•¥æœ€å¤§é™åº¦åœ°æé«˜äº†è¿æ¥æ€§ï¼Œä½†æ˜¯å®ƒå—åˆ°è¯ä¹¦é¢å‘æœºæ„çš„æ”»å‡»ï¼Œä¾‹å¦‚[<a href="http://www.computerworld.com/article/2510951/cybercrime-hacking/hackers-spied-on-300-000-iranians-using-fake-google-certificate.html" target="_blank" rel="noopener">2011å¹´DigiNotaræ”»å‡»</a>ã€‚å®ƒè¿˜å‡å®šæ‚¨çš„HTTPSæœåŠ¡å™¨çš„è¯ä¹¦ç”±è¯ä¹¦é¢å‘æœºæ„ç­¾åã€‚</p>
<p>ä½¿ç”¨<a href="http://square.github.io/okhttp/3.x/okhttp/okhttp3/CertificatePinner.html" target="_blank" rel="noopener">CertificatePinner</a>æ¥é™åˆ¶å“ªäº›è¯ä¹¦å’Œè¯ä¹¦é¢å‘æœºæ„æ˜¯å¯ä¿¡çš„ã€‚è¯ä¹¦å›ºå®šå¢åŠ äº†å®‰å…¨æ€§ï¼Œä½†æ˜¯é™åˆ¶äº†æ‚¨çš„æœåŠ¡å™¨å›¢é˜Ÿæ›´æ–°å…¶TLSè¯ä¹¦çš„èƒ½åŠ›ã€‚<strong>å¦‚æœæ²¡æœ‰æœåŠ¡å™¨çš„TLSç®¡ç†å‘˜çš„åŒæ„ï¼Œè¯·å‹¿ä½¿ç”¨è¯ä¹¦é”å®šï¼</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">CertificatePinning</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  client = <span class="keyword">new</span> OkHttpClient.Builder()</span><br><span class="line">      .certificatePinner(<span class="keyword">new</span> CertificatePinner.Builder()</span><br><span class="line">          .add(<span class="string">"publicobject.com"</span>, <span class="string">"sha256/afwiKY3RxoMmLkuRW1l7QsPZTJPwDS2pdDROQjXw8ig="</span>)</span><br><span class="line">          .build())</span><br><span class="line">      .build();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">  Request request = <span class="keyword">new</span> Request.Builder()</span><br><span class="line">      .url(<span class="string">"https://publicobject.com/robots.txt"</span>)</span><br><span class="line">      .build();</span><br><span class="line"></span><br><span class="line">  Response response = client.newCall(request).execute();</span><br><span class="line">  <span class="keyword">if</span> (!response.isSuccessful()) <span class="keyword">throw</span> <span class="keyword">new</span> IOException(<span class="string">"Unexpected code "</span> + response);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (Certificate certificate : response.handshake().peerCertificates()) &#123;</span><br><span class="line">    System.out.println(CertificatePinner.pin(certificate));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="è‡ªå®šä¹‰å¯ä¿¡è¯ä¹¦"><a href="#è‡ªå®šä¹‰å¯ä¿¡è¯ä¹¦" class="headerlink" title="è‡ªå®šä¹‰å¯ä¿¡è¯ä¹¦"></a>è‡ªå®šä¹‰å¯ä¿¡è¯ä¹¦</h4><p>å®Œæ•´çš„ä»£ç ç¤ºä¾‹æ˜¾ç¤ºäº†å¦‚ä½•ç”¨è‡ªå·±çš„é›†åˆæ›¿æ¢ä¸»æœºå¹³å°çš„è¯ä¹¦é¢å‘æœºæ„ã€‚å¦‚ä¸Šæ‰€è¿°ï¼Œ<strong>è¯·å‹¿åœ¨æ²¡æœ‰æœåŠ¡å™¨çš„TLSç®¡ç†å‘˜åŒæ„çš„æƒ…å†µä¸‹ä½¿ç”¨è‡ªå®šä¹‰è¯ä¹¦ï¼</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> OkHttpClient client;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">CustomTrust</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  SSLContext sslContext = sslContextForTrustedCertificates(trustedCertificatesInputStream());</span><br><span class="line">  client = <span class="keyword">new</span> OkHttpClient.Builder()</span><br><span class="line">      .sslSocketFactory(sslContext.getSocketFactory())</span><br><span class="line">      .build();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">  Request request = <span class="keyword">new</span> Request.Builder()</span><br><span class="line">      .url(<span class="string">"https://publicobject.com/helloworld.txt"</span>)</span><br><span class="line">      .build();</span><br><span class="line"></span><br><span class="line">  Response response = client.newCall(request).execute();</span><br><span class="line">  System.out.println(response.body().string());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> InputStream <span class="title">trustedCertificatesInputStream</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  ... <span class="comment">// Full source omitted. See sample.</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> SSLContext <span class="title">sslContextForTrustedCertificates</span><span class="params">(InputStream in)</span> </span>&#123;</span><br><span class="line">  ... <span class="comment">// Full source omitted. See sample.</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="Events-äº‹ä»¶ç›‘å¬"><a href="#Events-äº‹ä»¶ç›‘å¬" class="headerlink" title="Events(äº‹ä»¶ç›‘å¬)"></a>Events(äº‹ä»¶ç›‘å¬)</h3><p>äº‹ä»¶å…è®¸æ‚¨åœ¨åº”ç”¨ç¨‹åºçš„HTTPè°ƒç”¨ä¸­æ•è·åº¦é‡å€¼ã€‚ä½¿ç”¨äº‹ä»¶è¿›è¡Œç›‘è§†ï¼š</p>
<ul>
<li>HTTPè°ƒç”¨æ‚¨çš„åº”ç”¨ç¨‹åºçš„å¤§å°å’Œé¢‘ç‡ã€‚å¦‚æœä½ å£°æ˜äº†å¤ªå¤šçš„callsï¼Œæˆ–è€…ä½ çš„callså¤ªå¤§ï¼Œä½ åº”è¯¥çŸ¥é“å®ƒçš„ä¸€åˆ‡</li>
<li>è¿™äº›è°ƒç”¨åœ¨åº•å±‚ç½‘ç»œä¸Šçš„æ€§èƒ½ã€‚å¦‚æœç½‘ç»œæ€§èƒ½ä¸è¶³ï¼Œåˆ™éœ€è¦æ”¹å–„ç½‘ç»œæˆ–å°‘ç”¨ç½‘ç»œã€‚</li>
</ul>
<p><strong>è­¦å‘Šï¼šè¿™æ˜¯ä¸€ä¸ªéæœ€ç»ˆçš„APIã€‚<br>ä»OkHttp 3.9å¼€å§‹ï¼Œæ­¤åŠŸèƒ½æ˜¯ä¸€ä¸ªä¸ç¨³å®šçš„é¢„è§ˆï¼šAPIå¯èƒ½ä¼šæ›´æ”¹ï¼Œå¹¶ä¸”å®ç°ä¸å®Œæ•´ã€‚æˆ‘ä»¬é¢„è®¡OkHttp 3.10æˆ–3.11å°†å®Œæˆè¿™ä¸ªAPIã€‚åœ¨æ­¤ä¹‹å‰ï¼Œå½“æ‚¨æ›´æ–°æ‚¨çš„OkHttpä¾èµ–å…³ç³»æ—¶ï¼Œè¯·å‡†å¤‡APIå’Œè¡Œä¸ºæ›´æ”¹ã€‚</strong></p>
<h4 id="äº‹ä»¶ç›‘å¬"><a href="#äº‹ä»¶ç›‘å¬" class="headerlink" title="äº‹ä»¶ç›‘å¬"></a>äº‹ä»¶ç›‘å¬</h4><p>å­ç±»<a href="https://square.github.io/okhttp/3.x/okhttp/okhttp3/EventListener.html" target="_blank" rel="noopener"> EventListener</a>,è¦†ç›–æ‚¨æ„Ÿå…´è¶£çš„äº‹ä»¶çš„æ–¹æ³•ã€‚åœ¨æ²¡æœ‰é‡å®šå‘æˆ–é‡è¯•çš„æˆåŠŸHTTPè°ƒç”¨ä¸­ï¼Œäº‹ä»¶åºåˆ—ç”±æ­¤æµç¨‹æè¿°ã€‚<br><img src="https://raw.githubusercontent.com/wiki/square/okhttp/events@2x.png" alt=""><br>ä»¥ä¸‹æ˜¯ä¸€ä¸ª<a href="https://github.com/square/okhttp/blob/master/samples/guide/src/main/java/okhttp3/recipes/PrintEventsNonConcurrent.java" target="_blank" rel="noopener">ç¤ºä¾‹äº‹ä»¶ä¾¦å¬å™¨</a>ï¼Œå®ƒä½¿ç”¨æ—¶é—´æˆ³æ‰“å°æ¯ä¸ªäº‹ä»¶ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PrintingEventListener</span> <span class="keyword">extends</span> <span class="title">EventListener</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">long</span> callStartNanos;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">printEvent</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">long</span> nowNanos = System.nanoTime();</span><br><span class="line">    <span class="keyword">if</span> (name.equals(<span class="string">"callStart"</span>)) &#123;</span><br><span class="line">      callStartNanos = nowNanos;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">long</span> elapsedNanos = nowNanos - callStartNanos;</span><br><span class="line">    System.out.printf(<span class="string">"%.3f %s%n"</span>, elapsedNanos / <span class="number">1000000000</span>d, name);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">callStart</span><span class="params">(Call call)</span> </span>&#123;</span><br><span class="line">    printEvent(<span class="string">"callStart"</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">callEnd</span><span class="params">(Call call)</span> </span>&#123;</span><br><span class="line">    printEvent(<span class="string">"callEnd"</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">dnsStart</span><span class="params">(Call call, String domainName)</span> </span>&#123;</span><br><span class="line">    printEvent(<span class="string">"dnsStart"</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">dnsEnd</span><span class="params">(Call call, String domainName, List&lt;InetAddress&gt; inetAddressList)</span> </span>&#123;</span><br><span class="line">    printEvent(<span class="string">"dnsEnd"</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>æˆ‘ä»¬åšå‡ ä¸ªcallsï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">Request request = <span class="keyword">new</span> Request.Builder()</span><br><span class="line">    .url(<span class="string">"https://publicobject.com/helloworld.txt"</span>)</span><br><span class="line">    .build();</span><br><span class="line"></span><br><span class="line">System.out.println(<span class="string">"REQUEST 1 (new connection)"</span>);</span><br><span class="line"><span class="keyword">try</span> (Response response = client.newCall(request).execute()) &#123;</span><br><span class="line">  <span class="comment">// Consume and discard the response body.</span></span><br><span class="line">  response.body().source().readByteString();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">System.out.println(<span class="string">"REQUEST 2 (pooled connection)"</span>);</span><br><span class="line"><span class="keyword">try</span> (Response response = client.newCall(request).execute()) &#123;</span><br><span class="line">  <span class="comment">// Consume and discard the response body.</span></span><br><span class="line">  response.body().source().readByteString();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>ç›‘å¬å™¨æ‰“å°ç›¸åº”çš„äº‹ä»¶ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">REQUEST <span class="number">1</span> (<span class="keyword">new</span> connection)</span><br><span class="line"><span class="number">0.000</span> callStart</span><br><span class="line"><span class="number">0.010</span> dnsStart</span><br><span class="line"><span class="number">0.017</span> dnsEnd</span><br><span class="line"><span class="number">0.025</span> connectStart</span><br><span class="line"><span class="number">0.117</span> secureConnectStart</span><br><span class="line"><span class="number">0.586</span> secureConnectEnd</span><br><span class="line"><span class="number">0.586</span> connectEnd</span><br><span class="line"><span class="number">0.587</span> connectionAcquired</span><br><span class="line"><span class="number">0.588</span> requestHeadersStart</span><br><span class="line"><span class="number">0.590</span> requestHeadersEnd</span><br><span class="line"><span class="number">0.591</span> responseHeadersStart</span><br><span class="line"><span class="number">0.675</span> responseHeadersEnd</span><br><span class="line"><span class="number">0.676</span> responseBodyStart</span><br><span class="line"><span class="number">0.679</span> responseBodyEnd</span><br><span class="line"><span class="number">0.679</span> connectionReleased</span><br><span class="line"><span class="number">0.680</span> callEnd</span><br><span class="line">REQUEST <span class="number">2</span> (pooled connection)</span><br><span class="line"><span class="number">0.000</span> callStart</span><br><span class="line"><span class="number">0.001</span> connectionAcquired</span><br><span class="line"><span class="number">0.001</span> requestHeadersStart</span><br><span class="line"><span class="number">0.001</span> requestHeadersEnd</span><br><span class="line"><span class="number">0.002</span> responseHeadersStart</span><br><span class="line"><span class="number">0.082</span> responseHeadersEnd</span><br><span class="line"><span class="number">0.082</span> responseBodyStart</span><br><span class="line"><span class="number">0.082</span> responseBodyEnd</span><br><span class="line"><span class="number">0.083</span> connectionReleased</span><br><span class="line"><span class="number">0.083</span> callEnd</span><br></pre></td></tr></table></figure></p>
<p>æ³¨æ„ç¬¬äºŒæ¬¡è°ƒç”¨æ²¡æœ‰è¿æ¥äº‹ä»¶ã€‚å®ƒé‡ç”¨äº†ç¬¬ä¸€ä¸ªè¯·æ±‚çš„è¿æ¥ï¼Œä»¥æ˜¾ç€æé«˜æ€§èƒ½ã€‚</p>
<h4 id="EventListener-Factory"><a href="#EventListener-Factory" class="headerlink" title="EventListener.Factory"></a>EventListener.Factory</h4><p>åœ¨å‰é¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†ä¸€ä¸ªå­—æ®µ<code>callStartNanos</code>æ¥è·Ÿè¸ªæ¯ä¸ªäº‹ä»¶çš„ç»è¿‡æ—¶é—´ã€‚è¿™å¾ˆæ–¹ä¾¿ï¼Œä½†æ˜¯å¦‚æœå¤šä¸ªè°ƒç”¨åŒæ—¶æ‰§è¡Œï¼Œå®ƒå°†ä¸èµ·ä½œç”¨ã€‚ä¸ºäº†é€‚åº”è¿™ä¸ªï¼Œä½¿ç”¨ä¸€ä¸ª<code>Factory</code>åˆ›å»ºä¸€ä¸ªæ–°çš„<code>EventListener</code>ä¸ºæ¯ä¸ª<code>Call</code>ã€‚è¿™å…è®¸æ¯ä¸ªç›‘å¬è€…ä¿æŒç‰¹å®šäºå‘¼å«çš„çŠ¶æ€ã€‚</p>
<p>æ­¤<a href="https://github.com/square/okhttp/blob/master/samples/guide/src/main/java/okhttp3/recipes/PrintEvents.java" target="_blank" rel="noopener">ç¤ºä¾‹å·¥å‚</a>ä¸ºæ¯ä¸ªå‘¼å«åˆ›å»ºä¸€ä¸ªå”¯ä¸€çš„IDï¼Œå¹¶ä½¿ç”¨è¯¥IDåŒºåˆ†æ—¥å¿—æ¶ˆæ¯ä¸­çš„å‘¼å«ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PrintingEventListener</span> <span class="keyword">extends</span> <span class="title">EventListener</span> </span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Factory FACTORY = <span class="keyword">new</span> Factory() &#123;</span><br><span class="line">    <span class="keyword">final</span> AtomicLong nextCallId = <span class="keyword">new</span> AtomicLong(<span class="number">1L</span>);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> EventListener <span class="title">create</span><span class="params">(Call call)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">long</span> callId = nextCallId.getAndIncrement();</span><br><span class="line">      System.out.printf(<span class="string">"%04d %s%n"</span>, callId, call.request().url());</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> PrintingEventListener(callId, System.nanoTime());</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">final</span> <span class="keyword">long</span> callId;</span><br><span class="line">  <span class="keyword">final</span> <span class="keyword">long</span> callStartNanos;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">PrintingEventListener</span><span class="params">(<span class="keyword">long</span> callId, <span class="keyword">long</span> callStartNanos)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.callId = callId;</span><br><span class="line">    <span class="keyword">this</span>.callStartNanos = callStartNanos;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">printEvent</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">long</span> elapsedNanos = System.nanoTime() - callStartNanos;</span><br><span class="line">    System.out.printf(<span class="string">"%04d %.3f %s%n"</span>, callId, elapsedNanos / <span class="number">1000000000</span>d, name);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">callStart</span><span class="params">(Call call)</span> </span>&#123;</span><br><span class="line">    printEvent(<span class="string">"callStart"</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">callEnd</span><span class="params">(Call call)</span> </span>&#123;</span><br><span class="line">    printEvent(<span class="string">"callEnd"</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™ä¸ªä¾¦å¬å™¨æ¥ç«äº‰ä¸€å¯¹å¹¶å‘çš„HTTPè¯·æ±‚ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Request washingtonPostRequest = <span class="keyword">new</span> Request.Builder()</span><br><span class="line">    .url(<span class="string">"https://www.washingtonpost.com/"</span>)</span><br><span class="line">    .build();</span><br><span class="line">client.newCall(washingtonPostRequest).enqueue(<span class="keyword">new</span> Callback() &#123;</span><br><span class="line">  ...</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">Request newYorkTimesRequest = <span class="keyword">new</span> Request.Builder()</span><br><span class="line">    .url(<span class="string">"https://www.nytimes.com/"</span>)</span><br><span class="line">    .build();</span><br><span class="line">client.newCall(newYorkTimesRequest).enqueue(<span class="keyword">new</span> Callback() &#123;</span><br><span class="line">  ...</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>è¿è¡Œè¿™åœºæ¯”èµ›çš„å®¶åº­æ— çº¿ç½‘ç»œæ˜¾ç¤ºï¼ŒTimesï¼ˆ<code>0002</code>ï¼‰æ¯”Postï¼ˆ<code>0001</code>ï¼‰ç•¥å¿«ä¸€ç‚¹ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0001</span> https:<span class="comment">//www.washingtonpost.com/</span></span><br><span class="line"><span class="number">0001</span> <span class="number">0.000</span> callStart</span><br><span class="line"><span class="number">0002</span> https:<span class="comment">//www.nytimes.com/</span></span><br><span class="line"><span class="number">0002</span> <span class="number">0.000</span> callStart</span><br><span class="line"><span class="number">0002</span> <span class="number">0.010</span> dnsStart</span><br><span class="line"><span class="number">0001</span> <span class="number">0.013</span> dnsStart</span><br><span class="line"><span class="number">0001</span> <span class="number">0.022</span> dnsEnd</span><br><span class="line"><span class="number">0002</span> <span class="number">0.019</span> dnsEnd</span><br><span class="line"><span class="number">0001</span> <span class="number">0.028</span> connectStart</span><br><span class="line"><span class="number">0002</span> <span class="number">0.025</span> connectStart</span><br><span class="line"><span class="number">0002</span> <span class="number">0.072</span> secureConnectStart</span><br><span class="line"><span class="number">0001</span> <span class="number">0.075</span> secureConnectStart</span><br><span class="line"><span class="number">0001</span> <span class="number">0.386</span> secureConnectEnd</span><br><span class="line"><span class="number">0002</span> <span class="number">0.390</span> secureConnectEnd</span><br><span class="line"><span class="number">0002</span> <span class="number">0.400</span> connectEnd</span><br><span class="line"><span class="number">0001</span> <span class="number">0.403</span> connectEnd</span><br><span class="line"><span class="number">0002</span> <span class="number">0.401</span> connectionAcquired</span><br><span class="line"><span class="number">0001</span> <span class="number">0.404</span> connectionAcquired</span><br><span class="line"><span class="number">0001</span> <span class="number">0.406</span> requestHeadersStart</span><br><span class="line"><span class="number">0002</span> <span class="number">0.403</span> requestHeadersStart</span><br><span class="line"><span class="number">0001</span> <span class="number">0.414</span> requestHeadersEnd</span><br><span class="line"><span class="number">0002</span> <span class="number">0.411</span> requestHeadersEnd</span><br><span class="line"><span class="number">0002</span> <span class="number">0.412</span> responseHeadersStart</span><br><span class="line"><span class="number">0001</span> <span class="number">0.415</span> responseHeadersStart</span><br><span class="line"><span class="number">0002</span> <span class="number">0.474</span> responseHeadersEnd</span><br><span class="line"><span class="number">0002</span> <span class="number">0.475</span> responseBodyStart</span><br><span class="line"><span class="number">0001</span> <span class="number">0.554</span> responseHeadersEnd</span><br><span class="line"><span class="number">0001</span> <span class="number">0.555</span> responseBodyStart</span><br><span class="line"><span class="number">0002</span> <span class="number">0.554</span> responseBodyEnd</span><br><span class="line"><span class="number">0002</span> <span class="number">0.554</span> connectionReleased</span><br><span class="line"><span class="number">0002</span> <span class="number">0.554</span> callEnd</span><br><span class="line"><span class="number">0001</span> <span class="number">0.624</span> responseBodyEnd</span><br><span class="line"><span class="number">0001</span> <span class="number">0.624</span> connectionReleased</span><br><span class="line"><span class="number">0001</span> <span class="number">0.624</span> callEnd</span><br></pre></td></tr></table></figure></p>
<p>è¯¥<code>EventListener.Factory</code>è¿˜èƒ½å¤ŸæŒ‡æ ‡é™åˆ¶å‘¼å«çš„å­é›†ã€‚è¿™ä¸€ä¸ªéšæœºæ•è·æŒ‡æ ‡ä¸º10ï¼…ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MetricsEventListener</span> <span class="keyword">extends</span> <span class="title">EventListener</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Factory FACTORY = <span class="keyword">new</span> Factory() &#123;</span><br><span class="line">    <span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> EventListener <span class="title">create</span><span class="params">(Call call)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (Math.random() &lt; <span class="number">0.10</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> MetricsEventListener(call);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> EventListener.NONE;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="äº‹ä»¶ä¸å¤±è´¥"><a href="#äº‹ä»¶ä¸å¤±è´¥" class="headerlink" title="äº‹ä»¶ä¸å¤±è´¥"></a>äº‹ä»¶ä¸å¤±è´¥</h4><p>å½“æ“ä½œå¤±è´¥æ—¶ï¼Œè°ƒç”¨å¤±è´¥æ–¹æ³•ã€‚è¿™æ˜¯<code>connectFailed()</code>åœ¨å»ºç«‹åˆ°æœåŠ¡å™¨çš„è¿æ¥<code>callFailed()</code>æ—¶ï¼Œä»¥åŠHTTPè°ƒç”¨æ°¸ä¹…å¤±è´¥æ—¶çš„å¤±è´¥ã€‚å‘ç”Ÿæ•…éšœæ—¶ï¼Œ<code>start</code>äº‹ä»¶å¯èƒ½æ²¡æœ‰ç›¸åº”çš„<code>end</code>äº‹ä»¶ã€‚<br><img src="https://raw.githubusercontent.com/wiki/square/okhttp/events_with_failures@2x.png" alt=""></p>
<h4 id="äº‹ä»¶ä¸é‡è¯•å’Œè·Ÿè¿›"><a href="#äº‹ä»¶ä¸é‡è¯•å’Œè·Ÿè¿›" class="headerlink" title="äº‹ä»¶ä¸é‡è¯•å’Œè·Ÿè¿›"></a>äº‹ä»¶ä¸é‡è¯•å’Œè·Ÿè¿›</h4><p>OkHttpå…·æœ‰å¼¹æ€§ï¼Œå¯ä»¥è‡ªåŠ¨ä»ä¸€äº›è¿æ¥å¤±è´¥ä¸­æ¢å¤ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ<code>connectFailed()</code>äº‹ä»¶ä¸æ˜¯ç»ˆç«¯ï¼Œä¹Ÿä¸æ˜¯éšä¹‹è€Œæ¥çš„<code>callFailed()</code>ã€‚å½“å°è¯•é‡è¯•æ—¶ï¼Œäº‹ä»¶ç›‘å¬å™¨å°†æ”¶åˆ°å¤šä¸ªç›¸åŒç±»å‹çš„äº‹ä»¶ã€‚</p>
<p>å•ä¸ªHTTPè°ƒç”¨å¯èƒ½éœ€è¦åç»­è¯·æ±‚æ¥å¤„ç†è®¤è¯æŒ‘æˆ˜ï¼Œé‡å®šå‘å’ŒHTTPå±‚è¶…æ—¶ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯èƒ½ä¼šå°è¯•å¤šä¸ªè¿æ¥ï¼Œè¯·æ±‚å’Œå“åº”ã€‚è·Ÿè¿›æ˜¯å•ä¸ªç”µè¯å¯èƒ½è§¦å‘å¤šä¸ªç›¸åŒç±»å‹äº‹ä»¶çš„å¦ä¸€ä¸ªåŸå› ã€‚<br><img src="https://raw.githubusercontent.com/wiki/square/okhttp/events_with_failures_and_retries@2x.png" alt=""></p>
<h4 id="å¯ç”¨æ€§-1"><a href="#å¯ç”¨æ€§-1" class="headerlink" title="å¯ç”¨æ€§"></a>å¯ç”¨æ€§</h4><p>OkHttp 3.9ä¸­çš„é¢„è§ˆç‰ˆæœ¬æä¾›äº†äº‹ä»¶ã€‚æˆ‘ä»¬é¢„è®¡OkHttp 3.10æˆ–3.11å°†å®Œæˆè¿™ä¸ªAPIã€‚æœªæ¥ç‰ˆæœ¬å¯èƒ½ä¼šå¼•å…¥æ–°çš„äº‹ä»¶ç±»å‹; æ‚¨å°†éœ€è¦è¦†ç›–ç›¸åº”çš„æ–¹æ³•æ¥å¤„ç†å®ƒä»¬ã€‚</p>
<h3 id="FAQs-å¸¸è§é—®é¢˜è§£ç­”"><a href="#FAQs-å¸¸è§é—®é¢˜è§£ç­”" class="headerlink" title="FAQs(å¸¸è§é—®é¢˜è§£ç­”))"></a>FAQs(å¸¸è§é—®é¢˜è§£ç­”))</h3><h4 id="å¦‚ä½•ä¿®å¤dalvikvmä¸­çš„éªŒè¯è­¦å‘Šï¼Ÿ"><a href="#å¦‚ä½•ä¿®å¤dalvikvmä¸­çš„éªŒè¯è­¦å‘Šï¼Ÿ" class="headerlink" title="å¦‚ä½•ä¿®å¤dalvikvmä¸­çš„éªŒè¯è­¦å‘Šï¼Ÿ"></a>å¦‚ä½•ä¿®å¤dalvikvmä¸­çš„éªŒè¯è­¦å‘Šï¼Ÿ</h4><p>OkHttpæ”¯æŒä¸€äº›éœ€è¦Java 7+æˆ–Android API 20+çš„APIã€‚å¦‚æœä½ åœ¨æ—©æœŸçš„Androidç‰ˆæœ¬ä¸Šè¿è¡ŒOkHttpï¼Œdalvikvmçš„éªŒè¯å™¨ä¼šè­¦å‘Šä½ ç¼ºå°‘çš„æ–¹æ³•ã€‚è¿™ä¸æ˜¯ä¸€ä¸ªé—®é¢˜ï¼Œä½ å¯ä»¥å¿½ç•¥è­¦å‘Šã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">I/dalvikvmï¹• Could not find method okhttp3.internal.huc.HttpURLConnectionImpl.getContentLengthLong, referenced from method okhttp3.internal.huc.HttpsURLConnectionImpl.getContentLengthLong</span><br><span class="line">W/dalvikvmï¹• VFY: unable to resolve virtual method <span class="number">21498</span>: Lokhttp3/internal/huc/HttpURLConnectionImpl;.getContentLengthLong ()J</span><br><span class="line">D/dalvikvmï¹• VFY: replacing opcode <span class="number">0x6e</span> at <span class="number">0x0002</span></span><br><span class="line">I/dalvikvmï¹• Could not find method okhttp3.internal.huc.HttpURLConnectionImpl.getHeaderFieldLong, referenced from method okhttp3.internal.huc.HttpsURLConnectionImpl.getHeaderFieldLong</span><br><span class="line">W/dalvikvmï¹• VFY: unable to resolve virtual method <span class="number">21503</span>: Lokhttp3/internal/huc/HttpURLConnectionImpl;.getHeaderFieldLong (Ljava/lang/String;J)J</span><br><span class="line">D/dalvikvmï¹• VFY: replacing opcode <span class="number">0x6e</span> at <span class="number">0x0002</span></span><br><span class="line">W/dalvikvmï¹• VFY: <span class="function">unable to find class referenced in <span class="title">signature</span> <span class="params">(Ljava/nio/file/Path;)</span></span></span><br><span class="line"><span class="function">W/dalvikvmï¹• VFY: unable to find class referenced in <span class="title">signature</span> <span class="params">([Ljava/nio/file/OpenOption;)</span></span></span><br><span class="line"><span class="function">I/dalvikvmï¹• Could not find method java.nio.file.Files.newOutputStream, referenced from method okio.Okio.sink</span></span><br><span class="line"><span class="function">W/dalvikvmï¹• VFY: unable to resolve <span class="keyword">static</span> method 24080: Ljava/nio/file/Files</span>;.newOutputStream (Ljava/nio/file/Path;[Ljava/nio/file/OpenOption;)Ljava/io/OutputStream;</span><br><span class="line">D/dalvikvmï¹• VFY: replacing opcode <span class="number">0x71</span> at <span class="number">0x000a</span></span><br><span class="line">W/dalvikvmï¹• VFY: <span class="function">unable to find class referenced in <span class="title">signature</span> <span class="params">(Ljava/nio/file/Path;)</span></span></span><br><span class="line"><span class="function">W/dalvikvmï¹• VFY: unable to find class referenced in <span class="title">signature</span> <span class="params">([Ljava/nio/file/OpenOption;)</span></span></span><br><span class="line"><span class="function">I/dalvikvmï¹• Could not find method java.nio.file.Files.newInputStream, referenced from method okio.Okio.source</span></span><br><span class="line"><span class="function">W/dalvikvmï¹• VFY: unable to resolve <span class="keyword">static</span> method 24079: Ljava/nio/file/Files</span>;.newInputStream (Ljava/nio/file/Path;[Ljava/nio/file/OpenOption;)Ljava/io/InputStream;</span><br><span class="line">D/dalvikvmï¹• VFY: replacing opcode <span class="number">0x71</span> at <span class="number">0x000a</span></span><br></pre></td></tr></table></figure></p>
]]></content>
      
        <categories>
            
            <category> å®‰å“å¼€æºåº“ä½¿ç”¨æ•™ç¨‹ </category>
            
        </categories>
        
        
        <tags>
            
            <tag> okhttp3 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Android Studioä½¿ç”¨æŠ€å·§å’Œèµ„æº]]></title>
      <url>/AndroidStudio_uses_skills_and_resources.html</url>
      <content type="html"><![CDATA[<p><strong>ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡è½¬è½½è‡ª:<br><a href="http://www.jcodecraeer.com/a/anzhuokaifa/androidkaifa/2016/1116/6776.html" target="_blank" rel="noopener">http://www.jcodecraeer.com/a/anzhuokaifa/androidkaifa/2016/1116/6776.html</a>.<br>ç‰ˆæƒå½’åŸä½œè€…æ‰€æœ‰</strong></p>
<hr>
<blockquote>
<p>å¯¹äºAndroidStudioçš„ä½¿ç”¨ï¼Œæ—¥å¸¸ä½¿ç”¨æ²¡é—®é¢˜ï¼Œä½†ä¾æ—§æœ‰äº›å¿«æ·æŠ€å·§æ²¡æœ‰ä¹ æƒ¯ä½¿ç”¨,å› æ­¤è½¬è½½æœ¬ç¯‡æ–‡ç« å¸¸è¯»ï¼Œå¸Œæœ›å¯¹æ–‡ç« çš„æŠ€å·§æœ‰äº›è®°å¿†ï¼Œåšåˆ°ä»¥åçš„ç†Ÿç»ƒä½¿ç”¨</p>
</blockquote>
<a id="more"></a>
<p>æœ¬æ–‡åˆ—ä¸¾å‡ºä¸€äº›å¯ä»¥æé«˜æ•´ä½“æ•ˆç‡çš„Android StudioæŠ€å·§å’Œèµ„æºã€‚</p>
<p>æ˜¾ç„¶æœ‰å¤ªå¤šå¤ªå¤šè¿™æ–¹é¢çš„ä¸œè¥¿ï¼Œä½†æ˜¯ä¸ºäº†æ–‡ç« çš„ç®€æ´æ€§ï¼Œæˆ‘æŠŠå®ƒé™åˆ¶åœ¨50ä¸ªä»¥å†…ï¼Œå¸Œæœ›ä½ èƒ½å–œæ¬¢ï¼</p>
<h3 id="è§†è§‰æ•ˆæœ"><a href="#è§†è§‰æ•ˆæœ" class="headerlink" title="è§†è§‰æ•ˆæœ"></a>è§†è§‰æ•ˆæœ</h3><p><strong>1.Android Logcatçš„Materialé¢œè‰²ä¸»é¢˜ã€‚</strong><br><img src="http://www.jcodecraeer.com/uploads/20161114/1479092916140309.png" alt=""><br>è¦æ”¹å˜Android Studioçš„Logcatä½ éœ€è¦è¿™æ ·åšï¼šè¿›å…¥Preferences (Windowsä¸Šæ˜¯Settings / Linux machines) â†’ Editor â†’ Colors &amp; Fonts â†’ Android Logcatï¼Œç„¶åä¸ºæ¯ç§ç±»å‹çš„logè®¾ç½®å‰æ™¯é¢œè‰²ï¼ˆforegroundï¼‰ã€‚</p>
<p>æˆ‘ä½¿ç”¨çš„materialé¢œè‰²ï¼š</p>
<p>Assert #BA68C8<br>Debug #2196F3<br>Error #F44336<br>Info #4CAF50<br>Verbose #BBBBBB<br>Warning #FF9800<br>æ³¨æ„é‡Œé¢æœ‰å‡ ä¸ªç°æœ‰çš„ä¸»é¢˜ï¼Œå¯ä»¥ç›´æ¥ä¿®æ”¹ç°æœ‰ä¸»é¢˜ï¼ˆä¸å»ºè®®ï¼‰ï¼Œæˆ–è€…ç‚¹å‡»save  asæŒ‰é’®æ‹·è´ä¸€ä¸ªä¸»é¢˜å¹¶æ”¹åä¸ºMaterial theme Colorç„¶åå†æ”¹å˜æ¯ç§ç±»å‹logçš„é¢œè‰²ã€‚</p>
<p><strong>2.é˜²æ­¢å½“å‰åº”ç”¨å´©æºƒæ—¶Logcatæ¸…é™¤logã€‚</strong></p>
<p>åœ¨Android Monitoré¢æ¿çš„å³ä¸Šæ–¹ç‚¹å‡»ä¸‹æ‹‰èœå•ä¸­çš„Edit filter configurationï¼š<br><img src="http://www.jcodecraeer.com/uploads/20161114/1479110913240289.gif" alt=""><br>æ³¨æ„æ˜¯åœ¨å·¥ç¨‹ç•Œé¢çš„åº•éƒ¨Android Monitoré¢æ¿ï¼Œè€Œä¸æ˜¯å•ç‹¬çš„Android Monitorå·¥å…·ä¸­ã€‚</p>
<p><strong>3.ä½¿ç”¨ä¸€ä¸ªé€‚åˆè‡ªå·±çš„ä»£ç ä¸»é¢˜ (IntelliJ / Android Studio).</strong></p>
<p>æ‰¾åˆ°Preferences â†’ Code Style â†’ Javaï¼Œåœ¨Schemeä¸‹æ‹‰èœå•ä¸­ä½ å¯ä»¥é€‰æ‹©ä¸€ä¸ªä»£ç é£æ ¼ï¼ˆæˆ–è€…è®¾ç½®ä¸€ä¸ªæ–°çš„ï¼‰ã€‚</p>
<p>æœ‰ä¸¤ä¸ªé£æ ¼å€¼å¾—ä¸“é—¨æä¸€ä¸‹ï¼š</p>
<ul>
<li><a href="https://github.com/square/java-code-styles" target="_blank" rel="noopener">Square Java Code Styles with Android</a></li>
<li><a href="https://github.com/google/styleguide/blob/gh-pages/intellij-java-google-style.xml" target="_blank" rel="noopener">Google Java Code Style</a></li>
</ul>
<p>ä½ å¯ä»¥æŒ‰ç…§ä¸‹é¢gifå›¾ä¸­çš„åšæ³•å¯¼å…¥ä¸»é¢˜ï¼š<br><img src="http://www.jcodecraeer.com/uploads/20161115/1479152735132116.gif" alt=""></p>
<p><strong>.ä½¿ç”¨åˆ†å±æé«˜æ•ˆç‡</strong><br><img src="http://www.jcodecraeer.com/uploads/20161115/1479184670241838.png" alt=""></p>
<p>è¦æ‰“å¼€è¿™ä¸ªåŠŸèƒ½ï¼Œå³é”®ä¸»å±å¹•çš„é€‰é¡¹å¡ï¼ˆtabï¼‰é€‰æ‹© Split Vertically / Horizontallyã€‚<br><img src="http://www.jcodecraeer.com/uploads/20161115/1479185280137120.png" alt=""><br>ä½†æ˜¯ä¸ºäº†å°½é‡æé«˜æ•ˆç‡æˆ‘ä»¬éœ€è¦è®¾ç½®ä¸€ä¸ªè‡ªå®šä¹‰çš„å¿«æ·æ–¹å¼ã€‚ä¸ºæ­¤æ‰¾åˆ°åˆ°Preferences â†’ Keymapï¼Œæœç´¢Split Verticallyã€‚ç„¶åæ‰“å¼€ä¸€ä¸ªä¸Šä¸‹æ–‡èœå•ï¼Œç‚¹å‡»Add Keyboard Shortcutã€‚</p>
<p>æˆ‘çš„åˆ†å±ï¼ˆverticalï¼‰å¿«æ·é”®è®¾ç½®çš„æ˜¯control + alt + vã€‚åšæ³•å¦‚ä¸‹é¢çš„gifå›¾æ‰€ç¤ºã€‚åŒæ ·çš„ä½ è¿˜å¯ä»¥ä¸º horizontal splitè®¾ç½®å¿«æ·é”®ã€‚<br><img src="http://www.jcodecraeer.com/uploads/20161115/1479186609392277.gif" alt=""></p>
<p><strong>5.æ— å¹²æ‰°æ¨¡å¼</strong><br>ä½ å¯ä»¥åˆ°View â†’ Enter Distraction Free Modeé‡Œå¯ç”¨å®ƒ<br><img src="http://www.jcodecraeer.com/uploads/20161115/1479186797587469.png" alt=""></p>
<blockquote>
<p>åœ¨æ— å¹²æ‰°æ¨¡å¼ä¸‹ï¼Œç¼–è¾‘å™¨å æ®äº†æ•´ä¸ªIntelliJIDEAçª—å£ï¼Œæ²¡æœ‰ä»»ä½•tabæˆ–è€…å·¥å…·æŒ‰é’®ã€‚ä»£ç å±…ä¸­æ˜¾ç¤º<br><img src="http://www.jcodecraeer.com/uploads/20161115/1479187051576195.png" alt=""></p>
</blockquote>
<p><strong>6.ä½¿ç”¨Live Templates</strong></p>
<ul>
<li>ä½ å¯ä»¥ä½¿ç”¨å¿«æ·é”®ï¼šcmd + j (Windows / Linux: ctrl + j)ã€‚<br><img src="http://www.jcodecraeer.com/uploads/20161115/1479207132117532.gif" alt=""></li>
<li>å¯ä»¥ä½¿ç”¨å·²ç»å®šä¹‰å¥½äº†çš„Live Templatesï¼Œæ¯”å¦‚Toasts æˆ–è€…ifè¯­å¥ã€‚<br><img src="http://www.jcodecraeer.com/uploads/20161115/1479207307260987.gif" alt=""></li>
<li>å¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰çš„templatesã€‚è¿™é‡Œæ˜¯Reto Meierçš„ä¸€ç¯‡ä¸é”™çš„å‚è€ƒæ–‡ç« ã€‚ä½ ä¹Ÿå¯ä»¥å‚è€ƒ<a href="https://www.jetbrains.com/help/idea/2016.2/live-templates.html" target="_blank" rel="noopener">IntelliJ IDEA</a>çš„æ–‡æ¡£.</li>
</ul>
<h3 id="å¿«æ·é”®ä»¥åŠæœ‰ç”¨çš„å‘½ä»¤"><a href="#å¿«æ·é”®ä»¥åŠæœ‰ç”¨çš„å‘½ä»¤" class="headerlink" title="å¿«æ·é”®ä»¥åŠæœ‰ç”¨çš„å‘½ä»¤"></a>å¿«æ·é”®ä»¥åŠæœ‰ç”¨çš„å‘½ä»¤</h3><p>1.æœ€æœ‰ç”¨çš„å‘½ä»¤æ˜¯æœç´¢å‘½ä»¤çš„å‘½ä»¤ï¼šcmd + shift + a (Windows / Linux: ctrl + shift + a)ã€‚</p>
<p>å‡è®¾ä½ æƒ³å…³é—­å½“å‰tabå´ä¸çŸ¥é“æ€ä¹ˆåšï¼Œä½ åªéœ€è¾“å…¥closeä½ å°±å¯ä»¥å¾—åˆ°ä¸€ä¸ªæ­£ç¡®çš„å¿«æ·é”®/å‘½ä»¤ã€‚</p>
<p>2.é€‰æ‹©æœ€è¿‘çš„å¤åˆ¶ç²˜è´´ï¼ˆç®¡ç†å‰ªåˆ‡ç‰ˆï¼‰ï¼šcmd + shift + v (Windows / Linux: ctrl + shift + v)ã€‚<br>é»˜è®¤æœ‰5ä¸ªæœ€è¿‘çš„å¤åˆ¶/ç²˜è´´å…ƒç´ ã€‚<br><img src="http://www.jcodecraeer.com/uploads/20161115/1479209676110910.png" alt=""></p>
<p>3.å¯ç”¨å¤šå…‰æ ‡åŠŸèƒ½ï¼šcontrol + g (alt + j for Windows / Linux)ã€‚<br><img src="http://www.jcodecraeer.com/uploads/20161115/1479209848645605.gif" alt=""></p>
<p>4.æ‰“å¼€ä¸€ä¸ªç±»ï¼š cmd + o (Windows / Linux: ctrl + n)ã€‚</p>
<p>5.æ‰“å¼€ä»»æ„æ–‡ä»¶ï¼š cmd + shift + o (Windows / Linux: ctrl + shift + n)ã€‚</p>
<p>6.æ‰“å¼€symbolï¼šcmd + option + o (Windows / Linux: alt + shift + n)ã€‚</p>
<p>7.è·³åˆ°å®ç°ï¼šcmd + option + b (Windows / Linux:<br>ctrl + alt + b)ã€‚</p>
<p>å‡å¦‚ä½ æœ‰ä¸€ä¸ªinterfaceã€‚é€šè¿‡ç‚¹å‡»æ¥å£çš„åå­—ï¼Œç„¶åæŒ‰ä¸‹å¿«æ·é”®å°±å¯ä»¥è·³è½¬åˆ°è¿™ä¸ªæ¥å£çš„å®ç°ã€‚å¦‚æœæœ‰å¤šä¸ªå®ç°ä¼šå‡ºç°ä¸‹æ‹‰é€‰æ‹©ã€‚</p>
<p>8.è·³è½¬åˆ°å®šä¹‰ï¼šcmd + b (Windows / Linux: ctrl + b)ã€‚</p>
<p>å¯ä»¥è®©ä½ å¿«é€Ÿè·³è½¬åˆ°ä¸€ä¸ªç±»ï¼Œæ–¹æ³•æˆ–è€…å˜é‡è¢«å®šä¹‰çš„åœ°æ–¹ã€‚</p>
<p>9.è·³è½¬åˆ°ç±»å‹å®šä¹‰å¤„ï¼šcontrol + shift + b (Windows / Linux:<br>ctrl + shift + b)ã€‚</p>
<p>å‡è®¾ä½ å®šä¹‰äº†ï¼š</p>
<p>Employee employee = new Employee(â€œMichalâ€);</p>
<p>å½“ä½ çš„æ’å…¥ç¬¦å·åœ¨employeeä¸Šï¼Œè¿™æ—¶ä½ æŒ‰ä¸‹å¿«æ·é”®ï¼Œä½ å°†è·³è½¬åˆ°Employeeç±»ä¸­ã€‚</p>
<p>10.è·³è½¬åˆ°superï¼š cmd + u (Windows / Linux: ctrl + u)ã€‚</p>
<p>æ¯”å¦‚ï¼Œä½ é‡å†™äº†ä¸€äº›æ–¹æ³•,å½“ä½ çš„æ’å…¥ç¬¦å·åœ¨æ–¹æ³•åä¸Šï¼ŒæŒ‰ä¸‹è¿™ä¸ªå¿«æ·é”®ä½ å°†è·³è½¬åˆ°parentçš„è¿™ä¸ªæ–¹æ³•ã€‚</p>
<p>11.Move between tabs: cmd + shift + <a href="move right"> (move left) or cmd + shift + </a> (Windows / Linux: alt + â† / â†’).</p>
<p>12 Move between Design / Text tabs in layoutâ€™s view:<br>control + shift + â† / â†’ (Windows / Linux: alt + shift + â† / â†’).</p>
<p>13.å…³é—­å½“å‰çš„tabï¼šcmd + w (Windows / Linux: ctrl + shift + a)ã€‚</p>
<p>14.éšè—æ‰€æœ‰çª—å£ï¼šcmd + shift + F12 (Windows / Linux:<br>ctrl + shift + F12)ã€‚</p>
<p>15.æœ€å°åŒ– Android Studio instance: cmd + m (Windows / Linux:<br>ctrl + m)ã€‚</p>
<p>16.æ ¼å¼åŒ–ä»£ç : cmd + option + l (Windows / Linux:<br>ctrl + alt + l)ã€‚</p>
<p>17.Auto-indent lines: control + option + i (Windows / Linux:<br>ctrl + alt + i).</p>
<p>18.å®ç°æ¥å£çš„æ–¹æ³•: control + i (Windows / Linux: ctrl + i)ã€‚</p>
<p>å‡è®¾ä½ è¦å®ç°ä¸€ä¸ªæ¥å£ã€‚è¿™ä¸ªå¿«æ·é”®å¯ä»¥è®©ä½ å¿«é€Ÿå¯¼å…¥è¿™ä¸ªæ¥å£çš„æ‰€æœ‰æ–¹æ³•ã€‚</p>
<p>19.Smart code completion (filters the list of methods and variables by expected type): control + shift + space (Windows / Linux: ctrl + shift + space).</p>
<p>20.æŸ¥æ‰¾: cmd + f (Windows / Linux: ctrl + f)ã€‚</p>
<p>21.æŸ¥æ‰¾å¹¶æ›¿æ¢: cmd + r (Windows / Linux: ctrl + r)ã€‚</p>
<p>22.æŠŠä¸€ä¸ªç¡¬ç¼–ç çš„å­—ç¬¦ä¸²æ”¾åˆ°èµ„æºæ–‡ä»¶ä¸­ï¼šoption + return (Windows / Linux: alt + enter)ã€‚å…‰æ ‡å¿…é¡»åœ¨è¿™ä¸ªæ–‡å­—ä¹‹ä¸Šæ—¶æ‰èƒ½ä½¿ç”¨è¿™ä¸ªå¿«æ·é”®ã€‚çœ‹ä¸‹é¢çš„gifå›¾ï¼š<br><img src="http://www.jcodecraeer.com/uploads/20161116/1479268452113436.gif" alt=""></p>
<h3 id="æ’ä»¶"><a href="#æ’ä»¶" class="headerlink" title="æ’ä»¶"></a>æ’ä»¶</h3><p>1.<a href="https://plugins.jetbrains.com/plugin/4455" target="_blank" rel="noopener">Key promoter</a> - å¿«æ·é”®æç¤ºæ’ä»¶ å½“ä½ ç‚¹å‡»é¼ æ ‡ä¸€ä¸ªåŠŸèƒ½çš„æ—¶å€™,å¯ä»¥æç¤º ä½ è¿™ä¸ªåŠŸèƒ½å¿«æ·é”®æ˜¯ä»€ä¹ˆ ,å’Œè¿™ä¸ªæŒ‰é’®ä½ çš„ä½¿ç”¨é¢‘ç‡ </p>
<p>2.<a href="https://plugins.jetbrains.com/plugin/2162" target="_blank" rel="noopener">String Manipulation</a> - a plugin which provides actions for text manipulation (e.g. toggling styles like camelCase, hyphen-lowercase etc., capitalize text and many more).</p>
<p>3.<a href="https://github.com/konifar/android-material-design-icon-generator-plugin" target="_blank" rel="noopener">Android Material Design Icon Generator</a> -è¿™ä¸ªæ’ä»¶å¸®åŠ©ä½ ä¸ºå·¥ç¨‹æ·»åŠ Material Designå›¾æ ‡ã€‚å®‰è£…ä¹‹åä½¿ç”¨å¿«æ·é”®cmd + shift + mç”Ÿæˆä¸€ä¸ªå›¾æ ‡ã€‚</p>
<p>4.<a href="https://github.com/avast/android-butterknife-zelezny" target="_blank" rel="noopener">ButterKnifeZelezny</a> - ä¸€é”®ä» å¸ƒå±€æ–‡ä»¶ä¸­ ç”Ÿæˆå¯¹äºçš„ View å£°æ˜å’Œ ButterKnife æ³¨è§£ï¼š<br><img src="http://www.jcodecraeer.com/uploads/20161116/1479269691116405.gif" alt=""></p>
<p>5.<a href="https://github.com/mcharmas/android-parcelable-intellij-plugin" target="_blank" rel="noopener">IntelliJ/Android Studio Plugin for Android Parcelable boilerplate code generation</a> - ä¸€ä¸ªæ ¹æ®ç±»çš„æˆå‘˜ç”ŸæˆParcelableçš„æ’ä»¶ã€‚</p>
<p>6.<a href="https://github.com/pbreault/adb-idea" target="_blank" rel="noopener">ADB Idea</a> - ä¸€ä¸ªå¸®åŠ©ä½ ä½¿ç”¨adbå‘½ä»¤çš„æ’ä»¶ï¼šå¸è½½ï¼Œæ€æ­»ï¼Œå¯åŠ¨ï¼Œé‡å¯ï¼Œæ¸…é™¤æ•°æ®ç­‰å‘½ä»¤ã€‚</p>
<p>7.<a href="https://www.genymotion.com/plugins/" target="_blank" rel="noopener">Genymotion plugin</a> - ä¸€ä¸ªè®©ä½ å¯ä»¥åœ¨Android Studioä¸­åˆ›å»ºå’Œå¼€å¯Genymotionè™šæ‹Ÿè®¾å¤‡çš„æ’ä»¶ã€‚</p>
<p>8.<a href="http://www.methodscount.com/plugins" target="_blank" rel="noopener">Android Methods Count</a> - a plugin that parses your Android library dependencies and shows the methods count as an handy hint.</p>
<p>9.<a href="https://plugins.jetbrains.com/plugin/7315" target="_blank" rel="noopener">Git Flow Integration</a> - a plugin for introducing a Git Flow branching model.</p>
<p>10.<a href="https://plugins.jetbrains.com/plugin/7567" target="_blank" rel="noopener">Builder plugin</a> - a plugin (from Square) that generates a static nested Builder for a class.</p>
<h3 id="èµ„æº"><a href="#èµ„æº" class="headerlink" title="èµ„æº"></a>èµ„æº</h3><p>1.<a href="">Android Studio Tips of the Day by Philippe Breault</a><br>2.<a href="https://developer.android.com/studio/intro/keyboard-shortcuts.html" target="_blank" rel="noopener">å¿«æ·é”®å‚è€ƒ</a><br>3.<a href="http://www.jcodecraeer.com/a/anzhuokaifa/Android_Studio/2016/0424/4172.html" target="_blank" rel="noopener">(About) 10 Things You (Probably) Didnâ€™t Know You Could do in Android Studio by Reto Meierã€‚ä¸­æ–‡ç‰ˆï¼š10ä¸ªä½ å¯èƒ½ä¸çŸ¥é“çš„ Android StudioæŠ€å·§ã€‚ </a><br>4.<a href="https://vimeo.com/98922030
5.[Android Studio Like a Boss by Philippe Breault](https://realm.io/news/360andev-philippe-breault-android-studio-ide-like-boss-structural-search-refactoring-java/" target="_blank" rel="noopener">æ— é¼ æ ‡å¼€å‘ by Hadi Hariri</a><br>6.<a href="https://www.youtube.com/watch?v=Y2GC6P5hPeA" target="_blank" rel="noopener">Android Studio for Experts (Android Dev Summit 2015)</a><br>7.<a href="http://michaelevans.org/blog/2016/01/06/android-studio-tips-and-tricks/" target="_blank" rel="noopener">Android Studio Tips and Tricks by Michael Evans</a><br>8.<a href="https://developer.android.com/studio/intro/index.html" target="_blank" rel="noopener">è®¤è¯† Android Studio</a><br>9.<a href="http://www.donnfelker.com/android-studio-tips-and-tricks-part-1/" target="_blank" rel="noopener">Android Studio - Tips and Tricks by Donn Felker</a><br>10.<a href="https://developer.android.com/studio/debug/index.html" target="_blank" rel="noopener">Debug Your App with Android Studio</a><br>11.<a href="https://www.reddit.com/r/androiddev/comments/3ktqyb/what_are_some_of_your_musthave_plugins_for/" target="_blank" rel="noopener">What are some of your must-have plugins for - Reddit discussion</a></p>
]]></content>
      
        <categories>
            
            <category> AndroidStudio </category>
            
        </categories>
        
        
        <tags>
            
            <tag> AndroidStudio </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Android5.0æ–°æ§ä»¶å­¦ä¹ ]]></title>
      <url>/Android5-0-control-study-AppBarLayout-Toolbar-CoordinateLayout-cardView.html</url>
      <content type="html"><![CDATA[<p><strong>ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºåšä¸»åŸåˆ›æ–‡ç« ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„(www.huangjie.name)ï¼Œä¿æŠ¤åŸåˆ›ï¼Œä»æˆ‘åšèµ·.</strong></p>
<hr>
<blockquote>
<p>æœ¬æ–‡è®°å½•ä¸€äº›Androd5.0çš„æ–°æ§ä»¶çš„ä¸€äº›å­¦ä¹ æ€»ç»“ï¼Œç”±äºç½‘ä¸Šçš„åšæ–‡æ€»ç»“çš„æ¯”è¾ƒå…¨é¢ï¼Œæˆ‘å°±ä¸å†™åšæ–‡æ€»ç»“äº†ï¼Œè¿™é‡Œä¸»è¦æ˜¯åˆ—ä¸¾ä¸€äº›æ§ä»¶çš„å­¦ä¹ èµ„æ–™</p>
</blockquote>
<a id="more"></a>
<h3 id="CoordinateLayout"><a href="#CoordinateLayout" class="headerlink" title="CoordinateLayout"></a>CoordinateLayout</h3><p>ç®€ä»‹ï¼šåè°ƒå¸ƒå±€,é…åˆ<code>Behavior</code>ä½¿ç”¨ï¼Œç‰¹ç‚¹æ˜¯èƒ½æ ¹æ®ä¸€ä¸ª<code>View</code>çš„åŠ¨ä½œåè°ƒå¦ä¸€ä¸ª<code>View</code>çš„åŠ¨ä½œã€‚<br>å‚è€ƒæ–‡ç« :<a href="https://www.jianshu.com/p/72d45d1f7d55" target="_blank" rel="noopener">CoordinatorLayoutçš„ä½¿ç”¨å¦‚æ­¤ç®€å•</a></p>
<h3 id="ToolBar"><a href="#ToolBar" class="headerlink" title="ToolBar"></a>ToolBar</h3><p>ç®€ä»‹ï¼šä»£æ›¿<code>ActionBar</code>ï¼Œæ¯”å®ƒæ›´åŠ çš„çµæ´»ï¼Œå®è´¨æ˜¯ä¸€ä¸ª<code>ViewGroup</code></p>
<p>å‚è€ƒèµ„æ–™:<a href="http://blog.csdn.net/lmj623565791/article/details/45303349" target="_blank" rel="noopener">Android 5.x Theme ä¸ ToolBar å®æˆ˜</a><br><a href="http://blog.csdn.net/kebi007/article/details/71247295" target="_blank" rel="noopener">xamarin android toolbar(è¸©å‘å®Œå…¨å…¥é—¨è¯¦è§£)</a></p>
<h3 id="AppBarLayout"><a href="#AppBarLayout" class="headerlink" title="AppBarLayout"></a>AppBarLayout</h3><p>ç®€ä»‹ï¼šç»§æ‰¿è‡ª<code>LinearLayout</code>,å®ƒå¯ä»¥è®©ä½ å®šåˆ¶å½“æŸä¸ªå¯æ»šåŠ¨<code>View</code>æ‰‹åŠ¿å‘ç”Ÿå˜åŒ–æ—¶ï¼Œå…¶å†…éƒ¨å­<code>View</code>ä¼šå®ç°ä½•ç§åŠ¨ä½œ.</p>
<h3 id="CollapsingToolbarLayout"><a href="#CollapsingToolbarLayout" class="headerlink" title="CollapsingToolbarLayout"></a>CollapsingToolbarLayout</h3><p>ç®€ä»‹ï¼šç”¨æ¥å¯¹<code>ToolBar</code>è¿›è¡Œå†æ¬¡åŒ…è£…çš„<code>ViewGroup</code>ï¼Œå¯ä»¥å®ç°ä¸€äº›æŠ˜å çš„æ•ˆæœï¼ˆæ›´åƒæ˜¯ç¼©æ”¾ï¼‰ï¼Œæ¯”å¦‚å‘ä¸Šæ»‘åŠ¨æ ‡é¢˜æ–‡å­—é€æ¸ç¼©å°è‡³å·¦ä¸Šè§’ï¼Œå®ƒéœ€è¦ä½œä¸º<code>AppBarLayout</code>å¸ƒå±€é‡Œé¢å¹¶ä½œä¸ºå®ƒçš„ç›´æ¥å­<code>View</code>.</p>
<h3 id="NestedScrollView"><a href="#NestedScrollView" class="headerlink" title="NestedScrollView"></a>NestedScrollView</h3><p>ç®€ä»‹ï¼šä¸ºäº†é…åˆ<code>AppBarLayout</code>çš„æ»šåŠ¨æ•ˆæœè€Œç¼–å†™çš„æ»šåŠ¨æ§ä»¶ï¼Œç»§æ‰¿è‡ª<code>FrameLayout</code>,éšåä½¿ç”¨<code>appbar_scrolling_view_behavior</code>å³å¯å®ç°ç›¸åº”çš„æ•ˆæœ</p>
<p>å‚è€ƒæ–‡ç« :<a href="https://www.jianshu.com/p/d159f0176576" target="_blank" rel="noopener">ç©è½¬AppBarLayoutï¼Œæ›´é…·ç‚«çš„é¡¶éƒ¨æ </a></p>
<h3 id="CardView"><a href="#CardView" class="headerlink" title="CardView"></a>CardView</h3><p>ç®€ä»‹ï¼šå¡ç‰‡å¸ƒå±€ï¼Œç»§æ‰¿è‡ª<code>FrameLayout</code>ï¼Œå¯å®ç°é˜´å½±æ•ˆæœ,é€šå¸¸ä¸<code>RecycleView</code>æˆ–<code>ListView</code>é…åˆä½¿ç”¨ä½œä¸º<code>item</code>çš„å®¹å™¨<br>å‚è€ƒèµ„æ–™:<a href="https://www.jianshu.com/p/33b1d21d6ba6" target="_blank" rel="noopener">CardViewçš„åŸºæœ¬ç”¨æ³•</a></p>
<h3 id="RecyclerView"><a href="#RecyclerView" class="headerlink" title="RecyclerView"></a>RecyclerView</h3><p>ç®€ä»‹ï¼šæ¯”<code>ListView</code>æ›´åŠ çµæ´»ï¼Œæ›´ä½è€¦åˆçš„åˆ—è¡¨å±•ç¤ºæ§ä»¶ï¼Œå¯è½»æ˜“å®ç°<code>ListView</code>,<code>GridView</code>,å’Œç€‘å¸ƒæµçš„æ•ˆæœ</p>
<p>å‚è€ƒèµ„æ–™:<a href="http://blog.csdn.net/lmj623565791/article/details/45059587" target="_blank" rel="noopener"> Android RecyclerView ä½¿ç”¨å®Œå…¨è§£æ ä½“éªŒè‰ºæœ¯èˆ¬çš„æ§ä»¶</a></p>
<h3 id="FloatingActionButton"><a href="#FloatingActionButton" class="headerlink" title="FloatingActionButton"></a>FloatingActionButton</h3><p>ç®€ä»‹ï¼šç”¨æ¥åœ¨ç•Œé¢ä¸Šæ˜¾ç¤ºä¸€ä¸ªæ‚¬æµ®çš„æŒ‰é’®<br>å‚è€ƒèµ„æ–™ï¼š<a href="http://blog.csdn.net/lmj623565791/article/details/46678867" target="_blank" rel="noopener">FloatingActionButton å®Œå…¨è§£æ[Design Support Library(2)]</a></p>
<h3 id="TextInputLayout"><a href="#TextInputLayout" class="headerlink" title="TextInputLayout"></a>TextInputLayout</h3><p>ç®€ä»‹ï¼šé€šå¸¸ä¸<code>EditText</code>é…åˆä½¿ç”¨ï¼Œèƒ½åœ¨<code>EditText</code>è¾“å…¥æ—¶å°†<code>hint</code>æ”¾å…¥åˆ°ä¸Šæ–¹ï¼Œè¿˜å…·æœ‰ç©ºæ ¡éªŒçš„åŠŸèƒ½</p>
<p>å‚è€ƒèµ„æ–™ï¼š<br><a href="https://www.jianshu.com/p/c06b2a41f611" target="_blank" rel="noopener">TextInputlayoutå…¥é—¨è®²è§£</a><br><a href="http://blog.csdn.net/u011051627/article/details/48177095" target="_blank" rel="noopener">Android Design TextInputLayout è§£æ,å¸¦ä½ æ·±å…¥TextInputLayout</a></p>
<h3 id="TabLayout"><a href="#TabLayout" class="headerlink" title="TabLayout"></a>TabLayout</h3><p>ç®€ä»‹ï¼šæä¾›ä¸€ä¸ªæ°´å¹³çš„å¸ƒå±€æ¥å±•ç¤º<code>TAB</code></p>
<p>å‚è€ƒèµ„æ–™ï¼š<br><a href="https://www.jianshu.com/p/2b2bb6be83a8" target="_blank" rel="noopener">Designåº“-TabLayoutå±æ€§è¯¦è§£</a><br><a href="https://www.jianshu.com/p/be1e8a1da639?nomobile=yes" target="_blank" rel="noopener">TabLayoutçš„é«˜ç«¯ç”¨æ³•</a></p>
<h3 id="NavigationView"><a href="#NavigationView" class="headerlink" title="NavigationView"></a>NavigationView</h3><p>ç®€ä»‹:åœ¨<code>Material Design</code>ä¸­ï¼Œ<code>Navigation drawer</code>å¯¼èˆªæŠ½å±‰ï¼Œè¢«è®¾è®¡ç”¨äºåº”ç”¨å¯¼èˆªï¼Œæä¾›äº†ä¸€ç§é€šç”¨çš„å¯¼èˆªæ–¹å¼ï¼Œä½“ç°äº†è®¾è®¡çš„ä¸€è‡´æ€§ã€‚<br>è€Œ<code>NavigationView</code>çš„å…¸å‹ç”¨é€”å°±æ˜¯é…åˆä¹‹å‰v4åŒ…çš„<code>DrawerLayout</code>ï¼Œä½œä¸ºå…¶ä¸­çš„<code>Drawer</code>éƒ¨åˆ†ï¼Œå³å¯¼èˆªèœå•çš„æœ¬ä½“éƒ¨åˆ†ã€‚<code>NavigationView</code>æ˜¯ä¸€ä¸ªå¯¼èˆªèœå•æ¡†æ¶ï¼Œä½¿ç”¨<code>menu</code>èµ„æºå¡«å……æ•°æ®ï¼Œä½¿æˆ‘ä»¬å¯ä»¥æ›´ç®€å•é«˜æ•ˆçš„å®ç°å¯¼èˆªèœå•ã€‚å®ƒæä¾›äº†ä¸é”™çš„é»˜è®¤æ ·å¼ã€é€‰ä¸­é¡¹é«˜äº®ã€åˆ†ç»„å•é€‰ã€åˆ†ç»„å­æ ‡é¢˜ã€ä»¥åŠå¯é€‰çš„<code>Header</code>ã€‚</p>
<p>å‚è€ƒèµ„æ–™ï¼š<a href="http://blog.csdn.net/u012702547/article/details/51253222" target="_blank" rel="noopener"> Android5.0ä¹‹NavigationViewçš„ä½¿ç”¨</a></p>
<h3 id="Snackbar"><a href="#Snackbar" class="headerlink" title="Snackbar"></a>Snackbar</h3><p>ç®€ä»‹ï¼šä¸<code>Toast</code>ç›¸ä¼¼,å¼¹å‡ºä¸€ä¸ªæç¤ºæ¡†</p>
<p>å‚è€ƒèµ„æ–™ï¼š<a href="https://www.jianshu.com/p/cd1e80e64311/" target="_blank" rel="noopener">æ²¡æ—¶é—´è§£é‡Šäº†ï¼Œå¿«ä½¿ç”¨Snackbar!â€”â€”Android SnackbarèŠ±å¼ä½¿ç”¨æŒ‡å—
</a></p>
<h3 id="Palette"><a href="#Palette" class="headerlink" title="Palette"></a>Palette</h3><p>ç®€ä»‹ï¼šå–è‰²å™¨ï¼Œä»å›¾ç‰‡ä¸­æå–å…³é”®çš„é¢œè‰²ï¼Œå¹¶å°†è¯¥é¢œè‰²è®¾ç½®åˆ°åˆ«çš„æ§ä»¶ä¸Š,å¯ä»¥å’Œ<code>ToolBar</code>é…åˆä½¿ç”¨åŠ¨æ€æ”¹å˜é¢œè‰²<br>å‚è€ƒèµ„æ–™:<br><a href="http://blog.csdn.net/u013278099/article/details/49887463" target="_blank" rel="noopener">å®‰å“5.xçš„Paletteä¹‹ä½ ä¸çŸ¥é“çš„äº‹</a></p>
<p><a href="http://blog.csdn.net/bbld_/article/details/41439715" target="_blank" rel="noopener">Android Material Designä¹‹Toolbarä¸Paletteå®è·µ</a></p>
<h3 id="RippleDrawable"><a href="#RippleDrawable" class="headerlink" title="RippleDrawable"></a>RippleDrawable</h3><p>ç®€ä»‹ï¼š5.0ä»¥ä¸Šçš„æ¶Ÿæ¼ªæ•ˆæœ,éœ€è¦å…¼å®¹5.0ä»¥ä¸‹éœ€è¦ä½¿ç”¨å¼€æºåº“<a href="https://github.com/traex/RippleEffect" target="_blank" rel="noopener">RippleEffect</a>.<br>å‚è€ƒèµ„æ–™ï¼š<a href="http://blog.csdn.net/oqihaogongyuan/article/details/53102615" target="_blank" rel="noopener">Material Designä¹‹RippleDrawableè¯¦è§£</a></p>
]]></content>
      
        <categories>
            
            <category> AndroidåŸºç¡€è¿›é˜¶ </category>
            
            <category> å®‰å“æ§ä»¶ </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Android5.0 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[ä¸€äº›å…³äºå®‰å“éç¼–ç é—®é¢˜çš„è§£å†³æ–¹æ¡ˆè®°å½•]]></title>
      <url>/%E4%B8%80%E4%BA%9B%E5%85%B3%E4%BA%8E%E5%AE%89%E5%8D%93%E9%9D%9E%E7%BC%96%E7%A0%81%E9%97%AE%E9%A2%98%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%E8%AE%B0%E5%BD%95.html</url>
      <content type="html"><![CDATA[<p><strong>ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºåšä¸»åŸåˆ›æ–‡ç« ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„(www.huangjie.name)ï¼Œä¿æŠ¤åŸåˆ›ï¼Œä»æˆ‘åšèµ·.</strong></p>
<hr>
<blockquote>
<p>å®‰å“çš„ä¸€äº›éç¼–ç é—®é¢˜çš„ä¸€äº›è§£å†³æ–¹æ¡ˆè®°å½•ï¼Œå¦‚æ‰“åŒ…ï¼ŒåŠ å¯†ç­‰..</p>
</blockquote>
<a id="more"></a>
<h3 id="å®‰å“è‡ªåŠ¨åŒ–æ‰“åŒ…å‘å¸ƒå·¥ä½œæµ-ç­¾ååŠ å¯†"><a href="#å®‰å“è‡ªåŠ¨åŒ–æ‰“åŒ…å‘å¸ƒå·¥ä½œæµ-ç­¾ååŠ å¯†" class="headerlink" title="å®‰å“è‡ªåŠ¨åŒ–æ‰“åŒ…å‘å¸ƒå·¥ä½œæµ,ç­¾ååŠ å¯†"></a>å®‰å“è‡ªåŠ¨åŒ–æ‰“åŒ…å‘å¸ƒå·¥ä½œæµ,ç­¾ååŠ å¯†</h3><p>è§£å†³æ–¹æ¡ˆï¼š<br>å¯ä½¿ç”¨Travis CIé¡¹ç›®æ¡†æ¶</p>
<p>æœªè‡ªåŠ¨åŒ–å‰å®‰å“å¼€å‘çš„å·¥ä½œæµç¨‹ï¼š</p>
<ol>
<li>å¼€å‘ä¸€äº›æ–°åŠŸèƒ½ï¼Œæäº¤ä»£ç </li>
<li>å®Œæˆä¸€éƒ¨åˆ†åŠŸèƒ½åï¼Œæ‰“åŒ…ä¸€ä¸ªæµ‹è¯•ç‰ˆAPK</li>
<li>å°†æµ‹è¯•ç‰ˆAPKä¸Šä¼ åˆ°QQç¾¤ / ç½‘ç›˜ / Fir.im / è’²å…¬è‹±ç­‰</li>
<li>åœ¨QQç¾¤æˆ–å‘å¸ƒå¹³å°è§£é‡Šå½“å‰ç‰ˆæœ¬æ‰€å®Œæˆçš„åŠŸèƒ½</li>
<li>é€šçŸ¥æµ‹è¯•äººå‘˜æµ‹è¯•</li>
</ol>
<p>å®ç°äº†è¿™å¥—è‡ªåŠ¨åŒ–å‘å¸ƒåï¼Œå·¥ä½œæµç¨‹è¢«ç®€åŒ–æˆï¼š</p>
<ol>
<li>å¼€å‘æ–°åŠŸèƒ½ï¼Œæäº¤ä»£ç </li>
<li>é€šè¿‡git tagå¯¹ä»£ç æ‰“ä¸€ä¸ªå†…æµ‹ç‰ˆçš„tagï¼Œåœ¨tagçš„æè¿°ä¸­å¯¹å†™å½“å‰å®Œæˆçš„åŠŸèƒ½</li>
</ol>
<p>æ­¤å¤–è¿˜æ”¯æŒç­¾ååŠ å¯†ï¼š<br>åŠ å¯†å‰:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">android &#123;</span><br><span class="line">    signingConfigs &#123;</span><br><span class="line">        releaseConfig &#123;</span><br><span class="line">            storeFile file(&quot;../keys/evandroid.jks&quot;)</span><br><span class="line">            storePassword &quot;123456&quot;</span><br><span class="line">            keyAlias &quot;evandroid_alias&quot;</span><br><span class="line">            keyPassword &quot;654321&quot;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    buildTypes &#123;</span><br><span class="line">        release &#123;</span><br><span class="line">            minifyEnabled false</span><br><span class="line">            proguardFiles getDefaultProguardFile(&apos;proguard-android.txt&apos;), &apos;proguard-rules.pro&apos;</span><br><span class="line">            signingConfig signingConfigs.releaseConfig</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>åŠ å¯†åï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">releaseConfig &#123;</span><br><span class="line">    storeFile file(&quot;../keys/evandroid.jks&quot;)</span><br><span class="line">    storePassword project.hasProperty(&quot;KEYSTORE_PASS&quot;) ? KEYSTORE_PASS : System.getenv(&quot;KEYSTORE_PASS&quot;)</span><br><span class="line">    keyAlias project.hasProperty(&quot;ALIAS_NAME&quot;) ? ALIAS_NAME : System.getenv(&quot;ALIAS_NAME&quot;)</span><br><span class="line">    keyPassword project.hasProperty(&quot;ALIAS_PASS&quot;) ? ALIAS_PASS : System.getenv(&quot;ALIAS_PASS&quot;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>å¯†é’¥å®Œå…¨ä»åå°è·å–</p>
<p>å…³äº<a href="https://travis-ci.org/" target="_blank" rel="noopener">Travis CI</a>çš„èµ„æ–™:</p>
<ul>
<li><a href="https://avnpc.com/pages/android-auto-deploy-workflow-on-travis-ci" target="_blank" rel="noopener">åŸºäºTravis CIæ­å»ºAndroidè‡ªåŠ¨æ‰“åŒ…å‘å¸ƒå·¥ä½œæµï¼ˆæ”¯æŒGithub ReleaseåŠfir.im)</a></li>
</ul>
<h3 id="å®‰å“å¤šæ¸ é“æ‰“åŒ…-åŒæ—¶æ‰“900ä¸ªæ¸ é“åŒ…æ€ä¹ˆåŠï¼Ÿï¼Ÿï¼Ÿ"><a href="#å®‰å“å¤šæ¸ é“æ‰“åŒ…-åŒæ—¶æ‰“900ä¸ªæ¸ é“åŒ…æ€ä¹ˆåŠï¼Ÿï¼Ÿï¼Ÿ" class="headerlink" title="å®‰å“å¤šæ¸ é“æ‰“åŒ…(åŒæ—¶æ‰“900ä¸ªæ¸ é“åŒ…æ€ä¹ˆåŠï¼Ÿï¼Ÿï¼Ÿ)"></a>å®‰å“å¤šæ¸ é“æ‰“åŒ…(åŒæ—¶æ‰“900ä¸ªæ¸ é“åŒ…æ€ä¹ˆåŠï¼Ÿï¼Ÿï¼Ÿ)</h3><p>è§£å†³æ–¹æ¡ˆï¼š<br>V1ç­¾åä¸‹çš„å¿«é€Ÿæ‰“åŒ…å·¥å…·ï¼š<a href="https://github.com/GavinCT/AndroidMultiChannelBuildTool" target="_blank" rel="noopener">AndroidMultiChannelBuildTool</a></p>
<p>ä¸ç®¡å¤šå°‘æ¸ é“åŒ…ï¼Œåˆ†åˆ†é’Ÿæ‰“å®Œã€‚</p>
<p>V2ç­¾åæ‰“åŒ…:<br>å¦‚æœå…¬å¸éœ€è¦å‡çº§åˆ°V2ç­¾å,é‚£ä¹ˆä¸Šé¢é‚£ä¸ªå°±ä¸åœ¨é€‚ç”¨ï¼Œè¯·ç§»æ­¥åˆ°è¿™ä¸ª:<a href="https://github.com/Meituan-Dianping/walle" target="_blank" rel="noopener">walle</a>,ç¾å›¢é’ˆå¯¹V2ç­¾åè®¾è®¡çš„æ‰“åŒ…å·¥å…·ï¼Œä¸è¿‡ä½¿ç”¨æ–¹å¼ä¸ä¸Šé¢çš„é‚£ä¸ªä¸åŒï¼Œéœ€è¦åœ¨é¡¹ç›®ä¸­æ·»åŠ æ’ä»¶å¹¶ç”¨Gradleæ„å»ºæ‰“åŒ….</p>
]]></content>
      
        <categories>
            
            <category> å®‰å“æ‚è®° </category>
            
        </categories>
        
        
    </entry>
    
    <entry>
      <title><![CDATA[objectBoxæ•°æ®åº“ä½¿ç”¨æ•™ç¨‹]]></title>
      <url>/objectBox%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B-objectbox-java.html</url>
      <content type="html"><![CDATA[<p><strong>ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºåšä¸»åŸåˆ›æ–‡ç« ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„(www.huangjie.name)ï¼Œä¿æŠ¤åŸåˆ›ï¼Œä»æˆ‘åšèµ·.</strong></p>
<hr>
<h2 id="æ•°æ®åº“ç®€ä»‹"><a href="#æ•°æ®åº“ç®€ä»‹" class="headerlink" title="æ•°æ®åº“ç®€ä»‹"></a>æ•°æ®åº“ç®€ä»‹</h2><p><a href="https://github.com/objectbox/objectbox-java" target="_blank" rel="noopener">objectbox</a>æ•°æ®åº“æ˜¯greenrobotå›¢é˜Ÿå¼€å‘çš„å…¨æ–°éå…³ç³»å‹æ•°æ®åº“æ¡†æ¶ï¼Œè¯¥å›¢é˜Ÿè¿˜å¼€å‘è¿‡greenDao,EventBusç­‰çƒ­é—¨æ¡†æ¶ï¼Œå¯è°“å®åŠ›é›„åšã€‚æŒ‰ç…§å®˜æ–¹ä»‹ç»ï¼Œè¯¥åº“æœ‰å¦‚ä¸‹ç‰¹ç‚¹:<br><a id="more"></a></p>
<ul>
<li>è¶…å¿«é€Ÿ:å·ç§°èƒœè¿‡æµ‹è¯•è¿‡çš„æ‰€æœ‰åµŒå…¥å¼æ•°æ®åº“</li>
<li>é¢å‘å¯¹è±¡çš„ API: æ²¡æœ‰ rowsã€columns å’Œ SQLï¼Œå®Œå…¨ä»0å¼€å§‹çš„å¯¹è±¡ï¼ˆæ²¡æœ‰ORMï¼Œæ²¡æœ‰SQLiteï¼‰</li>
<li>ååº”æ€§:å¯¹æ•°æ®å˜åŒ–çš„ååº”ç®€å•è€Œå¼ºå¤§,ä½¿ç”¨ObjectBoxä¸­çš„ååº”æ•°æ®è§‚å¯Ÿå™¨æˆ–ä¸RxJavaé›†æˆã€‚</li>
<li>å¤šå¹³å°:å·²ç»æ”¯æŒå®‰å“å’Œjava,ioså’ŒMacOsæ­£åœ¨é›†æˆ</li>
<li>ç®€å•çš„çº¿ç¨‹:ObjectBoxè¿”å›çš„å¯¹è±¡å¯ä»¥åœ¨æ‰€ä»¥çº¿ç¨‹ä¸­è¿è¡Œ</li>
<li>æ²¡æœ‰æ‰‹åŠ¨æ¨¡å¼è¿ç§»:ObjectBoxè´Ÿè´£æ·»åŠ ï¼Œåˆ é™¤å’Œé‡å‘½åå±æ€§çš„æ–°å¯¹è±¡ç‰ˆæœ¬ï¼Œæ„å‘³ç€æ•°æ®åº“çš„å‡çº§ä¸å†éœ€è¦æˆ‘ä»¬è‡ªå·±ç®¡ç†ç‰ˆæœ¬å·ï¼ŒObjectBoxå†…éƒ¨ä¼šè‡ªåŠ¨å¸®æˆ‘ä»¬ç®¡ç†</li>
</ul>
<h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><p>æ³¨æ„ï¼Œæœ¬æ•™ç¨‹æ˜¯åŸºäºæˆªè‡³äºç›®å‰æœ€æ–°ç‰ˆ1.4.0ç¼–å†™</p>
<p>æ ¹ç›®å½•build.gradleä¸­æ·»åŠ ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">buildscript &#123;</span><br><span class="line">    ext.objectboxVersion = &apos;1.4.0&apos;</span><br><span class="line">    repositories &#123;</span><br><span class="line">        maven &#123; url &quot;http://objectbox.net/beta-repo/&quot; &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    dependencies &#123;</span><br><span class="line">        classpath &quot;io.objectbox:objectbox-gradle-plugin:$objectboxVersion&quot;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line">    </span><br><span class="line">allprojects &#123;</span><br><span class="line">    repositories &#123;</span><br><span class="line">        maven &#123; url &quot;http://objectbox.net/beta-repo/&quot; &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>app  build.gradleä¸­æ·»åŠ <br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apply plugin: &apos;io.objectbox&apos; // after applying Android plugin</span><br></pre></td></tr></table></figure></p>
<h2 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h2><h4 id="åˆå§‹åŒ–"><a href="#åˆå§‹åŒ–" class="headerlink" title="åˆå§‹åŒ–"></a>åˆå§‹åŒ–</h4><p>åœ¨Applicationä¸­çš„<code>onCreate()</code>ä¸­åˆå§‹åŒ–<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">boxStore = MyObjectBox.builder().androidContext(<span class="keyword">this</span>).build();</span><br></pre></td></tr></table></figure></p>
<p>åˆå§‹åŒ–åå¾—åˆ°ä¸€ä¸ª<code>BoxStore</code>å¯¹è±¡,è¯¥å¯¹è±¡å¯ä»¥ç®€å•ç†è§£ä¸ºè·å–æŸ¥è¯¢å¯¹è±¡çš„å…¥å£,å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ç”³æ˜ä¸€ä¸ª<code>get()</code>æ–¹æ³•ï¼Œåƒè¿™æ ·ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">public class BaseApp extends Application &#123;</span><br><span class="line">    private static BaseApp baseApp;</span><br><span class="line">    private BoxStore boxStore; //æ•°æ®åº“è¡¨çš„ç®¡ç†è€…</span><br><span class="line">    @Override</span><br><span class="line">    public void onCreate() &#123;</span><br><span class="line">        super.onCreate();</span><br><span class="line">        baseApp = this;</span><br><span class="line">        boxStore = MyObjectBox.builder().androidContext(this).build();</span><br><span class="line">        if (BuildConfig.DEBUG) &#123;</span><br><span class="line">            new AndroidObjectBrowser(boxStore).start(this);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public BoxStore getBoxStore()&#123;</span><br><span class="line">        return boxStore;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static BaseApp getInstence()&#123;</span><br><span class="line">        return baseApp;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="å®ä½“ç±»çš„å»ºç«‹"><a href="#å®ä½“ç±»çš„å»ºç«‹" class="headerlink" title="å®ä½“ç±»çš„å»ºç«‹"></a>å®ä½“ç±»çš„å»ºç«‹</h4><p>objectboxæ˜¯é€šè¿‡æ³¨è§£æ¥æ ‡æ˜å“ªä¸ªç±»æ˜¯å®ä½“ï¼Œå¸¸ç”¨çš„æ³¨è§£å¦‚ä¸‹ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">@Entity   //è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªéœ€è¦æŒä¹…åŒ–çš„å®ä½“</span><br><span class="line">public class Student &#123;</span><br><span class="line">    @Id </span><br><span class="line">    public long id;</span><br><span class="line"></span><br><span class="line">    @Index</span><br><span class="line">    public String name;</span><br><span class="line"> </span><br><span class="line">    @Transient</span><br><span class="line">    public int tempUsageCount;</span><br><span class="line"></span><br><span class="line">    @NameInDb(&quot;USERNAME&quot;)</span><br><span class="line">    public String name;</span><br><span class="line"></span><br><span class="line">    public ToOne&lt;Class&gt; classToOne;</span><br><span class="line"></span><br><span class="line">    public int age;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><strong>@Entityï¼š</strong>è¿™ä¸ªå¯¹è±¡éœ€è¦æŒä¹…åŒ–ã€‚</p>
<p><strong>@Idï¼š</strong>è¿™ä¸ªå¯¹è±¡çš„ä¸»é”®,é»˜è®¤æƒ…å†µä¸‹ï¼Œidæ˜¯ä¼šè¢«objectboxç®¡ç†çš„ï¼Œä¹Ÿå°±æ˜¯è‡ªå¢idï¼Œå¦‚æœä½ æƒ³æ‰‹åŠ¨ç®¡ç†idéœ€è¦åœ¨æ³¨è§£çš„æ—¶å€™åŠ ä¸Š@Id(assignable = true)å³å¯ã€‚å½“ä½ åœ¨è‡ªå·±ç®¡ç†idçš„æ—¶å€™å¦‚æœè¶…è¿‡longçš„æœ€å¤§å€¼ï¼Œobjectbox ä¼šæŠ¥é”™.idçš„å€¼ä¸èƒ½ä¸ºè´Ÿæ•°ã€‚å½“idç­‰äº0æ—¶objectboxä¼šè®¤ä¸ºè¿™æ˜¯ä¸€ä¸ªæ–°çš„å®ä½“å¯¹è±¡,å› æ­¤ä¼šæ–°å¢åˆ°æ•°æ®åº“è¡¨ä¸­</p>
<p><strong>@Indexï¼š</strong>è¿™ä¸ªå¯¹è±¡ä¸­çš„ç´¢å¼•ã€‚å¯¹ç»å¸¸å¤§é‡è¿›è¡ŒæŸ¥è¯¢çš„å­—æ®µåˆ›å»ºç´¢å¼•ï¼Œä¼šæé«˜ä½ çš„æŸ¥è¯¢æ€§èƒ½ã€‚</p>
<p><strong>@Transient:</strong>å¦‚æœä½ æœ‰æŸä¸ªå­—æ®µä¸æƒ³è¢«æŒä¹…åŒ–ï¼Œå¯ä»¥ä½¿ç”¨æ­¤æ³¨è§£,é‚£ä¹ˆè¯¥å­—æ®µå°†ä¸ä¼šä¿å­˜åˆ°æ•°æ®åº“</p>
<p><strong>@NameInDbï¼š</strong>æœ‰çš„æ—¶å€™æ•°æ®åº“ä¸­çš„å­—æ®µè·Ÿä½ çš„å¯¹è±¡å­—æ®µä¸åŒ¹é…çš„æ—¶å€™ï¼Œå¯ä»¥ä½¿ç”¨æ­¤æ³¨è§£ã€‚</p>
<p><strong>@ToOne:</strong>åšä¸€å¯¹ä¸€çš„å…³è”æ³¨è§£ï¼Œä¾‹å¦‚ç¤ºä¾‹ä¸­è¡¨ç¤ºä¸€å¼ å­¦ç”Ÿè¡¨ï¼ˆStudentï¼‰å…³è”ä¸€å¼ ç­çº§è¡¨ï¼ˆClassï¼‰,æ­¤å¤–è¿˜æœ‰ä¸€å¯¹å¤šï¼Œå¤šå¯¹å¤šçš„å…³è”ï¼Œä¾‹å¦‚Classçš„ç¤ºä¾‹ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">@Entity</span><br><span class="line">public class Class&#123;</span><br><span class="line">    @Id</span><br><span class="line">    long id;</span><br><span class="line">    </span><br><span class="line">    @Backlink(to = &quot;classToOne&quot;)</span><br><span class="line">    public ToMany&lt;Student&gt; studentEntitys;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><strong>@ToMany:</strong>åšä¸€å¯¹å¤šçš„å…³è”æ³¨è§£ï¼Œå¦‚ç¤ºä¾‹ä¸­è¡¨ç¤ºä¸€å¼ ç­çº§è¡¨(Class)å…³è”å¤šå¼ å­¦ç”Ÿè¡¨(Student)</p>
<p><strong>@Backlink:</strong>è¡¨ç¤ºåå‘å…³è”</p>
<h4 id="å¢åˆ æ”¹æŸ¥"><a href="#å¢åˆ æ”¹æŸ¥" class="headerlink" title="å¢åˆ æ”¹æŸ¥"></a>å¢åˆ æ”¹æŸ¥</h4><p>å®ä½“ç±»å»ºç«‹å®Œåï¼Œåœ¨Android Studioä¸­ä½¿ç”¨Build&gt; Make projectç¼–è¯‘ä¸€æ¬¡ï¼Œobjectboxä¼šè‡ªåŠ¨å¸®ä½ ç”Ÿæˆç›¸åº”çš„æ“ä½œå®ä½“,ä¾‹å¦‚Â·<code>Student</code>åˆ™ä¼šç”Ÿæˆä¸€ä¸ª<code>Student_</code>çš„ç±»ï¼Œè¯¥ç±»é€šå¸¸ä½œä¸ºParamsä¼ é€’ã€‚</p>
<p><strong>å¢åŠ ä¸€æ¡æ•°æ®</strong><br>é¦–å…ˆæˆ‘ä»¬è·å–è¯¥å®ä½“çš„<code>Box</code>å¯¹è±¡ï¼Œéšåè°ƒç”¨è¯¥å¯¹è±¡çš„<code>put()</code>æ–¹æ³•å³å¯å®Œæˆæ–°å¢æ“ä½œ<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Box&lt;Student&gt; StudentBox = BaseApp.getInstence().getBoxStore().boxFor(Student.class);</span><br><span class="line">Student student = new Student();</span><br><span class="line">student.name = &quot;Jay&quot;;</span><br><span class="line">StudentBox.put(student);</span><br></pre></td></tr></table></figure></p>
<p><strong>åˆ é™¤æ•°æ®</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">StudentBox.remove(student);  //è¯¥å‚æ•°å¯ä»¥ä¼ è¦åˆ é™¤çš„å®ä½“ï¼Œä¹Ÿå¯ä»¥ä¼ å…¥è¦åˆ é™¤çš„å®ä½“çš„id,å¯ä»¥æ‰¹é‡ä¼ å…¥</span><br></pre></td></tr></table></figure></p>
<p><strong>æŸ¥è¯¢</strong><br>é€šè¿‡<code>Box</code>çš„<code>query()</code>æ–¹æ³•å¯ä»¥å¾—åˆ°ä¸€ä¸ª<code>QueryBuilder</code>å¯¹è±¡ï¼Œè¯¥å¯¹è±¡å¯ä»¥å®ç°å„ç§æŸ¥è¯¢æ“ä½œï¼Œé‡Œé¢åŒ…å«<code>contains()</code>,<code>equal()</code>ç­‰å„ç§ä¾¿æ·çš„æŸ¥è¯¢æ–¹æ³•ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//æŸ¥è¯¢ä¸€ä¸ªåå«Jayçš„å­¦ç”Ÿä¿¡æ¯çš„è¡¨</span><br><span class="line">Student jayStudent = StudentBox.query().equal(Student_.name, &quot;Jay&quot;).build().find();</span><br></pre></td></tr></table></figure></p>
<p>é‡Œé¢çš„<code>Property</code>å¯¹è±¡å…¶å®å°±æ˜¯ä¼ å…¥æˆ‘ä»¬è‡ªåŠ¨ç”Ÿæˆçš„<code>Student_</code>å¯¹è±¡çš„å‚æ•°ã€‚</p>
<p><strong>ä¿®æ”¹</strong><br>objectBoxä¿®æ”¹æ•°æ®éå¸¸ç®€å•ï¼Œé¦–å…ˆå¾—åˆ°è¦ä¿®æ”¹çš„å®ä½“ç±»ï¼Œç›´æ¥ä¿®æ”¹æ•°æ®ï¼Œéšåè°ƒç”¨<code>put()</code>æ–¹æ³•å³å¯ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">//æŸ¥è¯¢ä¸€ä¸ªåå«Jayçš„å­¦ç”Ÿä¿¡æ¯çš„è¡¨</span><br><span class="line">Student jayStudent = StudentBox.query().equal(Student_.name, &quot;Jay&quot;).build().find();</span><br><span class="line">jayStudent.name = &quot;www.huangjie.name&quot;;</span><br><span class="line">StudentBox.put(jayStudent);</span><br></pre></td></tr></table></figure></p>
<p>è¿™æ ·å°±æŠŠJayæ”¹æˆäº†æˆ‘çš„åšå®¢åœ°å€,haha~</p>
<h4 id="æ•°æ®åº“çš„å…¶ä»–æ“ä½œ"><a href="#æ•°æ®åº“çš„å…¶ä»–æ“ä½œ" class="headerlink" title="æ•°æ®åº“çš„å…¶ä»–æ“ä½œ"></a>æ•°æ®åº“çš„å…¶ä»–æ“ä½œ</h4><p><strong>æ•°æ®åº“çš„æ•°æ®å‡çº§</strong><br>å½“æˆ‘ä»¬éœ€è¦æ–°å¢å’Œåˆ é™¤å­—æ®µæ—¶ï¼Œç›´æ¥æ“ä½œå®ä½“ç±»å³å¯ï¼Œä¸éœ€è¦åšç‰¹æ®Šçš„æ›´æ”¹ï¼Œå¦‚æœéœ€è¦é‡å‘½åå­—æ®µåæˆ–å®ä½“ç±»åï¼Œå¯ä»¥æŒ‰ç…§å¦‚ä¸‹æ­¥éª¤æ“ä½œï¼š<br>ç¬¬ä¸€æ­¥ï¼šç»™éœ€è¦ä¿®æ”¹çš„ç±»ååŠ ä¸Š@UIDæ³¨è§£<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">@Entity</span><br><span class="line">@Uid</span><br><span class="line">public class MyName &#123; ... &#125;</span><br></pre></td></tr></table></figure></p>
<p>ç¬¬äºŒæ­¥ï¼šç¼–è¯‘é¡¹ç›®ï¼Œç¼–è¯‘å°†å¤±è´¥ï¼Œå¹¶ä¸”ä¼šç»™ä½ ä¸€ä¸ªUID<br><code>error: [ObjectBox] UID operations for entity &quot;MyName&quot;: 
  [Rename] apply the current UID using @Uid(6645479796472661392L) -
  [Change/reset] apply a new UID using @Uid(4385203238808477712L)</code><br>ç¬¬ä¸‰æ­¥ï¼šå°†Renameåé¢çš„UIDæ”¾å…¥åˆ°è¦ä¿®æ”¹çš„ç±»ä¸­ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">@Entity</span><br><span class="line">@Uid(6645479796472661392L)</span><br><span class="line">public class MyName &#123; ... &#125;</span><br></pre></td></tr></table></figure></p>
<p>ç¬¬å››æ­¥ï¼šè¿›è¡Œæ•°æ®çš„ä¿®æ”¹<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">@Entity</span><br><span class="line">@Uid(6645479796472661392L)</span><br><span class="line">public class MyNewName &#123; ... &#125;</span><br></pre></td></tr></table></figure></p>
<p>æ›´æ”¹æ•°æ®å±æ€§æˆ–é‡å‘½åå­—æ®µååŒç†æ“ä½œã€‚</p>
<h4 id="è¡¨å…³ç³»"><a href="#è¡¨å…³ç³»" class="headerlink" title="è¡¨å…³ç³»"></a>è¡¨å…³ç³»</h4><p>@ToOneå’Œ@ToManyå¯ä»¥çœ‹ä½œJAVAä¸­çš„Tå’ŒList<t>çš„å…³ç³»,æ‹¿ç­çº§å’Œå­¦ç”Ÿä¸¾ä¾‹ï¼Œè®¾ç½®ç›¸å…³çš„å­¦ç”Ÿå¯¹è±¡å¦‚ä¸‹ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Class class = new Class(); //å…ˆåˆ›å»ºä¸€ä¸ªç­çº§</span><br><span class="line">Student student = new Student();</span><br><span class="line">student.name = &quot;Jay&quot;;</span><br><span class="line">student.classToOne.setTarget(class);  //è®¾ç½®ä¸€å¯¹ä¸€çš„targetå¯¹è±¡ï¼Œå­—æ®µå‚è§ä»¥ä¸Šç¤ºä¾‹</span><br><span class="line">long studentId = StudentBox.put(student);</span><br></pre></td></tr></table></figure></t></p>
<p>è·å–è¯¥å­¦ç”Ÿçš„ç­çº§ä¿¡æ¯ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Student student = StudentBox.get(studentId);</span><br><span class="line">Class class = student.classToOne.getTarget();</span><br></pre></td></tr></table></figure></p>
<p>è€Œä¸€å¯¹å¤šçš„å…³ç³»æ›´ä¸ºç®€å•ï¼Œä½ å¯ä»¥åƒListé›†åˆä¸€æ ·å»æ“ä½œå®ƒï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Class class_ = new Class(); //å…ˆåˆ›å»ºä¸€ä¸ªç­çº§</span><br><span class="line">Student s1 = new Student(); //æ·»åŠ ä¸€ä¸ªå­¦ç”Ÿ</span><br><span class="line">student.name = &quot;Jay&quot;;</span><br><span class="line"></span><br><span class="line">Student s2 = new Student();</span><br><span class="line">s2.name = &quot;Android&quot;;</span><br><span class="line"></span><br><span class="line">class_ .studentEntitys.add(s1);</span><br><span class="line">class_ .studentEntitys.add(s2);</span><br><span class="line">Box classBox = BaseApp.getInstence().getBoxStore().boxFor(Class.class);</span><br><span class="line">classBox.put(class);</span><br></pre></td></tr></table></figure></p>
<p>è¿™æ ·çš„è¯ä¸€å¼ Classè¡¨ä¸­å°±æœ‰ä¸¤ä¸ªå­¦ç”Ÿè¡¨çš„æ•°æ®äº†ï¼ŒæŸ¥è¯¢çš„è¯å¯ä»¥è·å–è¯¥Classçš„å®ä½“ï¼Œéšååƒéå†Listé›†åˆä¸€æ ·å»éå†<code>studentEntitys</code>å­—æ®µ,objectBoxæä¾›çš„æ–¹æ³•å’ŒListé›†åˆå‡ ä¹ä¸€æ ·ï¼Œè¿™é‡Œå°±ä¸åšç¤ºä¾‹äº†ã€‚</p>
<p><strong>æ±‚å’Œç­‰æ“ä½œ</strong><br>ä½¿ç”¨<code>Query</code>å¯¹è±¡å³å¯è¿›è¡Œæ±‚å’Œç­‰æ“ä½œ,é€šè¿‡<code>QueryBuilder</code>çš„<code>build()</code>æ–¹æ³•å³å¯å¾—åˆ°ã€‚éšåè°ƒç”¨<code>sumDouble()</code>ç­‰æ–¹æ³•ä¼ å…¥æ±‚å’Œæ¡ä»¶å³å¯ã€‚æˆ‘ä»¬è·å–å®ä½“ç±»æˆ–å®ä½“ç±»é›†åˆä¹Ÿæ˜¯ä½¿ç”¨çš„è¯¥å¯¹è±¡è·å–ã€‚</p>
<p>å¦å¤–ï¼ŒobjectBoxè¿˜æ”¯æŒäº‹åŠ¡ï¼ŒRxjavaæŸ¥è¯¢ï¼ŒKotlinçš„æ”¯æŒï¼Œæ›´å¤šè¯¦æƒ…å¯ä»¥é€šè¿‡å®˜æ–¹æ–‡æ¡£äº†è§£<a href="http://objectbox.io/" target="_blank" rel="noopener">http://objectbox.io</a>.</p>
<h4 id="End"><a href="#End" class="headerlink" title="End"></a>End</h4><p>emmmmmmâ€¦å†™äº†è¿™ä¹ˆå¤šï¼Œä¸ªäººè§‰å¾—objectBoxæŒºå¥½ç”¨çš„ï¼Œç›®å‰æ²¡å‘ç°å•¥å‘ï¼Œå”¯ä¸€çš„å‘æ˜¯ç¼–è¯‘çš„æ—¶å€™æç¤ºæ‰¾ä¸åˆ°<code>MyObjectBox</code>è¿™ä¸ªç±»ï¼Œè¿™ä¸ªä¸ç”¨æ‹…å¿ƒï¼Œå…ˆç¡®è®¤ä¸€ä¸‹é…ç½®æ˜¯å¦æœ‰è¯¯ï¼Œæ— è¯¯çš„è¯å°†é¡¹ç›®<code>Make Project</code>ä¸€ä¸‹æˆ–è€…é‡æ–°ç¼–è¯‘ä¸€ä¸‹å°±OKäº†ï¼Œå¦å¤–ï¼Œæ¨èä¸‹æˆ‘å†™çš„ObjectBoxæ•°æ®åº“çš„ç»ƒæ‰‹é¡¹ç›®<a href="https://github.com/Jay-huangjie/Notes" target="_blank" rel="noopener">ä»¿æ”¯ä»˜å®è®°è´¦æœ¬</a>,ä»¿çš„æ”¯ä»˜å®ä¸­çš„è®°è´¦æœ¬åŠŸèƒ½ï¼Œç»“åˆå®ƒçœ‹ä½ çš„objectBoxä¸Šæ‰‹æ›´å¿«å“¦ã€‚</p>
]]></content>
      
        <categories>
            
            <category> å®‰å“å¼€æºåº“ä½¿ç”¨æ•™ç¨‹ </category>
            
        </categories>
        
        
    </entry>
    
    <entry>
      <title><![CDATA[Androidå¼€å‘å¸¸è§é—®é¢˜ä¸æŠ€å·§æ±‡æ€»]]></title>
      <url>/Android%E5%BC%80%E5%8F%91%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98%E6%B1%87%E6%80%BB.html</url>
      <content type="html"><![CDATA[<p><strong>ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºåšä¸»åŸåˆ›æ–‡ç« ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„(www.huangjie.name)ï¼Œä¿æŠ¤åŸåˆ›ï¼Œä»æˆ‘åšèµ·.</strong></p>
<hr>
<blockquote>
<p>æ­¤ä¸ºå¼€å‘ä¸­é‡åˆ°çš„ä¸€äº›å¸¸è§é—®é¢˜çš„æ•´ç†ï¼Œæ–¹ä¾¿ä¸‹æ¬¡é‡åˆ°é—®é¢˜èƒ½å¿«é€Ÿæ‰¾åˆ°è§£å†³æ–¹æ¡ˆï¼Œæ­¤å¤–è¿˜æ”¶é›†äº†ä¸€äº›å¸¸è§çš„å¼€å‘æŠ€å·§ï¼ŒæŒç»­æ›´æ–°ä¸­~~</p>
</blockquote>
<h4 id="1-ç¼–è¯‘å‡ºç°ï¼š"><a href="#1-ç¼–è¯‘å‡ºç°ï¼š" class="headerlink" title="1 ç¼–è¯‘å‡ºç°ï¼š"></a>1 ç¼–è¯‘å‡ºç°ï¼š</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">All com.android.<span class="function">support libraries must use the exact same version <span class="title">specification</span> <span class="params">(mixing versions can lead to runtime crashes)</span>......</span></span><br></pre></td></tr></table></figure>
<p>å¦‚æœå¼•ç”¨çš„ç¬¬ä¸‰æ–¹åº“çš„æ”¯æŒåº“ç‰ˆæœ¬ä½äºï¼ˆæˆ–è€…ä¸ä¸€è‡´ï¼‰app build.gradleä¸­çš„æ”¯æŒåº“ç‰ˆæœ¬ï¼Œå°±ä¼šå‡ºç°è¿™ç§é—®é¢˜,ä¿®æ”¹ç¬¬ä¸‰æ–¹çš„ä¾èµ–çš„è¯å·¥ä½œé‡å¤ªå¤§,å› æ­¤è€ƒè™‘æ‰€æœ‰æ¨¡å—å¼ºåˆ¶ä½¿ç”¨ç›¸åŒçš„ç‰ˆæœ¬å·çš„æ”¯æŒåº“ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<p>åœ¨app build.gradleä¸­æ·»åŠ ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">configurations.all &#123;</span><br><span class="line">    resolutionStrategy.eachDependency &#123; DependencyResolveDetails details -&gt;</span><br><span class="line">        def requested = details.requested</span><br><span class="line">        <span class="keyword">if</span> (requested.group == <span class="string">'com.android.support'</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!requested.name.startsWith(<span class="string">"multidex"</span>)) &#123;</span><br><span class="line">                details.useVersion <span class="string">'26.1.0'</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ­¤ä»£ç å£°æ˜äº†é™¤multdexå¤–å…¨éƒ¨ä½¿ç”¨26.1.0çš„ç‰ˆæœ¬åº“</p>
<h4 id="2-SVGå›¾ç‰‡å…¼å®¹é—®é¢˜-ä¸»è¦é’ˆå¯¹5-0ä»¥ä¸‹æœºå‹"><a href="#2-SVGå›¾ç‰‡å…¼å®¹é—®é¢˜-ä¸»è¦é’ˆå¯¹5-0ä»¥ä¸‹æœºå‹" class="headerlink" title="2 SVGå›¾ç‰‡å…¼å®¹é—®é¢˜(ä¸»è¦é’ˆå¯¹5.0ä»¥ä¸‹æœºå‹)"></a>2 SVGå›¾ç‰‡å…¼å®¹é—®é¢˜(ä¸»è¦é’ˆå¯¹5.0ä»¥ä¸‹æœºå‹)</h4><p>å‚è€ƒåšå®¢ï¼š<a href="https://www.jianshu.com/p/e3614e7abc03" target="_blank" rel="noopener">Android Vectoræ›²æŠ˜çš„å…¼å®¹ä¹‹è·¯</a></p>
<p>åŸºæœ¬é€‚é…æ–¹æ³•ï¼š<br>åœ¨app build.gradle çš„<code>defaultConfig</code>ä¸­æ·»åŠ <code>defaultvectorDrawables.useSupportLibrary = true</code></p>
<p>xmlä¸­ä½¿ç”¨ï¼š<br>ImageViewåŸæœ¬æ˜¯ä½¿ç”¨<code>src</code>åŠ è½½,æ”¹ä¸º<code>app:srcCompat</code>.</p>
<p>javaä¸­ä½¿ç”¨ï¼š<br><code>ImageView iv = (ImageView) findViewById(R.id.iv);
iv.setImageResource(R.drawable.vector_image);</code></p>
<h4 id="3-è‡ªå®šä¹‰Viewä¸­åœ¨4-Xç‰ˆæœ¬ä¸Šé€šè¿‡getContext-æ–¹æ³•å¼ºè½¬æˆActivityå¤±æ•ˆ"><a href="#3-è‡ªå®šä¹‰Viewä¸­åœ¨4-Xç‰ˆæœ¬ä¸Šé€šè¿‡getContext-æ–¹æ³•å¼ºè½¬æˆActivityå¤±æ•ˆ" class="headerlink" title="3.è‡ªå®šä¹‰Viewä¸­åœ¨4.Xç‰ˆæœ¬ä¸Šé€šè¿‡getContext()æ–¹æ³•å¼ºè½¬æˆActivityå¤±æ•ˆ"></a>3.è‡ªå®šä¹‰Viewä¸­åœ¨4.Xç‰ˆæœ¬ä¸Šé€šè¿‡getContext()æ–¹æ³•å¼ºè½¬æˆActivityå¤±æ•ˆ</h4><p>å‚è€ƒåšå®¢ï¼š <a href="http://blog.csdn.net/wingichoy/article/details/72868959" target="_blank" rel="noopener">è®°ä¸€æ¬¡View.getContext()é‡åˆ°çš„å¤§å‘</a></p>
<p>åŸå› ï¼šå…¼å®¹v7åŒ…å°†<code>Context</code>åŒ…è£¹æˆäº†<code>TintContextWrapper</code>,æ‰€ä»¥å¼ºè½¬æˆ<code>Activity</code>ä¼šå‡ºé”™</p>
<p>è§£å†³æ–¹æ³•ï¼šä½¿ç”¨æ„é€ æ–¹æ³•ä¸­çš„Contextæ¥å¼ºè½¬ã€‚</p>
<h4 id="4-å¼•å…¥çš„ç¬¬ä¸‰æ–¹åº“ä¸è‡ªå·±çš„supportåŒ…å†²çª"><a href="#4-å¼•å…¥çš„ç¬¬ä¸‰æ–¹åº“ä¸è‡ªå·±çš„supportåŒ…å†²çª" class="headerlink" title="4.å¼•å…¥çš„ç¬¬ä¸‰æ–¹åº“ä¸è‡ªå·±çš„supportåŒ…å†²çª"></a>4.å¼•å…¥çš„ç¬¬ä¸‰æ–¹åº“ä¸è‡ªå·±çš„supportåŒ…å†²çª</h4><p>è§£å†³æ–¹æ³•ï¼š<br>å°†å†²çªçš„åº“æ”¹æˆä»¥ä¸‹å†™æ³•ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">implementation (<span class="string">'æ­¤å¤„æ˜¯ä½ å¼•å…¥çš„åº“'</span>)&#123;</span><br><span class="line">        exclude group: <span class="string">'com.android.support'</span> <span class="comment">//ä»€ä¹ˆåŒ…å†²çªäº†è¿™é‡Œå°±å£°æ˜ä»€ä¹ˆ,æ³¨æ„åç§°è¦å†™å¯¹å†™å…¨</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<p>å¦å¤–ï¼Œåœ¨è¿™é‡Œæ™®åŠä¸€ä¸‹<code>implementation</code>çš„æ¦‚å¿µ,ç°åœ¨å‡çº§äº†ASåå¼•å…¥ä¸‰æ–¹åº“æœ‰å¤šç§æ–¹å¼ï¼Œå¦‚<code>implementation</code>,<code>compile</code>,<code>api</code> ..å…¶ä¸­ï¼Œ<br><code>implementation</code>ä¸»è¦æ˜¯å¼•ç”¨æœ¬æ¨¡å—çš„åº“ï¼Œå…¶ä»–æ¨¡å—æ˜¯è°ƒç”¨ä¸åˆ°è¯¥æ¨¡å—å¼•ç”¨çš„åº“çš„,ç±»ä¼¼javaä¸­çš„privateå±æ€§,è€Œ<code>compile</code>ç±»ä¼¼javaä¸­çš„publicå±æ€§,åªè¦æ¨¡å—ä¹‹é—´ç›¸äº’ä¾èµ–,å¼•ç”¨çš„åº“éƒ½èƒ½ç›¸äº’è°ƒç”¨,è€Œ<code>api</code>çš„ä½œç”¨ä¸<code>compile</code>ä¸€æ ·,ä½¿ç”¨è¿™äº›ä¸åŒçš„è°ƒç”¨æ–¹å¼æ˜¯ä¸ºäº†åŠ å¿«ç¼–è¯‘é€Ÿåº¦ï¼Œå¦‚æœä½ çš„åº“ä¸éœ€è¦åœ¨å…¶ä»–æ¨¡å—ä¹‹ä¸­ä½¿ç”¨,è¯·ä½¿ç”¨<code>implementation</code>æ–¹å¼ï¼Œè¿™æ ·å½“å¤–éƒ¨è°ƒç”¨æ”¹å˜ä¸ä¼šç¼–è¯‘æ•´ä¸ªmodelè€Œåªä¼šç¼–è¯‘æ”¹å˜çš„é‚£ä¸ªmodel.</p>
<h4 id="5-åœ¨javaä»£ç ä¸­è·å–xmlä¸­è®¾ç½®çš„behavior"><a href="#5-åœ¨javaä»£ç ä¸­è·å–xmlä¸­è®¾ç½®çš„behavior" class="headerlink" title="5.åœ¨javaä»£ç ä¸­è·å–xmlä¸­è®¾ç½®çš„behavior"></a>5.åœ¨javaä»£ç ä¸­è·å–xmlä¸­è®¾ç½®çš„behavior</h4><p>åœ¨å¼€å‘é¡¹ç›®çš„æ—¶å€™éœ€è¦è·å–behaviorçš„å®ä¾‹åšä¸€äº›äº‹æƒ…ï¼Œå‘ç°<code>CoordinatorLayout</code>æ²¡æœ‰æä¾›è·å–<code>behavior</code>çš„æ–¹æ³•ï¼Œåæ¥æŸ¥çœ‹æºç å‘ç°æ˜¯ä½¿ç”¨<code>CoordinatorLayout.LayoutParams</code>æ¥è®¾ç½®<code>behavior</code>çš„ï¼Œæ‰€ä»¥<code>behavior</code>è‡ªç„¶æ˜¯ä»è¿™é‡Œæ¥è·å–,ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å­ç±»è·å–ä¸Šçº§çš„CoordinatorLayout.LayoutParams</span></span><br><span class="line">CoordinatorLayout.LayoutParams cl = (CoordinatorLayout.LayoutParams) mRecyclerView.getLayoutParams();</span><br><span class="line"> MyBehavior behavior = (MyBehavior) cl.getBehavior(); <span class="comment">//è°ƒç”¨getBehavioræ–¹æ³•</span></span><br></pre></td></tr></table></figure>
<h4 id="6-è®¾ç½®çŠ¶æ€æ é€æ˜å¹¶ä½¿çˆ¶å¸ƒå±€ç§»åŠ¨åˆ°çŠ¶æ€æ ä¸Šå»-é€‚ç”¨äº5-0ä»¥ä¸Š"><a href="#6-è®¾ç½®çŠ¶æ€æ é€æ˜å¹¶ä½¿çˆ¶å¸ƒå±€ç§»åŠ¨åˆ°çŠ¶æ€æ ä¸Šå»-é€‚ç”¨äº5-0ä»¥ä¸Š" class="headerlink" title="6.è®¾ç½®çŠ¶æ€æ é€æ˜å¹¶ä½¿çˆ¶å¸ƒå±€ç§»åŠ¨åˆ°çŠ¶æ€æ ä¸Šå»(é€‚ç”¨äº5.0ä»¥ä¸Š)"></a>6.è®¾ç½®çŠ¶æ€æ é€æ˜å¹¶ä½¿çˆ¶å¸ƒå±€ç§»åŠ¨åˆ°çŠ¶æ€æ ä¸Šå»(é€‚ç”¨äº5.0ä»¥ä¸Š)</h4><p>é¡¹ç›®ä¸­éœ€è¦ç”¨åˆ°çŠ¶æ€æ é¢œè‰²éšç€æ ‡é¢˜æ é¢œè‰²æ”¹å˜,ç”šè‡³è¿˜æœ‰æ¸å˜æ•ˆæœ,å¦‚æœå•çº¯è®¾ç½®çŠ¶æ€æ é¢œè‰²éå¸¸ä¸æ–¹ä¾¿ï¼Œå¹¶ä¸”å®ç°é¢œè‰²æ¸å˜ä¹Ÿä¸ç®€å•ï¼Œæ‰€æœ‰å°†é‡‡ç”¨å°†çˆ¶å¸ƒå±€ä¸Šç§»çš„æ–¹æ³•,è¿™æ ·çŠ¶æ€æ çš„é¢œè‰²å°±æ˜¯æ ‡é¢˜æ çš„é¢œè‰²å•¦,å®ç°æ–¹æ³•å¦‚ä¸‹ï¼š</p>
<p>step1:å®šä¹‰ä¸»é¢˜æ–‡ä»¶<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;style name=<span class="string">"TransTheme"</span> parent=<span class="string">"Theme.AppCompat.Light.NoActionBar"</span>&gt;</span><br><span class="line">        &lt;item name="android:windowTranslucentStatus"&gt;true&lt;/item&gt;</span><br><span class="line">        &lt;item name="android:statusBarColor"&gt;@android:color/transparent&lt;/item&gt; //è®¾ç½®çŠ¶æ€æ é€æ˜</span><br><span class="line">    &lt;/style&gt;</span><br></pre></td></tr></table></figure></p>
<p>step2:åœ¨æ¸…å•æ–‡ä»¶çš„Activityä¸­ä½¿ç”¨å®ƒ<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;activity</span><br><span class="line">     android:name=<span class="string">".module.ScheduleActivity"</span></span><br><span class="line">     android:theme=<span class="string">"@style/TransTheme"</span> /&gt;</span><br></pre></td></tr></table></figure></p>
<p>step3:è®©ä½ çš„çˆ¶å¸ƒå±€çš„æ§ä»¶å‘ä¸‹åç§»ä¸€ä¸ªçŠ¶æ€æ çš„é«˜åº¦:<br>è·å–çŠ¶æ€æ çš„é«˜åº¦:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * è·å–çŠ¶æ€æ é«˜åº¦</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> context context</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span> çŠ¶æ€æ é«˜åº¦</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">getStatusBarHeight</span><span class="params">(Context context)</span> </span>&#123;</span><br><span class="line">       <span class="comment">// è·å¾—çŠ¶æ€æ é«˜åº¦</span></span><br><span class="line">       <span class="keyword">int</span> resourceId = context.getResources().getIdentifier(<span class="string">"status_bar_height"</span>, <span class="string">"dimen"</span>, <span class="string">"android"</span>);</span><br><span class="line">       <span class="keyword">return</span> context.getResources().getDimensionPixelSize(resourceId);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure></p>
<p>ç„¶åéœ€è¦åç§»çš„æ§ä»¶å°±éœ€è¦æ ¹æ®é¡¹ç›®å®é™…æƒ…å†µäº†ï¼Œä¸€èˆ¬æ˜¯è‡ªå®šä¹‰ä¸€ä¸ªæ ‡é¢˜å¸ƒå±€,ç„¶ååœ¨æ‰€æœ‰çš„Activityä¸­ä½¿ç”¨è¿™ä¸ªæ ‡é¢˜å¸ƒå±€,æˆ‘çš„æ ‡é¢˜å¸ƒå±€çš„çˆ¶å¸ƒå±€æ˜¯ä¸€ä¸ªFragmeLayoutï¼Œå› æ­¤åšå¦‚ä¸‹è®¾ç½®ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (Build.VERSION.SDK_INT&gt;Build.VERSION_CODES.KITKAT)&#123;</span><br><span class="line">            FrameLayout.LayoutParams fl = (LayoutParams) mFrameLayout.getLayoutParams();</span><br><span class="line">            fl.topMargin = getStatusBarHeight(getContext());</span><br><span class="line">            mFrameLayout.setLayoutParams(fl);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>ç„¶åç»™<code>mFrameLayout</code>è®¾ç½®èƒŒæ™¯è‰²,è¿™æ ·çŠ¶æ€æ å°±å’Œæ ‡é¢˜æ ä¸€ä¸ªé¢œè‰²å•¦ã€‚</p>
]]></content>
      
        <categories>
            
            <category> AndroidåŸºç¡€è¿›é˜¶ </category>
            
        </categories>
        
        
    </entry>
    
    <entry>
      <title><![CDATA[2017å¹´ç»ˆæ€»ç»“]]></title>
      <url>/2017%E5%B9%B4%E7%BB%88%E6%80%BB%E7%BB%93.html</url>
      <content type="html"><![CDATA[<p><strong>ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºåšä¸»åŸåˆ›æ–‡ç« ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„(www.huangjie.name)ï¼Œä¿æŠ¤åŸåˆ›ï¼Œä»æˆ‘åšèµ·.</strong></p>
<hr>
<h4 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h4><p>ä»è‡ªå·±å¼€å§‹åšæŒå†™åšå®¢ä¹Ÿæœ‰1ä¸ªæœˆäº†ï¼Œæ„Ÿè§‰éå¸¸çš„å……å®ï¼Œåšå®¢å°±æ˜¯æ³¨é‡æ€»ç»“å½’çº³å˜›ï¼Œæ—¢ç„¶2017éƒ½å·²ç»è¿‡å»ï¼Œé‚£ä¹ˆä¹Ÿæœ‰å¿…è¦æ€»ç»“å½’çº³ä¸€ä¸‹å•¦ã€‚å…¶å®æˆ‘è®¤ä¸ºæˆ‘çš„2017æ€»ç»“èµ·æ¥å°±æ˜¯ï¼šè¡ŒåŠ¨èµ·æ¥ï¼Œä¸å†ç­‰å¾…ï¼Œé‡åœ¨å‚ä¸ï¼<br><a id="more"></a></p>
<h4 id="å›é¦–"><a href="#å›é¦–" class="headerlink" title="å›é¦–"></a>å›é¦–</h4><p>ä¸€çœ¨çœ¼2017å°±è¿‡å»äº†ï¼Œæƒ³æƒ³è‡ªå·±ä»Šå¹´ï¼Œçš„ç¡®æ˜¯æˆé•¿æœ€å¿«çš„ä¸€å¹´ï¼Œä¹Ÿæ˜¯å¿™ç¢Œè€Œåˆå¹³æ·¡çš„ä¸€å¹´ï¼Œæ”¶è·äº†è®¸å¤šã€‚</p>
<p>ä¾ç¨€è®°å¾—å¹´åˆï¼Œå°±æœ‰äº†æŠ€æœ¯è¿›é˜¶çš„æƒ³æ³•ï¼Œå› ä¸ºæ„Ÿè§‰è‡ªå·±åœ¨è®¸å¤šåŠŸèƒ½ç‚¹ä¸Šâ€˜ä¼šåšâ€™ï¼Œä½†â€˜ä¸æ‡‚â€™ï¼Œæ— æ³•æ·±å…¥çš„è§£å†³é—®é¢˜ã€‚äºæ˜¯ï¼Œæˆ‘å°±å¯»æ±‚è¿›é˜¶çš„æ–¹æ³•ï¼Œæˆ‘åœ¨å¸…å¼ çš„å…¬ä¼—å·ä¸Šè¯»äº†ä»–å†™çš„ä¸€éæ–‡ç« ï¼Œæ–‡ç« æŒ‡å‡ºï¼Œä¹ æƒ¯å¾ˆé‡è¦ï¼Œæˆ‘ç»“åˆè‡ªèº«çš„è¡Œä¸ºæ£æ‘©è¿™å¥è¯ï¼Œæ€»ç»“å‘ç°ï¼Œå­¦ä¹ å¹¶ä¸éœ€è¦å¼ºè¿«è‡ªå·±å»å­¦ï¼Œè€Œåº”è¯¥æŠŠå®ƒå½“æˆä¸€ç§è‡ªç„¶ä¹ æƒ¯ï¼Œå°±åƒæ¸´äº†ä¼šå–æ°´ä¸€æ ·çš„ç”Ÿæ´»ä¹ æƒ¯ï¼Œè¿™ç§ä¹ æƒ¯çš„åŸ¹å…»éœ€è¦çš„æ˜¯åšæŒï¼Œä»¥åŠè‡ªå¾‹ï¼ä¸ºæ­¤æˆ‘å°è¯•æ…¢æ…¢å»åŸ¹å…»è‡ªå·±çš„å­¦ä¹ ä¹ æƒ¯ï¼š</p>
<p>å› ä¸ºå…¬å¸æ¬å®¶ï¼Œæˆ‘ä»å®¶åˆ°å…¬å¸éœ€è¦30-40åˆ†é’Ÿï¼Œåœ¨åœ°é“ä¸Šï¼Œä»¥å‰æ˜¯éƒ½æ˜¯çœ‹ä¸€ä¸‹æ–°é—»å•Šï¼Œåˆ·ä¸€ä¸‹å¾®åšå•Šï¼Œç°åœ¨æˆ‘éƒ½æ˜¯çœ‹æ˜é‡‘æœ‰æ²¡æœ‰ä»€ä¹ˆæ–°é²œçš„æ¡†æ¶ï¼Œçœ‹çœ‹ç®€ä¹¦æœ‰æ²¡æœ‰å¥½çœ‹çš„æŠ€æœ¯æ–‡ç« ï¼Œçœ‹çœ‹githubæœ‰æ²¡æœ‰ç«çƒ­çš„æŠ€æœ¯æ’åï¼Œé‚£äº›å¾®åšä»€ä¹ˆçš„æˆ‘å†ä¹Ÿæ²¡æ‰“å¼€è¿‡ï¼Œæˆ‘å·²ç»åšæŒæœ‰å¤§åŠå¹´çš„ï¼Œç”šè‡³ç°åœ¨ä½†å‡¡åº§åœ°é“æˆ‘ä¹Ÿä¼šä¹ æƒ¯æ€§æ‰“å¼€è¿™äº›app</p>
<p>ä»¥å‰çš„æˆ‘å·¥ä½œå›åˆ°å®¶éƒ½æ˜¯åˆ·ç”µè§†å‰§ï¼Œç°åœ¨éƒ½æ˜¯æœ‰ç›®çš„æ€§çš„å»å­¦ä¹ ä¸€ä¸ªçŸ¥è¯†ç‚¹æˆ–è€…ä¸€é—¨è¯­è¨€ï¼Œè¿™æ ·æ—¶é—´è¿‡å¾—éå¸¸çš„å¿«ï¼Œæ¯å¤©æ„Ÿè§‰æ—¶é—´ä¸å¤Ÿç”¨ï¼Œæœç„¶å½“æŠ•å…¥åˆ°æŸä¸€ä»¶äº‹æ—¶æ—¶é—´çš„æµé€æ˜¯éå¸¸å¿«é€Ÿçš„ã€‚</p>
<p>å…ˆå‰éƒ½æ˜¯è‡ªå·±å†™demo,è‡ªå·±æ€»ç»“çŸ¥è¯†ç‚¹ï¼Œç„¶åå†™åˆ°å°è±¡ç¬”è®°ä¸­ï¼Œä½†æ˜¯æˆ‘å‘ç°é‡Œé¢çš„çŸ¥è¯†ç‚¹å¤ªæ•£ä¹±ï¼Œæ— æ³•æˆä¸ºä¸€ä¸ªä½“ç³»ã€‚äºæ˜¯æˆ‘å°±è¯•ç€å†™åšå®¢ï¼Œä¸ºæ­¤ï¼Œæˆ‘å‘ç°äº†ä¸€ä¸ªæ–°å¤§é™†ï¼Œå†™åšå®¢å¯¹äºçŸ¥è¯†çš„æ¢³ç†ç®€ç›´å¤ªæœ‰ç”¨äº†ï¼Œå‰ææ˜¯ä½ æƒ³å†™å¥½ä¸€ç¯‡åšå®¢ã€‚</p>
<p>å­¦ä¹ çŸ¥è¯†å°±è¦å–„äºæ€»ç»“å½’çº³ï¼Œä¹¦æœ¬æ˜¯æœ€å¥½çš„è€å¸ˆï¼Œä¸ºæ­¤2017æˆ‘é˜…è¯»äº†ä¸€äº›çš„ä¹¦ç±ï¼š</p>
<p>éƒ­ç¥çš„ã€Šç¬¬ä¸€è¡Œä»£ç ã€‹ç¬¬äºŒç‰ˆï¼Œè¿™æ˜¯ä¸€æœ¬åŸºç¡€ä¹¦ç±ï¼Œå®ƒè®©æˆ‘å¯¹å®‰å“çš„åŸºç¡€æœ‰äº†æ›´åŠ å®Œå–„çš„äº†è§£å’Œå¤¯å®ã€‚</p>
<p>ä»»ç‰åˆšçš„ã€Šå®‰å“å¼€å‘è‰ºæœ¯æ¢ç´¢ã€‹ï¼Œè¿™æ˜¯ä¸€æœ¬è¿›é˜¶ç±»çš„ä¹¦ç±ï¼Œå®ƒè®©æˆ‘çªç ´äº†ç“¶é¢ˆï¼Œå¯¹å®‰å“çš„äº†è§£æ›´åŠ çš„æ·±å…¥äº†ã€‚</p>
<p>æˆ‘å¯¹è¿™ä¸¤ä½éƒ½éå¸¸çš„é’¦ä½©ï¼Œæ­£æ˜¯ä»–ä»¬è®©æˆ‘ä»¬è¿™äº›å¼€å‘è€…çš„è¿›é˜¶è‡³å°‘èƒ½æå‰0.5-1å¹´çš„æ—¶é—´ï¼Œã€Šå¼€å‘è‰ºæœ¯æ¢ç´¢ã€‹æˆ‘æ¥å›è¯»äº†å¥½å‡ éï¼Œæ¯ä¸€æ¬¡éƒ½ä¼šæœ‰æ–°çš„æ”¶è·ï¼Œå†æ¬¡æ„Ÿè°¢~</p>
<p>æ™šä¸Šï¼Œæˆ‘ä¹Ÿä¼šå¶å°”çœ‹ä¸‹æ…•è¯¾ç½‘ä¸Šçš„è§†é¢‘ï¼Œæˆ‘è§‰å¾—é‡Œé¢çš„è€å¸ˆè®²çš„è¿˜æ˜¯æ¯”è¾ƒå¥½çš„ï¼Œä¸ºæ­¤æˆ‘ä¹Ÿæ¨èç»™å¤§å®¶ã€‚</p>
<p>å›é¦–2017çš„æŠ€æœ¯æœ‰å¦‚ä¸‹çš„æ€»ç»“ï¼š</p>
<ul>
<li><p>å­¦ä¹ äº†è‡ªå®šä¹‰View,å¯¹è‡ªå®šä¹‰çš„æµç¨‹æœ‰äº†è¾ƒä¸ºå®Œå–„çš„äº†è§£</p>
</li>
<li><p>å­¦ä¹ äº†Viewä½“ç³»ï¼Œviewçš„ç¡®æ˜¯ä¸€ä¸ªéå¸¸æœ‰é­…åŠ›çš„æ§ä»¶ï¼Œå®ƒå¯ä»¥å¸¦æ¥æ— ç©·çš„åˆ›é€ åŠ›</p>
</li>
<li><p>å¯¹æ•°æ®åº“æ¡†æ¶éƒ½æœ‰æ‰€äº†è§£ï¼šå¦‚å…¬å¸é¡¹ç›®æ­£åœ¨ä½¿ç”¨çš„<a href="https://github.com/pardom/ActiveAndroid" target="_blank" rel="noopener">ActiveAndroid</a>(ä½œè€…è²Œä¼¼ä¸ç»´æŠ¤äº†ï¼Ÿ),ä½¿ç”¨<a href="https://github.com/greenrobot/greenDAO" target="_blank" rel="noopener">greenDAO</a>åšè¿‡ä¸€äº›ç®€å•çš„demo,åæ¥å‘ç°äº†greenDaoçš„ä½œè€…æ­£åœ¨å¼€å‘ä¸€ä¸ªå…¨æ–°çš„æ•°æ®åº“ï¼Œå·ç§°æœ€å¿«çš„æ•°æ®åº“ï¼Œäºæ˜¯å°±æ²¡æœ‰ç»§ç»­æ·±å…¥greenDaoçš„ç ”ç©¶ï¼Œè½¬è€Œç ”ç©¶æ–°çš„æ•°æ®åº“ï¼Œå®ƒå°±æ˜¯æˆ‘ç°åœ¨æ­£åœ¨ç ”ç©¶çš„<a href="https://github.com/objectbox/objectbox-java" target="_blank" rel="noopener">object-box</a>,ä¸è¿‡ç°åœ¨èµ„æ–™è¿˜è¾ƒå°‘ï¼Œå±Šæ—¶æˆ‘ä¼šå‡ºä¸€ä¸ªæ•™ç¨‹ã€‚</p>
</li>
<li><p>å­¦ä¹ äº†ExoPlayerè§†é¢‘æ’­æ”¾æ¡†æ¶ï¼ŒRxjava,okhttp,mvpç­‰ç­‰çš„ä¸€äº›çƒ­é—¨æ¡†æ¶å’Œæ¶æ„</p>
</li>
<li><p>å­¦ä¹ äº†ä¸€äº›kotlinçš„åŸºæœ¬è¯­æ³•</p>
</li>
<li><p>å­¦ä¹ äº†html5çš„ä¸€äº›åŸºæœ¬è¯­æ³•ï¼Œèƒ½åˆ¶ä½œä¸€äº›é™æ€é¡µé¢</p>
</li>
<li><p>åŸºäºhexoå’Œcodingæ­å»ºçš„åšå®¢å¹³å°.å…ˆå‰æœ¬æ¥æ˜¯ä¸Šä¼ åˆ°githubçš„ï¼Œç”±äºç™¾åº¦è¢«å¢™çš„å…³ç³»ï¼Œå°±ç§»åˆ°codingäº†ã€‚</p>
</li>
</ul>
<h4 id="å±•æœ›"><a href="#å±•æœ›" class="headerlink" title="å±•æœ›"></a>å±•æœ›</h4><p>å¯¹äº2018ï¼Œæˆ‘åšä¿¡æˆ‘çš„åšæŒä¼šå¸¦ç»™æˆ‘æ›´å¤šçš„æ”¶è·ã€‚æˆ‘ä¾æ—§ä¼šåŠªåŠ›åšæŒ2017æ­£åœ¨åšçš„äº‹æƒ…ï¼š</p>
<ul>
<li>åšæŒå†™åšå®¢ï¼Œè‡³å°‘1å‘¨ä¸€ç¯‡</li>
<li>åšæŒæŠ€æœ¯å­¦ä¹ </li>
</ul>
<p>2018è¦åˆ·çš„ä¹¦æœ‰ã€Škotlinå®æˆ˜ã€‹ï¼Œã€ŠAndroidç¥å…µåˆ©å™¨ã€‹ï¼Œã€Šå®‰å“ç¾¤è‹±ä¼ ã€‹ã€‚</p>
<p>2018éœ€è¦è¿›é˜¶çš„æŠ€æœ¯æœ‰ï¼š</p>
<ul>
<li>kotlinçš„ç†Ÿç»ƒä½¿ç”¨</li>
<li>è‡ªå®šä¹‰Viewçš„æ€»ç»“ï¼ŒåŠ¨ç”»ç³»åˆ—</li>
<li>ç›´æ’­ï¼Œè§†é¢‘æ’­æ”¾æŠ€æœ¯è¦ç‚¹æ€»ç»“</li>
<li>è®¾è®¡æ¨¡å¼</li>
<li>å†…å­˜ä¼˜åŒ–</li>
<li>gradleç²¾é€š</li>
<li>ç®€å•äº†è§£ä¸‹é€†å‘ï¼Œåç¼–è¯‘ç­‰æŠ€æœ¯</li>
</ul>
<p>2018ï¼Œè®©æˆ‘ä»¬ä¸€èµ·åŠ æ²¹<del>~</del></p>
]]></content>
      
        <categories>
            
            <category> æ„Ÿæ‚Ÿ </category>
            
        </categories>
        
        
    </entry>
    
    <entry>
      <title><![CDATA[ExoPlayerè§†é¢‘æ¡†æ¶ï¼šè‡ªå®šä¹‰UIç•Œé¢åŠæºç è§£æ]]></title>
      <url>/ExoPlayer%E8%A7%86%E9%A2%91%E6%A1%86%E6%9E%B6%EF%BC%9A%E8%87%AA%E5%AE%9A%E4%B9%89UI%E7%95%8C%E9%9D%A2%E5%8F%8A%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90.html</url>
      <content type="html"><![CDATA[<p><strong>ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºåšä¸»åŸåˆ›æ–‡ç« ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„(www.huangjie.name)ï¼Œä¿æŠ¤åŸåˆ›ï¼Œä»æˆ‘åšèµ·.</strong></p>
<hr>
<blockquote>
<p>æœ¬æ–‡ä¸»è¦è®²è¿°ä½¿ç”¨ExoPlayeræ¡†æ¶æ—¶å¦‚ä½•è‡ªå®šä¹‰è‡ªå·±çš„è§†é¢‘æ’­æ”¾ç•Œé¢ï¼Œæ¥è¾¾åˆ°æ»¡æ„çš„æ•ˆæœï¼Œä»¥åŠSimpleExoPlayerViewçš„æºç è§£æ</p>
</blockquote>
<h4 id="SimpleExoPlayerView"><a href="#SimpleExoPlayerView" class="headerlink" title="SimpleExoPlayerView"></a>SimpleExoPlayerView</h4><a id="more"></a>
<h5 id="ç±»ä»‹ç»"><a href="#ç±»ä»‹ç»" class="headerlink" title="ç±»ä»‹ç»"></a>ç±»ä»‹ç»</h5><p>SimpleExoPlayerViewæ˜¯ä¸€ä¸ªè‡ªå®šä¹‰FrameLayout,å†…éƒ¨å°è£…äº†è§†é¢‘ï¼Œå­—å¹•ï¼Œæ’­æ”¾å°é¢ï¼Œæ’­æ”¾æ§åˆ¶å™¨çš„Viewé€»è¾‘</p>
<h5 id="ç®€å•ä½¿ç”¨"><a href="#ç®€å•ä½¿ç”¨" class="headerlink" title="ç®€å•ä½¿ç”¨"></a>ç®€å•ä½¿ç”¨</h5><p><strong>åœ¨xmlä¸­å£°æ˜è¯¥æ§ä»¶ï¼š</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;com.google.android.exoplayer2.ui.SimpleExoPlayerView</span><br><span class="line">        android:layout_width=<span class="string">"match_parent"</span></span><br><span class="line">        android:layout_height=<span class="string">"wrap_content"</span></span><br><span class="line">        android:id=<span class="string">"@+id/simpleExoPlayerView"</span></span><br><span class="line">        app:resize_mode=<span class="string">"fixed_width"</span></span><br><span class="line">        /&gt;</span><br></pre></td></tr></table></figure></p>
<p>SimpleExoPlayerViewå†…éƒ¨çš„AspectRatioFrameLayoutå°è£…äº†è§†é¢‘å®½é«˜æ¯”çš„è®¡ç®—ï¼Œå®ƒæ ¹æ®è§†é¢‘æµçš„å®½é«˜æ¯”æ¥åŠ¨æ€è®¾ç½®æ§ä»¶çš„å®½é«˜æ¥è¾¾åˆ°é€‚åº”å±å¹•çš„ç›®çš„ï¼Œ<code>resize_mode</code>å¯ä»¥æŒ‡å®šè¿™ç§è§†é¢‘çš„å®½é«˜æ¯”è®¡ç®—æ¨¡å¼ï¼Œå…±æœ‰å››ç§æ¨¡å¼ï¼Œ<code>fixed_width</code>ä»£è¡¨æ ¹æ®å®½åº¦æ¥åŠ¨æ€è®¡ç®—é«˜åº¦ï¼Œå®½åº¦ä¸ä¼šå˜åŒ–ï¼Œ<code>fixed_height</code>ä¸ä¹‹ç›¸åï¼Œ<code>fill</code>æ¨¡å¼ä¼šå¿½ç•¥å®½é«˜æ¯”ï¼Œä¸è¿›è¡ŒåŠ¨æ€è®¡ç®—ï¼Œ<code>fit</code>ä¸ºé»˜è®¤æ¨¡å¼ï¼Œå¦‚æœé«˜åº¦å˜å½¢å°±åŠ¨æ€è®¡ç®—é«˜åº¦æ¥é€‚é…ï¼Œå®½åº¦å˜å½¢å°±åŠ¨æ€è®¡ç®—å®½åº¦æ¥é€‚é…ã€‚<br><strong>activityä¸­ï¼š</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">simpleExoPlayerView.setPlayer(player);</span><br></pre></td></tr></table></figure></p>
<p>é€šè¿‡<code>setPlayer</code>æ–¹æ³•æ¥ä¸<code>ExoPlayer</code>ç»‘å®š</p>
<h4 id="æºç åˆ†æ"><a href="#æºç åˆ†æ" class="headerlink" title="æºç åˆ†æ"></a>æºç åˆ†æ</h4><p>è¦éšå¿ƒæ‰€æ¬²çš„ä½¿ç”¨è¯¥Viewï¼Œæ¥å®šåˆ¶è‡ªå·±ç†æƒ³çš„UIï¼Œå°±å¾—å…ˆäº†è§£å…¶ä¸­çš„åŸç†ï¼Œæ–¹èƒ½å…¨é¢æŒæ§ï¼Œä¸‹é¢æˆ‘ä»¬å°±æ¥æ’¸ä¸€éæºç <br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@TargetApi</span>(<span class="number">16</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">SimpleExoPlayerView</span> <span class="keyword">extends</span> <span class="title">FrameLayout</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> SURFACE_TYPE_NONE = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> SURFACE_TYPE_SURFACE_VIEW = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> SURFACE_TYPE_TEXTURE_VIEW = <span class="number">2</span>;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> AspectRatioFrameLayout contentFrame;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> View shutterView;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> View surfaceView;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> ImageView artworkView;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> SubtitleView subtitleView;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> PlaybackControlView controller;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> ComponentListener componentListener;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> FrameLayout overlayFrameLayout;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> SimpleExoPlayer player;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">boolean</span> useController;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">boolean</span> useArtwork;</span><br><span class="line">  <span class="keyword">private</span> Bitmap defaultArtwork;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">int</span> controllerShowTimeoutMs;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">boolean</span> controllerAutoShow;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">boolean</span> controllerHideOnTouch;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">SimpleExoPlayerView</span><span class="params">(Context context)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>(context, <span class="keyword">null</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">SimpleExoPlayerView</span><span class="params">(Context context, AttributeSet attrs)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>(context, attrs, <span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">SimpleExoPlayerView</span><span class="params">(Context context, AttributeSet attrs, <span class="keyword">int</span> defStyleAttr)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>(context, attrs, defStyleAttr);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (isInEditMode()) &#123;</span><br><span class="line">      contentFrame = <span class="keyword">null</span>;</span><br><span class="line">      shutterView = <span class="keyword">null</span>;</span><br><span class="line">      surfaceView = <span class="keyword">null</span>;</span><br><span class="line">      artworkView = <span class="keyword">null</span>;</span><br><span class="line">      subtitleView = <span class="keyword">null</span>;</span><br><span class="line">      controller = <span class="keyword">null</span>;</span><br><span class="line">      componentListener = <span class="keyword">null</span>;</span><br><span class="line">      overlayFrameLayout = <span class="keyword">null</span>;</span><br><span class="line">      ImageView logo = <span class="keyword">new</span> ImageView(context);</span><br><span class="line">      <span class="keyword">if</span> (Util.SDK_INT &gt;= <span class="number">23</span>) &#123;</span><br><span class="line">        configureEditModeLogoV23(getResources(), logo);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        configureEditModeLogo(getResources(), logo);</span><br><span class="line">      &#125;</span><br><span class="line">      addView(logo);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">boolean</span> shutterColorSet = <span class="keyword">false</span>;</span><br><span class="line">    <span class="keyword">int</span> shutterColor = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> playerLayoutId = R.layout.exo_simple_player_view;</span><br><span class="line">    <span class="keyword">boolean</span> useArtwork = <span class="keyword">true</span>;</span><br><span class="line">    <span class="keyword">int</span> defaultArtworkId = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">boolean</span> useController = <span class="keyword">true</span>;</span><br><span class="line">    <span class="keyword">int</span> surfaceType = SURFACE_TYPE_SURFACE_VIEW;</span><br><span class="line">    <span class="keyword">int</span> resizeMode = AspectRatioFrameLayout.RESIZE_MODE_FIT;</span><br><span class="line">    <span class="keyword">int</span> controllerShowTimeoutMs = PlaybackControlView.DEFAULT_SHOW_TIMEOUT_MS;</span><br><span class="line">    <span class="keyword">boolean</span> controllerHideOnTouch = <span class="keyword">true</span>;</span><br><span class="line">    <span class="keyword">boolean</span> controllerAutoShow = <span class="keyword">true</span>;</span><br><span class="line">    <span class="keyword">if</span> (attrs != <span class="keyword">null</span>) &#123;</span><br><span class="line">      TypedArray a = context.getTheme().obtainStyledAttributes(attrs,</span><br><span class="line">              R.styleable.SimpleExoPlayerView, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        shutterColorSet = a.hasValue(R.styleable.SimpleExoPlayerView_shutter_background_color);</span><br><span class="line">        shutterColor = a.getColor(R.styleable.SimpleExoPlayerView_shutter_background_color,</span><br><span class="line">                shutterColor);</span><br><span class="line">        playerLayoutId = a.getResourceId(R.styleable.SimpleExoPlayerView_player_layout_id,</span><br><span class="line">                playerLayoutId);</span><br><span class="line">        useArtwork = a.getBoolean(R.styleable.SimpleExoPlayerView_use_artwork, useArtwork);</span><br><span class="line">        defaultArtworkId = a.getResourceId(R.styleable.SimpleExoPlayerView_default_artwork,</span><br><span class="line">                defaultArtworkId);</span><br><span class="line">        useController = a.getBoolean(R.styleable.SimpleExoPlayerView_use_controller, useController);</span><br><span class="line">        surfaceType = a.getInt(R.styleable.SimpleExoPlayerView_surface_type, surfaceType);</span><br><span class="line">        resizeMode = a.getInt(R.styleable.SimpleExoPlayerView_resize_mode, resizeMode);</span><br><span class="line">        controllerShowTimeoutMs = a.getInt(R.styleable.SimpleExoPlayerView_show_timeout,</span><br><span class="line">                controllerShowTimeoutMs);</span><br><span class="line">        controllerHideOnTouch = a.getBoolean(R.styleable.SimpleExoPlayerView_hide_on_touch,</span><br><span class="line">                controllerHideOnTouch);</span><br><span class="line">        controllerAutoShow = a.getBoolean(R.styleable.SimpleExoPlayerView_auto_show,</span><br><span class="line">                controllerAutoShow);</span><br><span class="line">      &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        a.recycle();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    LayoutInflater.from(context).inflate(playerLayoutId, <span class="keyword">this</span>);</span><br><span class="line">    componentListener = <span class="keyword">new</span> ComponentListener();</span><br><span class="line">    setDescendantFocusability(FOCUS_AFTER_DESCENDANTS);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Content frame.</span></span><br><span class="line">    contentFrame = findViewById(R.id.exo_content_frame);</span><br><span class="line">    <span class="keyword">if</span> (contentFrame != <span class="keyword">null</span>) &#123;</span><br><span class="line">      setResizeModeRaw(contentFrame, resizeMode);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Shutter view.</span></span><br><span class="line">    shutterView = findViewById(R.id.exo_shutter);</span><br><span class="line">    <span class="keyword">if</span> (shutterView != <span class="keyword">null</span> &amp;&amp; shutterColorSet) &#123;</span><br><span class="line">      shutterView.setBackgroundColor(shutterColor);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Create a surface view and insert it into the content frame, if there is one.</span></span><br><span class="line">    <span class="keyword">if</span> (contentFrame != <span class="keyword">null</span> &amp;&amp; surfaceType != SURFACE_TYPE_NONE) &#123;</span><br><span class="line">      ViewGroup.LayoutParams params = <span class="keyword">new</span> ViewGroup.LayoutParams(</span><br><span class="line">              ViewGroup.LayoutParams.MATCH_PARENT, ViewGroup.LayoutParams.MATCH_PARENT);</span><br><span class="line">      surfaceView = surfaceType == SURFACE_TYPE_TEXTURE_VIEW ? <span class="keyword">new</span> TextureView(context)</span><br><span class="line">              : <span class="keyword">new</span> SurfaceView(context);</span><br><span class="line">      surfaceView.setLayoutParams(params);</span><br><span class="line">      contentFrame.addView(surfaceView, <span class="number">0</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      surfaceView = <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Overlay frame layout.</span></span><br><span class="line">    overlayFrameLayout = findViewById(R.id.exo_overlay);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Artwork view.</span></span><br><span class="line">    artworkView = findViewById(R.id.exo_artwork);</span><br><span class="line">    <span class="keyword">this</span>.useArtwork = useArtwork &amp;&amp; artworkView != <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">if</span> (defaultArtworkId != <span class="number">0</span>) &#123;</span><br><span class="line">      defaultArtwork = BitmapFactory.decodeResource(context.getResources(), defaultArtworkId);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Subtitle view.</span></span><br><span class="line">    subtitleView = findViewById(R.id.exo_subtitles);</span><br><span class="line">    <span class="keyword">if</span> (subtitleView != <span class="keyword">null</span>) &#123;</span><br><span class="line">      subtitleView.setUserDefaultStyle();</span><br><span class="line">      subtitleView.setUserDefaultTextSize();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Playback control view.</span></span><br><span class="line">    PlaybackControlView customController = findViewById(R.id.exo_controller);</span><br><span class="line">    View controllerPlaceholder = findViewById(R.id.exo_controller_placeholder);</span><br><span class="line">    <span class="keyword">if</span> (customController != <span class="keyword">null</span>) &#123;</span><br><span class="line">      <span class="keyword">this</span>.controller = customController;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (controllerPlaceholder != <span class="keyword">null</span>) &#123;</span><br><span class="line">      <span class="comment">// Propagate attrs as playbackAttrs so that PlaybackControlView's custom attributes are</span></span><br><span class="line">      <span class="comment">// transferred, but standard FrameLayout attributes (e.g. background) are not.</span></span><br><span class="line">      <span class="keyword">this</span>.controller = <span class="keyword">new</span> PlaybackControlView(context, <span class="keyword">null</span>, <span class="number">0</span>, attrs);</span><br><span class="line">      controller.setLayoutParams(controllerPlaceholder.getLayoutParams());</span><br><span class="line">      ViewGroup parent = ((ViewGroup) controllerPlaceholder.getParent());</span><br><span class="line">      <span class="keyword">int</span> controllerIndex = parent.indexOfChild(controllerPlaceholder);</span><br><span class="line">      parent.removeView(controllerPlaceholder);</span><br><span class="line">      parent.addView(controller, controllerIndex);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">this</span>.controller = <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">this</span>.controllerShowTimeoutMs = controller != <span class="keyword">null</span> ? controllerShowTimeoutMs : <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">this</span>.controllerHideOnTouch = controllerHideOnTouch;</span><br><span class="line">    <span class="keyword">this</span>.controllerAutoShow = controllerAutoShow;</span><br><span class="line">    <span class="keyword">this</span>.useController = useController &amp;&amp; controller != <span class="keyword">null</span>;</span><br><span class="line">    hideController();</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  ä»¥ä¸‹æ˜¯ä¸€äº›æš´éœ²çš„æ–¹æ³•</span><br><span class="line">  .......</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></p>
<p>æˆ‘ä»¬çœ‹ä¸‹å®ƒçš„æ„é€ æ–¹æ³•ï¼Œé¦–å…ˆé€šè¿‡<code>isInEditMode()</code>æ–¹æ³•åˆ¤æ–­äº†æ˜¯å¦æ˜¯åœ¨å¯è§†åŒ–ç¼–è¾‘å™¨ä¸­åŠ è½½çš„ï¼Œæ˜¯çš„è¯å°±returnã€‚</p>
<p>æ¥ä¸‹æ¥å£°æ˜äº†ä¸€äº›é»˜è®¤çš„å˜é‡ï¼Œå¹¶èµ‹äºˆäº†ä¸€äº›é»˜è®¤çš„å€¼ï¼Œæˆ‘ä»¬çœ‹åˆ°æœ‰ä¸€ä¸ª<code>playerLayoutId</code>å£°æ˜äº†ä¸€ä¸ªé»˜è®¤çš„å¸ƒå±€æ–‡ä»¶<code>exo_simple_player_view</code>ï¼Œè·Ÿè¸ªå»çœ‹ä¸‹ï¼š<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">"1.0"</span> encoding=<span class="string">"utf-8"</span>?&gt;</span><br><span class="line">&lt;merge xmlns:android=<span class="string">"http://schemas.android.com/apk/res/android"</span>&gt;</span><br><span class="line"></span><br><span class="line">  &lt;com.google.android.exoplayer2.ui.AspectRatioFrameLayout android:id=<span class="string">"@id/exo_content_frame"</span></span><br><span class="line">      android:layout_width=<span class="string">"match_parent"</span></span><br><span class="line">      android:layout_height=<span class="string">"match_parent"</span></span><br><span class="line">      android:layout_gravity=<span class="string">"center"</span>&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- Video surface will be inserted as the first child of the content frame. --&gt;</span><br><span class="line"></span><br><span class="line">    &lt;View android:id=<span class="string">"@id/exo_shutter"</span></span><br><span class="line">        android:layout_width=<span class="string">"match_parent"</span></span><br><span class="line">        android:layout_height=<span class="string">"match_parent"</span></span><br><span class="line">        android:background=<span class="string">"@android:color/black"</span>/&gt;</span><br><span class="line"></span><br><span class="line">    &lt;ImageView android:id=<span class="string">"@id/exo_artwork"</span></span><br><span class="line">        android:layout_width=<span class="string">"match_parent"</span></span><br><span class="line">        android:layout_height=<span class="string">"match_parent"</span></span><br><span class="line">        android:scaleType=<span class="string">"fitXY"</span>/&gt;</span><br><span class="line"></span><br><span class="line">    &lt;com.google.android.exoplayer2.ui.SubtitleView android:id=<span class="string">"@id/exo_subtitles"</span></span><br><span class="line">        android:layout_width=<span class="string">"match_parent"</span></span><br><span class="line">        android:layout_height=<span class="string">"match_parent"</span>/&gt;</span><br><span class="line"></span><br><span class="line">  &lt;/com.google.android.exoplayer2.ui.AspectRatioFrameLayout&gt;</span><br><span class="line"></span><br><span class="line">  &lt;FrameLayout android:id=<span class="string">"@id/exo_overlay"</span></span><br><span class="line">      android:layout_width=<span class="string">"match_parent"</span></span><br><span class="line">      android:layout_height=<span class="string">"match_parent"</span>/&gt;</span><br><span class="line"></span><br><span class="line">  &lt;View android:id=<span class="string">"@id/exo_controller_placeholder"</span></span><br><span class="line">      android:layout_width=<span class="string">"match_parent"</span></span><br><span class="line">      android:layout_height=<span class="string">"match_parent"</span>/&gt;</span><br><span class="line"></span><br><span class="line">&lt;/merge&gt;</span><br></pre></td></tr></table></figure></p>
<p>è¿™ä¸ªå¸ƒå±€æ–‡ä»¶å°±æ˜¯æˆ‘ä»¬çš„ExoPlayer uiåŒ…ä¸­çš„é»˜è®¤uiå¸ƒå±€ã€‚<br><code>AspectRatioFrameLayout</code>æ˜¯ç»§æ‰¿è‡ª<code>FragmeLayout</code>,ä¹Ÿå°±æ˜¯æºç ä¸­çš„<code>contentFrame</code>ï¼Œå®ƒçš„ä½œç”¨æ˜¯æ ¹æ®è§†é¢‘çš„å®½é«˜æ¯”å’Œå±å¹•çš„å®½é«˜æ¯”æ¥åŠ¨æ€è®¡ç®—è§†é¢‘Viewçš„å®½é«˜æ¯”ä¾‹ã€‚è€Œ<code>SimpleExoPlayerView</code>ä¼šå°†<code>surfaceView</code>åŠ¨æ€æ’å…¥åˆ°<code>AspectRatioFrameLayout</code>çš„ç¬¬ä¸€ä¸ªå­Viewä¸­æ¥ï¼Œæ¥ä½œä¸ºæ’­æ”¾çš„View.</p>
<p><code>exo_shutter</code>ä¹Ÿå°±æ˜¯æºç ä¸­çš„shutterViewï¼Œå®ƒçš„èƒŒæ™¯å¯ä»¥é€šè¿‡ä»£ç åŠ¨æ€è®¾ç½®ï¼Œå¯ä»¥ä½œä¸ºè§†é¢‘çš„ä¸€ä¸ªè’™å±‚.</p>
<p><code>exo_artwork</code>ä¸ºæºç ä¸­çš„<code>artworkView</code>ï¼Œæ˜¯ä¸€ä¸ªImageView,å¯ä»¥æ”¾ä¸€äº›å›¾ç‰‡ä¸Šå».</p>
<p><code>SubtitleView</code>æ˜¯ä¸€ä¸ªå­—å¹•æ˜¾ç¤ºå™¨ï¼Œä¸ºæºç ä¸­çš„<code>subtitleView</code>ï¼Œå¯ä»¥å®šåˆ¶å­—å¹•æ–‡ä»¶ã€‚</p>
<p><code>exo_overlay</code>ä¸ºæºç ä¸­çš„<code>overlayFrameLayout</code>ï¼Œåœ¨æºç ä¸­æ²¡æœ‰å®šåˆ¶ä»»ä½•ä¸œè¥¿ï¼Œå¯ä»¥æ ¹æ®éœ€æ±‚æ”¾å…¥ä¸€äº›é€»è¾‘ã€‚</p>
<p><code>exo_controller_placeholder</code>ä¸ºæºç ä¸­çš„<code>controllerPlaceholder</code>ï¼Œå®šä¹‰äº†<code>PlaybackControlView</code>çš„å¸ƒå±€å±æ€§ï¼Œåœ¨ä»£ç ä¸­<code>SimpleExoPlayer</code>ä¼šå°†<code>controllerPlaceholder</code>çš„Paramå±æ€§æ·»åŠ åˆ°<code>PlaybackControlView</code>ä¸Šã€‚<br><code>PlaybackControlView</code>æ˜¯ä¸€ä¸ªæ’­æ”¾æ§åˆ¶å™¨View.å†…éƒ¨å°è£…äº†æ’­æ”¾å™¨æ§åˆ¶é€»è¾‘ï¼Œä¹Ÿå¯ä»¥å®šåˆ¶è‡ªå®šä¹‰uiå’Œå®ç°è‡ªå·±çš„æ§åˆ¶é€»è¾‘ã€‚</p>
<p>ä»‹ç»äº†è¿™ä¹ˆå¤šï¼Œæ¥ä¸‹æ¥ç»§ç»­åˆ†ææºç <br><code>LayoutInflater.from(context).inflate(playerLayoutId, this);</code><br>å¯ä»¥çœ‹åˆ°ï¼ŒSimpleExoPlayerViewå°†playerLayoutIdæ·»åŠ è¿›äº†è¯¥è§†å›¾ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡xmlçš„å±æ€§æ¥æŒ‡å®šè¯¥Viewçš„è§†å›¾idï¼Œæ¥ç€å£°æ˜äº†è¯¥ç„¦ç‚¹æ¨¡å¼ä¸ºåªæœ‰å½“å­Viewä¸éœ€è¦ç„¦ç‚¹æ—¶æ‰è·å–ç„¦ç‚¹ã€‚<br><code>setDescendantFocusability(FOCUS_AFTER_DESCENDANTS);</code><br>æ¥ä¸‹æ¥é€šè¿‡findViewByIdçš„æ¨¡å¼å¾—åˆ°è§†å›¾çš„æ§ä»¶æ¥è¿›è¡Œä¸åŒçš„è®¾ç½®ï¼Œå› æ­¤ï¼Œå¦‚æœæˆ‘ä»¬è‡ªå®šä¹‰çš„uiä¸­æƒ³ç”¨åˆ°é‡Œé¢çš„åŠŸèƒ½ï¼Œå°±å¿…é¡»ç”³æ˜ä¸€æ ·çš„id.ä¹Ÿå¯ä»¥é€šè¿‡findViewByIdçš„æ–¹å¼å¾—åˆ°è¯¥æ§ä»¶ã€‚<br>æ¥ä¸‹æ¥ç»§ç»­èµ°ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Create a surface view and insert it into the content frame, if there is one.</span></span><br><span class="line">   <span class="keyword">if</span> (contentFrame != <span class="keyword">null</span> &amp;&amp; surfaceType != SURFACE_TYPE_NONE) &#123;</span><br><span class="line">     ViewGroup.LayoutParams params = <span class="keyword">new</span> ViewGroup.LayoutParams(</span><br><span class="line">         ViewGroup.LayoutParams.MATCH_PARENT, ViewGroup.LayoutParams.MATCH_PARENT);</span><br><span class="line">     surfaceView = surfaceType == SURFACE_TYPE_TEXTURE_VIEW ? <span class="keyword">new</span> TextureView(context)</span><br><span class="line">         : <span class="keyword">new</span> SurfaceView(context);</span><br><span class="line">     surfaceView.setLayoutParams(params);</span><br><span class="line">     contentFrame.addView(surfaceView, <span class="number">0</span>);</span><br><span class="line">   &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">     surfaceView = <span class="keyword">null</span>;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°ï¼Œ<code>SimpleExoPlayerView</code>æ ¹æ®<code>sufaceType</code>è‡ªåŠ¨åˆ›å»ºä¸€ä¸ª<code>SufaceView</code>æˆ–<code>TextureView</code>,å¹¶å°†å…¶æ·»åŠ åˆ°<code>AspectRatioFrameLayout</code>çš„ç¬¬ä¸€ä¸ªå­Viewä¸Šï¼Œç”¨æ¥æ’­æ”¾è§†é¢‘ã€‚å› æ­¤å¦‚æœè‡ªå®šä¹‰UIï¼Œä¸€å®šè¦å®šä¹‰ä¸€ä¸ª<code>AspectRatioFrameLayout</code>æ¥åŒ…è£¹è¯¥View.<br>æ¥ç€æˆ‘ä»¬çœ‹ä¸€ä¸‹æ§åˆ¶å™¨çš„é€»è¾‘ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Playback control view.</span></span><br><span class="line">   PlaybackControlView customController = findViewById(R.id.exo_controller);</span><br><span class="line">   View controllerPlaceholder = findViewById(R.id.exo_controller_placeholder);</span><br><span class="line">   <span class="keyword">if</span> (customController != <span class="keyword">null</span>) &#123;</span><br><span class="line">     <span class="keyword">this</span>.controller = customController;</span><br><span class="line">   &#125; <span class="keyword">else</span> <span class="keyword">if</span> (controllerPlaceholder != <span class="keyword">null</span>) &#123;</span><br><span class="line">     <span class="comment">// Propagate attrs as playbackAttrs so that PlaybackControlView's custom attributes are</span></span><br><span class="line">     <span class="comment">// transferred, but standard FrameLayout attributes (e.g. background) are not.</span></span><br><span class="line">     <span class="keyword">this</span>.controller = <span class="keyword">new</span> PlaybackControlView(context, <span class="keyword">null</span>, <span class="number">0</span>, attrs);</span><br><span class="line">     controller.setLayoutParams(controllerPlaceholder.getLayoutParams());</span><br><span class="line">     ViewGroup parent = ((ViewGroup) controllerPlaceholder.getParent());</span><br><span class="line">     <span class="keyword">int</span> controllerIndex = parent.indexOfChild(controllerPlaceholder);</span><br><span class="line">     parent.removeView(controllerPlaceholder);</span><br><span class="line">     parent.addView(controller, controllerIndex);</span><br><span class="line">   &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">     <span class="keyword">this</span>.controller = <span class="keyword">null</span>;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure></p>
<p>å¯ä»¥çœ‹åˆ°<code>PlaybackControlView</code>ä¹Ÿæ˜¯é€šè¿‡æ‰¾idçš„æ–¹å¼è·å–ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦å®šåˆ¶æ§åˆ¶å™¨uiçš„è¯å¯ä»¥é€šè¿‡ç»§æ‰¿<code>PlaybackControlView</code>çš„æ–¹å¼æ¥å®šåˆ¶æˆ‘ä»¬è‡ªå·±çš„æ§åˆ¶UIã€‚<br>å¦‚æœæˆ‘ä»¬æ²¡æœ‰å®šä¹‰<code>PlaybackControlView</code>ï¼Œé‚£ä¹ˆä¼šå…ˆåˆ›å»ºä¸€ä¸ª<code>PlaybackControlView</code>ï¼Œç„¶åå»å–<code>exo_controller_placeholder</code>çš„<code>param</code>å±æ€§èµ‹ç»™<code>PlaybackControlView</code>ï¼Œå¦‚æœæ²¡æœ‰çš„è¯ï¼Œé‚£ä¹ˆä¸ä¼šç”³æ˜ä¸€ä¸ªæ§åˆ¶å™¨ã€‚</p>
<h4 id="UIå®šåˆ¶"><a href="#UIå®šåˆ¶" class="headerlink" title="UIå®šåˆ¶"></a>UIå®šåˆ¶</h4><p>ä»¥ä¸Šé€šè¿‡æºç åˆ†æï¼Œç›¸ä¿¡å¯¹è¯¥æ§ä»¶ä¹Ÿæœ‰ä¸ªå¤§æ¦‚çš„äº†è§£äº†ï¼Œæ¥ä¸‹æ¥çœ‹çœ‹å¦‚ä½•å®šåˆ¶æˆ‘ä»¬çš„UIï¼š<br>é¦–å…ˆï¼Œåœ¨xmlä¸­æˆ‘ä»¬å¯ä»¥é€šè¿‡<code>controller_layout_id</code>å±æ€§ç”³æ˜æˆ‘ä»¬è‡ªå·±çš„<code>Layout id</code>:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;com.google.android.exoplayer2.ui.SimpleExoPlayerView</span><br><span class="line">      android:layout_width=<span class="string">"match_parent"</span></span><br><span class="line">      android:layout_height=<span class="string">"wrap_content"</span></span><br><span class="line">      android:id=<span class="string">"@+id/simpleExoPlayerView"</span></span><br><span class="line">      app:resize_mode=<span class="string">"fixed_width"</span></span><br><span class="line">      app:controller_layout_id=<span class="string">"@layout/simple_player_view"</span></span><br><span class="line">      /&gt;</span><br></pre></td></tr></table></figure></p>
<p><code>simple_player_view</code>ä¸ºæˆ‘è‡ªå®šä¹‰å¸ƒå±€æ–‡ä»¶ï¼Œçœ‹ä¸€ä¸‹<code>simple_player_view</code>çš„ä»£ç ï¼š<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;com.google.android.exoplayer2.ui.AspectRatioFrameLayout</span><br><span class="line">    android:id=<span class="string">"@id/exo_content_frame"</span></span><br><span class="line">    android:layout_width=<span class="string">"match_parent"</span></span><br><span class="line">    android:layout_height=<span class="string">"wrap_content"</span></span><br><span class="line">    android:layout_gravity=<span class="string">"top"</span>&gt;</span><br><span class="line">    &lt;com.jie.exoplayerdemo.PlayControlView</span><br><span class="line">        android:layout_width=<span class="string">"match_parent"</span></span><br><span class="line">        android:layout_height=<span class="string">"wrap_content"</span></span><br><span class="line">        android:id=<span class="string">"@id/exo_controller"</span></span><br><span class="line">        android:layout_gravity=<span class="string">"bottom"</span></span><br><span class="line">        app:controller_layout_id=<span class="string">"@layout/exo_playback_control_view"</span></span><br><span class="line">        /&gt;</span><br><span class="line">&lt;/com.google.android.exoplayer2.ui.AspectRatioFrameLayout&gt;</span><br></pre></td></tr></table></figure></p>
<p>è¯¥å¸ƒå±€åªè¦idä¸æºç ä¸­å¯¹åº”å³å¯éšæ„å®šåˆ¶ï¼Œæˆ‘åœ¨é‡Œé¢åªæ˜¯ç”³æ˜äº†ä¸€ä¸ª<code>AspectRatioFrameLayout</code>å’Œä¸€ä¸ªè‡ªå®šä¹‰çš„æ§åˆ¶å™¨ï¼Œå¦‚æœæˆ‘ä»¬ä¸æƒ³ç”¨è¯¥æ¡†æ¶çš„é»˜è®¤æ§åˆ¶å™¨<code>PlaybackControlView</code>ï¼Œå¯ä»¥è‡ªå®šä¹‰è¯¥æ§åˆ¶å™¨ï¼Œæ§åˆ¶å™¨çš„è‡ªå®šä¹‰é€»è¾‘å’Œ<code>SimpleExoPlayerView</code>ä¸€æ ·ï¼Œä¹Ÿæ˜¯é€šè¿‡ç”³æ˜idçš„æ–¹å¼æ¥æ§åˆ¶Viewçš„é€»è¾‘ï¼Œå¹¶ä¸”è¯¥Viewä¸æ˜¯finalç±»ï¼Œå› æ­¤å¯ä»¥ç»§æ‰¿<code>PlaybackControlView</code>æ¥å®ç°è‡ªå·±çš„é€»è¾‘ã€‚<code>PlayControlView</code>å°±æ˜¯ç»§æ‰¿<code>PlaybackControlView</code>æ¥å®ç°çš„è‡ªå®šä¹‰é€»è¾‘ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥é€šè¿‡æ‰¾idçš„æ–¹å¼æ¥è·å–<code>PlaybackControlView</code>é‡Œçš„æ§ä»¶ï¼Œå› æ­¤ï¼Œé‡Œé¢çš„æ‰€æœ‰æ§ä»¶æ˜¯å¯å®šåˆ¶çš„ã€‚<br>å¯æ˜¯ï¼Œæˆ‘ä»¬çš„<code>SimpleExoPlayerView</code>æ˜¯ä¸€ä¸ªfinalç±»ï¼Œå¦‚æœéœ€è¦å®ç°<code>SimpleExoPlayerView</code>æ²¡æœ‰çš„åŠŸèƒ½ï¼Œæˆ‘ä»¬éœ€è¦å°†<code>SimpleExoPlayerView</code>çš„ä»£ç å¤åˆ¶ä¸€ä»½å‡ºæ¥æ¥è¾¾åˆ°ä¿®æ”¹çš„ç›®çš„ã€‚</p>
]]></content>
      
        <categories>
            
            <category> Androidè§†é¢‘æ’­æ”¾ </category>
            
        </categories>
        
        
        <tags>
            
            <tag> ExoPlayer </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[é«˜æ•ˆèµ„æºæœç½—åˆé›†ï¼Œä¸çœ‹ä¿è¯åæ‚”(æŒç»­æ›´æ–°)]]></title>
      <url>/Efficientresourcessearchtogethernoguaranteeofregret.html</url>
      <content type="html"><![CDATA[<p><strong>ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºåšä¸»åŸåˆ›æ–‡ç« ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„(www.huangjie.name)ï¼Œä¿æŠ¤åŸåˆ›ï¼Œä»æˆ‘åšèµ·.</strong></p>
<hr>
<blockquote>
<p>æ­å–œä½ å‘ç°äº†è¿™ç¯‡åšæ–‡ï¼Œçœ‹äº†è¿™ç¯‡åšæ–‡ï¼Œjayå¸®ä½ æ‰“å¼€æ–°ä¸–ç•Œçš„å¤§é—¨ï¼Œå¤šå¹´è€å¸æœºå¼€è½¦ï¼Œè¯·ç³»å¥½å®‰å…¨å¸¦ã€‚</p>
</blockquote>
<h4 id="æœç´¢ç¯‡-ä»€ä¹ˆï¼Ÿè¯´èµ·æœç´¢ä½ åªçŸ¥é“baidu-é‚£ä½ å°±outäº†"><a href="#æœç´¢ç¯‡-ä»€ä¹ˆï¼Ÿè¯´èµ·æœç´¢ä½ åªçŸ¥é“baidu-é‚£ä½ å°±outäº†" class="headerlink" title="æœç´¢ç¯‡(ä»€ä¹ˆï¼Ÿè¯´èµ·æœç´¢ä½ åªçŸ¥é“baidu?é‚£ä½ å°±outäº†)"></a>æœç´¢ç¯‡(ä»€ä¹ˆï¼Ÿè¯´èµ·æœç´¢ä½ åªçŸ¥é“baidu?é‚£ä½ å°±outäº†)</h4><a id="more"></a>
<p><strong>å¿«æœ</strong>ï¼š<a href="http://search.chongbuluo.com/" target="_blank" rel="noopener">http://search.chongbuluo.com/</a></p>
<p><img src="http://p07lh1fh6.bkt.clouddn.com/%E5%BF%AB%E6%90%9C%20-%20%E6%90%9C%E7%B4%A2%E5%BF%AB%E4%BA%BA%E4%B8%80%E6%AD%A5%20-%20Google.png" alt=""></p>
<p>çœ‹å›¾å°±çŸ¥é“ï¼Œå„ç§èµ„æºåº”æœ‰å°½æœ‰ï¼Œåªæœ‰ä½ æƒ³ä¸åˆ°ï¼Œæ²¡æœ‰ä½ æœä¸åˆ°ï¼Œå¼ºçƒˆæ¨è</p>
<p><strong>è¥¿æ—è¡—æœç´¢</strong>ï¼š<a href="http://www.xilinjie.com/" target="_blank" rel="noopener">http://www.xilinjie.com/</a></p>
<p><img src="http://p07lh1fh6.bkt.clouddn.com/xilingjie.png" alt=""></p>
<p>å„ç§ç”µå½±èµ„æº,è€ƒè¯•èµ„æ–™ï¼Œéƒ½æœ‰ï¼Œæœç´¢æ¯”è¾ƒç²¾å‡†ï¼Œæ¨è</p>
<p><strong>WolframAlpha</strong> :<a href="http://www.wolframalpha.com/" target="_blank" rel="noopener">http://www.wolframalpha.com/</a><br>å›½å¤–ç½‘ç«™ï¼Œå°±ä¸æ”¾å›¾äº†ï¼Œå¯ä»¥åœ¨çº¿è§£ç­”é—®é¢˜ï¼Œä¸ç®¡æ˜¯æ•°å­¦ï¼Œå†å²ï¼Œç”Ÿæ´»ï¼Œç­‰ç­‰ï¼Œéƒ½èƒ½å¸®ä½ å›ç­”</p>
<p><strong>StackExchange</strong>ï¼š <a href="https://stackexchange.com/" target="_blank" rel="noopener">https://stackexchange.com/</a><br>å›½å¤–çš„â€™çŸ¥ä¹â€™,é‡Œé¢çš„é—®é¢˜å’Œå›ç­”çš„è´¨é‡å¾ˆé«˜ï¼Œè‹±è¯­å¥½çš„å¯ä»¥ç»å¸¸é€›é€›</p>
<p><strong>Github</strong>ï¼š<a href="http://www.github.com/" target="_blank" rel="noopener">http://www.github.com/</a><br>å…¨çƒæœ€å¤§ä»£ç æ‰˜ç®¡å¹³å°ï¼Œæ²¡æœ‰ç¨‹åºå‘˜ä¸çŸ¥é“çš„å§ï¼Œåœ¨è¿™é‡Œä½ å¯ä»¥æ‰¾åˆ°å„ç§å¼€æºé¡¹ç›®å’Œå…±äº«èµ„æºï¼Œæ¯”å¦‚è°·æ­Œé•œåƒï¼Œhoståœ°å€åˆ†äº«ç­‰</p>
<p><strong>ç§å­æœç´¢ç±»(å®åœ¨å¤ªå¤šï¼Œéšä¾¿åˆ—å‡ ä¸ª)</strong></p>
<p><strong>BTZO</strong> :<a href="http://www.btzo.net/" target="_blank" rel="noopener">http://www.btzo.net/</a><br><img src="http://p07lh1fh6.bkt.clouddn.com/BTAVA%20-%20BTSOW%20-%20BTSO%20-%20AVMOO%20-%20BTAVMO%20-%20BTZO.com%20%281%29.png-suofang" alt=""><br>ç”µå½±èµ„æºæŒºä¸°å¯Œçš„ï¼Œå„ç§vipç”µå½±éƒ½æœ‰</p>
<p><strong>èƒ–æ¬¡æœç´¢</strong> ï¼š<a href="http://www.panc.cc/" target="_blank" rel="noopener">http://www.panc.cc/</a><br><img src="http://p07lh1fh6.bkt.clouddn.com/Panc.cc-%E8%83%96%E6%AC%A1%E7%BD%91%E7%9B%98%E6%90%9C%E7%B4%A2%20-%20%E8%83%96%E6%AC%A1%E5%88%86%E4%BA%AB%E7%A4%BE%E5%8C%BA%20-%20%E6%88%91%E4%BB%AC%E7%83%AD%E7%88%B1%E5%88%86%E4%BA%AB%20%281%29.png" alt=""></p>
<p>ç•Œé¢ç›¸å½“å¯çˆ±æœ‰æœ¨æœ‰ï¼Œå½“ç„¶èµ„æºä¹Ÿæ˜¯ç›¸å½“å¤šçš„</p>
<p><strong>ç½‘ç›˜æœç´¢</strong></p>
<p><strong>ç½‘ç›˜æœ</strong> ï¼š<a href="http://www.wangpansou.com/" target="_blank" rel="noopener">http://www.wangpansou.com/</a><br>ä½ æ˜¯ä¸æ˜¯ç»å¸¸é‡åˆ°æƒ³è¦çš„èµ„æºç™¾åº¦é“¾æ¥åˆå¤±æ•ˆäº†ï¼Œä¸è¦å®³æ€•ï¼Œä½¿ç”¨äº†ç½‘ç›˜æœï¼Œå…¨ç½‘èµ„æºä¸€ç½‘æ‰“å°½ï¼Œå†ä¹Ÿä¸éœ€è¦ç­‰å¾…åˆ«äººåˆ†äº«èµ„æºäº†ã€‚</p>
<h4 id="å›¾ç‰‡ç±»ï¼ˆè®¾è®¡å¸ˆç¦åˆ©ï¼‰"><a href="#å›¾ç‰‡ç±»ï¼ˆè®¾è®¡å¸ˆç¦åˆ©ï¼‰" class="headerlink" title="å›¾ç‰‡ç±»ï¼ˆè®¾è®¡å¸ˆç¦åˆ©ï¼‰"></a>å›¾ç‰‡ç±»ï¼ˆè®¾è®¡å¸ˆç¦åˆ©ï¼‰</h4><p><strong>Everypixel</strong> : <a href="https://everypixel.com/" target="_blank" rel="noopener">https://everypixel.com/</a><br>å›½å¤–å›¾ç‰‡æœç´¢ç±»ç½‘ç«™</p>
<p><strong>å›¾è™«ç½‘</strong>        <a href="https://tuchong.com/" target="_blank" rel="noopener">https://tuchong.com/</a></p>
<p><img src="http://p07lh1fh6.bkt.clouddn.com/%E5%9B%BE%E8%99%AB%E7%BD%91%20-%20%E6%9C%80%E5%A5%BD%E7%9A%84%E6%91%84%E5%BD%B1%E5%B8%88%E9%83%BD%E5%9C%A8%E8%BF%99%20%281%29%20%281%29.png" alt=""></p>
<p>æ‘„å½±çˆ±å¥½è€…å¿…å¤‡</p>
<p><strong>Pixabay</strong>  : <a href="https://pixabay.com/" target="_blank" rel="noopener">https://pixabay.com/</a></p>
<p><img src="http://p07lh1fh6.bkt.clouddn.com/%E5%85%8D%E8%B4%B9%E5%9B%BE%E7%89%87%20-%20Pixabay.png" alt=""></p>
<p>å—¯ï¼Œå…è´¹é«˜æ¸…å›¾ç‰‡ï¼ï¼ï¼ï¼</p>
<p><strong>Pexels</strong> : <a href="https://www.pexels.com/" target="_blank" rel="noopener">https://www.pexels.com/</a><br><img src="http://p07lh1fh6.bkt.clouddn.com/Free%20stock%20photos%20%C2%B7%20Pexels%20%281%29.png" alt=""><br>å›½å¤–ç½‘ç«™ï¼Œç´ æå¾ˆå¤šè€Œä¸”å…è´¹ã€‚</p>
<p><strong>500PX</strong>ï¼š<a href="https://500px.com/" target="_blank" rel="noopener">https://500px.com/</a><br><img src="http://p07lh1fh6.bkt.clouddn.com/%E6%9C%80%E5%87%BA%E8%89%B2%E7%9A%84%E6%91%84%E5%BD%B1%E7%A4%BE%E5%8C%BA%20%20%20500px%20%281%29.png" alt=""></p>
<p>å·ç§°æœ€å‡ºè‰²çš„æ‘„å½±ä¸“åŒºï¼Œå—¯ï¼Œå€¼å¾—ä¸€è¯•</p>
<p>è¿˜æœ‰å‡ ä¸ªæ‰¾iconçš„ç½‘ç«™ï¼š<br><strong>iconFont</strong> <a href="http://www.iconfont.cn/" target="_blank" rel="noopener">http://www.iconfont.cn/</a><br>é˜¿é‡ŒçŸ¢é‡å›¾åº“ï¼Œé‡Œé¢æœ‰è®¸å¤šappçš„å›¾ç‰‡èµ„æºå’Œiconï¼Œå¹¶ä¸”æä¾›svgå’Œå›¾æ ‡é¢œè‰²è½¬æ¢ï¼Œæˆ‘å¹³æ—¶ä»¿å†™appå°±æ˜¯ç”¨çš„å®ƒæ¥æ‰¾iconçš„</p>
<p><strong>easyicon</strong> :<a href="http://www.easyicon.net/iconsearch/See/" target="_blank" rel="noopener">http://www.easyicon.net/iconsearch/See/</a><br>ä¸€ä¸ªiconå›¾æ ‡æœç´¢ç½‘ç«™</p>
<p>æ­¤å¤–ï¼Œè¿˜æœ‰ç™¾åº¦çš„ç™¾åº¦è¯†å›¾ä¹Ÿä¸é”™ï¼Œæœ‰æ—¶å€™æ‰¾åˆ°äº†ä¸€å¼ éé«˜æ¸…çš„å›¾å¯ä»¥é€šè¿‡å®ƒæ‰¾åˆ°é«˜æ¸…çš„å›¾ï¼š<br><a href="http://image.baidu.com/?fr=shitu" target="_blank" rel="noopener">http://image.baidu.com/?fr=shitu</a></p>
<h4 id="å½±è§†ç±»ï¼ˆé«˜æ¸…ç”µå½±åœ¨çº¿è§‚çœ‹ï¼‰"><a href="#å½±è§†ç±»ï¼ˆé«˜æ¸…ç”µå½±åœ¨çº¿è§‚çœ‹ï¼‰" class="headerlink" title="å½±è§†ç±»ï¼ˆé«˜æ¸…ç”µå½±åœ¨çº¿è§‚çœ‹ï¼‰"></a>å½±è§†ç±»ï¼ˆé«˜æ¸…ç”µå½±åœ¨çº¿è§‚çœ‹ï¼‰</h4><p>æ¨èå‡ ä¸ªåœ¨çº¿è§‚çœ‹ç”µå½±çš„ç½‘ç«™ï¼Œæ²¡æœ‰å¹¿å‘Šå“¦,å½“ç„¶ï¼Œè¿™ç§ç½‘ç«™ç°åœ¨å¾ˆå¤šï¼Œæ¯•ç«Ÿæµé‡å¾ˆå¤§<br><strong>yy6080</strong> ï¼š<a href="http://www.yy6080.org/" target="_blank" rel="noopener">http://www.yy6080.org/</a>,<br>ç±»ä¼¼è¿˜æœ‰80s(è€ç‰Œç”µå½±ç½‘ç«™),äººäººå½±è§†ï¼Œå¤©å¤©ç¾å‰§,1905ç”µå½±ç½‘ï¼ŒBTå¤©å ‚ï¼Œç«¥è¯æ‘ï¼Œè¿™é‡Œå°±ä¸è´´åœ°å€äº†ï¼Œç™¾åº¦å°±èƒ½æ‰¾åˆ°</p>
<h4 id="éŸ³ä¹ç±»ï¼ˆhighåˆ°åœä¸ä¸‹æ¥ï¼‰"><a href="#éŸ³ä¹ç±»ï¼ˆhighåˆ°åœä¸ä¸‹æ¥ï¼‰" class="headerlink" title="éŸ³ä¹ç±»ï¼ˆhighåˆ°åœä¸ä¸‹æ¥ï¼‰"></a>éŸ³ä¹ç±»ï¼ˆhighåˆ°åœä¸ä¸‹æ¥ï¼‰</h4><p>å¼ºçƒˆå®‰åˆ©ä¸€æ¬¾å¬æ­Œç¥å™¨ï¼š<br><strong>listen1</strong> :<a href="http://listen1.github.io/listen1/" target="_blank" rel="noopener">http://listen1.github.io/listen1/</a><br><img src="http://p07lh1fh6.bkt.clouddn.com/%E2%96%B6%20%E9%9A%94%E7%83%9F%E6%B0%B4%EF%BC%88Cover%20%E6%99%83%E5%84%BF%EF%BC%89%20-%20%E7%89%B9%E6%9B%BC%20%281%29.png" alt=""><br>è¿™æ˜¯ä¸€æ¬¾è°·æ­Œæµè§ˆå™¨æ’ä»¶ï¼Œå½“ä½ æƒ³å¬æŸä¸€é¦–æœ‰ç‰ˆæƒçš„æ­Œï¼ŒQQéŸ³ä¹æœ‰è¿™é¦–æ­Œçš„ç‰ˆæƒï¼Œè€Œç½‘æ˜“äº‘æ²¡æœ‰ï¼Œè€Œä½ ä½¿ç”¨çš„æ˜¯ç½‘æ˜“äº‘ï¼Œè€Œä½ åˆæƒ³å¬è¿™é¦–æ­Œï¼Œè¿™ä¸ªæ—¶å€™ä½ å°±ä¸å¾—ä¸ä½¿ç”¨QQéŸ³ä¹æ’­æ”¾å™¨ï¼Œæ˜¯ä¸æ˜¯å¾ˆé—¹å¿ƒï¼Œè¿™ä¸ªæ’ä»¶çš„ä½œç”¨å°±æ˜¯é›†ç»“äº†ä¸‰å¤§ä¸»æµå¹³å°çš„éŸ³ä¹ï¼Œè®©ä½ å…å»åˆ‡æ’­æ”¾å™¨çš„çƒ¦æ¼ï¼Œä»æ­¤ä¸€æ¬¡æ€§å¯ä»¥å¬3ä¸ªéŸ³ä¹å¹³å°çš„æ­Œäº†ã€‚</p>
<p><strong>5Sing</strong> : <a href="http://5sing.kugou.com/index.html" target="_blank" rel="noopener">http://5sing.kugou.com/index.html</a><br>å®ƒæ˜¯ä¸€ä¸ªåŸåˆ›éŸ³ä¹åŸºåœ°ï¼Œæœ‰è®¸å¤šçš„åŸåˆ›å’Œç¿»å”±ä¼´å¥æ­Œæ›²ã€‚</p>
<h4 id="è½¯ä»¶å·¥å…·ç±»ï¼ˆè°ç”¨è°çŸ¥é“ï¼‰"><a href="#è½¯ä»¶å·¥å…·ç±»ï¼ˆè°ç”¨è°çŸ¥é“ï¼‰" class="headerlink" title="è½¯ä»¶å·¥å…·ç±»ï¼ˆè°ç”¨è°çŸ¥é“ï¼‰"></a>è½¯ä»¶å·¥å…·ç±»ï¼ˆè°ç”¨è°çŸ¥é“ï¼‰</h4><p>æ‰‹æœºapp:<br><strong>è—ä¹¦åº“</strong> : <a href="http://www.geeboo.com/" target="_blank" rel="noopener">http://www.geeboo.com/</a></p>
<p>è—ä¹¦é¦†ï¼Œæ˜¯è¯»ä¹¦çˆ±å¥½è€…åœ¨ç§»åŠ¨äº’è”ç½‘ç©ºé—´é‡Œçš„ä¸“å±ç§äººå›¾ä¹¦é¦†ï¼Œå®ƒé€šè¿‡å…±äº«å€Ÿé˜…çš„æ¨¡å¼ï¼Œå®ç°äº†ä¹¦å‹é—´æµ·é‡ä¹¦ç±çš„çº¿ä¸Šäº’å€Ÿã€‚</p>
<p><strong>ç½‘æ˜“èœ—ç‰›è¯»ä¹¦</strong>ï¼š<a href="http://du.163.com/" target="_blank" rel="noopener">http://du.163.com/</a><br>å…¨ç½‘æ¯å¤©æœ‰1å°æ—¶çš„å…è´¹è¯»ä¹¦æ—¶é—´ï¼Œæ¯”è¾ƒæœ‰ç‰¹è‰²</p>
<p>ç½‘ç«™ï¼š<br><strong>TinyPNG</strong>:<a href="https://tinypng.com/" target="_blank" rel="noopener">https://tinypng.com/</a><br>è¿™æ˜¯ä¸€æ¬¾å¯ä»¥åœ¨çº¿å‹ç¼©å›¾ç‰‡çš„ç½‘ç«™ï¼Œå‹ç¼©åå›¾ç‰‡è´¨é‡è¿˜æŒºå¥½çš„ï¼Œæœ¬äººä¸€ç›´åœ¨ç”¨</p>
<p><strong>135ç¼–è¾‘å™¨</strong>ï¼š<a href="http://www.135editor.com/" target="_blank" rel="noopener">http://www.135editor.com/</a><br>å¦‚æœä½ æ­£åœ¨è¿è¥ä¸€ä¸ªå…¬ä¼—å·ï¼Œé‚£ä¹ˆåœ¨å…¬ä¼—å·é‡Œå†™æ–‡ç« å°±å¯ä»¥ä½¿ç”¨è¿™ä¸ªç½‘ç«™ï¼Œé‡Œé¢çš„å…¬ä¼—å·æ¨¡æ¿å’Œæ’ç‰ˆä¸ªäººä¸€ç›´å¾ˆå–œæ¬¢</p>
<p>å¦å¤–ï¼Œå®‰åˆ©ä¸€ä¸ªæ·˜è½¯ä»¶çš„ç¥å™¨ç½‘ç«™ï¼š52ç ´è§£è®ºå›:<a href="https://www.52pojie.cn/" target="_blank" rel="noopener">https://www.52pojie.cn/</a><br>é‡Œé¢æ±‡èš360ï¼Œè…¾è®¯ï¼Œé˜¿é‡Œç­‰å®‰å…¨å¤§ç‰›ï¼Œæ¯å¤©éƒ½æœ‰åŸåˆ›ç ´è§£è½¯ä»¶å‘å¸ƒï¼ŒæƒŠå–œå¤šå¤šå“¦~~</p>
<p>èµ„æºæš‚æ—¶åˆ†äº«åˆ°è¿™ï¼ŒåæœŸè¿˜ä¼šæŒç»­æ›´æ–°ï¼Œç å­—ä¸æ˜“ï¼Œå¦‚æœè§‰å¾—å¯¹ä½ æœ‰å¸®åŠ©ï¼Œä¸å¦‚ç‚¹å‡»ä¸‹æ–¹èµèµæŒ‰é’®è¯·æˆ‘å–æ¯å’–å•¡ï¼Œå¦å¤–ï¼Œä½ å¯ä»¥æŒ‰ä¸‹Ctrl+Dæ”¶è—è¯¥ç½‘å€æˆ–è€…åˆ†äº«ç»™å¥½å‹ï¼Œé˜²æ­¢ä¸‹æ¬¡æ‰¾ä¸åˆ°äº†å“¦~~</p>
]]></content>
      
        <categories>
            
            <category> èµ„æºæ•´åˆ </category>
            
        </categories>
        
        
        <tags>
            
            <tag> tools </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[ä¸€çœ‹å°±æ‡‚çš„è‡ªå®šä¹‰é¡¶éƒ¨ç²˜æ€§ä¸‹æ‹‰æ§ä»¶TouchPullViewå…¨é¢å‰–æ]]></title>
      <url>/%E4%B8%80%E7%9C%8B%E5%B0%B1%E6%87%82%E7%9A%84%E8%87%AA%E5%AE%9A%E4%B9%89%E9%A1%B6%E9%83%A8%E7%B2%98%E6%80%A7%E4%B8%8B%E6%8B%89%E6%8E%A7%E4%BB%B6TouchPullView%E5%85%A8%E9%9D%A2%E5%89%96%E6%9E%90.html</url>
      <content type="html"><![CDATA[<p><strong>ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºåšä¸»åŸåˆ›æ–‡ç« ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„(www.huangjie.name)ï¼Œä¿æŠ¤åŸåˆ›ï¼Œä»æˆ‘åšèµ·.</strong></p>
<hr>
<blockquote>
<p>æ˜¨å¤©åœ¨æ…•è¯¾ä¸Šçœ‹åˆ°äº†ä¸€ä¸ªè‡ªå®šä¹‰ç²˜æ€§å¤´éƒ¨çš„å®ç°ï¼Œå‘ç°ç°åœ¨æœ‰è®¸å¤šçš„appéƒ½æœ‰è¿™ä¸ªæ•ˆæœï¼Œäºæ˜¯è·Ÿç€æ…•è¯¾ä¸Šå¾—è§†é¢‘æ•²äº†ä¸€éã€‚å› ä¸ºæ…•è¯¾ä¸Šçš„è€å¸ˆå¯¹äºååŠéƒ¨åˆ†çš„åæ ‡è¿ç®—è®²çš„å¹¶ä¸æ˜¯å¾ˆç»†è‡´ï¼Œå› æ­¤æˆ‘è‡ªå·±åˆ†æäº†ä¸€ä¸‹æºä»£ç ï¼Œæ€»ç»“äº†è¿™ç¯‡åšå®¢ï¼Œå¸Œæœ›å¯¹åŒå­¦ä»¬æœ‰æ‰€å¸®åŠ©ã€‚</p>
</blockquote>
<p>æ…•è¯¾è§†é¢‘åœ°å€ï¼š<a href="https://www.imooc.com/learn/830" target="_blank" rel="noopener">https://www.imooc.com/learn/830</a><br>æºç ä¸‹è½½åœ°å€ï¼š<a href="https://github.com/Jay-huangjie/TouchPullView" target="_blank" rel="noopener">https://github.com/Jay-huangjie/TouchPullView</a><br>å»ºè®®å¤§å®¶å…ˆä¸‹è½½æºç å†æ¥è§‚çœ‹<br><a id="more"></a></p>
<h4 id="ç”¨åˆ°çš„çŸ¥è¯†ç‚¹"><a href="#ç”¨åˆ°çš„çŸ¥è¯†ç‚¹" class="headerlink" title="ç”¨åˆ°çš„çŸ¥è¯†ç‚¹"></a>ç”¨åˆ°çš„çŸ¥è¯†ç‚¹</h4><p><strong>æˆ‘ä»¬å…ˆæ¥å¤ä¹ ä¸€ä¸‹éœ€è¦ç”¨åˆ°çš„æ•°å­¦çŸ¥è¯†ç‚¹</strong></p>
<p>ä¸‰è§’å‡½æ•°ï¼š</p>
<ul>
<li>sin =  a/c;     </li>
<li>cos = b/c;         </li>
<li>tan = a/b;<br><img src="https://gss1.bdstatic.com/-vo3dSag_xI4khGkpoWK1HF6hhy/baike/w%3D268/sign=1966ca03a0cc7cd9fa2d33df01032104/9825bc315c6034a8eb16696fc81349540823766c.jpg" alt=""></li>
</ul>
<p>è´å¡å°”æ›²çº¿ï¼š<br><img src="https://gss0.bdstatic.com/94o3dSag_xI4khGkpoWK1HF6hhy/baike/s%3D325/sign=391820be267f9e2f74351b0a2a31e962/91529822720e0cf34f59dca30b46f21fbe09aa38.jpg" alt=""></p>
<p>é˜…è¯»æœ¬æ–‡éœ€è¦äº†è§£è‡ªå®šä¹‰Viewçš„åŸºæœ¬æµç¨‹å’Œè´å¡å°”æ›²çº¿çš„ç»˜åˆ¶ã€‚</p>
<p>å¥½ï¼Œè¿›å…¥æ­£é¢˜ï¼Œæˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹å®ƒçš„è¿è¡Œæ•ˆæœï¼š</p>
<p><img src="http://p07lh1fh6.bkt.clouddn.com/touch_demo.gif-sy" alt="æ•ˆæœå›¾"></p>
<p>emmmmm,æ•ˆæœæ„Ÿè§‰è¿˜ä¸é”™~</p>
<h4 id="å®ç°åŸç†"><a href="#å®ç°åŸç†" class="headerlink" title="å®ç°åŸç†"></a>å®ç°åŸç†</h4><p>æ—¢ç„¶æ˜¯æ‹–åŠ¨ï¼Œè‚¯å®šæ˜¯åŸºäºTouchäº‹ä»¶æ¥å®ç°çš„ï¼Œé€šè¿‡Touchçš„Yåæ ‡è·å–åˆ°æ‹–åŠ¨è¿›åº¦progress,ç„¶åé€šè¿‡requestLayoutæ–¹æ³•ä¸æ–­é‡ç»˜ç•Œé¢ï¼Œåœ¨onSizeChangedæ–¹æ³•ä¸­é€šè¿‡è®¡ç®—ä¸æ–­ç§»åŠ¨åœ†å¿ƒåæ ‡ï¼Œåœ†çš„å·¦å³ä¸¤è¾¹æ˜¯ç»å…¸çš„è´å¡å°”æ›²çº¿ï¼Œåªè¦è·å–åˆ°æ§åˆ¶ç‚¹å’Œç»“æŸç‚¹çš„åæ ‡å°±èƒ½ç»˜åˆ¶å‡ºæ¥ï¼Œé€šè¿‡æ§åˆ¶ç‚¹çš„ä¸æ–­ç§»åŠ¨å’ŒonDrawæ–¹æ³•ä¸­çš„ç”»å¸ƒçš„ä¸æ–­ç§»åŠ¨æ¥è¾¾åˆ°å¼¹æ€§å’Œé¡¶éƒ¨ä¸¤ä¸ªèµ·å§‹ç‚¹å‘ä¸­å¿ƒé æ‹¢çš„æ•ˆæœï¼Œä¸­é—´çš„åœ†å¿ƒä¸æ—è¾¹çš„é—´è·éƒ¨åˆ†åˆ™æ˜¯ä½¿ç”¨çš„drawableçš„Boundsæ•ˆæœ,å›å¼¹åˆ™æ˜¯åˆ©ç”¨çš„å±æ€§åŠ¨ç”»çš„addUpdateListeneræ¥å£å°†progressæ•°å€¼ç”±å¤§åˆ°å°æ‰§è¡Œå›å»ä»è€Œè¾¾åˆ°çš„å›å¼¹æ•ˆæœ</p>
<h4 id="å…·ä½“åˆ†æ"><a href="#å…·ä½“åˆ†æ" class="headerlink" title="å…·ä½“åˆ†æ"></a>å…·ä½“åˆ†æ</h4><p>å…‰çœ‹åŸç†è‚¯å®šæ˜¯å››è„¸è’™è”½ï¼Œè¿˜æ˜¯ç»“åˆä»£ç åˆ†ææ‰èƒ½è¾¾åˆ°äº‹åŠåŠŸå€çš„æ•ˆæœã€‚<br>æˆ‘ä»¬å…ˆçœ‹OnTouchéƒ¨åˆ†çš„ä»£ç ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">findViewById(R.id.ll_mainLayout).setOnTouchListener(<span class="keyword">new</span> View.OnTouchListener() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onTouch</span><span class="params">(View v, MotionEvent event)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">int</span> actionMasked = event.getActionMasked();</span><br><span class="line">                <span class="keyword">switch</span> (actionMasked) &#123;</span><br><span class="line">                    <span class="keyword">case</span> MotionEvent.ACTION_DOWN:</span><br><span class="line">                        mTouchStartY = event.getY();</span><br><span class="line">                        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">                    <span class="keyword">case</span> MotionEvent.ACTION_MOVE:</span><br><span class="line">                        <span class="keyword">float</span> y = event.getY();</span><br><span class="line">                        <span class="keyword">if</span> (y &gt;= mTouchStartY) &#123;  <span class="comment">//è¡¨ç¤ºå‘ä¸‹ç§»åŠ¨</span></span><br><span class="line">                            <span class="keyword">float</span> moveSize = y - mTouchStartY;</span><br><span class="line">                            <span class="keyword">float</span> progress = moveSize &gt; TOUCH_MOVE_MAX_Y ?</span><br><span class="line">                                    <span class="number">1</span> : moveSize / TOUCH_MOVE_MAX_Y;   <span class="comment">//è®¡ç®—è¿›åº¦å€¼</span></span><br><span class="line">                            touchView.setProgress(progress);</span><br><span class="line">                            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    <span class="keyword">case</span> MotionEvent.ACTION_UP:</span><br><span class="line">                        touchView.release();</span><br><span class="line">                        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">                    <span class="keyword">default</span>:</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure></p>
<p>è¿™é‡Œè¿˜æ˜¯æ¯”è¾ƒç®€å•ï¼Œé€šè¿‡getYè·å–æ»‘åŠ¨çš„è·ç¦»ï¼ŒæŒ‰ä¸‹å»æœ‰ä¸€ä¸ªç‚¹ï¼Œæ»‘åŠ¨åæœ‰ä¸€ä¸ªç‚¹ï¼Œä¸¤ç‚¹ä¹‹é—´çš„è·ç¦»å°±æ˜¯æˆ‘ä»¬çš„<br>moveSizeäº†ï¼Œç”±äºprogressæ˜¯æŒ‡å½“å‰æ»‘åŠ¨çš„è¿›åº¦å€¼ï¼Œå–å€¼è‚¯å®šæ˜¯åœ¨0~1ä¹‹é—´ï¼Œå› æ­¤ï¼Œå½“moveSizeå¤§äºæˆ‘ä»¬é¢„è®¾çš„æœ€å¤§å€¼æ—¶ï¼Œprogresså°±è¿”å›1ï¼Œå¦åˆ™å°±è¿”å›å…·ä½“çš„è¿›åº¦å€¼ï¼Œæœ€ååœ¨è®¾ç½®ç»™touchViewï¼ŒtouchViewå°±ä¼šè¿›è¡Œé‡ç»˜ã€‚</p>
<p>å†æ¥çœ‹ä¸‹TouchPullViewé‡Œé¢çš„ä»£ç ï¼š<br>æˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹å˜é‡ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> Paint mCirclePaint = <span class="keyword">new</span> Paint(Paint.ANTI_ALIAS_FLAG);</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">float</span> mCircleRadius = <span class="number">50</span>; <span class="comment">//åœ†çš„åŠå¾„</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">float</span> mCirclePointX, mCirclePointY; <span class="comment">//åœ†å¿ƒåæ ‡</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> mDargHeight = <span class="number">400</span>;  <span class="comment">//æœ€å¤§å¯ä¸‹æ‹‰çš„é«˜åº¦</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">float</span> mProgress;  <span class="comment">//ä¸‹æ‹‰è¿›åº¦å€¼</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> mTargetWidth = <span class="number">400</span>; <span class="comment">//ç›®æ ‡å®½åº¦</span></span><br><span class="line">    <span class="keyword">private</span> Path mPath = <span class="keyword">new</span> Path(); <span class="comment">//è´å¡å°”è·¯å¾„</span></span><br><span class="line">    <span class="keyword">private</span> Paint mPathPaint = <span class="keyword">new</span> Paint(Paint.ANTI_ALIAS_FLAG); <span class="comment">//è´å¡å°”ç”»ç¬”</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> mTargetGravityHeight = <span class="number">10</span>; <span class="comment">//é‡å¿ƒç‚¹æœ€ç»ˆé«˜åº¦ï¼Œå†³å®šæ§åˆ¶ç‚¹çš„Yåæ ‡</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> mTargetAngle = <span class="number">105</span>; <span class="comment">//è§’åº¦å˜æ¢ 0~135</span></span><br><span class="line">    <span class="keyword">private</span> Interpolator mProgessInterpolator = <span class="keyword">new</span> DecelerateInterpolator(); <span class="comment">//ä¸€ä¸ªç”±å¿«åˆ°æ…¢çš„æ’å€¼å™¨</span></span><br><span class="line">    <span class="keyword">private</span> Interpolator mTanentAngleInterpolator;</span><br><span class="line">    <span class="keyword">private</span> Drawable content = <span class="keyword">null</span>; <span class="comment">//ä¸­å¿ƒåœ†drawable</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> mContentDrawableMargin = <span class="number">0</span>; <span class="comment">//ä¸­å¿ƒåœ†Drawableè¾¹è·</span></span><br></pre></td></tr></table></figure></p>
<p>å¤§éƒ¨åˆ†å˜é‡éƒ½ç®€æ´æ˜äº†ï¼ŒmTargetGravityHeightè§„å®šäº†æ§åˆ¶ç‚¹ä¸Šä¸‹æµ®åŠ¨çš„æœ€å¤§è·ç¦»ï¼Œè¯¥å€¼è¶Šå¤§ï¼Œæ§åˆ¶ç‚¹è¶Šå¾€ä¸‹ç§»ï¼ŒmTargetAngleè§„å®šäº†ç»“æŸç‚¹ä¸åœ†å¿ƒè¿çº¿çš„é‚£ä¸ªè§’åº¦çš„æœ€å¤§å˜å¹»å€¼ï¼Œå› ä¸ºä¸è§„å®šå¯ä»¥çœ‹åˆ°ç»“æŸç‚¹ä¼šå›´ç»•åœ†å¿ƒåšåœ†ç¯è¿åŠ¨ï¼Œæœ€ç»ˆå¯¼è‡´å˜å½¢ï¼Œè¿™ä¸æ˜¯æˆ‘ä»¬å¸Œæœ›çœ‹åˆ°çš„ã€‚mTargetWidthåˆ™è§„å®šäº†è¯¥æ§ä»¶èƒ½ç¼©å°çš„æœ€å°å®½åº¦ã€‚</p>
<p>æ¥ä¸‹æ¥çœ‹onDraw()æ–¹æ³•çš„å®ç°ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDraw</span><span class="params">(Canvas canvas)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onDraw(canvas);</span><br><span class="line">        <span class="comment">//åŸºç¡€åæ ‡ç³»æ”¹å˜</span></span><br><span class="line">        <span class="keyword">int</span> count = canvas.save();</span><br><span class="line">        <span class="comment">//è·å–å¹³ç§»ç”»å¸ƒçš„Xçš„å€¼,éšç€ä¸‹æ»‘èµ·å§‹ç‚¹çš„åæ ‡ç§»åŠ¨</span></span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">float</span> transX = (getWidth() - getValueByLine(getWidth(), mTargetWidth, mProgress)) / <span class="number">2</span>;</span><br><span class="line">        canvas.translate(transX, <span class="number">0</span>);</span><br><span class="line">        <span class="comment">//ç»˜åˆ¶è´å¡å°”</span></span><br><span class="line">        canvas.drawPath(mPath, mPathPaint);</span><br><span class="line">        <span class="comment">//ç”»åœ†</span></span><br><span class="line">        canvas.drawCircle(mCirclePointX, mCirclePointY, mCircleRadius, mCirclePaint);</span><br><span class="line">        <span class="comment">//ç»˜åˆ¶Drawable</span></span><br><span class="line">        Drawable drawable = content;</span><br><span class="line">        <span class="keyword">if</span> (drawable != <span class="keyword">null</span>) &#123;</span><br><span class="line">            canvas.save();</span><br><span class="line">            canvas.clipRect(drawable.getBounds());</span><br><span class="line">            drawable.draw(canvas);</span><br><span class="line">            canvas.restore();</span><br><span class="line">        &#125;</span><br><span class="line">        canvas.restoreToCount(count);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<p><code>getValueByLine</code>æ–¹æ³•çš„ä½œç”¨æ˜¯è·å–æŸä¸€æ—¶åˆ»è´å¡å°”æ›²çº¿ä¸Šçš„ç‚¹çš„åæ ‡ï¼Œçœ‹ä¸€ä¸‹å®ƒçš„æ–¹æ³•å®ç°ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–æŸä¸€æ—¶åˆ»çš„å€¼</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> star      èµ·å§‹ç‚¹</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> end       ç»“æŸç‚¹</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> mProgress å½“å‰è¿›åº¦å€¼</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">float</span> <span class="title">getValueByLine</span><span class="params">(<span class="keyword">float</span> star, <span class="keyword">float</span> end, <span class="keyword">float</span> mProgress)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> star + (end - star) * mProgress;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<p>å®ƒå°±æ˜¯ä¸€ä¸ªè´å¡å°”æ›²çº¿å…¬å¼Bt = P0+(P1-P0)*tï¼Œä¼ å…¥åˆå§‹åæ ‡P0å’Œç»“æŸåæ ‡P1å’Œæ—¶é—´tï¼Œå°±èƒ½è·å–åˆ°Btäº†ã€‚<br>æ¥ç€å®ƒå¾—åˆ°äº†ä¸€ä¸ªtransX,å®ƒç­‰äºèµ·å§‹ç‚¹ä¸å±å¹•å·¦å³çš„è·ç¦»ï¼Œé€šè¿‡ç”»å¸ƒçš„ç§»åŠ¨æ¥å®ç°èµ·å§‹ç‚¹ä¸æ–­é æ‹¢çš„æ•ˆæœï¼Œæ¥ä¸‹æ¥æ˜¯ç»˜åˆ¶è´å¡å°”æ›²çº¿ï¼Œç”»åœ†ï¼Œæ ¹æ®Boundså¤§å°æ·»åŠ Drawableåˆ°ç”»å¸ƒä¸Šã€‚</p>
<p>æ¥ä¸‹æ¥åˆ†ææˆ‘ä»¬çš„é‡ç‚¹ï¼šonSizeChangedä¸­çš„å®ç°,å…³é”®æ˜¯è¿™ä¸ªæ–¹æ³•<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ›´æ–°è·¯å¾„</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">updatePathLayout</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">float</span> progress = mProgessInterpolator.getInterpolation(mProgress);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//è·å–æ‰€æœ‰çš„å¯ç»˜åˆ¶çš„å®½/é«˜  æ­¤å€¼ä¼šæ ¹æ®progressä¸æ–­çš„å˜åŒ–</span></span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">float</span> w = getValueByLine(getWidth(), mTargetWidth, mProgress);</span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">float</span> h = getValueByLine(<span class="number">0</span>, mDargHeight, mProgress);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//åœ†å¿ƒXåæ ‡</span></span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">float</span> cPointX = w / <span class="number">2</span>;</span><br><span class="line">        <span class="comment">//åŠå¾„</span></span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">float</span> cRadius = mCircleRadius;</span><br><span class="line">        <span class="comment">//åœ†å¿ƒYåæ ‡</span></span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">float</span> cPaintY = h - cRadius;</span><br><span class="line">        <span class="comment">//æ§åˆ¶ç‚¹ç»“æŸYçš„å€¼</span></span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">float</span> endPointY = mTargetGravityHeight;</span><br><span class="line">        <span class="comment">//æ›´æ–°åœ†å¿ƒåæ ‡</span></span><br><span class="line">        mCirclePointX = cPointX;</span><br><span class="line">        mCirclePointY = cPaintY;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">final</span> Path path = mPath;</span><br><span class="line">        path.reset(); <span class="comment">//é‡ç½®</span></span><br><span class="line">        path.moveTo(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//åæ ‡ç³»æ˜¯ä»¥æœ€å·¦è¾¹çš„èµ·å§‹ç‚¹ä¸ºåŸç‚¹</span></span><br><span class="line">        <span class="keyword">float</span> lEndPointX, lEndPointY; <span class="comment">//ç»“æŸç‚¹çš„X,Yåæ ‡</span></span><br><span class="line">        <span class="keyword">float</span> lControlPointX, lControlPointY; <span class="comment">//æ§åˆ¶ç‚¹çš„Xï¼ŒYåæ ‡</span></span><br><span class="line">        <span class="comment">//è·å–å½“å‰åˆ‡çº¿çš„å¼§åº¦</span></span><br><span class="line">        <span class="keyword">double</span> angle = mTanentAngleInterpolator.getInterpolation(progress) * mTargetAngle;<span class="comment">//è·å–å½“å‰çš„è§’åº¦</span></span><br><span class="line">        <span class="keyword">double</span> radian = Math.toRadians(angle); <span class="comment">//è·å–å½“å‰å¼§åº¦</span></span><br><span class="line">        <span class="keyword">float</span> x = (<span class="keyword">float</span>) (Math.sin(radian) * cRadius);  <span class="comment">//æ±‚å‡ºâ€œè‚¡â€çš„é•¿åº¦ï¼ˆé•¿çš„é‚£æ¡ç›´è§’è¾¹ï¼‰</span></span><br><span class="line">        <span class="keyword">float</span> y = (<span class="keyword">float</span>) (Math.cos(radian) * cRadius);  <span class="comment">//æ±‚å‡ºâ€œå‹¾â€çš„é•¿åº¦ï¼ˆçŸ­çš„é‚£æ¡ç›´è§’è¾¹ï¼‰</span></span><br><span class="line">        lEndPointX = cPointX - x; <span class="comment">//ä»¥èµ·å§‹ç‚¹ä¸ºåŸç‚¹ï¼Œxåæ ‡å°±ç­‰äºåœ†çš„Xåæ ‡å‡å»è‚¡çš„é•¿åº¦</span></span><br><span class="line">        lEndPointY = cPaintY + y; <span class="comment">//ä»¥èµ·å§‹ç‚¹ä¸ºåŸç‚¹ï¼Œyåæ ‡å°±ç­‰äºåœ†çš„yåæ ‡åŠ ä¸Šå‹¾çš„é•¿åº¦</span></span><br><span class="line">        lControlPointY = getValueByLine(<span class="number">0</span>, endPointY, progress);<span class="comment">//è·å–æ§åˆ¶ç‚¹çš„Yåæ ‡</span></span><br><span class="line">        <span class="keyword">float</span> tHeight = lEndPointY - lControlPointY; <span class="comment">//ç»“æŸç‚¹ä¸æ§åˆ¶ç‚¹çš„Yåæ ‡å·®å€¼</span></span><br><span class="line">        <span class="keyword">float</span> tWidth = (<span class="keyword">float</span>) (tHeight / Math.tan(radian));  <span class="comment">//é€šè¿‡è®¡ç®—ä¸¤ä¸ªè§’åº¦æ˜¯ç›¸ç­‰çš„ï¼Œå› æ­¤å¼§åº¦ä¾æ—§é€‚ç”¨</span></span><br><span class="line">        lControlPointX = lEndPointX - tWidth; <span class="comment">//ç»“æŸç‚¹çš„x - â€˜å‹¾â€™ çš„é•¿åº¦æ±‚å‡ºäº†æ§åˆ¶ç‚¹çš„Xåæ ‡</span></span><br><span class="line"></span><br><span class="line">        path.quadTo(lControlPointX, lControlPointY, lEndPointX, lEndPointY); <span class="comment">//ç”»å·¦è¾¹è´å¡å°”æ›²çº¿</span></span><br><span class="line">        path.lineTo(cPointX + (cPointX - lEndPointX), lEndPointY); <span class="comment">//å·¦å³ä¸¤ä¸ªç»“æŸç‚¹ç›¸è¿</span></span><br><span class="line">        path.quadTo(cPointX + (cPointX - lControlPointX), lControlPointY, w, <span class="number">0</span>); <span class="comment">//ç”»å³è¾¹è´å¡å°”æ›²çº¿</span></span><br><span class="line"></span><br><span class="line">        updateContentLayout(cPointX, cPaintY, cRadius);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æµ‹é‡å¹¶è®¾ç½®ä¸­å¿ƒDrawable</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> cx</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> cy</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> radius</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">updateContentLayout</span><span class="params">(<span class="keyword">float</span> cx, <span class="keyword">float</span> cy, <span class="keyword">float</span> radius)</span> </span>&#123;</span><br><span class="line">        Drawable drawable = content;</span><br><span class="line">        <span class="keyword">if</span> (drawable != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">int</span> margin = mContentDrawableMargin;</span><br><span class="line">            <span class="keyword">int</span> l = (<span class="keyword">int</span>) (cx - radius + margin);</span><br><span class="line">            <span class="keyword">int</span> r = (<span class="keyword">int</span>) (cx + radius - margin);</span><br><span class="line">            <span class="keyword">int</span> t = (<span class="keyword">int</span>) (cy - radius + margin);</span><br><span class="line">            <span class="keyword">int</span> b = (<span class="keyword">int</span>) (cy + radius - margin);</span><br><span class="line">            drawable.setBounds(l, t, r, b);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<p>å…¶ä¸­æ¯ä¸€è¡Œæˆ‘éƒ½å¤‡æ³¨äº†æ³¨é‡Šï¼Œè¦ç†è§£å…¶ä¸­çš„è®¡ç®—ï¼Œå°±å¾—å…ˆä¸Šä¸ªå›¾ï¼š</p>
<p><img src="http://p07lh1fh6.bkt.clouddn.com/touchpullview.jpg-sy" alt=""></p>
<p>æˆ‘ä»¬è„‘æµ·ä¸­è¦æœ‰ä¸€ä¸ªæ¸…æ™°çš„å®šä¹‰ï¼Œæ•´ä¸ªåæ ‡ç³»æ˜¯åŸºäºèµ·å§‹ç‚¹ä¸ºåŸç‚¹ï¼Œå‘å³ä¸‹å»¶ä¼¸Xï¼ŒYè½´ï¼Œå·¦å³çš„è´å¡å°”æ›²çº¿æ˜¯ç”±ä¸€æ”¯ç”»ç¬”å®Œæˆ,é€šè¿‡lineToç›¸è¿æ¥ï¼Œå› æ­¤æ•´ä¸ªæ›²çº¿å‘ˆVå­—å½¢ã€‚<br>æ¥ä¸‹æ¥çœ‹ä»£ç ï¼š<br>é¦–å…ˆæ±‚å¾—äº†progressï¼Œè¿™ä¸ªæ— éœ€è§£é‡Šï¼Œä½¿ç”¨åŠ é€Ÿå™¨åªæ˜¯ä¸ºäº†æ›´å¥½çš„æ•ˆæœã€‚<br>æ¥ä¸‹æ¥æ˜¯wå’Œh,è¿™æ˜¯æ§ä»¶çš„æŸä¸€è¿›åº¦ä¸‹çš„å®½å’Œé«˜ï¼Œä¸ºä»€ä¹ˆé€šè¿‡getValueByLineæ–¹æ³•å°±èƒ½å¾—åˆ°å‘¢ï¼Ÿè¯·çœ‹è¾“å…¥çš„å‚æ•°ï¼Œèµ·å§‹ç‚¹æ˜¯getWidthï¼Œä¹Ÿå°±æ˜¯æ•´ä¸ªå±å¹•çš„å®½åº¦ï¼Œç»ˆç‚¹æ˜¯mTargetWidthä¹Ÿå°±æ˜¯æˆ‘ä»¬è§„å®šçš„æœ€å°å®½åº¦ï¼Œè€ŒgetValueByLineæ­£å¥½æ˜¯æ±‚å¾—æŸä¸€æ—¶åˆ»çš„è´å¡å°”å€¼ï¼Œå› æ­¤å°†progressè¾“å…¥æ­£å¥½æ±‚å¾—ä»æ•´ä¸ªå±å¹•è¿åŠ¨åˆ°æœ€å°å®½åº¦ä¹‹é—´çš„æŸä¸€ä¸ªå®½åº¦ï¼Œé«˜åº¦åŒç†ã€‚<br>å®½é«˜æ±‚å‡ºæ¥äº†é‚£ä¸ªåœ†å¿ƒçš„åæ ‡ä¹Ÿå°±ç›¸åº”å‡ºæ¥äº†ï¼Œæ³¨æ„æ•´ä¸ªåœ†çš„å¤§å°åŒ…å«marginå€¼ï¼Œä¹Ÿå°±æ˜¯åœ†ä¸å·¦å³ä¸¤è¾¹çš„è¾¹è·ä¹Ÿæ˜¯åŒ…å«çš„ã€‚å› ä¸ºmTargetGravityHeightæ˜¯æˆ‘ä»¬è®¾å®šçš„æ§åˆ¶ç‚¹ä¸‹ç§»çš„é«˜åº¦ï¼Œå› æ­¤ä¹Ÿå°±æ˜¯æ§åˆ¶ç‚¹Yçš„åæ ‡ã€‚<br>å› ä¸ºquadToæ–¹æ³•éœ€è¦æ§åˆ¶ç‚¹çš„åæ ‡å’Œç»“æŸç‚¹çš„åæ ‡ï¼Œå› æ­¤æ±‚å‡ºè¿™ä¸¤ä¸ªç‚¹çš„åæ ‡å°±å¤§åŠŸå‘Šæˆäº†ï¼Œæ¥ä¸‹æ¥å°±æ˜¯æ•°å­¦çŸ¥è¯†äº†ã€‚<br>é¦–å…ˆï¼Œé€šè¿‡æ’å€¼å™¨çš„æ–¹æ³•è·å¾—äº†æŸä¸€æ—¶åˆ»çš„è§’åº¦ï¼Œæœ€åé€šè¿‡Mathæ–¹æ³•å¾—åˆ°äº†å¼§åº¦,ä¹Ÿå°±æ˜¯å›¾ä¸­bçš„è§’åº¦ï¼ŒåŠå¾„æˆ‘ä»¬æ˜¯çŸ¥é“çš„ï¼Œæ‰€ä»¥é€šè¿‡sinå¯ä»¥å¾—å‡ºå›¾ä¸­xçš„é•¿åº¦ï¼Œç„¶åé€šè¿‡åŠå¾„çš„xåæ ‡å‡å»xçš„é•¿åº¦å°±å¾—åˆ°äº†ç»“æŸç‚¹çš„xåæ ‡ã€‚<br>é€šè¿‡cosæˆ‘ä»¬å¯ä»¥å¾—åˆ°yçš„é•¿åº¦,åœ†å¿ƒYçš„åæ ‡åŠ ä¸Šyçš„åæ ‡å°±å¾—åˆ°äº†ç»“æŸç‚¹yçš„åæ ‡ï¼ŒlEndPointXï¼ŒlEndPointYçš„å€¼ä¹Ÿå°±å¾—åˆ°äº†ã€‚<br>å› ä¸ºæˆ‘ä»¬å·²çŸ¥æ§åˆ¶ç‚¹ä¸Šä¸‹è¿è¡Œçš„èµ·å§‹å€¼å’Œæœ€å¤§å€¼ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥ä½¿ç”¨getValueByLineè·å–åˆ°å½“å‰çš„yåæ ‡ï¼Œæ¥ä¸‹æ¥åªéœ€è¦æ±‚å‡ºæ§åˆ¶ç‚¹çš„xåæ ‡å°±è¡Œäº†,tHeightè¡¨ç¤ºå·¦è¾¹è¿™æ¡ç›´è§’çš„é•¿ç›´è§’è¾¹ï¼Œç»“æŸç‚¹çš„yåæ ‡å·²çŸ¥ï¼Œæ§åˆ¶ç‚¹çš„yåæ ‡å·²çŸ¥ï¼Œå› æ­¤å¯ä»¥æ±‚å‡ºtHeightã€‚<br>å› ä¸ºå¹³è¡Œçº¿é—´çš„è§’åº¦ç›¸ç­‰ï¼Œå› æ­¤a = cï¼Œåˆå› ä¸ºc+d = e+d = 90; æ‰€ä»¥c = eï¼›æ‰€ä»¥a = e;tHeightå·²çŸ¥ï¼Œeå·²çŸ¥ï¼Œæ‰€ä»¥tWidthçš„å€¼å°±èƒ½æ±‚å‡ºæ¥äº†ã€‚æ‰€ä»¥æ§åˆ¶ç‚¹çš„xåæ ‡å°±ç­‰äºç»“æŸç‚¹çš„xåæ ‡å‡å»tWidthã€‚è‡³æ­¤æ‰€æœ‰çš„åæ ‡éƒ½å·²ç»æ±‚å‡ºæ¥äº†ï¼Œæ‰€ä»¥è´å¡å°”æ›²çº¿ä¹Ÿå°±èƒ½ç»˜åˆ¶å‡ºæ¥äº†ã€‚</p>
<p>æ¥ä¸‹æ¥è¿˜æœ‰ä¸ªæµ‹é‡çš„è¿‡ç¨‹ï¼Œé€»è¾‘æ¯”è¾ƒç®€å•ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onMeasure</span><span class="params">(<span class="keyword">int</span> widthMeasureSpec, <span class="keyword">int</span> heightMeasureSpec)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">int</span> MIN_W = (<span class="keyword">int</span>) (mCircleRadius * <span class="number">2</span> + getPaddingLeft() + getPaddingRight()); <span class="comment">//éœ€è¦çš„æœ€å°å®½åº¦</span></span><br><span class="line">       <span class="keyword">int</span> MIN_H = (<span class="keyword">int</span>) ((mDargHeight * mProgress + <span class="number">0.5f</span>)  <span class="comment">//mDargHeight * mProgress = moveSize(å³actionMove.getY - actionDown.getY),+0.5fä¸ºå››èˆäº”å…¥</span></span><br><span class="line">               + getPaddingBottom() + getPaddingTop());</span><br><span class="line">       <span class="keyword">int</span> widthMeasure = getMeasureSize(widthMeasureSpec, MIN_W);</span><br><span class="line">       <span class="keyword">int</span> heightMeasure = getMeasureSize(heightMeasureSpec, MIN_H);</span><br><span class="line">       setMeasuredDimension(widthMeasure, heightMeasure);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * è·å–æ‰€éœ€è¦çš„å®½/é«˜çš„æµ‹é‡ç»“æœ</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> Spec     æµ‹é‡æ¨¡å¼</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> minValue è§„å®šçš„æœ€å°å€¼</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span> æµ‹é‡ç»“æœ</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">getMeasureSize</span><span class="params">(<span class="keyword">int</span> Spec, <span class="keyword">int</span> minValue)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">int</span> result;</span><br><span class="line">       <span class="keyword">int</span> mode = MeasureSpec.getMode(Spec);</span><br><span class="line">       <span class="keyword">int</span> size = MeasureSpec.getSize(Spec);</span><br><span class="line">       <span class="keyword">switch</span> (mode) &#123;</span><br><span class="line">           <span class="keyword">case</span> MeasureSpec.AT_MOST: <span class="comment">//wrap_content</span></span><br><span class="line">               result = Math.min(size, minValue); <span class="comment">//å–æµ‹é‡å€¼å’Œè§„å®šçš„æœ€å°å®½åº¦ä¸­çš„æœ€å°å€¼</span></span><br><span class="line">               <span class="keyword">break</span>;</span><br><span class="line">           <span class="keyword">case</span> MeasureSpec.EXACTLY: <span class="comment">//match_parent or exactly num</span></span><br><span class="line">               result = size;</span><br><span class="line">               <span class="keyword">break</span>;</span><br><span class="line">           <span class="keyword">default</span>: <span class="comment">//å…¶ä½™æƒ…å†µå–æœ€å°å€¼</span></span><br><span class="line">               result = minValue;</span><br><span class="line">               <span class="keyword">break</span>;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">return</span> result;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure></p>
<p>æˆ‘å°†è§†é¢‘ä¸­çš„ä»£ç åšäº†ä¸€ä¸‹ç®€å•çš„å°è£…ï¼Œä»£ç ä¸­æœ‰è¯¦ç»†çš„æ³¨é‡Šï¼Œæˆ‘è¿™é‡Œå°±ä¸åšåˆ†æäº†ã€‚</p>
<p>æ•´ä¸ªåˆ†ææµç¨‹å°±åˆ°è¿™ï¼Œå¦‚æœæœ‰é”™è¯¯çš„åœ°æ–¹ï¼Œæ¬¢è¿æŒ‡æ­£ï¼ŒThanks~</p>
]]></content>
      
        <categories>
            
            <category> AndroidåŸºç¡€è¿›é˜¶ </category>
            
            <category> å®‰å“ç‰¹æ•ˆåˆé›†è§£æ </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Android </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[å®‰å“Viewä½“ç³»-Viewçš„å·¥ä½œæµç¨‹]]></title>
      <url>/%E5%AE%89%E5%8D%93View%E4%BD%93%E7%B3%BB-View%E7%9A%84%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B.html</url>
      <content type="html"><![CDATA[<blockquote>
<p>è‡ªå®šä¹‰Viewä¸‰éƒ¨æ›²ï¼šonMeasure â€“&gt; onLayout â€“&gt;onDraw,æœ¬æ–‡ç€é‡è§£æå‰ä¸¤ä¸ªæ–¹æ³•</p>
</blockquote>
<h4 id="onMeasure"><a href="#onMeasure" class="headerlink" title="onMeasure"></a>onMeasure</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onMeasure</span><span class="params">(<span class="keyword">int</span> widthMeasureSpec, <span class="keyword">int</span> heightMeasureSpec)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onMeasure(widthMeasureSpec, heightMeasureSpec);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>æåˆ°è¿™ä¸ªæ–¹æ³•ï¼Œå°±å¿…é¡»å…ˆäº†è§£MeasureSpecè¿™ä¸ªç±»ï¼Œå®ƒæœ‰ä¸€ä¸ªgetModeå’ŒgetSizeæ–¹æ³•ï¼Œç”¨äºè·å–SpecModeå’ŒSpecSize,é‚£ä¹ˆè¿™ä¸¤ä¸ªå‚æ•°åˆæ˜¯ä½•ç‰©å‘¢ï¼Ÿ<br>è¯·çœ‹ä»¥ä¸‹ä¸€èˆ¬è‡ªå®šä¹‰Viewçš„å®Œæ•´å®ç°ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onMeasure</span><span class="params">(<span class="keyword">int</span> widthMeasureSpec, <span class="keyword">int</span> heightMeasureSpec)</span> </span>&#123;</span><br><span class="line">          setMeasuredDimension(getDefaultSize(getSuggestedMinimumWidth(),widthMeasureSpec),getDefaultSize(getSuggestedMinimumHeight(),heightMeasureSpec));</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">getDefaultSize</span><span class="params">(<span class="keyword">int</span> size,<span class="keyword">int</span> measureSpec)</span></span>&#123;</span><br><span class="line">       <span class="keyword">int</span> result = size;</span><br><span class="line">       <span class="keyword">int</span> SpecMode = MeasureSpec.getMode(measureSpec);</span><br><span class="line">       <span class="keyword">int</span> SpecSize = MeasureSpec.getSize(measureSpec);</span><br><span class="line">       <span class="keyword">switch</span> (SpecMode)&#123;</span><br><span class="line">           <span class="keyword">case</span> MeasureSpec.UNSPECIFIED:</span><br><span class="line">               result = size;</span><br><span class="line">               <span class="keyword">break</span>;</span><br><span class="line">               <span class="keyword">case</span> MeasureSpec.AT_MOST:</span><br><span class="line">                   <span class="keyword">case</span> MeasureSpec.EXACTLY:</span><br><span class="line">                       result = SpecSize;</span><br><span class="line">                       <span class="keyword">break</span>;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">return</span> result;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure></p>
<p>å¯ä»¥çœ‹åˆ°ï¼ŒSpecModeæ˜¯æŒ‡æµ‹é‡çš„æ¨¡å¼ï¼Œå®ƒæœ‰ä¸‰ç§æ¨¡å¼ï¼š</p>
<p><strong>UNSPECIFIED</strong><br>ä»£è¡¨çˆ¶å®¹å™¨ä¸å¯¹Viewæœ‰ä»»ä½•çš„å¤§å°é™åˆ¶ï¼Œä¸€èˆ¬ç”¨äºç³»ç»Ÿçš„å†…éƒ¨ï¼Œå¾ˆå°‘ç”¨åˆ°</p>
<p><strong>AT_MOST</strong><br>ä»£è¡¨çˆ¶å®¹å™¨æŒ‡å®šäº†ä¸€ä¸ªå¤§å°å³SpecSize,Viewçš„å¤§å°ä¸èƒ½å¤§äºè¿™ä¸ªå€¼ï¼Œå®ƒå¯¹åº”äºLayoutParamsä¸­çš„wrap_contentï¼Œç»“åˆå®ƒä½ å°±å¾ˆå¥½ç†è§£äº†</p>
<p><strong>EXACTLY</strong><br>çˆ¶å®¹å™¨å·²ç»æ£€æµ‹åˆ°äº†viewæ‰€éœ€çš„ç²¾ç¡®å¤§å°ï¼Œè¿™æ—¶çš„viewçš„æœ€ç»ˆå¤§å°å°±æ˜¯SpecSizeä¸­çš„å€¼ï¼Œå®ƒå¯¹åº”äºLayoutParamä¸­çš„match_parentæˆ–è€…å…·ä½“çš„æ•°å€¼</p>
<p>è€ŒSpecSizeæ˜¯æŒ‡æŸç§æ¨¡å¼ä¸‹çš„è§„æ ¼å¤§å°ã€‚</p>
<p>å› æ­¤ï¼Œç»“åˆæ­¤æ–¹æ³•ï¼Œå½“viewçš„å¤§å°æ˜¯wrap_contentæˆ–è€…æ˜¯match_parentæˆ–è€…æ˜¯å…·ä½“çš„æ•°å€¼æ—¶ï¼Œéƒ½æ˜¯ä½¿ç”¨çš„çˆ¶å®¹å™¨ç»™å­viewæµ‹é‡çš„specsizeçš„å€¼ï¼Œå½“çˆ¶å®¹å™¨å¯¹å­viewæ²¡æœ‰ä»»ä½•çº¦æŸæ—¶ï¼Œç»™viewä¸€ä¸ªæ‰€è§„å®šçš„æœ€å°å€¼ï¼ˆgetSuggestedMinimumâ€¦æ–¹æ³•è·å–ï¼‰,setMeasuredDimensionå°±æ˜¯ç”¨æ¥è®¾ç½®viewçš„æµ‹é‡å¤§å°çš„ã€‚MeasureSpecç±»çš„å€¼çš„è·å–æ˜¯ç”±çˆ¶å®¹å™¨çš„MeasureSpecå’Œè‡ªèº«çš„LayoutParamsæ¥å…±åŒç¡®å®šçš„ï¼ŒMeasureSpecä¸€æ—¦ç¡®å®šï¼ŒonMeasureä¸­å°±å¯ä»¥ç¡®å®šviewçš„æµ‹é‡å®½é«˜äº†ã€‚</p>
<p>è¿™é‡Œå†æ¥è®²è§£ä¸€ä¸‹getSuggestedMinimumWidthè¿™ç±»æ–¹æ³•ï¼Œå®ƒçš„é€»è¾‘æ˜¯è¿™æ ·çš„ï¼š<br>å¦‚æœViewæ²¡æœ‰è®¾ç½®èƒŒæ™¯ï¼Œé‚£ä¹ˆå®ƒä¼šè¿”å›minWidthè®¾ç½®çš„å€¼ï¼Œå¯ä»¥ä¸º0ï¼Œå¦‚æœviewè®¾ç½®äº†èƒŒæ™¯ï¼Œé‚£ä¹ˆå®ƒä¼šè¿”å›minWidthå’ŒèƒŒæ™¯æœ€å°å®½åº¦çš„ä¸¤è€…ä¹‹é—´çš„æœ€å¤§å€¼ã€‚</p>
<p>ä¸€èˆ¬çš„è‡ªå®šä¹‰Viewæˆ‘ä»¬ä¸»è¦æ˜¯ç€é‡å¤„ç†AT_MOSTæ¨¡å¼çš„å€¼ï¼Œéœ€è¦æ ¹æ®å®é™…çš„æƒ…å†µæ¥ï¼Œæ²¡æœ‰å›ºå®šçš„ä¾æ®ï¼Œæœ‰å…´è¶£çš„å¯ä»¥çœ‹ä¸‹TextViewç­‰æ§ä»¶çš„æºç æ˜¯æ€ä¹ˆå¤„ç†çš„ã€‚</p>
<p><strong>Activityä¸­Viewçš„å®½/é«˜è·å–</strong><br>é€šè¿‡ä»¥ä¸Šåˆ†æè¯»è€…å·²ç»çŸ¥é“Viewçš„å®½é«˜æ˜¯éœ€è¦çˆ¶å®¹å™¨å»æµ‹é‡çš„ï¼Œå› æ­¤æˆ‘ä»¬å¦‚æœåœ¨onCreateæˆ–è€…onStaræ–¹æ³•ä¸­å»è·å–Viewçš„å®½é«˜å‘ç°å¹¶ä¸èƒ½ä¿è¯ç™¾åˆ†ç™¾è·å–åˆ°ï¼Œé‚£ä¹ˆæœ‰ä»€ä¹ˆæ–¹æ³•èƒ½è§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Œä»¥ä¸‹æœ‰4ä¸ªæ–¹æ³•èƒ½è§£å†³è¿™ä¸ªé—®é¢˜ï¼š</p>
<p><strong>1.onWindowFocusChanged</strong><br>å½“Activityçš„çª—å£å¾—åˆ°ç„¦ç‚¹æˆ–å¤±å»ç„¦ç‚¹éƒ½ä¼šè¢«è°ƒç”¨ä¸€æ¬¡,å¹¶ä¸”æ­¤æ—¶Viewå·²ç»åˆå§‹åŒ–å®Œæ¯•ï¼Œå› æ­¤æ­¤æ—¶å»è·å–Viewçš„å®½é«˜æ˜¯æ²¡é—®é¢˜çš„<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onWindowFocusChanged</span><span class="params">(<span class="keyword">boolean</span> hasFocus)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">super</span>.onWindowFocusChanged(hasFocus);</span><br><span class="line">       <span class="keyword">if</span> (hasFocus)&#123;</span><br><span class="line">           <span class="keyword">int</span> width = view.getMeasuredWidth();</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure></p>
<p><strong>2.view.post(runnable)</strong><br>é€šè¿‡postå¯ä»¥å°†ä¸€ä¸ªrunnableæŠ•é€’åˆ°æ¶ˆæ¯é˜Ÿåˆ—çš„å°¾éƒ¨ï¼Œç„¶åç­‰å¾…Looperè°ƒç”¨æ­¤runnableçš„æ—¶å€™ï¼Œviewæ­¤æ—¶ä¹Ÿå·²ç»åˆå§‹åŒ–å¥½äº†ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">view.post(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">           <span class="meta">@Override</span></span><br><span class="line">           <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">               <span class="keyword">int</span> width = view.getMeasuredWidth();    </span><br><span class="line">           &#125;</span><br><span class="line">       &#125;);</span><br></pre></td></tr></table></figure></p>
<p><strong>3.ViewTreeObserver</strong><br>ä½¿ç”¨ViewTreeObserverè¿™ä¸ªç±»çš„å›è°ƒå¯ä»¥å®Œæˆï¼Œæ¯”å¦‚OnGlobalLayoutListenerï¼Œå½“Viewæ ‘çš„çŠ¶æ€æ”¹å˜æˆ–è€…å†…éƒ¨viewçš„å¯è§æ€§å‘ç”Ÿæ”¹å˜æ—¶ï¼Œè¯¥æ¥å£ä¼šè¢«å›è°ƒï¼Œæ³¨æ„ï¼Œæ­¤æ¥å£ä¼šå›è°ƒå¤šæ¬¡ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> ViewTreeObserver viewTreeObserver = view.getViewTreeObserver();</span><br><span class="line">       viewTreeObserver.addOnGlobalLayoutListener(<span class="keyword">new</span> ViewTreeObserver.OnGlobalLayoutListener() &#123;</span><br><span class="line">           <span class="meta">@Override</span></span><br><span class="line">           <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onGlobalLayout</span><span class="params">()</span> </span>&#123;</span><br><span class="line">               view.getViewTreeObserver().removeOnGlobalLayoutListener(<span class="keyword">this</span>);</span><br><span class="line">               <span class="keyword">int</span> width = view.getMeasuredWidth();</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;);</span><br></pre></td></tr></table></figure></p>
<p><strong>4.view.measure(int widthMeasureSpec, int heightMeasureSpec)</strong><br>æ‰‹åŠ¨å¯¹viewè¿›è¡Œæµ‹é‡æ¥å¾—å‡ºviewçš„å®½é«˜ï¼Œè¿™ç§å®ç°æ¯”è¾ƒçš„å¤æ‚ï¼Œéœ€è¦çœ‹viewçš„LayoutParamï¼š</p>
<p><em>match_parent</em><br>æ— æ³•å¾—å‡ºViewçš„å®½/é«˜ï¼Œå› ä¸ºæ­¤ç§æƒ…å†µéœ€è¦è·å–åˆ°çˆ¶å®¹å™¨çš„å‰©ä½™ç©ºé—´ï¼Œè€Œæ­¤æ—¶æˆ‘ä»¬æ˜¯è·å–ä¸åˆ°çš„</p>
<p><em>å…·ä½“çš„æ•°å€¼</em><br>æ¯”å¦‚å®½/é«˜éƒ½æ˜¯50px,é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥è¿™æ ·å†™æ¥è·å–ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> widthMeasureSpec = View.MeasureSpec.makeMeasureSpec(<span class="number">100</span>, View.MeasureSpec.EXACTLY);</span><br><span class="line"><span class="keyword">int</span> heightMeasureSpec = View.MeasureSpec.makeMeasureSpec(<span class="number">100</span>,View.MeasureSpec.EXACTLY);</span><br><span class="line">view.measure(widthMeasureSpec,heightMeasureSpec);</span><br></pre></td></tr></table></figure></p>
<p><em>wrap_content</em><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">int</span> widthMeasureSpec = View.MeasureSpec.makeMeasureSpec((<span class="number">1</span>&lt;&lt;<span class="number">30</span>)-<span class="number">1</span>, View.MeasureSpec.AT_MOST);</span><br><span class="line"><span class="keyword">int</span> heightMeasureSpec = View.MeasureSpec.makeMeasureSpec((<span class="number">1</span>&lt;&lt;<span class="number">30</span>)-<span class="number">1</span>,View.MeasureSpec.AT_MOST);        </span><br><span class="line">view.measure(widthMeasureSpec,heightMeasureSpec);</span><br></pre></td></tr></table></figure></p>
<p>æ³¨æ„(1&lt;&lt;30)-1è¿™ä¸ªå€¼ï¼Œé€šè¿‡æŸ¥çœ‹æºç å¯ä»¥çŸ¥é“Viewçš„å°ºå¯¸æ˜¯ä½¿ç”¨çš„30ä½äºŒè¿›åˆ¶è¡¨ç¤ºï¼Œæ‰€ä»¥æœ€å¤§å€¼æ˜¯30ä¸ª1ï¼ˆ2^30-1ï¼‰ï¼Œä¹Ÿå°±ç­‰äºï¼ˆ1&lt;&lt;30ï¼‰-1ï¼Œæ‰€ä»¥ç»™å‡ºè¿™ä¸ªæ•°å€¼æ˜¯åˆç†çš„ã€‚</p>
<h4 id="onLayout"><a href="#onLayout" class="headerlink" title="onLayout"></a>onLayout</h4><p>onLayoutæ–¹æ³•æ˜¯ViewGroupç”¨æ¥ç»™å­å…ƒç´ ç¡®å®šä½ç½®çš„ï¼Œç›¸æ¯”å¦‚onMeasureæ–¹æ³•ï¼ŒonLayoutåˆ™ç®€å•å¤šäº†ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onLayout</span><span class="params">(<span class="keyword">boolean</span> changed, <span class="keyword">int</span> left, <span class="keyword">int</span> top, <span class="keyword">int</span> right, <span class="keyword">int</span> bottom)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">super</span>.onLayout(changed, left, top, right, bottom);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure></p>
<p>åå››ä¸ªå‚æ•°åˆ†åˆ«ä»£è¡¨å·¦ï¼Œä¸Šï¼Œå³ï¼Œä¸‹ï¼Œåªéœ€è¿”å›ä¸åŒçš„åæ ‡å³å¯ç¡®å®šViewçš„ä½ç½®ã€‚</p>
]]></content>
      
        <categories>
            
            <category> AndroidåŸºç¡€è¿›é˜¶ </category>
            
            <category> å®‰å“Viewä½“ç³» </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Android </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[å®‰å“Viewä½“ç³»:Viewçš„ä¸€äº›åŸºæœ¬çŸ¥è¯†ç‚¹]]></title>
      <url>/%E5%AE%89%E5%8D%93View%E4%BD%93%E7%B3%BB-View%E7%9A%84%E4%B8%80%E4%BA%9B%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AF%86%E7%82%B9.html</url>
      <content type="html"><![CDATA[<blockquote>
<p>å®‰å“å¼€å‘ä¸­ç†Ÿç»ƒä½¿ç”¨è‡ªå®šä¹‰Viewæ˜¯å¼€å‘è€…å¿…å¤‡çš„æŠ€èƒ½ï¼Œå› ä¸ºå®‰å“åŸç”Ÿæ§ä»¶å¾ˆå¤šæ—¶å€™æ˜¯ä¸èƒ½æ»¡è¶³éœ€æ±‚çš„ï¼Œè€Œè‡ªå®šä¹‰æ§ä»¶èƒ½åšå‡ºå„ç§ç»šä¸½çš„æ•ˆæœ,ç”¨äºæ»¡è¶³äº§å“å„ç§å¥‡æ€ªçš„éœ€æ±‚(æˆ‘ä¸ºä»€ä¹ˆè¦ç”¨å¥‡æ€ªå‘¢ï¼Œå“ˆå“ˆå“ˆå“ˆ)ã€‚</p>
</blockquote>
<h4 id="è‡ªå®šä¹‰Viewè¦æŒæ¡çš„å†…å®¹"><a href="#è‡ªå®šä¹‰Viewè¦æŒæ¡çš„å†…å®¹" class="headerlink" title="è‡ªå®šä¹‰Viewè¦æŒæ¡çš„å†…å®¹"></a>è‡ªå®šä¹‰Viewè¦æŒæ¡çš„å†…å®¹</h4><p>è‡ªå®šä¹‰Viewä¸»è¦æ˜¯æŒæ¡ä»¥ä¸‹äº”ä¸ªå†…å®¹ï¼š</p>
<ul>
<li>ç»˜åˆ¶åŸç†: æŒæ¡onMeasure,onLayout,onDrawåŠç›¸å…³ç±»çš„ä½¿ç”¨ã€‚</li>
<li>äº‹ä»¶ä¼ é€’ï¼šæŒæ¡dispathTouchEvent(),onInterceptEvent(),onTouchEvent()ä¸‰è€…çš„ä¼ é€’é€»è¾‘.</li>
<li>åŠ¨ç”»ï¼šå±æ€§åŠ¨ç”»ï¼Œç”¨äºå¯¹Viewè¿›è¡ŒåŠ¨ç”»æ“ä½œ</li>
<li>ç›¸å…³æ‰‹åŠ¿ï¼šGestureDetectorï¼ŒVelocityTrackerç­‰ç±»çš„åº”ç”¨</li>
<li>æ»‘åŠ¨ï¼šæ»‘åŠ¨çš„ä¸‰ç§å®ç°æ–¹æ³•ï¼ŒScrollerçš„è¿ç”¨</li>
</ul>
<h4 id="è‡ªå®šä¹‰Viewçš„åŸºæœ¬çŸ¥è¯†"><a href="#è‡ªå®šä¹‰Viewçš„åŸºæœ¬çŸ¥è¯†" class="headerlink" title="è‡ªå®šä¹‰Viewçš„åŸºæœ¬çŸ¥è¯†"></a>è‡ªå®šä¹‰Viewçš„åŸºæœ¬çŸ¥è¯†</h4><h5 id="è‡ªå®šä¹‰Viewçš„åˆ†ç±»"><a href="#è‡ªå®šä¹‰Viewçš„åˆ†ç±»" class="headerlink" title="è‡ªå®šä¹‰Viewçš„åˆ†ç±»"></a>è‡ªå®šä¹‰Viewçš„åˆ†ç±»</h5><p><strong>1. ç›´æ¥ç»§æ‰¿View</strong><br>ä¸»è¦ç”¨äºå®ç°ä¸€äº›ä¸è§„åˆ™çš„æ•ˆæœï¼Œä¸èƒ½é€šè¿‡ç°æœ‰æ§ä»¶æ‰©å±•çš„ä¸€äº›æ•ˆæœ</p>
<p><strong>2. ç»§æ‰¿è‡ªviewGroup</strong><br>ä¸»è¦æ˜¯ä¸ºäº†å®ç°è‡ªå®šä¹‰çš„å¸ƒå±€ï¼Œè¿™ä¸ªå¸ƒå±€é‡ŒåŒ…å«äº†ä¸€äº›ç‰¹å®šçš„æ§ä»¶ï¼Œå¾ˆåƒå‡ ä¸ªviewç»„åˆåœ¨ä¸€èµ·</p>
<p><strong>3.ç»§æ‰¿ç‰¹å®šçš„view</strong><br>ä¸»è¦æ˜¯ä¸ºäº†æ‰©å±•å·²æœ‰viewçš„åŠŸèƒ½ï¼Œæ¯”å¦‚TextViewç­‰</p>
<p><strong>4.ç»§æ‰¿ç‰¹å®šçš„ViewGroup</strong><br>ä¸ºäº†æ‰©å±•ç‰¹å®šçš„å¸ƒå±€ï¼Œæ¯”å¦‚LinearLayout</p>
<h5 id="è‡ªå®šä¹‰æ§ä»¶çš„æ„é€ å‡½æ•°"><a href="#è‡ªå®šä¹‰æ§ä»¶çš„æ„é€ å‡½æ•°" class="headerlink" title="è‡ªå®šä¹‰æ§ä»¶çš„æ„é€ å‡½æ•°"></a>è‡ªå®šä¹‰æ§ä»¶çš„æ„é€ å‡½æ•°</h5><p>å»ºç«‹ä¸€ä¸ªclassç±»ç»§æ‰¿è‡ªView,å®ç°å®ƒçš„æ‰€æœ‰çš„æ„é€ æ–¹æ³•ï¼Œé‚£ä¹ˆè¿™ä¸ªç±»å°±æ˜¯ä¸€ä¸ªå¯ä»¥åœ¨xmlä¸­ä½¿ç”¨çš„è‡ªå®šä¹‰Viewï¼Œä»¥ä¸‹æ˜¯å…³äºå®ƒçš„æ„é€ æ–¹æ³•çš„ä»£ç ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jie.demo_01.View;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.content.Context;</span><br><span class="line"><span class="keyword">import</span> android.support.annotation.Nullable;</span><br><span class="line"><span class="keyword">import</span> android.util.AttributeSet;</span><br><span class="line"><span class="keyword">import</span> android.view.View;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">mView</span> <span class="keyword">extends</span> <span class="title">View</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">mView</span><span class="params">(Context context)</span> </span>&#123;  <span class="comment">//åœ¨ä»£ç ä¸­ç›´æ¥newå‡ºè¿™ä¸ªå®ä¾‹ä¼šè°ƒç”¨è¿™ä¸ªæ–¹æ³•</span></span><br><span class="line">        <span class="keyword">super</span>(context);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">mView</span><span class="params">(Context context, @Nullable AttributeSet attrs)</span> </span>&#123;</span><br><span class="line">	<span class="comment">//åœ¨xmlä¸­å®ç°ä¼šè°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼ˆæœªæŒ‡å®šstyleï¼‰</span></span><br><span class="line">        <span class="keyword">super</span>(context, attrs);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">mView</span><span class="params">(Context context, @Nullable AttributeSet attrs, <span class="keyword">int</span> defStyleAttr)</span> </span>&#123;</span><br><span class="line">	<span class="comment">//ä¸ºviewæŒ‡å®šäº†ä¸€ä¸ªstyle</span></span><br><span class="line">        <span class="keyword">super</span>(context, attrs, defStyleAttr);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">mView</span><span class="params">(Context context, @Nullable AttributeSet attrs, <span class="keyword">int</span> defStyleAttr, <span class="keyword">int</span> defStyleRes)</span> </span>&#123;</span><br><span class="line">	<span class="comment">//api&gt;21æ—¶è°ƒç”¨ï¼Œä¸€èˆ¬ä¸ç”¨å®ç°</span></span><br><span class="line">        <span class="keyword">super</span>(context, attrs, defStyleAttr, defStyleRes);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>å…³äºæ„é€ å‡½æ•°ä¸­å‚æ•°çš„å«ä¹‰ï¼š</p>
<ul>
<li><p>AttributeSet set:  å±æ€§å€¼çš„é›†åˆ.</p>
</li>
<li><p>int[] attrs:  æˆ‘ä»¬è‡ªå®šä¹‰å±æ€§é›†åˆåœ¨Rç±»ä¸­ç”Ÿæˆçš„intå‹æ•°ç»„.è¿™ä¸ªæ•°ç»„ä¸­åŒ…å«äº†è‡ªå®šä¹‰å±æ€§çš„èµ„æºID.</p>
</li>
<li><p>int defStyleAttr:  è¿™æ˜¯å½“å‰Themeä¸­çš„åŒ…å«çš„ä¸€ä¸ªæŒ‡å‘styleçš„å¼•ç”¨.å½“æˆ‘ä»¬æ²¡æœ‰ç»™è‡ªå®šä¹‰Viewè®¾ç½®declare-styleableèµ„æºé›†åˆæ—¶,é»˜è®¤ä»è¿™ä¸ªé›†åˆé‡Œé¢æŸ¥æ‰¾å¸ƒå±€æ–‡ä»¶ä¸­é…ç½®å±æ€§å€¼.ä¼ å…¥0è¡¨ç¤ºä¸å‘è¯¥defStyleAtträ¸­æŸ¥æ‰¾é»˜è®¤å€¼.</p>
</li>
<li><p>int defStyleRes:  è¿™ä¸ªä¹Ÿæ˜¯ä¸€ä¸ªæŒ‡å‘Styleçš„èµ„æºID,ä½†æ˜¯ä»…åœ¨defStyleAtträ¸º0æˆ–è€…defStyleAtträ¸ä¸º0ä½†Themeä¸­æ²¡æœ‰ä¸ºdefStyleAttrå±æ€§èµ‹å€¼æ—¶èµ·ä½œç”¨.</p>
</li>
</ul>
<blockquote>
<p>å±æ€§èµ‹å€¼ä¼˜å…ˆçº§æ¬¡åºè¡¨:<br>åœ¨å¸ƒå±€xmlä¸­ç›´æ¥å®šä¹‰ &gt; åœ¨å¸ƒå±€xmlä¸­é€šè¿‡styleå®šä¹‰ &gt; è‡ªå®šä¹‰Viewæ‰€åœ¨çš„Activityçš„Themeä¸­æŒ‡å®šstyleå¼•ç”¨ &gt; æ„é€ å‡½æ•°ä¸­defStyleResæŒ‡å®šçš„é»˜è®¤å€¼</p>
</blockquote>
<h5 id="è‡ªå®šä¹‰viewçš„xmlèµ‹å€¼"><a href="#è‡ªå®šä¹‰viewçš„xmlèµ‹å€¼" class="headerlink" title="è‡ªå®šä¹‰viewçš„xmlèµ‹å€¼"></a>è‡ªå®šä¹‰viewçš„xmlèµ‹å€¼</h5><p>æˆ‘ä»¬ç»å¸¸å¯ä»¥çœ‹åˆ°ä½¿ç”¨xmlçš„å±æ€§å¯ä»¥ä¸ºviewè¿›è¡Œå„ç§èµ‹å€¼,é‚£ä¹ˆæ˜¯æ€ä¹ˆåšåˆ°çš„å‘¢ï¼Œå¦‚å›¾ï¼Œåœ¨valuesç›®å½•ä¸‹æ–°å»ºä¸€ä¸ªattrs.xmlçš„æ–‡ä»¶ï¼Œæ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;resources&gt;</span><br><span class="line">    &lt;declare-styleable name=<span class="string">"mView"</span>&gt;</span><br><span class="line">        &lt;attr name=<span class="string">"mview_color"</span> format=<span class="string">"color"</span>/&gt;</span><br><span class="line">    &lt;/declare-styleable&gt;</span><br><span class="line">&lt;/resources&gt;</span><br></pre></td></tr></table></figure></p>
<p>æˆ‘åœ¨è¿™é‡Œå£°æ˜äº†ä¸€ä¸ªmview_colorå±æ€§ï¼Œç”¨äºå®šä¹‰é¢œè‰²å€¼ï¼Œformatä»£è¡¨å±æ€§çš„æ ¼å¼ï¼Œæœ‰è®¸å¤šï¼Œè¯»è€…æŸ¥é˜…æ–‡æ¡£å³å¯äº†è§£ã€‚</p>
<p>æ¥ä¸‹æ¥,æˆ‘åœ¨Viewä¸­åšå¦‚ä¸‹å¤„ç†ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">mView</span> <span class="keyword">extends</span> <span class="title">View</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> defultColor = <span class="number">0xFFFFFF6</span>;</span><br><span class="line">    <span class="keyword">int</span> mColor;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">mView</span><span class="params">(Context context)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>(context,<span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">mView</span><span class="params">(Context context, @Nullable AttributeSet attrs)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>(context, attrs,<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">mView</span><span class="params">(Context context, @Nullable AttributeSet attrs, <span class="keyword">int</span> defStyleAttr)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(context, attrs, defStyleAttr);</span><br><span class="line">        TypedArray t = context.obtainStyledAttributes(attrs, R.styleable.mView);</span><br><span class="line">        mColor = t.getColor(R.styleable.mView_mview_color,defultColor);</span><br><span class="line">        t.recycle(); <span class="comment">//è®°å¾—å›æ”¶</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>ä½¿ç”¨TypedArrayæ¥è§£ææˆ‘ä»¬å®šä¹‰çš„å±æ€§,æ¥ç€å°±èµ‹å€¼ç»™æˆ‘ä»¬çš„å˜é‡ï¼Œæœ€åå›æ”¶ï¼Œè¿™æ ·è§£æå·¥ä½œå°±å®Œæˆäº†</p>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬åœ¨xmlä¸­ä½¿ç”¨æˆ‘ä»¬çš„View:<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">"1.0"</span> encoding=<span class="string">"utf-8"</span>?&gt;</span><br><span class="line">&lt;LinearLayout xmlns:android=<span class="string">"http://schemas.android.com/apk/res/android"</span></span><br><span class="line">   <span class="comment">//ä¸ºäº†ä½¿ç”¨è‡ªå®šä¹‰å±æ€§ï¼Œå¿…é¡»ä½œæ­¤å£°æ˜ï¼Œappå¯ä»¥æ¢æˆå…¶ä»–çš„åå­—</span></span><br><span class="line">    xmlns:app=<span class="string">"http://schemas.android.com/apk/res-auto"</span>  </span><br><span class="line">    xmlns:tools=<span class="string">"http://schemas.android.com/tools"</span></span><br><span class="line">    android:layout_width=<span class="string">"match_parent"</span></span><br><span class="line">    android:layout_height=<span class="string">"match_parent"</span></span><br><span class="line">    tools:context=<span class="string">"com.jie.demo_01.MainActivity"</span>&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;com.jie.demo_01.View.mView</span><br><span class="line">        android:layout_width=<span class="string">"match_parent"</span></span><br><span class="line">        android:layout_height=<span class="string">"100dp"</span> </span><br><span class="line">        app:mview_color=<span class="string">"@color/colorAccent"</span>  <span class="comment">//å£°æ˜æˆ‘ä»¬çš„è‡ªå®šä¹‰å±æ€§</span></span><br><span class="line">        /&gt;</span><br><span class="line">&lt;/LinearLayout&gt;</span><br></pre></td></tr></table></figure></p>
<h5 id="è‡ªå®šä¹‰viewçš„ç»˜åˆ¶"><a href="#è‡ªå®šä¹‰viewçš„ç»˜åˆ¶" class="headerlink" title="è‡ªå®šä¹‰viewçš„ç»˜åˆ¶"></a>è‡ªå®šä¹‰viewçš„ç»˜åˆ¶</h5><p>å±æ€§å·²ç»å®šä¹‰å¥½äº†ï¼Œæ¥ä¸‹æ¥å°±æ˜¯å¦‚ä½•ä½¿ç”¨äº†ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬é‡å†™å®ƒçš„onDrawæ–¹æ³•ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">mView</span> <span class="keyword">extends</span> <span class="title">View</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> defultColor = <span class="number">0xFFFFFF6</span>;</span><br><span class="line">    <span class="keyword">int</span> mColor;</span><br><span class="line">    <span class="keyword">private</span> Paint mPaint = <span class="keyword">new</span> Paint(Paint.ANTI_ALIAS_FLAG);</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">mView</span><span class="params">(Context context)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>(context,<span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">mView</span><span class="params">(Context context, @Nullable AttributeSet attrs)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>(context, attrs,<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">mView</span><span class="params">(Context context, @Nullable AttributeSet attrs, <span class="keyword">int</span> defStyleAttr)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(context, attrs, defStyleAttr);</span><br><span class="line">        TypedArray t = context.obtainStyledAttributes(attrs, R.styleable.mView);</span><br><span class="line">        mColor = t.getColor(R.styleable.mView_mview_color,defultColor);</span><br><span class="line">        t.recycle(); <span class="comment">//è®°å¾—å›æ”¶</span></span><br><span class="line">        init();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        mPaint.setColor(mColor);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDraw</span><span class="params">(Canvas canvas)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onDraw(canvas);</span><br><span class="line">        canvas.drawCircle(<span class="number">200</span>,<span class="number">200</span>,<span class="number">100</span>,mPaint);  <span class="comment">//ç»˜åˆ¶ä¸€ä¸ªä½äº200ï¼Œ200å¤„çš„åŠå¾„ä¸º100çš„åœ†</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>onDrawæ–¹æ³•æ˜¯viewç»˜åˆ¶å›¾å½¢å›¾åƒçš„åœ°æ–¹ï¼Œé€šè¿‡ç”»å¸ƒï¼ˆcanvasï¼‰å’Œç”»ç¬”ï¼ˆpaintï¼‰æ¥çµæ´»çš„ç»˜åˆ¶å„ç§å›¾å½¢ï¼Œè¿™ä¸¤ä¸ªç±»æ‰€åŒ…å«çš„æ–¹æ³•å¤šè€Œå…¨ï¼Œè¯»è€…å¯ä»¥å¤šé˜…è¯»æ–‡æ¡£æ¥ç»ƒä¹ ç»˜åˆ¶å„ç§å›¾å½¢,ä»£ç è¿è¡Œå¦‚å›¾æ‰€ç¤ºï¼š</p>
<p><img src="http://p07lh1fh6.bkt.clouddn.com/%E5%BA%94%E7%94%A8%E5%AE%9D%E6%88%AA%E5%B1%8F2017121601.png-suofang" alt=""></p>
<h4 id="è‡ªå®šä¹‰Viewçš„æ³¨æ„äº‹é¡¹"><a href="#è‡ªå®šä¹‰Viewçš„æ³¨æ„äº‹é¡¹" class="headerlink" title="è‡ªå®šä¹‰Viewçš„æ³¨æ„äº‹é¡¹"></a>è‡ªå®šä¹‰Viewçš„æ³¨æ„äº‹é¡¹</h4><p>ä¸Šé¢çš„è‡ªå®šä¹‰viewå¹¶ä¸æ˜¯ä¸€ä¸ªæ ‡å‡†çš„è‡ªå®šä¹‰view,æ ‡å‡†çš„è‡ªå®šä¹‰viewè¿˜åº”è¯¥åŒ…å«onMeasureå’ŒonLayoutçš„å¤„ç†ï¼Œè®©å…¶æ”¯æŒwrap_contentã€‚</p>
<p>è¿™é‡Œè¦æ³¨æ„äº†ï¼š</p>
<ul>
<li><p>ç›´æ¥ç»§æ‰¿viewæˆ–è€…viewgroupçš„æ§ä»¶ä¸æ”¯æŒwrap_content,éœ€è¦åœ¨onMeasureä¸­è¿›è¡Œç‰¹æ®Šçš„å¤„ç†æ‰èƒ½è¾¾åˆ°é¢„æœŸçš„æ•ˆæœ</p>
</li>
<li><p>å¦‚æœæœ‰å¿…è¦çš„è¯ï¼Œéœ€è¦åœ¨drawæ–¹æ³•ä¸­å¤„ç†paddingï¼Œä½¿viewæ§ä»¶çš„paddingç”Ÿæ•ˆï¼Œå¦åˆ™paddingæ˜¯æ— æ•ˆçš„</p>
</li>
<li><p>å°½é‡ä¸åœ¨viewä¸­ä½¿ç”¨handler,å› ä¸ºviewæœ¬èº«è‡ªå¸¦äº†postæ–¹æ³•</p>
</li>
<li><p>å¦‚æœåœ¨viewä¸­æœ‰çº¿ç¨‹æˆ–è€…åŠ¨ç”»ï¼Œè¦åŠæ—¶å…³é—­ï¼Œå…³é—­çš„æ—¶æœºæ˜¯onDetachedFromWindowæ–¹æ³•ï¼Œå½“åŒ…å«æ­¤viewçš„Activityé€€å‡ºæˆ–è€…viewè¢«removeæ‰æ—¶ï¼Œæ­¤æ–¹æ³•ä¼šè¢«è°ƒç”¨</p>
</li>
<li><p>ä¸è¦å†onDrawæ–¹æ³•ä¸­ä½œåˆå§‹åŒ–æ“ä½œï¼Œå› ä¸ºè¿™ä¸ªæ–¹æ³•ä¼šç»˜åˆ¶å¤šæ¬¡ï¼Œä¼šäº§ç”Ÿå¾ˆå¤šä¸å¿…è¦çš„å¼€é”€</p>
</li>
<li><p>å½“Viewæœ‰æ»‘åŠ¨åµŒå¥—çš„æƒ…å†µï¼Œè¦å¤„ç†å¥½æ»‘åŠ¨å†²çª</p>
</li>
</ul>
]]></content>
      
        <categories>
            
            <category> AndroidåŸºç¡€è¿›é˜¶ </category>
            
            <category> å®‰å“Viewä½“ç³» </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Android </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[å®‰å“IPCæœºåˆ¶:AIDLé€šä¿¡çš„ä½¿ç”¨å’Œç†è§£]]></title>
      <url>/%E5%AE%89%E5%8D%93IPC%E6%9C%BA%E5%88%B6-AIDL%E9%80%9A%E4%BF%A1%E7%9A%84%E4%BD%BF%E7%94%A8%E5%92%8C%E7%90%86%E8%A7%A3.html</url>
      <content type="html"><![CDATA[<h4 id="ä½¿ç”¨æƒ…æ™¯"><a href="#ä½¿ç”¨æƒ…æ™¯" class="headerlink" title="ä½¿ç”¨æƒ…æ™¯"></a>ä½¿ç”¨æƒ…æ™¯</h4><p>è™½ç„¶Messengerå¯¹AIDLåšäº†å°è£…ä½¿å…¶å˜å¾—æ›´æ˜“ç”¨ï¼Œä½†Messengeråªèƒ½ä¸€ä¸ªä¸€ä¸ªçš„å¤„ç†æ¥æ”¶çš„æ•°æ®,å½“æœ‰å¤§é‡å¹¶å‘çš„æ•°æ®æ¶Œå…¥æ—¶ï¼ŒMessengerå°±æ˜¾å¾—ä¸é‚£ä¹ˆåˆé€‚äº†,å¹¶ä¸”Messengeråªèƒ½ç”¨æ¥ä¼ é€’æ¶ˆæ¯ï¼Œå¦‚æœéœ€è¦è°ƒç”¨è·¨è¿›ç¨‹çš„æ–¹æ³•æ€ä¹ˆåŠå‘¢ï¼Œè¿™æ˜¯ï¼ŒAIDLå°±æ´¾ä¸Šç”¨åœºäº†ã€‚<br><a id="more"></a></p>
<h4 id="ä½¿ç”¨æ–¹æ³•"><a href="#ä½¿ç”¨æ–¹æ³•" class="headerlink" title="ä½¿ç”¨æ–¹æ³•"></a>ä½¿ç”¨æ–¹æ³•</h4><p>é¦–å…ˆåˆ›å»ºä¸€ä¸ªAIDLæ–‡ä»¶,åœ¨é‡Œé¢å£°æ˜ä¸€äº›éœ€è¦ç”¨åˆ°çš„æ–¹æ³•æ¥å£ï¼Œæ³¨æ„ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„æ•°æ®ç±»å‹åœ¨AIDLä¸­éƒ½èƒ½ä½¿ç”¨ï¼ŒAIDLèƒ½å¤Ÿä½¿ç”¨çš„æ•°æ®ç±»å‹å¦‚ä¸‹:</p>
<ul>
<li>åŸºæœ¬æ•°æ®ç±»å‹</li>
<li>String,CharSequence</li>
<li>ArrayList,é‡Œé¢åŒ…å«çš„å…ƒç´ å¿…é¡»æ”¯æŒAIDL</li>
<li>HashMap,é‡Œé¢åŒ…å«çš„keyå’Œvalueå¿…é¡»è¢«AIDLæ”¯æŒ</li>
<li>Parcelable,æ‰€æœ‰å®ç°äº†Parcelableæ¥å£çš„å¯¹è±¡</li>
<li>AIDLæ¥å£æœ¬èº«ä¹Ÿæ”¯æŒ</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// IBookManager.aidl</span></span><br><span class="line"><span class="keyword">package</span> com.jie.demo_01;</span><br><span class="line"><span class="keyword">import</span> com.jie.demo_01.Book;</span><br><span class="line"><span class="comment">// Declare any non-default types here with import statements</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">IBookManager</span> </span>&#123;</span><br><span class="line">    <span class="function">List&lt;Book&gt; <span class="title">getBookList</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">addBook</span><span class="params">(in Book book)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘åœ¨é‡Œé¢å¼•å…¥äº†Bookå®ä½“ç±»ï¼ŒæŒ‰ç…§AIDLçš„è§„åˆ™ï¼Œæ˜¯éœ€è¦å†åˆ›å»ºä¸€ä¸ªBook.aidlæ–‡ä»¶çš„ï¼Œå¹¶ä¸”éœ€è¦æ‰‹åŠ¨å°†å¼•å…¥è·¯å¾„å¯¼å…¥<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Book.aidl.aidl</span></span><br><span class="line"><span class="keyword">package</span> com.jie.demo_01;</span><br><span class="line">parcelable Book;</span><br></pre></td></tr></table></figure></p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒAIDLä¸­æ¯ä¸ªå®ç°äº†Parcelableæ¥å£çš„ç±»éƒ½éœ€è¦æŒ‰ç…§è¿™ç§æ–¹å¼åˆ›å»ºç›¸åº”çš„æ–‡ä»¶å¹¶ä¸”ç”³æ˜è¯¥ç±»ä¸ºParcelableï¼Œå¹¶ä¸”ï¼ŒAIDLä¸­é™¤äº†åŸºæœ¬æ•°æ®ç±»å‹ï¼Œå…¶ä»–çš„å‚æ•°éƒ½å¿…é¡»æ ‡ä¸Šæ–¹å‘ï¼š</p>
<ul>
<li>in è¡¨ç¤ºè¾“å…¥å‹çš„å‚æ•°</li>
<li>out è¡¨ç¤ºè¾“å‡ºå‹çš„å‚æ•°</li>
<li>inout è¡¨ç¤ºè¾“å…¥è¾“å‡ºå‹å‚æ•°<br>å¹¶ä¸”AIDLä¸æ”¯æŒå£°æ˜é™æ€å˜é‡ã€‚</li>
</ul>
<p>ä¸‹é¢æ˜¯è¿œç¨‹æœåŠ¡ç«¯çš„å®ç°:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jie.demo_01;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.app.Service;</span><br><span class="line"><span class="keyword">import</span> android.content.Intent;</span><br><span class="line"><span class="keyword">import</span> android.os.Binder;</span><br><span class="line"><span class="keyword">import</span> android.os.IBinder;</span><br><span class="line"><span class="keyword">import</span> android.os.RemoteException;</span><br><span class="line"><span class="keyword">import</span> android.support.annotation.Nullable;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.CopyOnWriteArrayList;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">mService</span> <span class="keyword">extends</span> <span class="title">Service</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> CopyOnWriteArrayList&lt;Book&gt; mBookList = <span class="keyword">new</span> CopyOnWriteArrayList&lt;&gt;(); <span class="comment">//æ”¯æŒå¹¶å‘è¯»å†™çš„ä¸€ä¸ªç±»ï¼ŒéArraylist</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> Binder mbinder = <span class="keyword">new</span> IBookManager.Stub() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> List&lt;Book&gt; <span class="title">getBookList</span><span class="params">()</span> <span class="keyword">throws</span> RemoteException </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> mBookList;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addBook</span><span class="params">(Book book)</span> <span class="keyword">throws</span> RemoteException </span>&#123;</span><br><span class="line">             mBookList.add(book);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> IBinder <span class="title">onBind</span><span class="params">(Intent intent)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> mbinder;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate();</span><br><span class="line">        mBookList.add(<span class="keyword">new</span> Book(<span class="number">1</span>,<span class="string">"Kotlinå®æˆ˜"</span>));</span><br><span class="line">        mBookList.add(<span class="keyword">new</span> Book(<span class="number">2</span>,<span class="string">"ç¼–ç¨‹ç ç‘"</span>));</span><br><span class="line">        mBookList.add(<span class="keyword">new</span> Book(<span class="number">3</span>,<span class="string">"Javaæ•°æ®ä¸ç»“æ„ç®—æ³•è§£æ"</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>æœåŠ¡ç«¯çš„å®ç°æ¯”è¾ƒç®€å•ï¼Œä¸»è¦æ˜¯é€šè¿‡<code>IBookManager.Stub</code>æ¥è·å–<code>Binder</code>å¯¹è±¡å¹¶å®ç°å®šä¹‰çš„æ–¹æ³•,æœ€ååœ¨<code>onBind</code>ä¸­ç»‘å®š<code>`Binder</code>å¯¹è±¡,å…¶ä¸­ï¼Œ<code>IBookManager</code>è¿™ä¸ªç±»æ˜¯è‡ªåŠ¨ç”Ÿæˆçš„ï¼Œä½äºgenç›®å½•çš„aidlæ–‡ä»¶å¤¹ä¸­,å…³äºè¯¥ç±»ç¨åå†åšåˆ†æã€‚</p>
<p>ä»¥ä¸‹æ˜¯å®¢æˆ·ç«¯çš„å®ç°,ä¹Ÿæ¯”è¾ƒç®€å•:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jie.demo_01;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.content.ComponentName;</span><br><span class="line"><span class="keyword">import</span> android.content.Intent;</span><br><span class="line"><span class="keyword">import</span> android.content.ServiceConnection;</span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> android.os.IBinder;</span><br><span class="line"><span class="keyword">import</span> android.os.RemoteException;</span><br><span class="line"><span class="keyword">import</span> android.support.v7.app.AppCompatActivity;</span><br><span class="line"><span class="keyword">import</span> android.util.Log;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> ServiceConnection mConnection = <span class="keyword">new</span> ServiceConnection() &#123;  <span class="comment">//Ibindç›‘å¬ï¼Œæ³¨æ„ç»‘å®šæ˜¯å¼‚æ­¥çš„</span></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onServiceConnected</span><span class="params">(ComponentName componentName, IBinder iBinder)</span> </span>&#123; <span class="comment">//å½“ä¸Serviceå»ºç«‹è¿æ¥æ—¶è°ƒç”¨</span></span><br><span class="line">             IBookManager manager = IBookManager.Stub.asInterface(iBinder); <span class="comment">//è·å–AIDLç®¡ç†ç±»</span></span><br><span class="line">             <span class="comment">//å¾—åˆ°æ•°æ®</span></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                List&lt;Book&gt; bookList = manager.getBookList();  <span class="comment">//è¿™é‡Œå®é™…ä¸Šå°±æ˜¯è°ƒç”¨äº†Binderä¸­çš„æ–¹æ³•</span></span><br><span class="line">                Log.i(<span class="string">"hj"</span>,<span class="string">"ä»æœåŠ¡ç«¯è·å–çš„é›†åˆå¤§å°:"</span>+bookList.size());</span><br><span class="line">                <span class="keyword">if</span> (bookList.size()&gt;<span class="number">0</span>)&#123;</span><br><span class="line">                    Log.i(<span class="string">"hj"</span>,<span class="string">"ç¬¬ä¸€ä¸ªä¹¦åæ˜¯:"</span>+bookList.get(<span class="number">0</span>).bookName);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (RemoteException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onServiceDisconnected</span><span class="params">(ComponentName componentName)</span> </span>&#123;  <span class="comment">//ä¸Serviceæ„å¤–ä¸­æ–­æ—¶è°ƒç”¨</span></span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">        Intent intent = <span class="keyword">new</span> Intent(MainActivity.<span class="keyword">this</span>,mService.class);</span><br><span class="line">        bindService(intent,mConnection,BIND_AUTO_CREATE);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDestroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        unbindService(mConnection);</span><br><span class="line">        <span class="keyword">super</span>.onDestroy();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>è¿è¡Œåæ‰“å°å¦‚ä¸‹ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">12</span>-<span class="number">09</span> <span class="number">17</span>:<span class="number">05</span>:<span class="number">46.447</span> <span class="number">19690</span>-<span class="number">19690</span>/? I/hj: ä»æœåŠ¡ç«¯è·å–çš„é›†åˆå¤§å°:<span class="number">3</span></span><br><span class="line"><span class="number">12</span>-<span class="number">09</span> <span class="number">17</span>:<span class="number">05</span>:<span class="number">46.448</span> <span class="number">19690</span>-<span class="number">19690</span>/? I/hj: ç¬¬ä¸€ä¸ªä¹¦åæ˜¯:Kotlinå®æˆ˜</span><br></pre></td></tr></table></figure></p>
<p>è¿è¡ŒåŸç†æ˜¯é€šè¿‡<code>IBookManager.Stub.asInterface</code>æ–¹æ³•è·å–åˆ°<code>IBookManager</code>,ä»è€Œè°ƒç”¨é‡Œé¢çš„æ–¹æ³•æ¥å®ç°æ•°æ®çš„ä¼ é€’ä¸æ–¹æ³•ä¹‹é—´çš„è°ƒç”¨ï¼Œæ³¨æ„ï¼Œè¿™äº›æ–¹æ³•éƒ½æ˜¯è¿è¡Œåœ¨UIçº¿ç¨‹ä¸­çš„ï¼Œæ‰€ä»¥ä¸èƒ½æœ‰è€—æ—¶çš„æ“ä½œï¼Œå¦‚æœæœ‰è€—æ—¶çš„æ“ä½œï¼Œåº”è¯¥æ–°å¼€å¯ä¸€ä¸ªçº¿ç¨‹æ¥è§£å†³ã€‚</p>
<p>è¿˜æœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœæœ‰ç±»ä¼¼äºè®¢é˜…è€…çš„å®ç°ï¼Œåœ¨è¿›ç¨‹é€šä¿¡ä¸­ï¼Œä¸èƒ½ç®€å•çš„ç”¨Listæ¥ç®¡ç†æ¥å£ï¼Œå› ä¸ºè¿›ç¨‹ä¸­çš„å¯¹è±¡ä¼ è¾“åå…¶å®å˜æˆäº†ä¸¤ä¸ªä¸åŒçš„å¯¹è±¡ï¼Œé‚£ä¹ˆè®¢é˜…å’Œå–æ¶ˆè®¢é˜…å°†ä¼šå¤±æ•ˆï¼Œå› æ­¤ï¼Œç³»ç»Ÿæä¾›äº†ä¸€ä¸ªå«<code>RemoteCallbackList</code>çš„æ¥å£ä¸“é—¨ç”¨æ¥ç®¡ç†è·¨è¿›ç¨‹çš„æ¥å£ï¼Œå®ƒçš„ä½¿ç”¨ä¹Ÿå¾ˆç®€å•ï¼š</p>
<ul>
<li>beginBroadcast()æ–¹æ³•ä¼šè¿”å›è¯¥ç±»é‡Œæ‰€æœ‰é›†åˆçš„å¤§å°</li>
<li>getBroadcastItem(int position) è¿”å›æŒ‡å®šçš„item</li>
<li>finishBroadcast()  ç»“æŸéå†</li>
</ul>
<p>é€šè¿‡ä»¥ä¸Šä¸‰ä¸ªæ–¹æ³•å¯ä»¥å¾ªç¯éå†è®¢é˜…è€…æ¥å£æ¥è¾¾åˆ°å–æ¶ˆè®¢é˜…çš„ç›®çš„ã€‚æ³¨æ„beginBroadcastå’ŒfinishBroadcastå¿…é¡»é…å¯¹ä½¿ç”¨</p>
<h4 id="IBookManager-ç±»åˆ†æ"><a href="#IBookManager-ç±»åˆ†æ" class="headerlink" title="IBookManager ç±»åˆ†æ"></a>IBookManager ç±»åˆ†æ</h4><p>é€šè¿‡ä»¥ä¸Šçš„AIDLå®ç°ï¼Œæˆ‘ä»¬å‘ç°äº†IBookManagerç±»èµ·åˆ°äº†åˆ¶å…³é‡è¦çš„ä½œç”¨,æ‰€ä»¥æˆ‘ä»¬æ¥æ·±å…¥è§‚å¯Ÿä¸€ä¸‹è¯¥ç±»ï¼Œç†è§£äº†è¯¥ç±»æœ‰åŠ©äºæˆ‘ä»¬æ›´å¥½çš„ä½¿ç”¨AIDL.ä»¥ä¸‹æ˜¯è¯¥ç±»çš„æºç ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * This file is auto-generated.  DO NOT MODIFY.</span></span><br><span class="line"><span class="comment"> * Original file: D:\\MyWork\\Studio_Work\\demo_01\\app\\src\\main\\aidl\\com\\jie\\demo_01\\IBookManager.aidl</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">package</span> com.jie.demo_01;</span><br><span class="line"><span class="comment">// Declare any non-default types here with import statements</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IBookManager</span> <span class="keyword">extends</span> <span class="title">android</span>.<span class="title">os</span>.<span class="title">IInterface</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Local-side IPC implementation stub class.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Stub</span> <span class="keyword">extends</span> <span class="title">android</span>.<span class="title">os</span>.<span class="title">Binder</span> <span class="keyword">implements</span> <span class="title">com</span>.<span class="title">jie</span>.<span class="title">demo_01</span>.<span class="title">IBookManager</span> </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> java.lang.String DESCRIPTOR = <span class="string">"com.jie.demo_01.IBookManager"</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * Construct the stub at attach it to the interface.</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Stub</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.attachInterface(<span class="keyword">this</span>, DESCRIPTOR);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * Cast an IBinder object into an com.jie.demo_01.IBookManager interface,</span></span><br><span class="line"><span class="comment">         * generating a proxy if needed.</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> com.jie.demo_01.<span class="function">IBookManager <span class="title">asInterface</span><span class="params">(android.os.IBinder obj)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> ((obj == <span class="keyword">null</span>)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            android.os.IInterface iin = obj.queryLocalInterface(DESCRIPTOR);</span><br><span class="line">            <span class="keyword">if</span> (((iin != <span class="keyword">null</span>) &amp;&amp; (iin <span class="keyword">instanceof</span> com.jie.demo_01.IBookManager))) &#123;</span><br><span class="line">                <span class="keyword">return</span> ((com.jie.demo_01.IBookManager) iin);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> com.jie.demo_01.IBookManager.Stub.Proxy(obj);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> android.os.<span class="function">IBinder <span class="title">asBinder</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onTransact</span><span class="params">(<span class="keyword">int</span> code, android.os.Parcel data, android.os.Parcel reply, <span class="keyword">int</span> flags)</span> <span class="keyword">throws</span> android.os.RemoteException </span>&#123;</span><br><span class="line">            <span class="keyword">switch</span> (code) &#123;</span><br><span class="line">                <span class="keyword">case</span> INTERFACE_TRANSACTION: &#123;</span><br><span class="line">                    reply.writeString(DESCRIPTOR);</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">case</span> TRANSACTION_getBookList: &#123;</span><br><span class="line">                    data.enforceInterface(DESCRIPTOR);</span><br><span class="line">                    java.util.List&lt;com.jie.demo_01.Book&gt; _result = <span class="keyword">this</span>.getBookList();</span><br><span class="line">                    reply.writeNoException();</span><br><span class="line">                    reply.writeTypedList(_result);</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">case</span> TRANSACTION_addBook: &#123;</span><br><span class="line">                    data.enforceInterface(DESCRIPTOR);</span><br><span class="line">                    com.jie.demo_01.Book _arg0;</span><br><span class="line">                    <span class="keyword">if</span> ((<span class="number">0</span> != data.readInt())) &#123;</span><br><span class="line">                        _arg0 = com.jie.demo_01.Book.CREATOR.createFromParcel(data);</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        _arg0 = <span class="keyword">null</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">this</span>.addBook(_arg0);</span><br><span class="line">                    reply.writeNoException();</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">super</span>.onTransact(code, data, reply, flags);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Proxy</span> <span class="keyword">implements</span> <span class="title">com</span>.<span class="title">jie</span>.<span class="title">demo_01</span>.<span class="title">IBookManager</span> </span>&#123;</span><br><span class="line">            <span class="keyword">private</span> android.os.IBinder mRemote;</span><br><span class="line"></span><br><span class="line">            Proxy(android.os.IBinder remote) &#123;</span><br><span class="line">                mRemote = remote;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> android.os.<span class="function">IBinder <span class="title">asBinder</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> mRemote;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">public</span> java.lang.<span class="function">String <span class="title">getInterfaceDescriptor</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> DESCRIPTOR;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> java.util.List&lt;com.jie.demo_01.Book&gt; getBookList() <span class="keyword">throws</span> android.os.RemoteException &#123;</span><br><span class="line">                android.os.Parcel _data = android.os.Parcel.obtain();</span><br><span class="line">                android.os.Parcel _reply = android.os.Parcel.obtain();</span><br><span class="line">                java.util.List&lt;com.jie.demo_01.Book&gt; _result;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    _data.writeInterfaceToken(DESCRIPTOR);</span><br><span class="line">                    mRemote.transact(Stub.TRANSACTION_getBookList, _data, _reply, <span class="number">0</span>);</span><br><span class="line">                    _reply.readException();</span><br><span class="line">                    _result = _reply.createTypedArrayList(com.jie.demo_01.Book.CREATOR);</span><br><span class="line">                &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                    _reply.recycle();</span><br><span class="line">                    _data.recycle();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> _result;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addBook</span><span class="params">(com.jie.demo_01.Book book)</span> <span class="keyword">throws</span> android.os.RemoteException </span>&#123;</span><br><span class="line">                android.os.Parcel _data = android.os.Parcel.obtain();</span><br><span class="line">                android.os.Parcel _reply = android.os.Parcel.obtain();</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    _data.writeInterfaceToken(DESCRIPTOR);</span><br><span class="line">                    <span class="keyword">if</span> ((book != <span class="keyword">null</span>)) &#123;</span><br><span class="line">                        _data.writeInt(<span class="number">1</span>);</span><br><span class="line">                        book.writeToParcel(_data, <span class="number">0</span>);</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        _data.writeInt(<span class="number">0</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                    mRemote.transact(Stub.TRANSACTION_addBook, _data, _reply, <span class="number">0</span>);</span><br><span class="line">                    _reply.readException();</span><br><span class="line">                &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                    _reply.recycle();</span><br><span class="line">                    _data.recycle();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> TRANSACTION_getBookList = (android.os.IBinder.FIRST_CALL_TRANSACTION + <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> TRANSACTION_addBook = (android.os.IBinder.FIRST_CALL_TRANSACTION + <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> java.util.List&lt;com.jie.demo_01.Book&gt; getBookList() <span class="keyword">throws</span> android.os.RemoteException;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addBook</span><span class="params">(com.jie.demo_01.Book book)</span> <span class="keyword">throws</span> android.os.RemoteException</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>å¯ä»¥çœ‹åˆ°è¯¥ç±»çš„ç»“æ„è¿˜æ˜¯æ¯”è¾ƒæ¸…æ™°çš„,é¦–å…ˆï¼Œå®ƒç”³æ˜äº†getBookListå’ŒaddBookä¸¤ä¸ªæ–¹æ³•ï¼Œæ˜¾ç„¶è¿™æ˜¯æˆ‘åœ¨aidlæ¥å£ä¸­ç”³æ˜çš„æ–¹æ³•ï¼Œæ¥ç€ï¼Œè¿˜ç”³æ˜äº†ä¸¤ä¸ªintå‹çš„id,TRANSACTION_getBookList å’ŒTRANSACTION_addBookï¼Œè¿™ä¸¤ä¸ªidæ˜¯ä¸ºäº†åœ¨transactè¿‡ç¨‹ä¸­åŒºåˆ†å®¢æˆ·ç«¯è¯·æ±‚çš„æ˜¯å“ªä¸ªæ–¹æ³•ï¼Œæ¥ç€ï¼Œå®ƒç”³æ˜äº†ä¸€ä¸ªå†…éƒ¨ç±»Stub,å®ƒæ˜¯ä¸€ä¸ªBinderç±»ï¼Œæ¥ç€è¿˜ç”³æ˜äº†ä¸€ä¸ªStubçš„å†…éƒ¨ä»£ç†ç±»ï¼Œä»¥ä¸Šå°±æ˜¯è¯¥ç±»çš„ç»“æ„ã€‚ä¸‹é¢è¯¦ç»†ä»‹ç»ä¸€ä¸‹å„ä¸ªæ–¹æ³•çš„ä½œç”¨</p>
<p>é¦–å…ˆæ˜¯<code>Stub</code> ç±»çš„æ–¹æ³•ï¼š</p>
<p><strong>asInterface(android.os.IBinder obj)</strong><br>ä¼ å…¥ä¸€ä¸ªBinderå¯¹è±¡ï¼Œè½¬æ¢æˆå®¢æˆ·ç«¯æ‰€éœ€è¦çš„AIDLæ¥å£ç±»å‹çš„å¯¹è±¡ï¼Œè¿™ç§è½¬æ¢æ˜¯åŒºåˆ†è¿›ç¨‹çš„ï¼Œå¦‚æœæœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯æ˜¯åœ¨ä¸€ä¸ªè¿›ç¨‹ä¸­ï¼Œé‚£ä¹ˆè¯¥æ–¹æ³•ä¼šè¿”å›Stubå¯¹è±¡æœ¬èº«ï¼Œå¦‚æœæ˜¯ä¸¤ä¸ªè¿›ç¨‹ï¼Œé‚£ä¹ˆä¼šè¿”å›Stub.proxyå¯¹è±¡ã€‚</p>
<p><strong>adBinder</strong><br>è¿”å›Binderå¯¹è±¡.</p>
<p><strong>onTransactï¼ˆ(int code, android.os.Parcel data, android.os.Parcel reply, int flagsï¼‰</strong><br>è¯¥æ–¹æ³•æ˜¯è¿”å›ä¸€ä¸ªbooleanå¯¹è±¡ï¼Œè¿è¡Œåœ¨Binderçº¿ç¨‹æ± ä¸­ï¼Œå½“å®¢æˆ·ç«¯å‘èµ·è¯·æ±‚ï¼Œè¿œç¨‹ä¼šé€šè¿‡ç³»ç»Ÿåº•å±‚å°è£…åç”±æ­¤æ–¹æ³•å¤„ç†ã€‚codeå‚æ•°å¯ä»¥ç¡®å®šå®¢æˆ·ç«¯è¯·æ±‚çš„æ–¹æ³•æ˜¯ä»€ä¹ˆï¼Œdataä¸­èƒ½å–å‡ºç›®æ ‡çš„å‚æ•°ï¼Œç„¶åæ‰§è¡Œç›®æ ‡çš„æ–¹æ³•ï¼Œå½“æ‰§è¡Œå®Œæ¯•åï¼Œå°±å‘replyä¸­å†™å…¥è¿”å›å€¼ï¼ˆå¦‚æœæœ‰è¿”å›å€¼çš„è¯ï¼‰ï¼Œè€Œè¿”å›çš„booleanå¯¹è±¡ï¼Œå¦‚æœä¸ºfalse,é‚£ä¹ˆå®¢æˆ·ç«¯ä¼šè¯·æ±‚å¤±è´¥ï¼Œå› æ­¤å¯ä»¥é€šè¿‡è¿™ä¸ªè¿”å›å€¼åšæƒé™éªŒè¯ã€‚</p>
<p><code>Proxy</code>ä¸­çš„æ–¹æ³•ï¼š</p>
<p><strong>getBookList</strong><br>æ­¤æ–¹æ³•è¿è¡Œåœ¨å®¢æˆ·ç«¯ï¼Œå½“å®¢æˆ·ç«¯è¿œç¨‹è°ƒç”¨æ­¤æ–¹æ³•æ—¶ï¼Œå®ƒä¼šåˆ›å»ºè¯¥æ–¹æ³•æ‰€éœ€è¦çš„è¾“å…¥å‹Parcelå¯¹è±¡data,è¾“å‡ºå‹Parcelå¯¹è±¡,_replyå’Œè¿”å›å€¼å¯¹è±¡List,ç„¶åå°†è¯¥æ–¹æ³•çš„å‚æ•°ä¿¡æ¯å†™å…¥_dataä¸­ï¼ˆå¦‚æœæœ‰å‚æ•°çš„è¯ï¼‰ï¼›æ¥ç€è°ƒç”¨transactæ–¹æ³•æ¥å‘èµ·è¯·æ±‚ï¼ŒåŒæ—¶å½“å‰çº¿ç¨‹æŒ‚èµ·ï¼Œç„¶åæœåŠ¡ç«¯çš„onTransatctæ–¹æ³•ä¼šè¢«è°ƒç”¨ï¼Œç›´åˆ°è¿œç¨‹è°ƒç”¨è¿”å›ï¼Œå½“å‰çº¿ç¨‹ç»§ç»­æ‰§è¡Œï¼Œå¹¶ä»_replyä¸­å–å‡ºè¿œç¨‹è°ƒç”¨è¿‡ç¨‹çš„è¿”å›ç»“æœï¼Œæœ€åè¿”å›_replyæ•°æ®ã€‚</p>
<p><strong>addBook</strong><br>åŒ<code>getBookList</code>ä¸€æ ·ï¼Œå› ä¸ºæ²¡æœ‰è¿”å›å€¼ï¼Œæ‰€ä»¥ä¸éœ€è¦ä»_replyä¸­å–å€¼</p>
<p>æ•´ä½“æ¥è¯´æ•´ä¸ªç±»è¿˜æ˜¯æ˜“äºç†è§£çš„ï¼Œå¤§å¤šå…¶å®éƒ½æ˜¯ååº•å±‚çš„å®ç°,éœ€è¦æ³¨æ„çš„æ˜¯,å®¢æˆ·ç«¯é€šè¿‡æ¥å£æ–¹æ³•å‘èµ·è¯·æ±‚æ—¶ï¼Œå½“å‰çº¿ç¨‹ä¼šè¢«æŒ‚èµ·ç›´åˆ°æœåŠ¡ç«¯è¿”å›æ•°æ®ï¼Œå› æ­¤ï¼Œå¦‚æœä¸€ä¸ªè¿œç¨‹çš„æ–¹æ³•éå¸¸è€—æ—¶ï¼Œé‚£ä¹ˆå°±ä¸èƒ½åœ¨ä¸»çº¿ç¨‹ä¸­å‘èµ·è¯·æ±‚ï¼Œéœ€è¦å¦å¼€ä¸€ä¸ªçº¿ç¨‹ã€‚</p>
]]></content>
      
        <categories>
            
            <category> AndroidåŸºç¡€è¿›é˜¶ </category>
            
            <category> å®‰å“IPCæœºåˆ¶ </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Android </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[å®‰å“IPCæœºåˆ¶:ä½¿ç”¨Messengeré€šä¿¡]]></title>
      <url>/%E5%AE%89%E5%8D%93IPC%E6%9C%BA%E5%88%B6-%E4%BD%BF%E7%94%A8Messenger%E9%80%9A%E4%BF%A1.html</url>
      <content type="html"><![CDATA[<h4 id="MessengeråŸç†"><a href="#MessengeråŸç†" class="headerlink" title="MessengeråŸç†"></a>MessengeråŸç†</h4><p>Messengerçš„åº•å±‚å®ç°æ˜¯AILDï¼Œå®ƒæ˜¯ä¸€ä¸ªMessageçš„è½½ä½“ï¼Œé€šè¿‡å®ƒå¯ä»¥åœ¨ä¸åŒè¿›ç¨‹é—´ä¼ é€’messageå¯¹è±¡,ä»è€Œå®ç°æ•°æ®ä¼ é€’<br><a id="more"></a></p>
<h4 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h4><p>ä»£ç ç¤ºä¾‹ï¼š<br>é¦–å…ˆåˆ›å»ºä¸€ä¸ªServiceï¼Œè®©å®ƒè¿è¡Œåœ¨ä¸€ä¸ªå•ç‹¬çš„è¿›ç¨‹ä¸­<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;service android:name=<span class="string">".mService"</span></span><br><span class="line">           android:process=<span class="string">":remote"</span></span><br><span class="line">           /&gt;</span><br></pre></td></tr></table></figure></p>
<p>ç„¶åå†æ¥çœ‹æœåŠ¡ç«¯<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">mService</span> <span class="keyword">extends</span> <span class="title">Service</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Messenger messenger = <span class="keyword">new</span> Messenger(<span class="keyword">new</span> messengerHandler());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">messengerHandler</span> <span class="keyword">extends</span> <span class="title">Handler</span> </span>&#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleMessage</span><span class="params">(Message msg)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">switch</span> (msg.what) &#123;</span><br><span class="line">                <span class="keyword">case</span> Constants.MSG_FROM_CLIENT:</span><br><span class="line">                    String clientMsg = msg.getData().getString(<span class="string">"msg"</span>);  <span class="comment">//æ¥æ”¶å®¢æˆ·ç«¯çš„æ¶ˆæ¯</span></span><br><span class="line">                    Log.i(<span class="string">"hj"</span>,<span class="string">"ä»å®¢æˆ·ç«¯æ¥æ”¶åˆ°çš„æ¶ˆæ¯:"</span>+clientMsg);</span><br><span class="line">                    Messenger messenger = msg.replyTo;  <span class="comment">//è·å–å®¢æˆ·ç«¯å‘æ¥çš„Messenger</span></span><br><span class="line">                    Message replyMessage = Message.obtain(<span class="keyword">null</span>,Constants.MSG_FROM_SERVICE);  <span class="comment">//åˆ›å»ºä¸€ä¸ªæ–°çš„Messageå¯¹è±¡</span></span><br><span class="line">                    Bundle bundle = <span class="keyword">new</span> Bundle();</span><br><span class="line">                    bundle.putString(<span class="string">"reply"</span>, <span class="string">"å·²æ”¶åˆ°å®¢æˆ·ç«¯çš„æ¶ˆæ¯ï¼Œç¨åå›å¤~"</span>);</span><br><span class="line">                    replyMessage.setData(bundle);</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        messenger.send(replyMessage);  <span class="comment">//å‘é€æ¶ˆæ¯ç»™å®¢æˆ·ç«¯</span></span><br><span class="line">                    &#125; <span class="keyword">catch</span> (RemoteException e) &#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">default</span>:</span><br><span class="line">                    <span class="keyword">super</span>.handleMessage(msg);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> IBinder <span class="title">onBind</span><span class="params">(Intent intent)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> messenger.getBinder();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>åˆ›å»ºä¸€ä¸ªHandlerå¹¶ä¸”ä¼ å…¥åˆ°Messengerå¯¹è±¡ä¸­,é€šè¿‡Handleræ¥æ¥æ”¶Messageå¯¹è±¡å‘æ¥çš„æ¶ˆæ¯,å¹¶ä¸”åœ¨Serviceçš„onBindä¸­è¿”å›è¿™ä¸ªMessagerå¯¹è±¡åº•å±‚çš„Binderã€‚éšåæˆ‘åˆé€šè¿‡msg.replyToæ–¹æ³•è·å–åˆ°ä»å®¢æˆ·ç«¯å‘æ¥çš„Messengerå¯¹è±¡ï¼Œç”¨äºå›å¤æ¶ˆæ¯ç»™å®¢æˆ·ç«¯,æœ€åè°ƒç”¨sendæ–¹æ³•å‘å‡ºæ¶ˆæ¯ï¼Œè¿™æ ·å°±å®Œæˆäº†æ¶ˆæ¯çš„æ¥æ”¶ä¸å›å¤ï¼Œæ¥ä¸‹æ¥å†çœ‹å®¢æˆ·ç«¯çš„å®ç°<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jie.demo_01;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.content.ComponentName;</span><br><span class="line"><span class="keyword">import</span> android.content.Intent;</span><br><span class="line"><span class="keyword">import</span> android.content.ServiceConnection;</span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> android.os.Handler;</span><br><span class="line"><span class="keyword">import</span> android.os.IBinder;</span><br><span class="line"><span class="keyword">import</span> android.os.Message;</span><br><span class="line"><span class="keyword">import</span> android.os.Messenger;</span><br><span class="line"><span class="keyword">import</span> android.os.RemoteException;</span><br><span class="line"><span class="keyword">import</span> android.support.v7.app.AppCompatActivity;</span><br><span class="line"><span class="keyword">import</span> android.util.Log;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Messenger messenger;  <span class="comment">//å®¢æˆ·ç«¯å‘é€æ¶ˆæ¯çš„messenger</span></span><br><span class="line">    <span class="keyword">private</span> ServiceConnection mConnection = <span class="keyword">new</span> ServiceConnection() &#123;  <span class="comment">//Ibindç›‘å¬ï¼Œæ³¨æ„ç»‘å®šæ˜¯å¼‚æ­¥çš„</span></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onServiceConnected</span><span class="params">(ComponentName componentName, IBinder iBinder)</span> </span>&#123; <span class="comment">//å½“ä¸Serviceå»ºç«‹è¿æ¥æ—¶è°ƒç”¨</span></span><br><span class="line">              messenger = <span class="keyword">new</span> Messenger(iBinder);</span><br><span class="line">            Message message = Message.obtain(<span class="keyword">null</span>,Constants.MSG_FROM_CLIENT);</span><br><span class="line">            Bundle bundle = <span class="keyword">new</span> Bundle();</span><br><span class="line">            bundle.putString(<span class="string">"msg"</span>,<span class="string">"Serviceå…„å¼Ÿåœ¨å—ï¼Œæ˜¯å¦å·²æ”¶åˆ°å›å¤"</span>);</span><br><span class="line">            message.setData(bundle);</span><br><span class="line">            message.replyTo = replyMessager;  <span class="comment">//æ³¨æ„è¿™ä¸€å¥ï¼Œå°†å®¢æˆ·ç«¯ç”¨äºæ¥å—æ¶ˆæ¯çš„Messagerå¯¹è±¡ä¼ é€’ç»™Service</span></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                messenger.send(message);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (RemoteException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onServiceDisconnected</span><span class="params">(ComponentName componentName)</span> </span>&#123;  <span class="comment">//ä¸Serviceæ„å¤–ä¸­æ–­æ—¶è°ƒç”¨</span></span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Messenger replyMessager = <span class="keyword">new</span> Messenger(<span class="keyword">new</span> GetReplyMessenger());  <span class="comment">//å®¢æˆ·ç«¯æ¥æ”¶æ¶ˆæ¯çš„messenger</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">GetReplyMessenger</span> <span class="keyword">extends</span> <span class="title">Handler</span></span>&#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleMessage</span><span class="params">(Message msg)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">switch</span> (msg.what)&#123;</span><br><span class="line">                <span class="keyword">case</span> Constants.MSG_FROM_SERVICE:</span><br><span class="line">                    String reply = msg.getData().getString(<span class="string">"reply"</span>);</span><br><span class="line">                    Log.i(<span class="string">"hj"</span>,<span class="string">"ä»Serviceæ¥æ”¶åˆ°çš„æ¶ˆæ¯:"</span>+reply);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">default</span>:</span><br><span class="line">                    <span class="keyword">super</span>.handleMessage(msg);</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">        Intent intent = <span class="keyword">new</span> Intent(MainActivity.<span class="keyword">this</span>,mService.class);</span><br><span class="line">        bindService(intent,mConnection,BIND_AUTO_CREATE);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDestroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        unbindService(mConnection);</span><br><span class="line">        <span class="keyword">super</span>.onDestroy();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>é¦–å…ˆæ˜¯ç»‘å®šä¸€ä¸ªServiceï¼Œæ¥ä¸‹æ¥åœ¨ç»‘å®šç›‘å¬ä¸­åˆ›å»ºä¸€ä¸ªMessagerå¯¹è±¡,é€šè¿‡Messagerå°±å¯ä»¥å‘æ¶ˆæ¯ç»™æœåŠ¡ç«¯äº†,æ³¨æ„ï¼Œæˆ‘åœ¨è¿™é‡Œé€šè¿‡replyToå‘é€äº†ä¸€ä¸ªæ–°çš„Messagerå¯¹è±¡ç»™æœåŠ¡ç«¯ï¼Œè¿™æ ·æœåŠ¡ç«¯å°±å¯ä»¥å›å¤æ¶ˆæ¯ç»™å®¢æˆ·ç«¯äº†ï¼Œå®¢æˆ·ç«¯ä¹Ÿæ˜¯é€šè¿‡Handleræ¥æ¥æ”¶æ¶ˆæ¯çš„ã€‚</p>
<p>è¿è¡Œç»“æœå¦‚ä¸‹ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">12</span>-<span class="number">09</span> <span class="number">11</span>:<span class="number">16</span>:<span class="number">07.733</span> <span class="number">7900</span>-<span class="number">7900</span>/com.jie.demo_01:remote I/hj: ä»å®¢æˆ·ç«¯æ¥æ”¶åˆ°çš„æ¶ˆæ¯:Serviceå…„å¼Ÿåœ¨å—ï¼Œæ˜¯å¦å·²æ”¶åˆ°å›å¤</span><br></pre></td></tr></table></figure></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">12</span>-<span class="number">09</span> <span class="number">11</span>:<span class="number">16</span>:<span class="number">07.753</span> <span class="number">7871</span>-<span class="number">7871</span>/com.jie.demo_01 I/hj: ä»Serviceæ¥æ”¶åˆ°çš„æ¶ˆæ¯:å·²æ”¶åˆ°å®¢æˆ·ç«¯çš„æ¶ˆæ¯ï¼Œç¨åå›å¤~</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°ä¸¤ä¸ªä¸åŒè¿›ç¨‹ä¹‹é—´é€šä¿¡æˆåŠŸäº†</p>
]]></content>
      
        <categories>
            
            <category> AndroidåŸºç¡€è¿›é˜¶ </category>
            
            <category> å®‰å“IPCæœºåˆ¶ </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Android </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[å®‰å“IPCæœºåˆ¶ï¼šä½¿ç”¨æ–‡ä»¶å…±äº«]]></title>
      <url>/%E5%AE%89%E5%8D%93IPC%E6%9C%BA%E5%88%B6%EF%BC%9A%E4%BD%BF%E7%94%A8%E6%96%87%E4%BB%B6%E5%85%B1%E4%BA%AB.html</url>
      <content type="html"><![CDATA[<h4 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h4><p>é€šè¿‡ä¸¤ä¸ªè¿›ç¨‹é—´è¯»/å†™åŒä¸€ä¸ªæ–‡ä»¶æ¥äº¤æ¢æ•°æ®<br><a id="more"></a><br>ç¤ºä¾‹ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">package com.jie.demo_01;</span><br><span class="line"></span><br><span class="line">import android.content.Intent;</span><br><span class="line">import android.os.Bundle;</span><br><span class="line">import android.os.Environment;</span><br><span class="line">import android.support.v7.app.AppCompatActivity;</span><br><span class="line">import android.view.View;</span><br><span class="line"></span><br><span class="line">import java.io.File;</span><br><span class="line">import java.io.FileOutputStream;</span><br><span class="line">import java.io.IOException;</span><br><span class="line">import java.io.ObjectOutputStream;</span><br><span class="line"></span><br><span class="line">public class MainActivity extends AppCompatActivity &#123;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void onCreate(Bundle savedInstanceState) &#123;</span><br><span class="line">        super.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void onResume() &#123;</span><br><span class="line">        super.onResume();</span><br><span class="line">        initWriteToFile();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  //ç‚¹å‡»è·³è½¬åˆ°SecondActivity</span><br><span class="line">    public void start(View v)&#123;</span><br><span class="line">        startActivity(new Intent(MainActivity.this,SecondActivity.class));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private void initWriteToFile()&#123;</span><br><span class="line">        new Thread()&#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void run() &#123;</span><br><span class="line">                User user = new User();</span><br><span class="line">                user.userName = &quot;Hello World&quot;;</span><br><span class="line">                File file = new File(getDiskCacheDir());</span><br><span class="line">                ObjectOutputStream oos = null;</span><br><span class="line">                try &#123;</span><br><span class="line">                    oos = new ObjectOutputStream(new FileOutputStream(file));</span><br><span class="line">                    oos.writeObject(user);</span><br><span class="line">                &#125; catch (IOException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;finally &#123;</span><br><span class="line">                    try &#123;</span><br><span class="line">                        if (oos!=null)</span><br><span class="line">                        oos.close();</span><br><span class="line">                    &#125; catch (IOException e) &#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;.start();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getDiskCacheDir() &#123;</span><br><span class="line">        String cachePath = null;</span><br><span class="line">        if (Environment.MEDIA_MOUNTED.equals(Environment.getExternalStorageState())</span><br><span class="line">                || !Environment.isExternalStorageRemovable()) &#123;</span><br><span class="line">            cachePath = getExternalCacheDir().getPath()+&quot;/cache.txt&quot;;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            cachePath = getCacheDir().getPath()+&quot;/cache.txt&quot;;</span><br><span class="line">        &#125;</span><br><span class="line">        return cachePath;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>SecondActivityä»£ç ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">package com.jie.demo_01;</span><br><span class="line"></span><br><span class="line">import android.os.Bundle;</span><br><span class="line">import android.os.Environment;</span><br><span class="line">import android.support.v7.app.AppCompatActivity;</span><br><span class="line">import android.util.Log;</span><br><span class="line"></span><br><span class="line">import java.io.File;</span><br><span class="line">import java.io.FileInputStream;</span><br><span class="line">import java.io.IOException;</span><br><span class="line">import java.io.ObjectInputStream;</span><br><span class="line"></span><br><span class="line">public class SecondActivity extends AppCompatActivity &#123;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void onCreate(Bundle savedInstanceState) &#123;</span><br><span class="line">        super.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void onResume() &#123;</span><br><span class="line">        super.onResume();</span><br><span class="line">        getCacheFromFile();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private void getCacheFromFile ()&#123;</span><br><span class="line">        new Thread()&#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void run() &#123;</span><br><span class="line">                User user = null;</span><br><span class="line">                File file = new File(getDiskCacheDir());</span><br><span class="line">                if (file.exists())&#123;</span><br><span class="line">                    ObjectInputStream ois = null;</span><br><span class="line">                    try &#123;</span><br><span class="line">                        ois = new ObjectInputStream(new FileInputStream(file));</span><br><span class="line">                        user = (User) ois.readObject();</span><br><span class="line">                        Log.i(&quot;TAG&quot;,user.userName);</span><br><span class="line">                    &#125; catch (IOException e) &#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125; catch (ClassNotFoundException e) &#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;.start();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getDiskCacheDir() &#123;</span><br><span class="line">        String cachePath = null;</span><br><span class="line">        if (Environment.MEDIA_MOUNTED.equals(Environment.getExternalStorageState())</span><br><span class="line">                || !Environment.isExternalStorageRemovable()) &#123;</span><br><span class="line">            cachePath = getExternalCacheDir().getPath()+&quot;/cache.txt&quot;;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            cachePath = getCacheDir().getPath()+&quot;/cache.txt&quot;;</span><br><span class="line">        &#125;</span><br><span class="line">        return cachePath;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>è¿è¡Œåï¼Œæ‰“å°å‡ºæ—¥å¿—ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">12-08 13:13:30.372 17706-17723/com.jie.demo_01.remote I/TAG: Hello World</span><br></pre></td></tr></table></figure></p>
<p>æ–‡ä»¶ä¼ å€¼æˆåŠŸ</p>
<p>æ–‡ä»¶ä¼ å€¼å¹¶æ²¡æœ‰å…·ä½“çš„è¦æ±‚ï¼Œä¸ç®¡æ˜¯é€šè¿‡txt,xml,ç­‰ç­‰éƒ½å¯ä»¥ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯æ–‡ä»¶çš„å¹¶å‘é—®é¢˜ï¼Œè¦é¿å…è·å–æ–‡ä»¶å€¼å¾—æ—¶å€™åŒæ—¶å»ä¿®æ”¹æ–‡ä»¶ï¼Œè¿™æ ·ä¼šé€ æˆæ•°æ®çš„æ··ä¹±ã€‚</p>
]]></content>
      
        <categories>
            
            <category> AndroidåŸºç¡€è¿›é˜¶ </category>
            
            <category> å®‰å“IPCæœºåˆ¶ </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Android </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[å®‰å“IPCæœºåˆ¶ï¼šBundleæ•°æ®ä¼ é€’]]></title>
      <url>/%E5%AE%89%E5%8D%93IPC%E6%9C%BA%E5%88%B6%EF%BC%9ABundle%E6%95%B0%E6%8D%AE%E4%BC%A0%E9%80%92.html</url>
      <content type="html"><![CDATA[<h4 id="åºåˆ—åŒ–ä¸ååºåˆ—åŒ–"><a href="#åºåˆ—åŒ–ä¸ååºåˆ—åŒ–" class="headerlink" title="åºåˆ—åŒ–ä¸ååºåˆ—åŒ–"></a>åºåˆ—åŒ–ä¸ååºåˆ—åŒ–</h4><p>è¦å®ç°è¿›ç¨‹ä¹‹é—´çš„é€šä¿¡ï¼Œåºåˆ—åŒ–æ˜¯é€šä¿¡çš„åŸºç¡€ï¼Œæ‰€ä»¥å…ˆè¦äº†è§£ä¸‹ä»€ä¹ˆæ˜¯åºåˆ—åŒ–<br><a id="more"></a><br>å®‰å“å®ç°åºåˆ—åŒ–æœ‰ä¸¤ç§æ–¹å¼ï¼š<br><strong>1. å®ç°Serializableæ¥å£</strong>ï¼Œä½¿ç”¨ç›¸å½“ç®€å•ï¼Œè¿™ä¸ªæ˜¯JAVAæä¾›çš„æ–¹æ³•ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯,è¯¥æ¥å£æœ‰ä¸€ä¸ªserialVersionUIDå‚æ•°ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">private static final long serialVersionUID = 1L ;</span><br></pre></td></tr></table></figure></p>
<p>å¯ä»¥é€‰æ‹©ä¸å®ç°ï¼Œä¾æ—§å¯ä»¥åºåˆ—åŒ–ï¼Œä½†æ˜¯ä¼šå¯¹ååºåˆ—åŒ–äº§ç”Ÿå½±å“ï¼Œå¦‚æœåœ¨ååºåˆ—åŒ–çš„è¿‡ç¨‹ä¸­ç±»å‘ç”Ÿäº†å˜åŒ–ï¼Œé‚£ä¹ˆå°†ä¼šæŠ¥é”™ã€‚<br>AndroidStudioé»˜è®¤ä¸æ£€æŸ¥serialVersionUIDçš„å®ç°ï¼Œå› æ­¤ï¼Œå¯ä»¥æ‰‹åŠ¨å¼€å¯å®ƒï¼Œè¿™æ ·ç³»ç»Ÿå°±ä¼šè‡ªåŠ¨å¸®ä½ å®ç°serialVersionUIDã€‚å¼€å¯æ–¹æ³•ï¼š<br>Settings-&gt;Editor-&gt;Inspections-&gt;serialization issues-&gt;Serializable class without â€˜serialVersionUIDâ€™ å‹¾ä¸Šç¡®è®¤å°±å¯ä»¥</p>
<p>åºåˆ—åŒ–å¯¹è±¡ä¹Ÿéå¸¸ç®€å•ï¼Œé€šè¿‡ObjectOutputStreamå’ŒObjectInputStreamå³å¯è½»æ¾å®ç°</p>
<p><strong>2.å®ç°Parcelableæ¥å£</strong>,è¿™æ˜¯Androidæä¾›çš„æ–¹æ³•ï¼Œå®ç°è¯¥æ¥å£ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨å¸®ä½ å®ç°éœ€è¦çš„ä»£ç ï¼ŒAndroidä¸­æ¨èä½¿ç”¨è¯¥æ–¹æ³•ï¼Œå› ä¸ºæ•ˆç‡æ¯”Serializableé«˜ï¼ŒSerializableéœ€è¦è¿›è¡Œå¤§é‡çš„I/Oæ“ä½œã€‚ä»¥ä¸‹æ˜¯å®Œæ•´å®ç°å®ä¾‹ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">public class User implements Parcelable &#123;</span><br><span class="line">    public int userId;</span><br><span class="line">    public String userName;</span><br><span class="line">    public boolean isMale;</span><br><span class="line">    public Book book;</span><br><span class="line"></span><br><span class="line">    protected User(Parcel in) &#123;</span><br><span class="line">        userId = in.readInt();</span><br><span class="line">        userName = in.readString();</span><br><span class="line">        isMale = in.readByte() != 0;</span><br><span class="line">        book = in.readParcelable(Book.class.getClassLoader());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static final Creator&lt;User&gt; CREATOR = new Creator&lt;User&gt;() &#123;</span><br><span class="line">        @Override</span><br><span class="line">        public User createFromParcel(Parcel in) &#123;</span><br><span class="line">            return new User(in);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        @Override</span><br><span class="line">        public User[] newArray(int size) &#123;</span><br><span class="line">            return new User[size];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public int describeContents() &#123;</span><br><span class="line">        return 0;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void writeToParcel(Parcel parcel, int i) &#123;</span><br><span class="line">        parcel.writeInt(userId);</span><br><span class="line">        parcel.writeString(userName);</span><br><span class="line">        parcel.writeByte((byte) (isMale ? 1 : 0));</span><br><span class="line">        parcel.writeParcelable(book, i);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>æ–¹æ³•è¯¦è§£è§ä¸‹è¡¨ï¼š</p>
<table>
<thead>
<tr>
<th>æ–¹æ³•</th>
<th>åŠŸèƒ½</th>
<th>æ ‡è®°ä½</th>
</tr>
</thead>
<tbody>
<tr>
<td>createFromParce(Parcel in)l</td>
<td>ä»åºåˆ—åŒ–çš„å¯¹è±¡ä¸­åˆ›å»ºåŸå§‹å¯¹è±¡</td>
<td></td>
</tr>
<tr>
<td>newArray</td>
<td>åˆ›å»ºæŒ‡å®šé•¿åº¦çš„åŸå§‹å¯¹è±¡æ•°ç»„</td>
<td></td>
</tr>
<tr>
<td>User(Parcel in)</td>
<td>ä»åºåˆ—åŒ–çš„å¯¹è±¡ä¸­åˆ›å»ºåŸå§‹å¯¹è±¡</td>
<td></td>
</tr>
<tr>
<td>writeToParcel(Parcel parcel, int i)</td>
<td>å°†å½“å‰å¯¹è±¡å†™å…¥åºåˆ—åŒ–ç»“æ„ä¸­,å…¶ä¸­ iæœ‰ä¸¤ç§å€¼ï¼Œ1ä»£è¡¨å½“å‰å¯¹è±¡éœ€è¦ä½œä¸ºè¿”å›å€¼è¿”å›ï¼Œä¸èƒ½ç«‹å³é‡Šæ”¾èµ„æºï¼Œ</td>
<td>PARCELABLE_WRITE_VALUE</td>
</tr>
<tr>
<td>describeContents</td>
<td>è¿”å›å½“å‰å¯¹è±¡çš„å†…å®¹æè¿°ï¼Œå¦‚æœå«æœ‰æ–‡ä»¶æ‰«æç¬¦ï¼Œè¿”å›1ï¼ˆå‚è§å³ä¾§æ ‡è®°ä½ï¼‰ï¼Œå¦åˆ™è¿”å›0</td>
<td>CONTENTS_FILE_DESCRIPTOR</td>
</tr>
</tbody>
</table>
<p>å®ç°äº†åºåˆ—åŒ–ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¾ˆæ–¹ä¾¿çš„é€šè¿‡Intentå‘é€Bundle,è¿™æ˜¯ä¸€ç§ç®€å•çš„è¿›ç¨‹é—´é€šä¿¡çš„æ–¹æ³•<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Bundle bundle = new Bundle();</span><br><span class="line">       bundle.putParcelable(&quot;User&quot;,new User());</span><br><span class="line">       Intent intent = new Intent(MainActivity.this, SecondActivity.class);</span><br><span class="line">       intent.putExtra(&quot;data&quot;,bundle);</span><br><span class="line">       startActivity(intent);</span><br></pre></td></tr></table></figure></p>
]]></content>
      
        <categories>
            
            <category> AndroidåŸºç¡€è¿›é˜¶ </category>
            
            <category> å®‰å“IPCæœºåˆ¶ </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Android </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[å®‰å“IPCæœºåˆ¶:å¤šè¿›ç¨‹]]></title>
      <url>/%E5%AE%89%E5%8D%93IPC%E6%9C%BA%E5%88%B6-%E5%A4%9A%E8%BF%9B%E7%A8%8B.html</url>
      <content type="html"><![CDATA[<h4 id="ä»€ä¹ˆæ˜¯IPC"><a href="#ä»€ä¹ˆæ˜¯IPC" class="headerlink" title="ä»€ä¹ˆæ˜¯IPC"></a>ä»€ä¹ˆæ˜¯IPC</h4><p> IPCæ˜¯æŒ‡è¿›ç¨‹é—´é€šä¿¡æˆ–è€…è·¨è¿›ç¨‹é€šä¿¡ï¼ŒæŒ‡ä¸¤ä¸ªè¿›ç¨‹ä¹‹é—´äº¤æ¢æ•°æ®çš„è¿‡ç¨‹ã€‚è€ŒIPCä½¿ç”¨çš„åœºæ™¯å¾€å¾€æ˜¯åœ¨å¤šè¿›ç¨‹ä¹‹é—´è¿›è¡Œé€šä¿¡ã€‚</p>
<h4 id="Androidå¼€å¯å¤šè¿›ç¨‹"><a href="#Androidå¼€å¯å¤šè¿›ç¨‹" class="headerlink" title="Androidå¼€å¯å¤šè¿›ç¨‹"></a>Androidå¼€å¯å¤šè¿›ç¨‹</h4><p> é€šè¿‡ç»™ActivityæŒ‡å®šandroid:processå±æ€§æ¥å¼€å¯å¤šè¿›ç¨‹æ¨¡å¼,å¦‚ä¸‹ç¤ºä¾‹ï¼Œ<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;application</span><br><span class="line">       android:allowBackup=&quot;true&quot;</span><br><span class="line">       android:icon=&quot;@mipmap/ic_launcher&quot;</span><br><span class="line">       android:label=&quot;@string/app_name&quot;</span><br><span class="line">       android:roundIcon=&quot;@mipmap/ic_launcher_round&quot;</span><br><span class="line">       android:supportsRtl=&quot;true&quot;</span><br><span class="line">       android:theme=&quot;@style/AppTheme&quot;&gt;</span><br><span class="line">       &lt;activity android:name=&quot;.MainActivity&quot;&gt;</span><br><span class="line">           &lt;intent-filter&gt;</span><br><span class="line">               &lt;action android:name=&quot;android.intent.action.MAIN&quot; /&gt;</span><br><span class="line"></span><br><span class="line">               &lt;category android:name=&quot;android.intent.category.LAUNCHER&quot; /&gt;</span><br><span class="line">           &lt;/intent-filter&gt;</span><br><span class="line">       &lt;/activity&gt;</span><br><span class="line">       &lt;activity android:name=&quot;.ThirdActivity&quot; </span><br><span class="line">           android:process=&quot;:remote&quot;</span><br><span class="line">           /&gt;</span><br><span class="line">       &lt;activity android:name=&quot;.SecondActivity&quot; </span><br><span class="line">           android:process=&quot;com.jie.demo_01.remote&quot;</span><br><span class="line">           /&gt;</span><br><span class="line">   &lt;/application&gt;</span><br></pre></td></tr></table></figure></p>
<p>ç¤ºä¾‹ä¸­å®ç°äº†ä¸¤ç§ä¸åŒçš„å†™æ³•ï¼Œè¿™ä¸¤ç§å†™æ³•æ˜¯æœ‰åŒºåˆ«çš„,å½“ThirdActivityå¯åŠ¨ï¼Œç³»ç»Ÿä¼šå•ç‹¬å¼€å¯ä¸€ä¸ªå«com.jie.demo_01:remoteçš„è¿›ç¨‹(com.jie.demo_01ä¸ºåŒ…å),å½“å¯åŠ¨SecondActivity,ç³»ç»Ÿä¼šå•ç‹¬å¼€å¯ä¸€ä¸ªå«com.jie.demo_01.remoteçš„è¿›ç¨‹ï¼Œå…¶ä¸­ï¼Œâ€œï¼šâ€ä»£è¡¨è¦åœ¨å½“å‰è¿›ç¨‹åå‰é¢åŠ ä¸Šå½“å‰çš„åŒ…åï¼Œå¹¶ä¸”ä»£è¡¨æ­¤è¿›ç¨‹ä¸ºç§æœ‰è¿›ç¨‹ï¼Œå…¶ä»–åº”ç”¨ä¸èƒ½å’Œå®ƒè·‘åœ¨ä¸€ä¸ªè¿›ç¨‹ä¸­ï¼Œè€Œæ²¡æœ‰â€ï¼šâ€çš„ä¸ºå…¨å±€è¿›ç¨‹ã€‚SecondActivityçš„è¿™ç§å†™æ³•ï¼Œæ˜¯ä¸€ç§å®Œæ•´çš„å‘½åæ–¹å¼ï¼Œä¸ä¼šé™„åŠ åŒ…åä¿¡æ¯ã€‚</p>
<h4 id="å¼€å¯å¤šè¿›ç¨‹çš„ä¸€äº›å‘"><a href="#å¼€å¯å¤šè¿›ç¨‹çš„ä¸€äº›å‘" class="headerlink" title="å¼€å¯å¤šè¿›ç¨‹çš„ä¸€äº›å‘"></a>å¼€å¯å¤šè¿›ç¨‹çš„ä¸€äº›å‘</h4><p>å½“ä¸€ä¸ªActivityå•ç‹¬å¼€å¯äº†ä¸€ä¸ªè¿›ç¨‹ï¼Œé‚£ä¹ˆè¿™ä¸ªActivityå°±ä¸èƒ½å’Œåˆ«çš„è¿›ç¨‹çš„Activityå…±äº«æ•°æ®äº†ï¼Œåªèƒ½é€šè¿‡IPCæœºåˆ¶æ¥ä¼ é€’æ•°æ®ã€‚</p>
<p>ä¾‹å¦‚æˆ‘ç”³æ˜äº†ä¸€ä¸ªé™æ€å˜é‡ Userid = 1;æˆ‘åœ¨MainActivityä¸­æŠŠå®ƒæ”¹ä¸ºäº†2ï¼Œæˆ‘åœ¨SecondActivityä¸­å¼€å¯äº†ä¸€ä¸ªè¿›ç¨‹ï¼Œæˆ‘è·å–è¿™ä¸ªUseridï¼Œä½ ä¼šå‘ç°Useridè¿˜æ˜¯1ï¼Œè¿™æ˜¯å› ä¸ºAndroidä¼šä¸ºæ¯ä¸€ä¸ªè¿›ç¨‹åˆ†é…ä¸€ä¸ªè™šæ‹Ÿæœºï¼Œä¸åŒçš„è™šæ‹Ÿæœºåœ¨å†…å­˜åˆ†é…ä¸Šä¼šæœ‰ä¸åŒçš„åœ°å€ç©ºé—´ï¼Œæ‰€ä»¥Useridä¼šåœ¨ä¸åŒçš„è™šæ‹Ÿæœºä¸Šäº§ç”Ÿä¸åŒçš„å‰¯æœ¬ï¼Œå¹¶ä¸”å‰¯æœ¬ä¹‹é—´æ˜¯äº’ä¸å¹²æ‰°çš„,æˆ‘åœ¨MainActivityä¸­æŠŠå®ƒæ”¹ä¸º2ï¼Œåœ¨SecondActivityä¸­çš„å‰¯æœ¬æ˜¯ä¸ä¼šå˜å¾—,å¯ä»¥ç†è§£ä¸ºåˆæ–°å¼€å¯äº†ä¸€ä¸ªåº”ç”¨ï¼Œæ‰€ä»¥ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œå¤šè¿›ç¨‹ä¹‹é—´ä¼šå­˜åœ¨ä¸‹åˆ—ä¸€äº›é—®é¢˜ï¼š</p>
<ul>
<li>é™æ€æˆå‘˜å’Œå•ä¾‹æ¨¡å¼æ— æ•ˆ</li>
<li>çº¿ç¨‹åŒæ­¥æœºåˆ¶å¤±æ•ˆ</li>
<li>SharedPreferencesçš„å­˜å‚¨ç»“æœå˜å¾—ä¸å†å¯é </li>
<li>Applicationä¼šå¤šæ¬¡åˆ›å»º</li>
</ul>
<p>ä¸ºäº†è§£å†³è¿™äº›é—®é¢˜ï¼Œç³»ç»Ÿå¼•å…¥äº†IPCæœºåˆ¶ï¼Œç”¨äºåœ¨è¿›ç¨‹é—´å…±äº«å’Œä¼ é€’æ•°æ®ï¼ŒIPCçš„æ–¹å¼ä¸»è¦æœ‰ä»¥ä¸‹å‡ ç§ï¼š</p>
<ul>
<li>ä½¿ç”¨Bundle</li>
<li>ä½¿ç”¨æ–‡ä»¶å…±äº«</li>
<li>ä½¿ç”¨Messenger</li>
<li>ä½¿ç”¨AIDL</li>
</ul>
<p>å…¶ä¸­Messengeråº•å±‚å…¶å®ä½¿ç”¨çš„AILDï¼ŒAIDLå…¶å®æ˜¯ä¾é Binder,ä¸‹ä¸€ç« å°†è¯¦ç»†ä»‹ç»è¿™å‡ ç§æ–¹æ³•ã€‚</p>
]]></content>
      
        <categories>
            
            <category> AndroidåŸºç¡€è¿›é˜¶ </category>
            
            <category> å®‰å“IPCæœºåˆ¶ </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Android </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Activityçš„ç”Ÿå‘½å‘¨æœŸå’Œå¯åŠ¨æ¨¡å¼]]></title>
      <url>/Activity%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E5%92%8C%E5%90%AF%E5%8A%A8%E6%A8%A1%E5%BC%8F.html</url>
      <content type="html"><![CDATA[<blockquote>
<p>æ­¤ç³»åˆ—æ–‡ç« ä¸ºè¿›é˜¶ç±»æ–‡ç« ,å¿«é¤ç±»è®°å½•æ–‡,ç”¨äºè‡ªå·±å®‰å“çŸ¥è¯†ç‚¹çš„å¤ä¹ </p>
</blockquote>
<h4 id="å…¸å‹æƒ…å†µç”Ÿå‘½å‘¨æœŸ"><a href="#å…¸å‹æƒ…å†µç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="å…¸å‹æƒ…å†µç”Ÿå‘½å‘¨æœŸ"></a>å…¸å‹æƒ…å†µç”Ÿå‘½å‘¨æœŸ</h4><ul>
<li>onCreate() :Activityè¢«åˆ›å»º<a id="more"></a></li>
<li>onRestart() : æ­£åœ¨é‡æ–°å¯åŠ¨ã€‚è°ƒç”¨åœºæ™¯ï¼šå½“å‰Activityä»ä¸å¯è§åˆ°å˜ä¸ºå¯è§çŠ¶æ€</li>
<li>onStart():  Activityæ­£åœ¨å¯åŠ¨,æ­¤æ—¶Activityå·²ç»å¯è§ï¼Œä½†è¿˜ä¸èƒ½å’Œç”¨æˆ·äº¤äº’</li>
<li>onResume() :æ­¤æ—¶Activityå·²ç»å¯è§å¹¶å¼€å§‹æ´»åŠ¨</li>
<li>onPause() :Activityæ­£åœ¨åœæ­¢ï¼Œå¦‚æœæ˜¯ä»æ­¤Activityé€€åˆ°ä¸Šä¸€ä¸ªActivity,é‚£ä¹ˆä¼šå…ˆæ‰§è¡Œæ­¤Activityçš„onPause,å†æ‰§è¡Œä¸Šä¸€ä¸ªActivityçš„onResume,æ‰€ä»¥æ­¤æ–¹æ³•ä¸èƒ½æ‰§è¡Œè€—æ—¶çš„æ“ä½œï¼Œä¸ç„¶ä¼šå½±å“æ–°Activityçš„æ˜¾ç¤º</li>
<li>onStop() : Activityå³å°†åœæ­¢,ç´§æ¥ç€onPauseåé¢æ‰§è¡Œ</li>
<li>onDestroy() : Activityå³å°†é”€æ¯,åœ¨è¿™é‡Œä¸»è¦åšä¸€äº›èµ„æºçš„é‡Šæ”¾<br>å®Œæ•´çš„å¯åŠ¨æµç¨‹æ˜¯ä»ä¸Šåˆ°ä¸‹,æœ‰å‡ ä¸ªå…·ä½“æƒ…å†µè¯´æ˜:<br>1)ç¬¬ä¸€æ¬¡å¯åŠ¨ä¸€ä¸ªæ–°çš„Activity: onCreate-&gt;onStart-&gt;onResume<br>2)å†æ¬¡æ‰“å¼€ä¸€ä¸ªActivityæˆ–è€…åˆ‡æ¢åˆ°æ¡Œé¢ï¼šonPause -&gt;onStop (æ³¨ï¼šå¦‚æœæ–°çš„Activityæ˜¯ç”¨çš„é€æ˜ä¸»é¢˜,é‚£ä¹ˆä¸ä¼šå›è°ƒonStop)<br>3) å†æ¬¡å›åˆ°æ­¤Activityï¼šonRestar -&gt;onStart -&gt;onResume<br>4)é€€å‡ºæ­¤Activity (finishæ‰)ï¼šonPause -&gt;onStop -&gt;onDestroty</li>
</ul>
<h4 id="å¼‚å¸¸æƒ…å†µç”Ÿå‘½å‘¨æœŸ"><a href="#å¼‚å¸¸æƒ…å†µç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="å¼‚å¸¸æƒ…å†µç”Ÿå‘½å‘¨æœŸ"></a>å¼‚å¸¸æƒ…å†µç”Ÿå‘½å‘¨æœŸ</h4><h5 id="èµ„æºç›¸å…³çš„ç³»ç»Ÿé…ç½®å‘ç”Ÿäº†æ”¹å˜å¯¼è‡´Activityè¢«æ€æ­»å¹¶é‡æ–°åˆ›å»º"><a href="#èµ„æºç›¸å…³çš„ç³»ç»Ÿé…ç½®å‘ç”Ÿäº†æ”¹å˜å¯¼è‡´Activityè¢«æ€æ­»å¹¶é‡æ–°åˆ›å»º" class="headerlink" title="èµ„æºç›¸å…³çš„ç³»ç»Ÿé…ç½®å‘ç”Ÿäº†æ”¹å˜å¯¼è‡´Activityè¢«æ€æ­»å¹¶é‡æ–°åˆ›å»º"></a>èµ„æºç›¸å…³çš„ç³»ç»Ÿé…ç½®å‘ç”Ÿäº†æ”¹å˜å¯¼è‡´Activityè¢«æ€æ­»å¹¶é‡æ–°åˆ›å»º</h5><p>å‘ç”Ÿæ­¤ç§æƒ…å†µæœ€å…¸å‹çš„å°±æ˜¯æ¨ªç«–å±çš„åˆ‡æ¢,å› ä¸ºç³»ç»Ÿä¼šå»æ‹¿ä¸¤å¼ ä¸åŒçš„å›¾ç‰‡ï¼Œè¿™æ—¶ï¼ŒActivityå°±ä¼šé‡æ–°åˆ›å»º,å®ƒçš„onPause,onStop,onDestroyéƒ½ä¼šè¢«è°ƒç”¨,åŒæ—¶å› ä¸ºActivityæ˜¯åœ¨å¼‚å¸¸æƒ…å†µä¸‹ç»ˆæ­¢çš„,æ‰€ä»¥ç³»ç»Ÿä¼šè°ƒç”¨onSaveInstanceStateæ¥ä¿å­˜å½“å‰Activityçš„çŠ¶æ€ï¼Œè¿™ä¸ªæ–¹æ³•ä¼šåœ¨onStopæ–¹æ³•ä¹‹å‰è°ƒç”¨ã€‚å½“Activityåˆ›å»ºå®Œæˆ,ç³»ç»Ÿä¼šè°ƒç”¨onRestoreInstanceStateï¼Œå¯ä»¥ä»è¿™ä¸ªæ–¹æ³•é‡Œæ‹¿åˆ°bundleå¯¹è±¡å¹¶æ¢å¤Activityçš„çŠ¶æ€</p>
<h5 id="èµ„æºä¸è¶³å¯¼è‡´Activityè¢«æ€æ­»"><a href="#èµ„æºä¸è¶³å¯¼è‡´Activityè¢«æ€æ­»" class="headerlink" title="èµ„æºä¸è¶³å¯¼è‡´Activityè¢«æ€æ­»"></a>èµ„æºä¸è¶³å¯¼è‡´Activityè¢«æ€æ­»</h5><p>æ­¤ç§æƒ…å†µå’Œç¬¬ä¸€ç±»å·®ä¸å¤šï¼Œéƒ½å¯ä»¥é€šè¿‡ä»¥ä¸Šä¸¤ç§æ–¹æ³•æ¥æ¢å¤æ•°æ®</p>
<p>æ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä¸è®©Activityé‡æ–°åˆ›å»º,é€šè¿‡åœ¨æ¸…å•æ–‡ä»¶ä¸­æŒ‡å®šActivityçš„configChangeså±æ€§,é€šè¿‡è¿™äº›å±æ€§,å¯ä»¥è®©æˆ‘ä»¬åœ¨ç‰¹å®šåœºæ™¯ä¸‹Activityä¸ä¼šè¢«é‡æ–°åˆ›å»º,æ­¤æ—¶ï¼Œå¦‚æœæˆ‘ä»¬è¿›è¡Œäº†ç‰¹æ®Šçš„æ“ä½œ,Activityä¼šè°ƒç”¨onConfigurationChangedæ–¹æ³•</p>
<h4 id="Activityçš„å¯åŠ¨æ¨¡å¼"><a href="#Activityçš„å¯åŠ¨æ¨¡å¼" class="headerlink" title="Activityçš„å¯åŠ¨æ¨¡å¼"></a>Activityçš„å¯åŠ¨æ¨¡å¼</h4><p>1)standardï¼š é»˜è®¤æ¨¡å¼ï¼Œæ¯æ¬¡éƒ½æ‰“å¼€ä¸€ä¸ªæ–°çš„Activity,ä¾‹å¦‚ABCDå››ä¸ªActivity,Aæ˜¯æœ€åº•çš„Activity,Dæ˜¯å½“å‰çš„æ ˆé¡¶Activity,é€šè¿‡Då¯åŠ¨Dï¼Œæ­¤æ—¶æ ˆä¸­çš„Activityå°±ä¼šå˜æˆABCDD<br>2ï¼‰singleTopï¼š æ ˆé¡¶å¤ç”¨æ¨¡å¼ï¼Œä¾‹å¦‚ABCDå››ä¸ªActivity,ç”¨Då¯åŠ¨D,æ ˆä¸­çš„Activityè¿˜æ˜¯ABCDï¼ŒDè¢«å¤ç”¨äº†,å¹¶ä¸”Dä¸ä¼šå†æ¬¡è°ƒç”¨onCreateï¼Œè€Œæ˜¯ä¼šè°ƒç”¨onNewIntent<br>3)singleTask:  æ ˆå†…å¤ç”¨æ¨¡å¼,ä¾‹å¦‚ABCD,é€šè¿‡Då¯åŠ¨Bï¼Œæ ˆä¸­çš„Activityä¸ºï¼šACDB,Bä¸ä¼šè¢«é‡æ–°åˆ›å»º,å¹¶ä¸”Bä¼šæ”¾å…¥åˆ°æ ˆé¡¶,å¦‚æœæ˜¯é€šè¿‡Då¯åŠ¨Eï¼Œé‚£ä¸ªæ ˆä¸­Activcityä¸ºABCDE,å› ä¸ºEåœ¨æ ˆä¸­æ²¡æœ‰ï¼Œç³»ç»Ÿä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å®ä¾‹ã€‚å¤ç”¨çš„Activityä¾æ—§ä¼šè°ƒç”¨onNewInternt<br>4) å•å®ä¾‹æ¨¡å¼ï¼Œå¯ä»¥ç†è§£ä¸ºåŠ å¼ºç‰ˆçš„singTask.æ­¤ç§æ¨¡å¼ä¸ä½†æ‹¥æœ‰singTaskçš„å…¨éƒ¨ç‰¹æ€§ï¼Œè€Œä¸”æ˜¯å•ç‹¬çš„ä½äºä¸€ä¸ªä»»åŠ¡æ ˆä¸­ï¼Œä¾‹å¦‚Aæ˜¯æ­¤ç§æ¨¡å¼ï¼Œé‚£ä¸ªç³»ç»Ÿä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ä»»åŠ¡æ ˆï¼Œé‚£ä¹ˆç”±äºæ ˆçš„å¤ç”¨ç‰¹æ€§ï¼Œåç»­çš„è¯·æ±‚éƒ½ä¸ä¼šé‡æ–°åˆ›å»ºæ–°çš„Activityï¼Œé™¤éè¢«ç³»ç»Ÿé”€æ¯äº†</p>
<h4 id="å¯åŠ¨æ¨¡å¼çš„è®¾ç½®"><a href="#å¯åŠ¨æ¨¡å¼çš„è®¾ç½®" class="headerlink" title="å¯åŠ¨æ¨¡å¼çš„è®¾ç½®"></a>å¯åŠ¨æ¨¡å¼çš„è®¾ç½®</h4><p>1ï¼‰é€šè¿‡æ¸…å•æ–‡ä»¶çš„launchModeå±æ€§è®¾ç½®<br>2ï¼‰é€šè¿‡Intentè®¾ç½®æ ‡å¿—ä½æ¥æŒ‡å®š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Intent intent = new Intent();</span><br><span class="line">intent.setClass(A.this,B.class);</span><br><span class="line">intent.addFlags(Intent.FLAG_ACTIVITY_NEW_TASK);</span><br><span class="line">startActivity(intent);</span><br></pre></td></tr></table></figure></p>
<p>ä¸¤è€…çš„åŒºåˆ«:ç¬¬äºŒç§çš„ä¼˜å…ˆçº§ä¼šé«˜äºç¬¬ä¸€ç§ï¼Œç¬¬ä¸€ç§æ— æ³•è®¾ç½®FLAG_ACTIVITY_CLEAR_TOPæ ‡è¯†,ç¬¬äºŒç§æ— æ³•ä¸ºActivityæŒ‡å®šsingleInstanceæ¨¡å¼ã€‚</p>
<h4 id="Activityçš„Flags"><a href="#Activityçš„Flags" class="headerlink" title="Activityçš„Flags"></a>Activityçš„Flags</h4><p><strong>FLAG_ACTIVITY_NEW_TASK</strong><br>singleTaskæ¨¡å¼<br><strong>FLAG_ACTIVITY_SINGLE_TOP</strong><br>singleTopæ¨¡å¼<br><strong>FLAG_ACTIVITY_CLEAR_TOP</strong><br>è®¾ç½®äº†æ­¤æ¨¡å¼ï¼Œå¦‚æœæ˜¯singleTaskæ¨¡å¼å¯åŠ¨,é‚£ä¹ˆå°±ä¼šè°ƒç”¨onNewIntentï¼Œå¦‚æœæ˜¯standardæ¨¡å¼å¯åŠ¨,é‚£ä¹ˆä½äºæ­¤Activityæ ˆä¸Šçš„æ‰€æœ‰Activityéƒ½è¦å‡ºæ ˆ<br><strong>FLAG_ACTIVITY_EXCLUDE_FROM_RECENTS</strong><br>å…·æœ‰è¿™ä¸ªæ ‡è®°çš„Activityä¸ä¼šå‡ºç°åœ¨åˆ—è¡¨ä¸­,ç­‰åŒäºxmlä¸­çš„excludeFromRecents=true;</p>
]]></content>
      
        <categories>
            
            <category> AndroidåŸºç¡€è¿›é˜¶ </category>
            
            <category> å®‰å“Activity </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Android </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[æœ‰å“ªäº›é€ç»™å¹´è½»äººçš„å»ºè®®æˆ–é“ç†ï¼Ÿ]]></title>
      <url>/%E6%9C%89%E5%93%AA%E4%BA%9B%E9%80%81%E7%BB%99%E5%B9%B4%E8%BD%BB%E4%BA%BA%E7%9A%84%E5%BB%BA%E8%AE%AE%E6%88%96%E9%81%93%E7%90%86%EF%BC%9F.html</url>
      <content type="html"><![CDATA[<blockquote>
<p>åºè¨€ï¼šè¿™ç¯‡æ–‡ç« ï¼Œå†™ç»™ä½ ä»¬ï¼Œä¹Ÿå†™ç»™æˆ‘è‡ªå·±ï¼Œæˆ‘è‡ªå·±ä¼šç»å¸¸é˜…è¯»è¿™ç¯‡æ–‡ç« æ¥æ¿€åŠ±è‡ªå·±ï¼Œæ¯å½“è‡ªå·±èŒ«ç„¶ï¼Œæ— æªï¼Œä¸çŸ¥é“è¯¥å¹²å˜›æ—¶ï¼Œæˆ‘éƒ½ä¼šè¯»ä¸€éï¼Œè¿™æ ·æˆ‘çš„è„‘æµ·å°±ä¼šè‡ªåŠ¨ç»™è‡ªå·±ç½—åˆ—å‡ºä¸€äº›äº‹æƒ…æ¥åšï¼Œå“ˆå“ˆå“ˆã€‚å¸Œæœ›å¯¹é˜…è¯»è¿™ç¯‡æ–‡ç« çš„ä½ ä¼šæœ‰å¯å‘,æˆ‘ç›¸ä¿¡æœªæ¥çš„ä½ ä¸€å®šä¼šæ„Ÿè°¢ç°åœ¨è¿™ä¹ˆåŠªåŠ›çš„è‡ªå·±ï¼</p>
</blockquote>
<h4 id="å­¦ä¹ å¾ˆé‡è¦ï¼å­¦ä¹ å¾ˆé‡è¦ï¼å­¦ä¹ å¾ˆé‡è¦ï¼"><a href="#å­¦ä¹ å¾ˆé‡è¦ï¼å­¦ä¹ å¾ˆé‡è¦ï¼å­¦ä¹ å¾ˆé‡è¦ï¼" class="headerlink" title="å­¦ä¹ å¾ˆé‡è¦ï¼å­¦ä¹ å¾ˆé‡è¦ï¼å­¦ä¹ å¾ˆé‡è¦ï¼"></a>å­¦ä¹ å¾ˆé‡è¦ï¼å­¦ä¹ å¾ˆé‡è¦ï¼å­¦ä¹ å¾ˆé‡è¦ï¼</h4><p> çŸ¥è¯†æˆ–è€…æŠ€èƒ½è¿™ç§ä¸œè¥¿ï¼Œå­¦åˆ°äº†å°±è·Ÿä½ ä¸€è¾ˆå­ï¼Œä¸ç®¡å·¥ä½œæˆ–æ—¶ç©ºè·¨åº¦å¤šå¤§ï¼Œæ–°çŸ¥å’ŒæŠ€èƒ½éƒ½èƒ½æ’ä¸Šç”¨åœºï¼Œè¯·ä¸è¦æ„Ÿå¹æ—¶å…‰å·²é€ï¼Œå­¦ä¹ ä¸æ˜“ï¼Œäººå®¶è€æ¥è€ƒç ”çš„ï¼Œç”šæ˜¯80å²å­¦ç¼–ç¨‹çš„éƒ½æœ‰ï¼Œè¯·ä¸è¦ä¸ºä½ çš„æ‡’æƒ°æ‰¾å€Ÿå£ã€‚</p>
<h4 id="ä¹ æƒ¯å¾ˆé‡è¦ï¼"><a href="#ä¹ æƒ¯å¾ˆé‡è¦ï¼" class="headerlink" title="ä¹ æƒ¯å¾ˆé‡è¦ï¼"></a>ä¹ æƒ¯å¾ˆé‡è¦ï¼</h4><p> æœ‰äººæ€»æ˜¯å’Œæˆ‘ä»¬è¯´ï¼Œè¦å…»æˆå¥½çš„ä¹ æƒ¯ã€‚å¯æ²¡äººè·Ÿæˆ‘è¯´é‡è¦åˆ°æ·±åº¦å½±å“è‡ªå·±ç”Ÿæ´»ã€äººç”Ÿé€‰æ‹©å’Œç”Ÿå‘½è´¨é‡çš„ç¨‹åº¦ã€‚å› ä¸ºå‡ ä¹å¤§å¤šæ•°äººï¼Œæ¯æ—¶æ¯åˆ»éƒ½ç”Ÿæ´»åœ¨å½¢å½¢è‰²è‰²çš„æ€ç»´ä¹ æƒ¯ã€ç”Ÿæ´»ä¹ æƒ¯ä¸­ï¼Œæ¯”å¦‚å¥èº«ã€è·‘æ­¥ã€é˜…è¯»ã€è¡¨è¾¾ã€å†™ä½œã€æ²Ÿé€šã€å­¦ä¹ ç­‰ç­‰ï¼Œæ‰€æœ‰å½±å“æˆ‘ä»¬ç”Ÿæ´»å·¥ä½œç»“æœçš„å…¨æ˜¯è¿™äº›ä¹ æƒ¯ã€‚æˆ‘ä»¬å…»æˆä¹ æƒ¯ï¼Œç„¶åä¹ æƒ¯å…»æˆæˆ‘ä»¬ã€‚</p>
<h4 id="å­¦ä¼šå­¦ä¹ ä»–äººä¼˜ç§€çš„å“è´¨"><a href="#å­¦ä¼šå­¦ä¹ ä»–äººä¼˜ç§€çš„å“è´¨" class="headerlink" title="å­¦ä¼šå­¦ä¹ ä»–äººä¼˜ç§€çš„å“è´¨"></a>å­¦ä¼šå­¦ä¹ ä»–äººä¼˜ç§€çš„å“è´¨</h4><p>å›´å‰¿å¼å­¦ä¹ ï¼Œä¹Ÿå°±æ˜¯å¸æ˜Ÿå¤§æ³•ï¼Œé€šè¿‡è§‚å¯Ÿå¯¹æ–¹çš„æ²Ÿé€šã€æ¼”è®²ã€å†™ä½œæ–¹å¼ï¼Œä»è€Œå­¦ä¹ ä»–ä»¬çš„æ€ç»´æ–¹å¼ã€å­¦ä¹ ä»–ä»¬èº«ä¸Šæœ€ä¼˜ç§€çš„æ€ç»´ä¹ æƒ¯,å½“ä½ ä»¬æŠŠä¼˜ç§€çš„äººèº«ä¸Šä¼˜ç§€çš„å“è´¨å­¦ä¹ ä¸‹æ¥ï¼Œè¿™å°±æ˜¯æˆåŠŸï¼</p>
<h4 id="çœŸè¯šå’Œè¯šä¿¡"><a href="#çœŸè¯šå’Œè¯šä¿¡" class="headerlink" title="çœŸè¯šå’Œè¯šä¿¡"></a>çœŸè¯šå’Œè¯šä¿¡</h4><p>çœŸè¯šæ˜¯é¢†å¯¼åŠ›çš„çœŸè°›ï¼Œè¯šä¿¡æ˜¯å•†ä¸šçš„çœŸè°›ï¼Œæ¯ä¸ªäººçš„å¹´è–ªã€é¢†å¯¼èƒ½åŠ›ã€å•†ä¸šæˆå°±å…¨éƒ¨éƒ½å¯ä»¥ä»è¿™ä¸¤ä¸ªè¯æ±‡é‡Œè¯ é‡Š,å½“ä½ è‡ªå·±åšè€æ¿ä½ å°±ä¼šè§‰å¾—è¿™ä¸¤ä¸ªå“è´¨æ˜¯å¤šä¹ˆçš„é‡è¦äº†ã€‚</p>
<h4 id="è¦å¤šé™ªé™ªå®¶äºº"><a href="#è¦å¤šé™ªé™ªå®¶äºº" class="headerlink" title="è¦å¤šé™ªé™ªå®¶äºº"></a>è¦å¤šé™ªé™ªå®¶äºº</h4><p>å¹´è½»äººå¯èƒ½å¿ƒé‡Œæƒ³å¾—æ›´å¤šçš„æ˜¯å¹¸ç¦ç”Ÿæ´»ï¼Œä½†çˆ¶æ¯çš„å¹´çºªï¼Œä»–ä»¬å¹´é¾„è¶Šå¤§ï¼Œè¶Šè¦å»é¢ä¸´ç¦»å¼€è¿™ä¸€ä¸»é¢˜ï¼Œä»–ä»¬æ‹…å¿ƒè¢«ä¸–ç•ŒæŠ›å¼ƒï¼Œæ‹…å¿ƒè‡ªå·±åœ¨å„¿å¥³ç”Ÿæ´»ä¸­æ‰®æ¼”ä¸äº†ä»€ä¹ˆé‡è¦ä»·å€¼ï¼Œç‰¹åˆ«æ¸´æœ›å›é¦ˆã€å…³æ³¨å’Œå°Šé‡ï¼Œä¸ç®¡å¤šå¿™ï¼Œèƒ½å¤šæ‰“ä¸€ä¸ªç”µè¯å°±å¤šæ‰“ä¸€ä¸ªç”µè¯ï¼Œèƒ½å¤šåœ¨ä¸€èµ·åƒé¡¿é¥­ï¼Œå°±å¤šåœ¨ä¸€èµ·åƒé¡¿é¥­ï¼Œèƒ½æ»¡è¶³ä»–ä»¬æƒ³è¦çš„ï¼Œä¸ç®¡å¤§å°ï¼Œå°½é‡å»æ»¡è¶³ã€‚å¯èƒ½ä½ æ²¡å¯Ÿè§‰çš„æ˜¯ï¼Œéšç€ä½ çš„é€æ¸æˆé•¿ï¼Œä½ çš„çˆ¶æ¯æ­£é€¼è¿‘æ­»äº¡ï¼</p>
<h4 id="ä¸è¦ç†¬å¤œ"><a href="#ä¸è¦ç†¬å¤œ" class="headerlink" title="ä¸è¦ç†¬å¤œ"></a>ä¸è¦ç†¬å¤œ</h4><p>ç¡çœ å…¶å®çœŸæ­£å†³å®šäº†ç”Ÿå‘½çš„æ•ˆç‡ã€‚å› ä¸ºç¡çœ å†³å®šç€ç¬¬äºŒå¤©çš„å¿ƒæƒ…ã€çŠ¶æ€ã€ä¸“æ³¨åº¦ç­‰ï¼Œè€Œå¿ƒæƒ…ã€çŠ¶æ€ã€ä¸“æ³¨åº¦ç›´æ¥å½±å“ç»“æœï¼Œæˆ‘ä»¬çš„ç°åœ¨å°±æ˜¯ç”±å¤§å¤§å°å°çš„è¿™äº›ç»“æœæ„æˆçš„ã€‚æ‰€ä»¥ç¡ä¸ªå¥½è§‰å¯èƒ½æ˜¯è®©ç”Ÿæ´»å˜å¾—æ›´å¥½çš„æœ€å¤§çš„æ·å¾„ã€‚ä¸è¦ç›¸ä¿¡ä»€ä¹ˆç‹—è¡€æˆåŠŸå‰§ç»å¸¸ç†¬å¤œå°±èƒ½æˆåŠŸï¼ŒæˆåŠŸæ˜¯è®²ç©¶æ•ˆç‡çš„ã€‚</p>
<h4 id="ä¿æŒè‡ªæˆ‘ï¼Œä¸æ–­å®Œå–„"><a href="#ä¿æŒè‡ªæˆ‘ï¼Œä¸æ–­å®Œå–„" class="headerlink" title="ä¿æŒè‡ªæˆ‘ï¼Œä¸æ–­å®Œå–„"></a>ä¿æŒè‡ªæˆ‘ï¼Œä¸æ–­å®Œå–„</h4><p>ä¿æŒè‡ªæˆ‘ï¼Œå¹¶ä¸æ–­å˜å¾—æ›´å¥½ï¼Œå…¶å®åœ¨ä¸€æ®µæ„Ÿæƒ…é‡Œï¼Œè¿œæ¯”å§”æ›²æ±‚å…¨ï¼Œä¸€å‘³åœ°å® æººå¯¹æ–¹ï¼Œæ›´é‡è¦ã€‚ä¿æŒè‡ªæˆ‘å¯ä»¥æµ‹è¯•å‡ºå’Œå¯¹æ–¹æ˜¯å¦åˆæ‹ï¼Œä¸æ–­å˜å¾—æ›´å¥½ï¼Œå¯ä»¥è®©æ„Ÿæƒ…æ›´æ·±åˆ»è€ŒæŒä¹…ã€‚åƒä¸‡ä¸è¦å› ä¸ºå­¤ç‹¬ã€æ— åŠ©ã€çˆ¶æ¯é€¼è¿«ã€ä¸ªäººé¢å­ã€ç„¦è™‘ç­‰åŸå› ä»“ä¿ƒåœ°é€‰æ‹©ä¸€ä¸ªäººã€‚è¿™ä¸ªäººæ˜¯è‡ªå·±ç”Ÿå‘½çš„ä¸€éƒ¨åˆ†ï¼Œå¯¹è‡ªå·±æ–½åŠ ç€æ— ä»¥å¤åŠ åœ°å½±å“ï¼Œæ‰€ä»¥è°¨æ…ç‚¹ï¼Œå³ä¾¿å•èº«éƒ½æ¯”é”™è¯¯å¥½å¾ˆå¤šã€‚</p>
<h4 id="ç”¨æ„Ÿå®˜å»å‘ç°æ›´ç¾å¥½çš„ä¸–ç•Œ"><a href="#ç”¨æ„Ÿå®˜å»å‘ç°æ›´ç¾å¥½çš„ä¸–ç•Œ" class="headerlink" title="ç”¨æ„Ÿå®˜å»å‘ç°æ›´ç¾å¥½çš„ä¸–ç•Œ"></a>ç”¨æ„Ÿå®˜å»å‘ç°æ›´ç¾å¥½çš„ä¸–ç•Œ</h4><p>åˆ©ç”¨æ‰€æœ‰çš„æ„Ÿå®˜å»ä½“éªŒå‘¨é­çš„ä¸–ç•Œæ˜¯é‚£ä¹ˆé‡è¦ï¼Œåˆ»æ„å‘ç°ç”Ÿæ´»çš„ç¾ï¼Œå‘ç°ç»†å¾®å¤„çš„ä¸åŒï¼Œä¼šç»™è‡ªå·±å¸¦æ¥å¾ˆå¤šå°æƒŠå–œ</p>
<blockquote>
<p>æ¥ä¸‹æ¥èŠèŠèŒåœºå‘å±•çš„,äººè¦èˆå¾—æŠ•èµ„è‡ªå·±ï¼Œè¿™æ ·ä½ æ‰ä¼šè¶Šæ¥è¶Šå€¼é’±</p>
</blockquote>
<h4 id="ä¸è¦è®©ä¸“ä¸šé™åˆ¶ä½ çš„é€‰æ‹©"><a href="#ä¸è¦è®©ä¸“ä¸šé™åˆ¶ä½ çš„é€‰æ‹©" class="headerlink" title="ä¸è¦è®©ä¸“ä¸šé™åˆ¶ä½ çš„é€‰æ‹©"></a>ä¸è¦è®©ä¸“ä¸šé™åˆ¶ä½ çš„é€‰æ‹©</h4><p>è®¸å¤šäººæˆ–è®¸éƒ½æ˜¯ä¸€äº›åˆšåˆšæ­¥å…¥ç¤¾ä¼šçš„å­¦ç”Ÿï¼Œå­¦ç”Ÿæ€ç»´çš„ä¸€å¤§å±€é™å°±æ˜¯è§‰å¾—æ‰¾å·¥ä½œåº”è¯¥ä¸“ä¸šè¦å¯¹å£ï¼Œå®é™…ä¸Šä»æˆ‘ä¸ªäººçš„è§‚å¯Ÿæ¥çœ‹ï¼Œå¤§å­¦æ¯•ä¸šåï¼ŒåŒå­¦ä¸­åå€’æ˜¯ä»äº‹æœ¬ä¸“ä¸šçš„å±äºå°ä¼—ï¼Œæˆ‘è§‰å¾—é€ æˆè¿™ä¸ªç°è±¡çš„åŸå› æœ‰ï¼š<br>ï¼ˆ1ï¼‰ä¸€èˆ¬æ¥è¯´ï¼Œå¡«é«˜è€ƒå¿—æ„¿çš„æ—¶å€™ï¼Œä½ æŠ¥çš„ä¸“ä¸šæœªæ¥åˆ°åº•èƒ½åšä»€ä¹ˆå·¥ä½œï¼Œä½ çš„çˆ¶æ¯å¦‚æœä¸å¤ªäº†è§£çš„è¯ï¼Œä½ å¿…å®šä¹Ÿä¸å¤ªäº†è§£ï¼Œå†µä¸”å¾ˆå¤šå­¦ç”ŸæŠ¥çš„ä¸“ä¸šéƒ½æ˜¯é‚£ç§æ‰€è°“çš„çƒ­é—¨ä¸“ä¸šï¼Œæˆ–è€…çˆ¶æ¯ç»™é€‰çš„ï¼Œæˆ–è€…çˆ¶æ¯ä»äº‹çš„ä¸“ä¸šï¼›<br>ï¼ˆ2ï¼‰ä¸Šå¤§å­¦åï¼ŒçœŸæ­£çš„å­¦äº†ä¸“ä¸šè¯¾åï¼Œä½ å¾ˆæœ‰å¯èƒ½å¹¶ä¸æ„Ÿå…´è¶£ï¼Œæˆ–è€…å¹¶ä¸æ“…é•¿ï¼›<br>ï¼ˆ3ï¼‰é™¤äº†å°‘æ•°å¯¹ä¸“ä¸šçŸ¥è¯†è¦æ±‚è¾ƒé«˜çš„ç†å·¥ç§‘ä¸“ä¸šï¼Œå¤§éƒ¨åˆ†ä¸“ä¸šæ¯•ä¸šåå»å…¬å¸å®ä¹ å®Œå…¨å¯ä»¥ææ˜ç™½å·¥ä½œæµç¨‹ã€‚æ‰€ä»¥é™¤äº†é˜ŸæŠ€æœ¯è¦æ±‚è¾ƒé«˜çš„ç†å·¥ç§‘èŒä½ï¼Œå…¶ä»–å¤§å¤šæ•°èŒä½ï¼Œæ¯•ä¸šå»å…¬å¸ï¼Œé€šè¿‡å®é™…å·¥ä½œä¸­å­¦ä¹ ï¼Œæ˜¯å®Œå…¨å¯ä»¥çš„ï¼Œåªè¦ä½ åšäº†æ„Ÿå…´è¶£ï¼Œå¹¶ä¸”æ“…é•¿çš„å·¥ä½œï¼Œå·¥ä½œæŠ€èƒ½éƒ½æ˜¯å­¦çš„å¾ˆå¿«çš„ï¼Œè€Œä¸”åœ¨å…¬å¸é‡Œä½ ä¸æ‡‚çš„é—®é¢˜å¯ä»¥ç›´æ¥é—®èµ„å†è€çš„å‘˜å·¥ï¼Œæ¯”ä½ è‡ªå·±åœ¨å­¦æ ¡é‡Œä¸Šè¯¾æ•ˆç‡é«˜å¤šäº†ï¼Œæˆ‘æœ¬ç§‘å­¦è®¡ç®—æœºçš„ï¼Œç­é‡ŒåŒå­¦æœ‰ä»äº‹åª’ä½“çš„ï¼Œé‡‘èçš„ï¼Œå‡ºç‰ˆç¤¾çš„ï¼Œæˆ¿åœ°äº§çš„ï¼Œè€ƒå…¬åŠ¡å‘˜çš„ï¼Œè¿˜æœ‰ç»å•†çš„ï¼Œåæ­£å¹²å•¥çš„éƒ½æœ‰ï¼Œåªè¦æ˜¯ä½ æ„Ÿå…´è¶£çš„ï¼Œå¹¶ä¸”è§‰å¾—è‡ªå·±èƒ½åšå¥½çš„èŒä½ï¼Œå¤§å¯ä»¥ä¸€è¯•ã€‚</p>
<h4 id="ä¸è¦æ€•çŠ¯é”™ï¼Œå¹´è½»æ²¡æœ‰å¤±è´¥"><a href="#ä¸è¦æ€•çŠ¯é”™ï¼Œå¹´è½»æ²¡æœ‰å¤±è´¥" class="headerlink" title="ä¸è¦æ€•çŠ¯é”™ï¼Œå¹´è½»æ²¡æœ‰å¤±è´¥"></a>ä¸è¦æ€•çŠ¯é”™ï¼Œå¹´è½»æ²¡æœ‰å¤±è´¥</h4><p>ç½‘ä¸Šå¾ˆå¤šäººè¯´è¿‡è¦æ‰¾è‡ªå·±æ“…é•¿çš„å·¥ä½œï¼Œä½†æ˜¯é—®é¢˜æ˜¯ï¼Œä¸€ä»½å·¥ä½œä½ æ²¡å¹²ä¹‹å‰ï¼Œå¾ˆéš¾çŸ¥é“è‡ªå·±åˆ°åº•æ˜¯å¦æ“…é•¿ï¼Œé‚£è¿™ä»½æ“…é•¿çš„å·¥ä½œæˆ–è¡Œä¸šè¦æ€ä¹ˆæ‰¾å‘¢ï¼Ÿç­”æ¡ˆæ˜¯ï¼šå¤šå»å°è¯•ä¸åŒçš„èŒä¸šã€‚å¤§å­¦åˆšæ¯•ä¸šä¸€ä¸¤å¹´ï¼Œå¾ˆæœ‰å¯èƒ½ä½ ç›®å‰ä»äº‹çš„å·¥ä½œå¹¶ä¸æ˜¯ä½ å–œæ¬¢çš„ï¼Œä¹Ÿä¸æ˜¯ä½ ä¸€è¾ˆå­åªèƒ½å¹²è¿™ä¸ªï¼Œå¦‚æœå¹²çš„ä¸å¼€å¿ƒï¼Œå¹¶ä¸”åœ¨å…¬å¸é‡Œå¹²çš„ä¹Ÿä¸ç®—å‡ºè‰²ï¼Œé‚£ä¹ˆï¼Œå¾ˆå¯èƒ½å°±æ˜¯ä½ ä¸æ“…é•¿è¿™ä¸ªè¡Œä¸šï¼Œè¿™ä¸ªæ—¶å€™ï¼Œä»—ç€ä½ å¹´è½»ï¼Œä½ å¤§å¯ä»¥è¾èŒè½¬è¡Œï¼Œ30å²ä¹‹å‰ä½ çš„è½¬è¡Œæˆæœ¬æ˜¯å¾ˆä½çš„ï¼Œå› ä¸ºä½ å¹´è½»ï¼Œå¤§éƒ¨åˆ†å…¬å¸éƒ½ä¼šç»™ä½ ä¸€ä¸ªé¢è¯•çš„æœºä¼šï¼Œç­‰ä½ è¿‡äº†30å²å†æƒ³è½¬è¡Œï¼Œä¹Ÿä¸æ˜¯ä¸å¯èƒ½ï¼Œä½†æ˜¯éš¾åº¦æ¯”20å‡ å²çš„æ—¶å€™ä¼šé«˜å‡ ä¸ªé‡çº§ï¼š<br>ï¼ˆ1ï¼‰ä»å…¬å¸çš„è§’åº¦æ¥çœ‹ï¼Œå…¬å¸æ›´çˆ±åŸ¹å…»å¹´è½»äººï¼›<br>ï¼ˆ2ï¼‰30å²å¾ˆå¯èƒ½ç»“å©šäº†ï¼Œä¸Šæœ‰è€ï¼Œä¸‹æœ‰å°ï¼Œè½¬è¡Œçš„é£é™©ç‰¹åˆ«çš„é«˜ï¼Œå°±æ˜¯æ‰¾1ä¸ªæœˆå·¥ä½œï¼Œå¾ˆå¤šå®¶åº­çš„æˆ¿è´·å°±è¦æ–­ä¾›äº†ï¼Œå¯¼è‡´è¿™ä¸ªå¹´çºªå³ä½¿æƒ³è½¬è¡Œï¼Œéœ€è¦è€ƒè™‘çš„å› ç´ ä¹Ÿä¼šå¤šå¾ˆå¤šã€‚æ‰€ä»¥ï¼Œæœ€å¥½çš„é€‰æ‹©å°±æ˜¯åœ¨ä½ çš„25-30å²ä¹‹é—´è¿™5å¹´é‡Œï¼Œæ‰¾åˆ°ä½ æ“…é•¿çš„è¡Œä¸šæˆ–é¢†åŸŸï¼Œè¿™5å¹´å†…ä½ å¹²çš„ä¸çˆ½å°½å¯ä»¥æ¢ï¼Œä½†æ˜¯æœ€å¥½åœ¨30å²ä¹‹å‰æ‰¾åˆ°è‡ªå·±èƒ½åšä¸€ç”Ÿçš„èŒä¸šï¼Œå¹¶ä¸”ç¨³å®šä¸‹æ¥ã€‚</p>
<h4 id="å¥½å¥½åˆ©ç”¨ä¸‹ç­çš„æ—¶é—´ï¼Œ5å¹´åä¼šç»™ä½ å¸¦æ¥å·¨å¤§çš„æ”¹å˜"><a href="#å¥½å¥½åˆ©ç”¨ä¸‹ç­çš„æ—¶é—´ï¼Œ5å¹´åä¼šç»™ä½ å¸¦æ¥å·¨å¤§çš„æ”¹å˜" class="headerlink" title="å¥½å¥½åˆ©ç”¨ä¸‹ç­çš„æ—¶é—´ï¼Œ5å¹´åä¼šç»™ä½ å¸¦æ¥å·¨å¤§çš„æ”¹å˜"></a>å¥½å¥½åˆ©ç”¨ä¸‹ç­çš„æ—¶é—´ï¼Œ5å¹´åä¼šç»™ä½ å¸¦æ¥å·¨å¤§çš„æ”¹å˜</h4><p>20-25å²çš„å¹´è½»äººï¼Œå¦‚æœæŒ‡æœ›ä¸ä¸Šçˆ¶æ¯ï¼Œåªèƒ½é è‡ªå·±å¥‹æ–—çš„è¯ï¼Œè¯´éš¾å¬ç‚¹ï¼Œä½ éšåçš„å‡ å¹´æ˜¯ä¸åº”è¯¥æœ‰è¿‡å¤šçš„å¨±ä¹ç”Ÿæ´»çš„ã€‚é“ç†å¾ˆç®€å•ï¼Œåœ¨ä½ æ²¡æœ‰è¿‡å¤šçš„å¥½çš„é€‰æ‹©çš„æ—¶å€™ï¼Œå¥½å¥½å·¥ä½œï¼Œå‡èŒåŠ è–ªæ˜¯ä½ èƒ½åšåˆ°çš„é£é™©æœ€å°çš„é€‰æ‹©ï¼ˆåˆ›ä¸šé£é™©å¤ªé«˜ï¼Œä¸é€‚åˆæ™®é€šäººï¼‰ï¼Œè€Œå†³å®šä½ å‡èŒåŠ è–ªçš„å…³é”®å°±æ˜¯ä½ çš„å·¥ä½œæŠ€èƒ½ï¼Œæ‰€ä»¥å¦‚æœä½ æƒ³30å²æ··ä¸ªä¸€å®˜åŠèŒå½“ä¸ªå°ä¸»ç®¡ï¼Œä¸æƒ³å†å½“æ™®é€šæ‰“å·¥ä»”ï¼Œé‚£ä¹ˆï¼Œæœ‰æ•ˆçš„åˆ©ç”¨ä¸‹ç­æ—¶é—´å¥½å¥½çš„ç»™è‡ªå·±å……ç”µæ˜¯ä½ å¿…é¡»è¦åšçš„ã€‚è€Œç°ä»£ç¤¾ä¼šæ¯ä¸ªäººç™½å¤©å¾—ä¸Šè‡³å°‘å…«å°æ—¶çš„ç­ï¼ˆä¸åŠ ç­çš„ä¼ä¸šçœŸæ˜¯è‰¯å¿ƒï¼‰ï¼Œå³ä½¿ä½ æœ‰å¹¸åœ¨ä¸€å®¶ä¸åŠ ç­çš„ä¼ä¸šå·¥ä½œï¼Œæ™šä¸Šä¸‹ç­æŒ¤åœ°é“/å…¬äº¤åˆ°å®¶åƒå®Œé¥­ï¼Œæ´—å®Œæ¾¡ä¹‹åï¼Œæ€ä¹ˆç€ä¹Ÿå¾—8ç‚¹äº†ï¼Œå¦‚æœä½ 12ç‚¹ç¡çš„è¯ï¼ˆåŸºæœ¬å·²æ˜¯æé™ï¼Œå†æ™šç¡ä¼šå½±å“ç™½å¤©çš„å·¥ä½œï¼‰ï¼Œä½ ä¸€å¤©ä¸­æœ‰æ•ˆçš„è¿ç»­å­¦ä¹ æ—¶é—´å°±æ˜¯4å°æ—¶ï¼ˆè¿™æ˜¯æ¯”è¾ƒä¹è§‚çš„ä¼°è®¡ï¼Œè¿˜æœ‰å¾ˆå¤šäººé€šå‹¤æ—¶é—´å°±å¾—1ä¸ªå¤šå°æ—¶ï¼Œæ‰€ä»¥èƒ½æœ‰4ä¸ªå°æ—¶çš„å­¦ä¹ æ—¶é—´çš„äººçœŸæ˜¯å¾ˆå¹¸è¿ï¼‰ï¼Œ4å°æ—¶ï¼Œä¹ä¸€çœ‹ä¸å°‘äº†ï¼Œä½†æ˜¯å®é™…ç”¨èµ·æ¥ï¼Œå‡æ‰ä¸­é—´ä¼‘æ¯ä¸€ä¸‹çš„æ—¶é—´ï¼Œä½ å°±ä¼šå‘ç°ï¼Œæ˜¯å¾ˆç´§å‡‘çš„ï¼Œè€Œä¸”ä¸€æ—¦å¼€å§‹å†³å®šæ™šä¸Šå­¦ä¹ ï¼ŒåŸºæœ¬å°±ä¸èƒ½éš”ä¸‰å·®äº”çš„å’Œæœ‹å‹å‡ºå»æµªäº†ï¼Œå› ä¸ºå°±æ€•ä¸€å‡ºå»ï¼Œæ‰“ç ´äº†å­¦ä¹ æƒ¯æ€§ï¼Œå¿ƒå°±æ•£äº†ï¼Œæ— å¿ƒå†è€å¿ƒå­¦ä¹ ä¸‹å»äº†ï¼Œæ‰€ä»¥å¦‚æœä½ å†³å®šç»™è‡ªå·±å……ç”µï¼Œå‡ ä¹ä¹Ÿå°±å¯ä»¥å‘Šåˆ«å¨±ä¹ç”Ÿæ´»äº†ï¼Œè™½ç„¶è¿™æ ·çš„ç”Ÿæ´»å¾ˆè‹¦ï¼Œä½†æ˜¯äººç”Ÿæ˜¯éœ€è¦è§„åˆ’çš„ï¼Œè‹¥å¹²å¹´åï¼Œä½ åº”è¯¥æ„Ÿè°¢æ›¾ç»é‚£ä¹ˆçš„åŠªåŠ›çš„è‡ªå·±ã€‚ä¸€è¾ˆå­å¾ˆé•¿ï¼Œ25å²æ˜¯ä½ æ’­ç§çš„æ—¶å€™ï¼Œä¸ºçš„æ˜¯æœªæ¥çš„æ”¶è·ã€‚</p>
<h4 id="å¯¹å·¥ä½œçš„çˆ±å¥½æœ€é‡è¦"><a href="#å¯¹å·¥ä½œçš„çˆ±å¥½æœ€é‡è¦" class="headerlink" title="å¯¹å·¥ä½œçš„çˆ±å¥½æœ€é‡è¦"></a>å¯¹å·¥ä½œçš„çˆ±å¥½æœ€é‡è¦</h4><p>çˆ±å¥½æ˜¯æœ€é‡è¦çš„ï¼Œä½ ä¸çˆ±çš„å·¥ä½œå†èµšé’±ä½ ä¹Ÿä¼šå¿§éƒç—‡çš„ï¼Œåˆ°æ—¶å€™æ¯å¤©èµ·åºŠéƒ½æ²¡åŠ¨åŠ›ï¼Œæ¯•ç«Ÿå·¥ä½œæ˜¯åŠè¾ˆå­çš„äº‹æƒ…ã€‚</p>
<h4 id="å®šåˆ¶è‡ªå·±çš„èŒä¸šå‘å±•è®¡åˆ’-æ˜ç¡®è‡ªå·±è¦çš„æ˜¯ä»€ä¹ˆ"><a href="#å®šåˆ¶è‡ªå·±çš„èŒä¸šå‘å±•è®¡åˆ’-æ˜ç¡®è‡ªå·±è¦çš„æ˜¯ä»€ä¹ˆ" class="headerlink" title="å®šåˆ¶è‡ªå·±çš„èŒä¸šå‘å±•è®¡åˆ’,æ˜ç¡®è‡ªå·±è¦çš„æ˜¯ä»€ä¹ˆ"></a>å®šåˆ¶è‡ªå·±çš„èŒä¸šå‘å±•è®¡åˆ’,æ˜ç¡®è‡ªå·±è¦çš„æ˜¯ä»€ä¹ˆ</h4><p>æå‰ç»™è‡ªå·±å®šå¥½è®¡åˆ’ï¼Œé¿å…è®©è‡ªå·±åƒä¸€ä¸ªæ— å¤´è‹è‡èˆ¬åˆ°å¤„ä¹±é£ï¼Œæ˜ç¡®è‡ªå·±æƒ³è¦çš„æ˜¯ä»€ä¹ˆï¼Œè¯¥å¦‚ä½•å»åŠªåŠ›ï¼Œå¯¹è‡ªå·±çš„è´¢äº§ä¹Ÿè¦æœ‰è§„åˆ’ï¼Œå¤šé˜…è¯»ä¸€äº›å…³äºé‡‘èç†è´¢ç±»çš„ä¹¦ç±ã€‚</p>
<blockquote>
<p>æœ€åï¼Œå†æ¥ä¸€ä¸ªæ¯’é¸¡æ±¤æ€»ç»“</p>
</blockquote>
<h4 id="è¿™æ˜¯ä¸€ä¸ªå¸¦æ¯’çš„æ€»ç»“"><a href="#è¿™æ˜¯ä¸€ä¸ªå¸¦æ¯’çš„æ€»ç»“" class="headerlink" title="è¿™æ˜¯ä¸€ä¸ªå¸¦æ¯’çš„æ€»ç»“"></a>è¿™æ˜¯ä¸€ä¸ªå¸¦æ¯’çš„æ€»ç»“</h4><p>åœ¨å¹´è½»çš„æ—¶å€™ï¼Œå³ä½¿ä½ çŸ¥é“å†å¤šâ€œäººç”Ÿçš„é“ç†â€ï¼Œå³ä½¿ä½ ä¸‹äº†å†å¤§çš„å†³å¿ƒï¼Œå³ä½¿ä½ åšäº†å†å‘¨å¯†çš„è®¡åˆ’ã€‚ä½ è¿˜æ˜¯å¯èƒ½ä¸€äº‹æ— æˆã€‚å› ä¸ºä½ å¹¶æ²¡æœ‰åšæŒä¸‹æ¥,é“ç†ä½ éƒ½æ‡‚ï¼Œè¦å¹²ä»€ä¹ˆäº‹å„¿ä¹Ÿéƒ½çŸ¥é“ï¼Œä¸ºä»€ä¹ˆä½ åšä¸åˆ°ï¼Ÿæœ‰è°è®¤çœŸæƒ³è¿‡? </p>
<p>æˆ‘ä»¬ä¹‹æ‰€ä»¥åšä¸åˆ°ï¼Œæ˜¯å› ä¸ºå¤§éƒ¨åˆ†äººï¼Œéƒ½æ— æ³•æŠŠè‡ªå·±çœ¼å‰çš„äº‹æˆ–å³å°†è¦åšçš„äº‹ï¼Œå’Œä»Šåçš„æ”¶ç›Šè”ç³»èµ·æ¥,å› ä¸ºä½ åšæŒäº†ä¸€ä¸ªæœˆå,ä½ å¯èƒ½å°±ä¼šæƒ³ï¼Œæˆ‘è¿™æ ·åšçœŸçš„æœ‰ç”¨å—ï¼Ÿè¿™æ—¶ä½ å°±ä¼šå½·å¾¨ï¼Œç”šè‡³æƒŠæï¼Œæ¯•ç«Ÿï¼Œéš”å±±çš„é‡‘å­ä¸å¦‚é“œ:<br>æˆ‘åˆä¸é å†™ä½œåƒé¥­,çœ‹é‚£ä¹ˆå¤šä¹¦æœ‰ä»€ä¹ˆç”¨å‘¢?<br>ä¸€ä¸ªæœˆå°±é‚£ä¹ˆç‚¹é’±,ç†è´¢æœ‰ä»€ä¹ˆç”¨å‘¢?<br>å·²ç»é•¿é‚£æ ·äº†,å¥èº«æœ‰ä»€ä¹ˆç”¨å‘¢?<br>æˆ‘åˆä¸æƒ³å‡ºå›½ã€ä¸è€ƒå¤–äº¤éƒ¨ã€ä¸å»å¤–ä¼,ä½ è®©æˆ‘åŠªåŠ›æ‰“å¡å­¦è‹±è¯­ä¸æ˜¯æç¬‘å—?<br>â€¦â€¦â€¦<br>äººå¾€å¾€å°±æ˜¯è¿™æ ·,äº‹åˆ°ä¸´å¤´æ‰ä¼šæƒ³åˆ°è¦æŠ±ä½›è„šã€‚<br>é‚£ä¹ˆå¦‚ä½•æ‰èƒ½å»åšæŒï¼Œå…¶å®æˆ‘ä¹Ÿæ²¡ä»€ä¹ˆæ–¹æ³•å¯è¨€ï¼Œé“ç†ä½ éƒ½æ‡‚äº†ï¼Œåšä¸ä¸åšéƒ½æ˜¯ä½ çš„ä¸€å¿µä¹‹é—´,æˆ‘åªèƒ½å‘Šè¯‰ä½ ä¸€ä¸ªé“ç†éœ€è¦ä½ ä»¬è‡ªå·±å»æ‚Ÿï¼š</p>
<p><code>ä½ è¦è®©ä½ æ‰€æœ‰åšçš„äº‹æƒ…ï¼Œéšç€æ—¶é—´å‘å±•äº§ç”Ÿå˜åŒ–</code></p>
<p>ä½ éœ€è¦çš„åªæ˜¯åœ¨å¹´è½»çš„æ—¶å€™å¤šç”¨æ—¶é—´åšèµ„æœ¬ï¼Œå»ä¸ºæœªæ¥åšæŠ•èµ„.<br>å°±èƒ½åœ¨æœªæ¥å–å¾—æ”¶ç›Šåï¼Œä¹°ä¸‹æ›´é‡è¦çš„æ—¶é—´ã€‚<br>äººçš„ä¸€ç”Ÿå¾ˆå®è´µï¼Œé…’è¶³é¥­é¥±ä¹‹ä½™ï¼Œä¸å¦¨å¤šæƒ³æƒ³ï¼Œåšç‚¹ä»€ä¹ˆæ›´æœ‰ç”¨çš„äº‹ï¼Œæ‰èƒ½åœ¨é˜¶å±‚å›ºåŒ–ä¹‹å‰å°½é‡å¾€ä¸Šå¤šè¹¦ä¸€ä¸¤ä¸ªå°é˜¶</p>
<h5 id="å› ä¸ºï¼Œç›¸å¯¹äºä½ ä»Šåçš„æ¯ä¸€å¤©ï¼Œç°åœ¨çš„ä½ éƒ½æ˜¯æœ€å¹´è½»çš„ä½ ã€‚"><a href="#å› ä¸ºï¼Œç›¸å¯¹äºä½ ä»Šåçš„æ¯ä¸€å¤©ï¼Œç°åœ¨çš„ä½ éƒ½æ˜¯æœ€å¹´è½»çš„ä½ ã€‚" class="headerlink" title="å› ä¸ºï¼Œç›¸å¯¹äºä½ ä»Šåçš„æ¯ä¸€å¤©ï¼Œç°åœ¨çš„ä½ éƒ½æ˜¯æœ€å¹´è½»çš„ä½ ã€‚"></a>å› ä¸ºï¼Œç›¸å¯¹äºä½ ä»Šåçš„æ¯ä¸€å¤©ï¼Œç°åœ¨çš„ä½ éƒ½æ˜¯æœ€å¹´è½»çš„ä½ ã€‚</h5><p>å¥½æ–‡é“¾æ¥ï¼š</p>
<ul>
<li><p><a href="https://www.jianshu.com/p/a5448821f9ad" target="_blank" rel="noopener">ã€ä¹ æƒ¯ã€‘ä½ åŸ¹å…»ä¹ æƒ¯çš„æ–¹æ³•å¯èƒ½æ˜¯ä¸ªå‡æ–¹æ³•</a></p>
</li>
<li><p><a href="https://www.jianshu.com/p/93e59aed232a?utm_campaign=maleskine&amp;utm_content=note&amp;utm_medium=pc_all_hots&amp;utm_source=recommendation" target="_blank" rel="noopener">ä½ çš„æ‰€è°“æˆç†Ÿï¼Œä¸è¿‡æ˜¯ç²¾ç¥æ—©è¡°</a></p>
</li>
</ul>
<p>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€“å¸Œæœ›ç”Ÿæ´»å–„å¾…å¦‚æ­¤åŠªåŠ›çš„ä½ â¤â€”â€”â€”â€”â€”â€”â€”â€”â€”-</p>
]]></content>
      
        <categories>
            
            <category> æ„Ÿæ‚Ÿ </category>
            
        </categories>
        
        
    </entry>
    
    <entry>
      <title><![CDATA[å¦‚ä½•å°†ä¸ªäººåŸŸåä¸githubç»‘å®š]]></title>
      <url>/%E5%A6%82%E4%BD%95%E5%B0%86%E4%B8%AA%E4%BA%BA%E5%9F%9F%E5%90%8D%E4%B8%8Egithub%E7%BB%91%E5%AE%9A.html</url>
      <content type="html"><![CDATA[<h1 id="è´­ä¹°ä¸ªäººåŸŸå"><a href="#è´­ä¹°ä¸ªäººåŸŸå" class="headerlink" title="è´­ä¹°ä¸ªäººåŸŸå"></a>è´­ä¹°ä¸ªäººåŸŸå</h1><p>ä¾‹å¦‚æˆ‘çš„æ˜¯åœ¨é˜¿é‡Œäº‘ä¸‡ç½‘è´­ä¹°çš„,ç‚¹å‡»è¿›å…¥åŸŸååˆ—è¡¨,ç‚¹å‡»è§£æ,ä¼šå‡ºç°ä¸€ä¸ªæ·»åŠ è§£ææŒ‰é’®ï¼Œç‚¹å¼€æœ‰è®°å½•ç±»å‹ï¼Œä¸»æœºè®°å½•ï¼Œè§£æçº¿è·¯ï¼Œè®°å½•å€¼ï¼ŒTTLå€¼äº”ä¸ªé€‰é¡¹<br>ä¾æ¬¡å¡«å†™ï¼š</p>
<ul>
<li>è®°å½•ç±»å‹ï¼šA</li>
<li>ä¸»æœºè®°å½•ï¼šwww</li>
<li>è§£æçº¿è·¯ï¼šä¸ç”¨é€‰ï¼Œå°±ç”¨é»˜è®¤</li>
<li>è®°å½•å€¼ï¼šå¡«å†™ä½ çš„githubç½‘å€çš„ip,å¯ä»¥ç”¨ipæŸ¥è¯¢æˆ–pingæŸ¥åˆ°ï¼Œä¸€èˆ¬éƒ½æ˜¯151å¼€å¤´ã€‚</li>
<li>TTLå€¼ï¼šä¸ç”¨ç®¡ï¼Œé»˜è®¤10åˆ†é’Ÿã€‚</li>
</ul>
<p>å¡«å†™å®Œæ¯•åå°±å¯ä»¥å…³é—­é¡µé¢äº†</p>
<h1 id="Githubé…ç½®"><a href="#Githubé…ç½®" class="headerlink" title="Githubé…ç½®"></a>Githubé…ç½®</h1><p>åœ¨ä½ çš„ioç½‘ç«™æœ¬åœ°ä»“åº“ä¸­æ–°å»ºä¸€ä¸ªCHAME(æ³¨æ„éƒ½è¦å¤§å†™)æ–‡ä»¶ï¼Œæ²¡æœ‰åç¼€ï¼Œæ‰“å¼€ç¼–è¾‘ï¼Œå°†ä½ çš„åŸŸåæ·»åŠ è¿›å…¥ï¼Œä¾‹å¦‚æˆ‘çš„å°±æ˜¯www.huangjie.name,ä¿å­˜ï¼Œå…³é—­,å°†æ–‡ä»¶æäº¤åˆ°è¿œç¨‹ä»“åº“,è¿™æ—¶githubåº”è¯¥ä¼šå‘ä¸€å°é‚®ä»¶ç»™ä½ ä»£è¡¨é…ç½®æˆåŠŸï¼Œæ›´æ”¹ä¸ä¼šç«‹å³ç”Ÿæ•ˆï¼Œä¸€èˆ¬10åˆ†é’Ÿå·¦å³</p>
<p>å¦‚æœä½ æ˜¯ç”¨çš„hexoï¼Œå¯ä»¥å°†CHAMEæ–‡ä»¶å»ºç«‹åœ¨sourceæ–‡ä»¶å¤¹ä¸­ï¼Œè¿™æ ·é€šè¿‡Hexoæäº¤åˆ°githubä¸ä¼šè¢«è¦†ç›–</p>
]]></content>
      
        <categories>
            
            <category> Hexo </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Hexo </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Hexoåšå®¢ä½¿ç”¨å¿ƒå¾—]]></title>
      <url>/hello-world.html</url>
      <content type="html"><![CDATA[<p>æ¬¢è¿æ¥åˆ°é»„æ°çš„ä¸ªäººåšå®¢ï¼Œè¿™æ˜¯æˆ‘å†™å…¥çš„ç¬¬ä¸€ç¯‡åšæ–‡,æ­¤åšå®¢å¹³å°é‡‡ç”¨  <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> + <a href="https://github.com/" target="_blank" rel="noopener">githubPages</a>æ­å»ºè€Œæˆ,æ­å»ºæ—¥æœŸï¼š2017/11/29ã€‚è¿™ç¯‡åšå®¢å°†æŒç»­è®°å½•hexoä½¿ç”¨è¿‡ç¨‹ä¸­çš„ä¸€äº›é—®é¢˜<br><a id="more"></a></p>
<h1 id="å¼•è¨€"><a href="#å¼•è¨€" class="headerlink" title="å¼•è¨€"></a>å¼•è¨€</h1><p>è®°å½•ä¸€äº›è‡ªå·±æ­å»ºçš„å‚è€ƒèµ„æ–™</p>
<ul>
<li><a href="http://blog.haoji.me/build-blog-website-by-hexo-github.html?from=xa" target="_blank" rel="noopener">http://blog.haoji.me/build-blog-website-by-hexo-github.html?from=xa</a></li>
<li><a href="https://hexo.io/zh-cn/docs/generating.html" target="_blank" rel="noopener">https://hexo.io/zh-cn/docs/generating.html</a></li>
<li><a href="http://blog.csdn.net/poem_of_sunshine/article/details/2936978" target="_blank" rel="noopener">http://blog.csdn.net/poem_of_sunshine/article/details/2936978</a></li>
<li><a href="http://blog.sunnyxx.com/2014/02/27/hexo_startup/" target="_blank" rel="noopener">http://blog.sunnyxx.com/2014/02/27/hexo_startup/</a></li>
</ul>
<h1 id="å¸¸ç”¨å‘½ä»¤"><a href="#å¸¸ç”¨å‘½ä»¤" class="headerlink" title="å¸¸ç”¨å‘½ä»¤"></a>å¸¸ç”¨å‘½ä»¤</h1><p>è¿›å…¥é¡¹ç›®ä¸»ç»“æ„ï¼Œä½¿ç”¨git bashæ‰§è¡Œå‘½ä»¤</p>
<ul>
<li>ç›‘å¬æ–‡ä»¶å˜åŠ¨  <code>$ hexo g</code></li>
<li>å¼€å¯æœ¬åœ°æœåŠ¡ <code>$ hexo s</code> ï¼Œå¼€å¯ååœ¨æµè§ˆå™¨è¾“å…¥<a href="http://localhost:4000" target="_blank" rel="noopener">http://localhost:4000</a> å³å¯è®¿é—®</li>
<li>æäº¤ä»£ç  <code>$ hexo d</code>  ï¼Œéœ€è¦é…ç½®deploy</li>
</ul>
<p>åœ¨ä¸»é¡¹ç›®ç›®å½•ä¸‹æœ‰ä¸ª_config.yml,ä¸ºå…¨å±€é…ç½®æ–‡ä»¶,åœ¨themesæ–‡ä»¶å¤¹é‡Œï¼Œå­˜æ”¾ç€ç½‘ç«™ä½¿ç”¨çš„ä¸»é¢˜æ–‡ä»¶ï¼Œæ‰“å¼€ä¸»é¢˜æ–‡ä»¶å¤¹ï¼Œé‡Œé¢ä¹Ÿæœ‰ä¸ª_config.ymlï¼Œä¸ºä¸»é¢˜é…ç½®æ–‡ä»¶ï¼Œä¸ä¸»é¢˜ç›¸å…³çš„åœ¨è¿™é‡Œé…ç½®ï¼Œæˆ‘ç°åœ¨é‡‡ç”¨çš„æ˜¯<a href="https://github.com/iissnan/hexo-theme-next" target="_blank" rel="noopener">Next</a>ä¸»é¢˜</p>
<h1 id="é‡åˆ°çš„é—®é¢˜"><a href="#é‡åˆ°çš„é—®é¢˜" class="headerlink" title="é‡åˆ°çš„é—®é¢˜"></a>é‡åˆ°çš„é—®é¢˜</h1><h4 id="ä¸€-é¦–é¡µçš„æ–‡ç« å†…å®¹å…¨éƒ¨æ˜¾ç¤ºå‡ºæ¥äº†ï¼Œæ²¡æœ‰â€œé˜…è¯»å…¨æ–‡â€"><a href="#ä¸€-é¦–é¡µçš„æ–‡ç« å†…å®¹å…¨éƒ¨æ˜¾ç¤ºå‡ºæ¥äº†ï¼Œæ²¡æœ‰â€œé˜…è¯»å…¨æ–‡â€" class="headerlink" title="ä¸€.é¦–é¡µçš„æ–‡ç« å†…å®¹å…¨éƒ¨æ˜¾ç¤ºå‡ºæ¥äº†ï¼Œæ²¡æœ‰â€œé˜…è¯»å…¨æ–‡â€?"></a>ä¸€.é¦–é¡µçš„æ–‡ç« å†…å®¹å…¨éƒ¨æ˜¾ç¤ºå‡ºæ¥äº†ï¼Œæ²¡æœ‰â€œé˜…è¯»å…¨æ–‡â€?</h4><h5 id="è§£å†³åŠæ³•"><a href="#è§£å†³åŠæ³•" class="headerlink" title="è§£å†³åŠæ³•"></a>è§£å†³åŠæ³•</h5><p>æœ‰ä¸¤ç§æ–¹æ³•</p>
<p>ç¬¬ä¸€ç§ï¼š<br>åœ¨ä¸»é¢˜é…ç½®æ–‡ä»¶é‡Œ(themes/next/_config.yml)ç”¨ç¼–è¾‘å™¨æ‰“å¼€ï¼Œæ‰¾åˆ°<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># Automatically Excerpt. Not recommend.</span><br><span class="line"># Please use &lt;!-- more --&gt; in the post to control excerpt accurately.</span><br><span class="line">auto_excerpt:</span><br><span class="line">  enable: false</span><br><span class="line">  length: 150</span><br></pre></td></tr></table></figure></p>
<p>å°† <code>enableï¼šfalse</code> æ”¹ä¸º<code>true</code>å°±è¡Œäº†ï¼Œåé¢çš„<code>length:150</code>ä»£è¡¨æ˜¾ç¤ºçš„æ–‡æœ¬å­—æ•°ã€‚</p>
<p>ç¬¬äºŒç§ï¼š<br>ç›´æ¥åœ¨ç¼–è¾‘çš„.mdæ–‡ä»¶é‡Œå°†è¦é¢„è§ˆçš„æ–‡å­—åé¢åŠ ä¸Š<code>&lt;!--more--&gt;</code>,è¿™æ ·ä¹‹å‰çš„å°±æ˜¯é¢„è§ˆçš„æ–‡å­—,åé¢çš„å°±ä¸ä¼šæ˜¾ç¤ºäº†</p>
<h4 id="äºŒ-å¦‚ä½•å°†README-mdæ–‡ä»¶ä¼ åˆ°githubè€Œä¸è¢«ç¼–è¯‘æˆhtml"><a href="#äºŒ-å¦‚ä½•å°†README-mdæ–‡ä»¶ä¼ åˆ°githubè€Œä¸è¢«ç¼–è¯‘æˆhtml" class="headerlink" title="äºŒ.å¦‚ä½•å°†README.mdæ–‡ä»¶ä¼ åˆ°githubè€Œä¸è¢«ç¼–è¯‘æˆhtml"></a>äºŒ.å¦‚ä½•å°†README.mdæ–‡ä»¶ä¼ åˆ°githubè€Œä¸è¢«ç¼–è¯‘æˆhtml</h4><p>åœ¨Hexoç›®å½•çš„sourceç›®å½•åœ¨å»ºç«‹ä¸€ä¸ªREADME.mdæ–‡ä»¶,ä¿®æ”¹Hexoç›®å½•çš„_config.ymlé…ç½®,æ‰¾åˆ° skip_renderå‚æ•°è®¾ç½®,åé¢åŠ ä¸Š README.md,å…³é—­ä¿å­˜,ä¹‹åç¼–è¯‘å°±ä¸ä¼šæ¸²æŸ“README.mdè¿™ä¸ªæ–‡ä»¶äº†</p>
<h4 id="ä¸‰-ç™¾åº¦æœç´¢å¼•æ“ä¸èƒ½æ”¶å½•è‡ªå·±çš„ç½‘ç«™åœ°å€"><a href="#ä¸‰-ç™¾åº¦æœç´¢å¼•æ“ä¸èƒ½æ”¶å½•è‡ªå·±çš„ç½‘ç«™åœ°å€" class="headerlink" title="ä¸‰.ç™¾åº¦æœç´¢å¼•æ“ä¸èƒ½æ”¶å½•è‡ªå·±çš„ç½‘ç«™åœ°å€"></a>ä¸‰.ç™¾åº¦æœç´¢å¼•æ“ä¸èƒ½æ”¶å½•è‡ªå·±çš„ç½‘ç«™åœ°å€</h4><p>åŸå› æ˜¯githubå±è”½äº†ç™¾åº¦çš„spiderçˆ¬è™«,å¯¼è‡´ç™¾åº¦ä¸èƒ½æ”¶å½•,è§£å†³åŠæ³•æ˜¯ä½¿ç”¨codingæ¥æ‰˜ç®¡å›½å†…çš„æµé‡è®¿é—®,å…·ä½“çš„æ–¹æ³•å¯ä»¥å‚è€ƒè¿™ç¯‡åšæ–‡:<a href="http://blog.csdn.net/sunshine940326/article/details/70936988" target="_blank" rel="noopener">hexoé«˜é˜¶æ•™ç¨‹ï¼šæƒ³è®©ä½ çš„åšå®¢è¢«æ›´å¤šçš„äººåœ¨æœç´¢å¼•æ“ä¸­æœåˆ°å—ï¼Ÿ</a></p>
<h1 id="å†™ä½œæŠ€å·§è®°å½•"><a href="#å†™ä½œæŠ€å·§è®°å½•" class="headerlink" title="å†™ä½œæŠ€å·§è®°å½•"></a>å†™ä½œæŠ€å·§è®°å½•</h1><h4 id="ä¸€-å¦‚ä½•å°†mdæ–‡ä»¶ä»¥æ—¶é—´å‘½å"><a href="#ä¸€-å¦‚ä½•å°†mdæ–‡ä»¶ä»¥æ—¶é—´å‘½å" class="headerlink" title="ä¸€.å¦‚ä½•å°†mdæ–‡ä»¶ä»¥æ—¶é—´å‘½å"></a>ä¸€.å¦‚ä½•å°†mdæ–‡ä»¶ä»¥æ—¶é—´å‘½å</h4><p>  åœ¨_config.ymlä¸­æ‰¾åˆ°new_post_name,ä¿®æ”¹åç§°ä¸º<code>:year-:month-:day-:title.md</code>,è¿™æ ·åˆ›å»ºçš„æ–‡ä»¶å°±ä¼šä»¥ç”µè„‘æ—¶é—´å‘½åï¼Œä½¿ç”¨æ—¶é—´å‘½åå¯ä»¥æ›´æ–¹ä¾¿çš„ç®¡ç†æ–‡ç« </p>
]]></content>
      
        <categories>
            
            <category> Hexo </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Hexo </tag>
            
        </tags>
        
    </entry>
    
  
  
    
    <entry>
      <title><![CDATA[tags]]></title>
      <url>/tags/index.html</url>
      <content type="html"></content>
    </entry>
    
    <entry>
      <title></title>
      <url>/about/index.html</url>
      <content type="html"><![CDATA[<h1 id="About-Me"><a href="#About-Me" class="headerlink" title="About Me"></a>About Me</h1><blockquote>
<p>Android å°ç”Ÿä¸€æšï¼Œè½»å¾®å¼ºè¿«ç—‡æ‚£è€…ï¼Œéå¤„å¥³åº§ï¼Œå¿ å®è°·ç²‰å…¼æœç²‰ï¼Œå–œæ¬¢çœ‹ä¹¦å¬æ­Œæ—…æ¸¸,å–œæ¬¢ç ”ç©¶å„ç§æ–°æŠ€æœ¯~~</p>
</blockquote>
<p>è”ç³»æˆ‘:</p>
<ul>
<li>Email(QQ): jay@huangjie.name</li>
<li>Github : <a href="https://github.com/Jay-huangjie" target="_blank" rel="noopener">Jay-huangjie</a></li>
<li>QQ: 289223562</li>
<li>CSDN: <a href="http://blog.csdn.net/qq289223562" target="_blank" rel="noopener">_æ°å“¥</a></li>
<li>ç®€ä¹¦:<a href="https://www.jianshu.com/u/2334b8b9f764" target="_blank" rel="noopener">æˆ‘æ˜¯é»„æ•™ä¸»å•Š</a></li>
</ul>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[åˆ†ç±»]]></title>
      <url>/categories/index.html</url>
      <content type="html"></content>
    </entry>
    
  
</search>
